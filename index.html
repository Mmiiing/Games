<!DOCTYPE html>
<html lang="ko">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>ì°í‘¸ë“œ â€” ë‹¹ì‹ ì˜ ìŒì‹ê³¼ ì°ì€?</title>
<link href="https://fonts.googleapis.com/css2?family=Noto+Serif+KR:wght@400;700;900&family=Noto+Sans+KR:wght@300;400;500&display=swap" rel="stylesheet">
<style>
  :root {
    --cream: #FAF3E8; --toast: #D4956A; --caramel: #B8622A; --dark: #2C1810;
    --muted: #7A5C4A; --accent: #E8734A; --green: #5A7A52;
    --border: rgba(180,130,90,0.25);
    --story-blue: #4a5fa0; --story-bg: #f0f4ff; --story-border: rgba(100,130,220,.25);
    --rec-red: #E8453C; --rec-red-glow: rgba(232,69,60,0.2);
  }
  * { margin:0; padding:0; box-sizing:border-box; }
  body { background:var(--cream); font-family:'Noto Sans KR',sans-serif; color:var(--dark); min-height:100vh; overflow-x:hidden; }
  body::before { content:''; position:fixed; inset:0; background-image:radial-gradient(circle at 20% 20%,rgba(212,149,106,.08) 0%,transparent 50%),radial-gradient(circle at 80% 80%,rgba(91,122,82,.06) 0%,transparent 50%); pointer-events:none; z-index:0; }
  .page { display:none; position:relative; z-index:1; min-height:100vh; }
  .page.active { display:flex; flex-direction:column; }

  /* SPLASH */
  #page-splash { align-items:center; justify-content:center; background:linear-gradient(160deg,#FFF9F0 0%,#FAF0E0 40%,#F5E8CC 100%); text-align:center; padding:40px 20px; }
  .splash-title { font-family:'Noto Serif KR',serif; font-size:clamp(28px,8vw,52px); font-weight:900; color:var(--dark); line-height:1.25; letter-spacing:-1px; margin-bottom:10px; animation:fadeUp .8s ease both; }
  .splash-title em { color:var(--caramel); font-style:normal; }
  .splash-sub { font-size:14px; color:var(--muted); margin-bottom:44px; animation:fadeUp .8s .15s ease both; opacity:0; animation-fill-mode:both; }
  .splash-chars { display:flex; gap:12px; align-items:flex-end; justify-content:center; flex-wrap:wrap; margin-bottom:48px; animation:fadeUp .8s .25s ease both; opacity:0; animation-fill-mode:both; }
  .splash-char { display:flex; flex-direction:column; align-items:center; gap:6px; animation:bobble 2s ease-in-out infinite; }
  .splash-char:nth-child(2){animation-delay:.2s;} .splash-char:nth-child(3){animation-delay:.4s;} .splash-char:nth-child(4){animation-delay:.6s;}
  .splash-char svg { width:70px; height:78px; filter:drop-shadow(0 6px 12px rgba(44,24,16,.13)); }
  .splash-char-name { font-size:11px; font-weight:700; color:var(--muted); letter-spacing:.5px; }
  @keyframes bobble { 0%,100%{transform:translateY(0)} 50%{transform:translateY(-10px)} }
  .splash-btn { padding:16px 52px; border-radius:50px; border:none; background:linear-gradient(135deg,var(--caramel),var(--accent)); color:white; font-size:18px; font-weight:700; cursor:pointer; font-family:'Noto Serif KR',serif; box-shadow:0 8px 24px rgba(184,98,42,.35); transition:all .25s; animation:fadeUp .8s .4s ease both; opacity:0; animation-fill-mode:both; }
  .splash-btn:hover { transform:translateY(-3px); box-shadow:0 12px 32px rgba(184,98,42,.45); }

  /* LAYOUT */
  .page-wrap { max-width:640px; margin:0 auto; width:100%; padding:0 20px 80px; flex:1; }
  .page-header { text-align:center; padding:44px 0 28px; }
  .page-tag { display:inline-block; background:var(--toast); color:white; font-size:11px; letter-spacing:2px; padding:5px 14px; border-radius:20px; margin-bottom:14px; font-weight:500; }
  .page-header h2 { font-family:'Noto Serif KR',serif; font-size:clamp(22px,5vw,32px); font-weight:900; line-height:1.3; letter-spacing:-.5px; }
  .page-header h2 em { color:var(--caramel); font-style:normal; }
  .page-header p { margin-top:10px; color:var(--muted); font-size:13px; line-height:1.7; }

  /* QUIZ */
  .quiz-card { background:linear-gradient(135deg,#FFF9F0,#FFF3E0); border-radius:20px; padding:26px; border:1.5px solid rgba(212,149,106,.3); box-shadow:0 4px 24px rgba(44,24,16,.06); }
  .quiz-progress { display:flex; gap:6px; margin-bottom:10px; }
  .quiz-dot { height:4px; flex:1; border-radius:2px; background:var(--border); transition:background .3s; }
  .quiz-dot.active{background:var(--toast);} .quiz-dot.done{background:var(--caramel);}
  .quiz-step-label { font-size:11px; color:var(--muted); margin-bottom:18px; letter-spacing:.5px; font-weight:600; }
  .quiz-question { font-family:'Noto Serif KR',serif; font-size:18px; font-weight:700; line-height:1.5; margin-bottom:20px; color:var(--dark); }
  .quiz-options { display:grid; grid-template-columns:1fr 1fr; gap:10px; }
  .quiz-option { padding:14px 12px; border-radius:14px; border:2px solid var(--border); background:white; cursor:pointer; font-size:13px; color:var(--dark); text-align:center; line-height:1.4; transition:all .2s; font-family:'Noto Sans KR',sans-serif; }
  .quiz-option:hover { border-color:var(--toast); background:#FFF8F0; transform:translateY(-2px); }
  .quiz-option.selected { border-color:var(--caramel); background:linear-gradient(135deg,#FFF0E0,#FFE8CC); font-weight:500; }
  .quiz-option .opt-emoji { display:block; font-size:24px; margin-bottom:6px; }
  .btn-next { width:100%; padding:15px; border-radius:12px; border:none; background:var(--dark); color:white; font-size:15px; font-weight:700; cursor:pointer; font-family:'Noto Serif KR',serif; transition:all .2s; margin-top:18px; }
  .btn-next:hover { background:var(--caramel); transform:translateY(-2px); }
  .btn-prev { flex:0 0 auto; padding:13px 20px; border-radius:12px; border:2px solid var(--border); background:white; color:var(--muted); font-size:14px; font-weight:600; cursor:pointer; font-family:"Noto Serif KR",serif; transition:all .2s; margin-top:18px; }
  .btn-prev:hover { border-color:var(--toast); color:var(--toast); transform:translateY(-2px); }
  .quiz-nav-row { display:flex; gap:10px; align-items:flex-end; }
  .quiz-nav-row .btn-next { flex:1; margin-top:18px; }
  #prev-only-wrap { margin-top:14px; }

  /* â•â• RECORD PAGE â•â• */
  #page-record { background:var(--cream); }
  .record-wrap { max-width:640px; margin:0 auto; padding:0 20px 80px; flex:1; }

  /* Food input card */
  .food-input-card {
    background:linear-gradient(135deg,#FFF9F0,#FFF3E0);
    border-radius:20px; padding:22px;
    border:1.5px solid rgba(212,149,106,.3);
    box-shadow:0 4px 24px rgba(44,24,16,.06);
    margin-bottom:18px;
  }
  .food-input-card label { display:block; font-size:12px; font-weight:700; color:var(--muted); letter-spacing:.5px; margin-bottom:10px; }
  .food-input-row { display:flex; gap:10px; align-items:center; }
  .food-text-input {
    flex:1; padding:13px 16px;
    border-radius:12px; border:2px solid var(--border);
    background:#FDFAF6; font-size:15px; color:var(--dark);
    font-family:'Noto Sans KR',sans-serif; outline:none;
    transition:border-color .2s;
  }
  .food-text-input:focus { border-color:var(--toast); }
  .food-text-input::placeholder { color:rgba(122,92,74,.4); }
  .food-emoji-btn { font-size:26px; flex-shrink:0; cursor:default; }

  /* Theme chips */
  .theme-row { margin-top:14px; }
  .theme-chips-label { font-size:11px; font-weight:700; color:var(--muted); letter-spacing:.5px; margin-bottom:8px; }
  .theme-chips { display:flex; flex-wrap:wrap; gap:7px; }
  .theme-chip { padding:6px 14px; border-radius:20px; border:1.5px solid var(--border); background:transparent; font-size:12px; color:var(--muted); cursor:pointer; transition:all .2s; font-family:'Noto Sans KR',sans-serif; }
  .theme-chip:hover { border-color:var(--toast); color:var(--toast); }
  .theme-chip.active { background:var(--dark); border-color:var(--dark); color:white; }

  /* Recorder Zone */
  .recorder-zone {
    background:white;
    border-radius:24px; padding:28px 24px;
    border:2px solid var(--border);
    box-shadow:0 4px 24px rgba(44,24,16,.06);
    margin-bottom:18px;
    text-align:center;
    transition:border-color .3s, box-shadow .3s;
  }
  .recorder-zone.recording {
    border-color:var(--rec-red);
    box-shadow:0 0 0 4px var(--rec-red-glow), 0 8px 32px rgba(44,24,16,.08);
  }

  /* Waveform */
  .waveform-container {
    height:52px; display:flex;
    align-items:center; justify-content:center;
    gap:3px; margin-bottom:16px;
  }
  .wave-bar {
    width:3px; border-radius:2px;
    background:rgba(180,130,90,0.2);
    transition:background .3s;
  }
  .recording .wave-bar {
    background:var(--rec-red);
    animation:waveDance var(--dur,.6s) ease-in-out infinite alternate;
    animation-delay:var(--delay,0s);
  }
  @keyframes waveDance { from{height:4px} to{height:var(--max-h,36px)} }

  /* Timer */
  .rec-timer {
    font-family:'Noto Serif KR',serif;
    font-size:40px; font-weight:900;
    letter-spacing:3px; color:var(--dark);
    margin-bottom:6px; transition:color .3s;
  }
  .recording .rec-timer { color:var(--rec-red); }
  .rec-status-row {
    display:flex; align-items:center; justify-content:center;
    gap:7px; margin-bottom:22px; min-height:20px;
  }
  .rec-live-dot {
    width:7px; height:7px; border-radius:50%;
    background:var(--rec-red);
    display:none;
    animation:dotBlink 1s ease-in-out infinite;
  }
  .recording .rec-live-dot { display:block; }
  @keyframes dotBlink{0%,100%{opacity:1}50%{opacity:.2}}
  .rec-status-text { font-size:12px; color:var(--muted); }

  /* Record button */
  .rec-btn-outer {
    display:flex; flex-direction:column;
    align-items:center; gap:12px;
  }
  .rec-btn {
    width:80px; height:80px; border-radius:50%;
    border:none; cursor:pointer;
    display:flex; align-items:center; justify-content:center;
    font-size:34px;
    transition:all .25s cubic-bezier(.34,1.56,.64,1);
    background:linear-gradient(135deg,var(--caramel),var(--accent));
    box-shadow:0 6px 24px rgba(184,98,42,.35);
  }
  .rec-btn:hover { transform:scale(1.08); }
  .rec-btn:active { transform:scale(0.95); }
  .rec-btn.recording-active {
    background:linear-gradient(135deg,var(--rec-red),#FF7A72);
    box-shadow:0 0 0 8px var(--rec-red-glow), 0 6px 24px rgba(232,69,60,.3);
    animation:recPulse 1.5s ease-in-out infinite;
  }
  @keyframes recPulse{0%,100%{box-shadow:0 0 0 8px rgba(232,69,60,.2),0 6px 24px rgba(232,69,60,.3)}50%{box-shadow:0 0 0 14px rgba(232,69,60,.08),0 6px 24px rgba(232,69,60,.3)}}
  .rec-btn-label { font-size:12px; color:var(--muted); font-weight:500; }

  /* Processing overlay */
  .rec-processing {
    display:none;
    flex-direction:column;
    align-items:center;
    gap:10px;
    padding:20px 0 4px;
  }
  .rec-processing.show { display:flex; }
  .proc-spinner { width:32px; height:32px; border:3px solid var(--border); border-top-color:var(--toast); border-radius:50%; animation:spin .8s linear infinite; }
  @keyframes spin{to{transform:rotate(360deg)}}
  .proc-text { font-size:13px; color:var(--muted); }

  /* RESULT */
  #page-result { background:var(--cream); }
  .result-wrap { max-width:640px; margin:0 auto; padding:40px 20px 80px; }
  .result-loading-screen { display:flex; flex-direction:column; align-items:center; justify-content:center; min-height:70vh; gap:20px; text-align:center; }
  .result-loading-screen p { font-size:14px; color:var(--muted); line-height:1.8; }
  .big-spinner { width:52px; height:52px; border:4px solid var(--border); border-top-color:var(--toast); border-radius:50%; animation:spin .9s linear infinite; }

  /* Loading steps */
  .loading-steps { margin-top:16px; display:flex; flex-direction:column; gap:8px; text-align:left; }
  .loading-step-item {
    display:flex; align-items:center; gap:10px;
    padding:10px 14px; border-radius:12px;
    font-size:12px; color:var(--muted);
    background:white; border:1px solid var(--border);
    transition:all .3s;
  }
  .loading-step-item.active { color:var(--toast); border-color:rgba(212,149,106,.4); background:#FFF8F0; }
  .loading-step-item.done { color:var(--green); border-color:rgba(90,122,82,.3); }
  .loading-step-icon { font-size:16px; }

  /* Section header */
  .result-section-header { text-align:center; padding:28px 0 18px; }
  .result-badge { display:inline-flex; align-items:center; gap:6px; color:white; font-size:11px; letter-spacing:2px; padding:6px 16px; border-radius:20px; margin-bottom:10px; font-weight:700; }
  .result-badge.warm { background:linear-gradient(135deg,var(--caramel),var(--accent)); }
  .result-badge.cool { background:linear-gradient(135deg,#4a5fa0,#6678cc); }
  .result-section-title { font-family:'Noto Serif KR',serif; font-size:16px; font-weight:700; color:var(--dark); }

  /* Section divider */
  .section-divider { display:flex; align-items:center; gap:12px; margin:28px 0 20px; }
  .section-divider-line { flex:1; height:1px; background:linear-gradient(90deg,transparent,var(--border),transparent); }
  .section-divider-label { font-family:'Noto Serif KR',serif; font-size:11px; font-weight:700; letter-spacing:2px; color:var(--muted); white-space:nowrap; padding:6px 14px; background:white; border:1px solid var(--border); border-radius:20px; }

  /* PERSONALITY CARD */
  .personality-card { background:white; border-radius:24px; padding:28px; border:1.5px solid rgba(212,149,106,.3); box-shadow:0 8px 32px rgba(44,24,16,.08); margin-bottom:14px; text-align:center; animation:popIn .5s cubic-bezier(.34,1.56,.64,1) both; }
  .personality-emoji { font-size:52px; display:block; margin-bottom:12px; }
  .personality-char-svg { display:flex; justify-content:center; margin-bottom:16px; }
  .personality-char-svg svg { width:110px; height:120px; filter:drop-shadow(0 8px 18px rgba(44,24,16,.15)); animation:bobble 2.5s ease-in-out infinite; }
  @keyframes bobble { 0%,100%{transform:translateY(0)} 50%{transform:translateY(-10px)} }
  .personality-food-type { font-family:'Noto Serif KR',serif; font-size:24px; font-weight:900; color:var(--caramel); margin-bottom:8px; }
  .personality-type-tag { display:inline-block; padding:5px 14px; background:rgba(212,149,106,.12); border:1px solid rgba(212,149,106,.3); border-radius:20px; font-size:12px; font-weight:600; color:var(--caramel); margin-bottom:14px; }
  .personality-desc { font-size:14px; color:var(--muted); line-height:1.85; text-align:left; padding:14px 16px; background:rgba(212,149,106,.05); border-radius:12px; border-left:3px solid var(--toast); }

  /* QUIZ AI BOX */
  .quiz-ai-box { background:linear-gradient(135deg,#FFF9F0,#FFF3E0); border-radius:16px; padding:20px; border:1.5px solid rgba(212,149,106,.3); margin-bottom:14px; animation:popIn .5s .1s cubic-bezier(.34,1.56,.64,1) both; }
  .quiz-ai-box-title { font-family:'Noto Serif KR',serif; font-size:14px; font-weight:700; color:var(--caramel); margin-bottom:14px; display:flex; align-items:center; gap:8px; }
  .quiz-ai-content { font-size:13px; color:var(--dark); line-height:1.9; }
  .q-ai-section { margin-bottom:14px; padding-bottom:14px; border-bottom:1px dashed rgba(212,149,106,.2); }
  .q-ai-section:last-child { border-bottom:none; margin-bottom:0; padding-bottom:0; }
  .q-ai-section-title { font-size:11px; font-weight:700; color:var(--toast); letter-spacing:1px; margin-bottom:8px; }
  .q-ai-tag { display:inline-block; margin:4px 3px 0; padding:3px 10px; background:rgba(212,149,106,.12); color:var(--caramel); border-radius:12px; font-size:11px; font-weight:600; }

  /* QUIZ RECAP */
  .quiz-recap-card { background:white; border-radius:20px; padding:20px; border:1px solid var(--border); box-shadow:0 4px 24px rgba(44,24,16,.05); margin-bottom:14px; animation:popIn .5s .2s cubic-bezier(.34,1.56,.64,1) both; }
  .recap-title { font-size:11px; color:var(--muted); letter-spacing:1px; font-weight:600; margin-bottom:12px; }
  .recap-q { margin-bottom:8px; border-radius:12px; overflow:hidden; border:1px solid var(--border); }
  .recap-q-text { font-size:12px; font-weight:700; color:var(--dark); padding:9px 12px; background:rgba(44,24,16,.04); border-bottom:1px solid var(--border); line-height:1.4; }
  .recap-opt-chosen { display:flex; align-items:center; gap:8px; padding:8px 12px; font-size:13px; font-weight:600; color:var(--dark); background:linear-gradient(90deg,#FFF0E0,#FFF8F4); }
  .recap-check { width:18px; height:18px; border-radius:50%; background:var(--caramel); display:flex; align-items:center; justify-content:center; font-size:10px; color:white; flex-shrink:0; }

  /* CHARACTER CARD */
  .character-card { background:white; border-radius:24px; padding:24px; border:1.5px solid var(--story-border); box-shadow:0 8px 32px rgba(44,24,16,.08); margin-bottom:14px; animation:popIn .5s .05s cubic-bezier(.34,1.56,.64,1) both; }
  .character-card-inner { display:flex; gap:18px; align-items:flex-start; }
  .char-img-wrap { width:130px; height:130px; border-radius:20px; background:linear-gradient(135deg,#f0f4ff,#e8ecff); border:2px solid var(--story-border); display:flex; align-items:center; justify-content:center; overflow:hidden; flex-shrink:0; transition:background .5s; }
  .char-img { width:100%; height:100%; object-fit:cover; }
  .char-loading-inner { display:flex; flex-direction:column; align-items:center; gap:8px; color:var(--muted); font-size:11px; text-align:center; padding:8px; }
  .small-spinner { width:24px; height:24px; border:3px solid var(--border); border-top-color:var(--toast); border-radius:50%; animation:spin .8s linear infinite; }
  .character-info { flex:1; min-width:0; }
  .character-food-name { font-family:'Noto Serif KR',serif; font-size:20px; font-weight:900; color:var(--story-blue); margin-bottom:6px; }
  .character-sub-tag { display:inline-block; padding:4px 12px; background:linear-gradient(135deg,#f0f4ff,#e8ecff); border:1px solid var(--story-border); border-radius:20px; font-size:11px; font-weight:600; color:var(--story-blue); margin-bottom:10px; }
  .character-base-desc { font-size:13px; color:var(--muted); line-height:1.7; }

  /* MOOD BADGE */
  .mood-badge { display:inline-flex; align-items:center; gap:5px; padding:4px 12px; border-radius:20px; font-size:11px; font-weight:700; margin-bottom:8px; border:1px solid; }

  /* CHARACTER TRAITS CARD */
  .character-traits-card { border-radius:20px; padding:22px; margin-bottom:14px; animation:popIn .5s .12s cubic-bezier(.34,1.56,.64,1) both; border:1.5px solid var(--story-border); background:linear-gradient(135deg,#f0f4ff,#eaedff); }
  .character-traits-title { font-family:'Noto Serif KR',serif; font-size:14px; font-weight:700; color:var(--story-blue); margin-bottom:14px; display:flex; align-items:center; gap:8px; }
  .trait-item { display:flex; gap:12px; align-items:flex-start; padding:12px 14px; background:white; border-radius:12px; margin-bottom:8px; border:1px solid rgba(100,130,220,.12); }
  .trait-item:last-child { margin-bottom:0; }
  .trait-icon { font-size:20px; flex-shrink:0; }
  .trait-text { font-size:13px; color:var(--dark); line-height:1.7; }
  .trait-text strong { color:var(--story-blue); font-weight:700; display:block; font-size:11px; margin-bottom:3px; letter-spacing:.5px; }

  /* STORY (TRANSCRIPT) AI BOX */
  .story-ai-box { background:linear-gradient(135deg,#f0f4ff,#e8f0fe); border-radius:16px; padding:20px; border:1.5px solid var(--story-border); margin-bottom:14px; animation:popIn .5s .2s cubic-bezier(.34,1.56,.64,1) both; }
  .story-ai-box-title { font-family:'Noto Serif KR',serif; font-size:14px; font-weight:700; color:#3a56b0; margin-bottom:14px; display:flex; align-items:center; gap:8px; }
  .story-ai-content { font-size:13px; color:#2a3a6a; line-height:1.9; }
  .ai-section { margin-bottom:14px; padding-bottom:14px; border-bottom:1px dashed rgba(100,130,220,.2); }
  .ai-section:last-child { border-bottom:none; margin-bottom:0; padding-bottom:0; }
  .ai-section-title { font-size:11px; font-weight:700; color:#7a90cc; letter-spacing:1px; margin-bottom:8px; }
  .ai-tag { display:inline-block; margin:4px 3px 0; padding:3px 10px; background:rgba(100,130,220,.15); color:#3a56b0; border-radius:12px; font-size:11px; font-weight:600; }

  /* TRANSCRIPT RECAP */
  .story-recap-card { background:white; border-radius:20px; padding:20px; border:1px solid var(--story-border); box-shadow:0 4px 24px rgba(44,24,16,.05); margin-bottom:14px; animation:popIn .5s .28s cubic-bezier(.34,1.56,.64,1) both; }
  .recap-story { border-radius:12px; overflow:hidden; border:1px solid var(--story-border); }
  .recap-story-label { font-size:12px; font-weight:700; color:var(--dark); padding:9px 12px; background:rgba(44,24,16,.04); border-bottom:1px solid var(--story-border); }
  .recap-story-content { padding:12px 14px; font-size:13px; color:var(--muted); line-height:1.8; }

  /* KEYWORDS */
  .keywords-row { display:flex; flex-wrap:wrap; gap:7px; margin-top:10px; }
  .kw-chip { padding:5px 13px; border-radius:20px; font-size:12px; font-weight:600; background:rgba(74,95,160,.1); color:var(--story-blue); border:1px solid rgba(74,95,160,.2); }

  /* LOADING DOTS */
  .loading-row { display:flex; align-items:center; gap:10px; color:var(--muted); font-size:12px; }
  .ai-dots { display:flex; gap:4px; }
  .ai-dots span { width:6px; height:6px; border-radius:50%; background:currentColor; animation:dotBounce 1.2s ease-in-out infinite; }
  .ai-dots span:nth-child(2){animation-delay:.2s;} .ai-dots span:nth-child(3){animation-delay:.4s;}
  @keyframes dotBounce{0%,80%,100%{transform:scale(.7);opacity:.5}40%{transform:scale(1);opacity:1}}

  .btn-to-phone { width:100%; padding:16px; border-radius:14px; border:none; background:linear-gradient(135deg,var(--caramel),var(--accent)); color:white; font-size:16px; font-weight:700; cursor:pointer; font-family:'Noto Serif KR',serif; box-shadow:0 6px 20px rgba(184,98,42,.3); transition:all .25s; margin-top:20px; animation:fadeUp .5s .5s ease both; opacity:0; animation-fill-mode:both; }
  .btn-to-phone:hover { transform:translateY(-2px); }

  /* PHONE */
  #page-phone { background:var(--cream); }
  .phone-wrap { max-width:480px; margin:0 auto; padding:60px 20px 80px; text-align:center; }
  .phone-emoji { font-size:56px; margin-bottom:20px; animation:popIn .6s cubic-bezier(.34,1.56,.64,1) both; }
  .phone-title { font-family:'Noto Serif KR',serif; font-size:26px; font-weight:900; color:var(--dark); margin-bottom:12px; }
  .phone-desc { font-size:14px; color:var(--muted); line-height:1.8; margin-bottom:32px; }
  .phone-input { width:100%; padding:16px 20px; border-radius:14px; border:2px solid var(--border); background:white; font-size:16px; color:var(--dark); font-family:'Noto Sans KR',sans-serif; outline:none; transition:border-color .2s; text-align:center; letter-spacing:1px; margin-bottom:12px; }
  .phone-input:focus { border-color:var(--toast); }
  .phone-skip { font-size:12px; color:var(--muted); text-decoration:underline; cursor:pointer; margin-bottom:20px; display:block; }
  .permission-row { display:flex; align-items:flex-start; gap:12px; padding:14px 16px; background:#F8F5F0; border-radius:12px; margin-bottom:24px; text-align:left; }
  .custom-cb { width:20px; height:20px; border:2px solid var(--border); border-radius:5px; flex-shrink:0; cursor:pointer; display:flex; align-items:center; justify-content:center; margin-top:1px; transition:all .2s; }
  .custom-cb.checked { background:var(--green); border-color:var(--green); }
  .custom-cb.checked::after { content:'âœ“'; color:white; font-size:12px; font-weight:700; }
  .permission-text { font-size:12px; color:var(--muted); line-height:1.6; }
  .permission-text strong { color:var(--dark); }
  .btn-finish { width:100%; padding:16px; border-radius:14px; border:none; background:linear-gradient(135deg,var(--caramel),var(--accent)); color:white; font-size:16px; font-weight:700; cursor:pointer; font-family:'Noto Serif KR',serif; box-shadow:0 6px 20px rgba(184,98,42,.3); transition:all .25s; }
  .btn-finish:hover { transform:translateY(-2px); }

  /* DONE */
  #page-done { background:var(--cream); }
  .done-wrap { max-width:480px; margin:0 auto; padding:80px 20px; text-align:center; }
  .done-emoji { font-size:64px; margin-bottom:24px; animation:popIn .6s cubic-bezier(.34,1.56,.64,1) both; }
  .done-title { font-family:'Noto Serif KR',serif; font-size:26px; font-weight:900; color:var(--dark); margin-bottom:12px; animation:fadeUp .6s .1s ease both; opacity:0; animation-fill-mode:both; }
  .done-desc { font-size:14px; color:var(--muted); line-height:1.9; margin-bottom:28px; animation:fadeUp .6s .2s ease both; opacity:0; animation-fill-mode:both; }
  .done-tag { display:inline-block; background:var(--dark); color:white; padding:10px 24px; border-radius:20px; font-size:13px; font-weight:500; animation:fadeUp .6s .3s ease both; opacity:0; animation-fill-mode:both; }

  /* DECO */
  .deco { position:fixed; font-size:28px; opacity:.06; pointer-events:none; z-index:0; animation:floatUp linear infinite; }
  @keyframes floatUp{0%{transform:translateY(100vh) rotate(0)}100%{transform:translateY(-100px) rotate(360deg)}}
  @keyframes fadeUp{from{opacity:0;transform:translateY(16px)}to{opacity:1;transform:translateY(0)}}
  @keyframes popIn{0%{transform:scale(.8);opacity:0}100%{transform:scale(1);opacity:1}}
  /* â•â• RESULT ZONES â•â• */
  .result-zone {
    border-radius:24px; padding:24px 20px; margin:0 -4px;
  }
  .result-zone-story {
    background:linear-gradient(160deg,#0f0f1e,#1a1a3a);
    border:1.5px solid rgba(100,130,220,.2);
    box-shadow:0 8px 40px rgba(0,0,0,.3);
    color:white;
  }
  .result-zone-quiz {
    background:linear-gradient(160deg,#FFF9F3,#FFF4E8);
    border:1.5px solid rgba(212,149,106,.2);
    box-shadow:0 4px 24px rgba(44,24,16,.08);
    margin-top:0;
  }
  .result-zone-header {
    text-align:center; margin-bottom:20px;
  }
  .result-zone-badge {
    display:inline-block; padding:5px 16px; border-radius:20px;
    font-size:11px; font-weight:800; letter-spacing:1.5px;
    margin-bottom:10px;
  }
  .result-zone-badge.story {
    background:rgba(255,255,255,.1); color:rgba(255,255,255,.8);
    border:1px solid rgba(255,255,255,.2);
  }
  .result-zone-badge.quiz {
    background:rgba(212,149,106,.12); color:var(--caramel);
    border:1px solid rgba(212,149,106,.3);
  }
  .result-zone-title {
    font-family:'Noto Serif KR',serif; font-size:18px;
    font-weight:900; line-height:1.4;
  }
  .result-zone-story .result-zone-title { color:white; }
  .result-zone-quiz .result-zone-title { color:var(--dark); }

  /* â”€â”€ ì¡´ ì „í™˜ êµ¬ë¶„ì„  â”€â”€ */
  .zone-transition {
    text-align:center; padding:16px 0 14px;
  }
  .zone-transition-label {
    font-size:11px; font-weight:700; color:var(--muted);
    letter-spacing:1px; margin-bottom:6px;
  }
  .zone-transition-arrow {
    font-size:22px; color:var(--toast); animation:bounce .8s ease infinite alternate;
  }
  @keyframes bounce { from{transform:translateY(0)} to{transform:translateY(5px)} }

  /* â•â• RESULT ZONE DIVIDER (legacy â€” keep for safety) â•â• */
  .result-zone-divider {
    margin:28px 0; text-align:center; position:relative;
  }
  .result-zone-divider::before {
    content:''; position:absolute; left:0; right:0; top:50%;
    height:1px; background:linear-gradient(90deg,transparent,var(--border),transparent);
  }
  .result-zone-divider-inner {
    display:inline-block; position:relative; z-index:1;
    background:var(--cream); padding:8px 20px;
    font-family:'Noto Serif KR',serif; font-size:12px;
    font-weight:700; color:var(--muted); letter-spacing:1.5px;
    border:1.5px solid var(--border); border-radius:20px;
  }

  /* â”€â”€ story zone ë‚´ë¶€ ì¹´ë“œ ì˜¤ë²„ë¼ì´ë“œ â”€â”€ */
  .result-zone-story .character-card-mini {
    background:rgba(255,255,255,.07);
    border-color:rgba(255,255,255,.15);
  }
  .result-zone-story .character-food-name { color:white; }
  .result-zone-story .character-sub-tag { color:rgba(255,255,255,.5); }
  .result-zone-story .story-ai-box {
    background:rgba(255,255,255,.07);
    border-color:rgba(255,255,255,.12);
  }
  .result-zone-story .story-ai-box-title { color:rgba(255,255,255,.85); }
  .result-zone-story .story-ai-content { color:rgba(255,255,255,.8); }
  .result-zone-story .story-recap-card {
    background:rgba(255,255,255,.06);
    border-color:rgba(255,255,255,.1);
    color:rgba(255,255,255,.8);
  }
  .result-zone-story .recap-title { color:rgba(255,255,255,.7); }
  .result-zone-story .recap-story-label { color:rgba(255,255,255,.5); }
  .result-zone-story .recap-story-content { color:rgba(255,255,255,.85); }
  .result-zone-story .kw-chip {
    background:rgba(255,255,255,.1); color:rgba(255,255,255,.7);
    border-color:rgba(255,255,255,.15);
  }

  .fade-in{animation:fadeUp .35s ease both;}

  /* â•â• CHOICE PAGE â•â• */
  .choice-card {
    display:flex; align-items:center; gap:16px;
    background:white; border-radius:20px; padding:20px;
    border:2px solid var(--border); cursor:pointer;
    transition:all .2s; margin-bottom:12px;
    box-shadow:0 4px 16px rgba(44,24,16,.05);
  }
  .choice-card:hover { border-color:var(--toast); transform:translateY(-2px); box-shadow:0 8px 24px rgba(44,24,16,.1); }
  .choice-card-highlight { background:linear-gradient(135deg,#FFF9F0,#FFF3E0); border-color:rgba(212,149,106,.4); }
  .choice-card-highlight:hover { border-color:var(--caramel); }
  .choice-icon { font-size:32px; flex-shrink:0; }
  .choice-body { flex:1; }
  .choice-title { font-family:'Noto Serif KR',serif; font-size:16px; font-weight:900; color:var(--dark); margin-bottom:4px; }
  .choice-desc { font-size:12px; color:var(--muted); line-height:1.6; }
  .choice-arrow { font-size:20px; color:var(--muted); flex-shrink:0; }
  .choice-or { text-align:center; font-size:12px; color:var(--muted); font-weight:600; letter-spacing:2px; margin:4px 0 12px; }

  /* â•â• STORY ONELINER â€” ë©”ì¸ í•˜ì´ë¼ì´íŠ¸ â•â• */
  .story-oneliner-card {
    background:linear-gradient(135deg,#1a1a2e,#16213e);
    border-radius:24px; padding:24px 22px; margin-bottom:14px;
    box-shadow:0 8px 32px rgba(0,0,0,.2);
    animation:popIn .5s cubic-bezier(.34,1.56,.64,1) both;
  }
  .story-oneliner-label {
    font-size:11px; font-weight:700; letter-spacing:2px;
    color:rgba(255,255,255,.5); margin-bottom:14px;
  }
  .story-oneliner-text {
    font-family:'Noto Serif KR',serif;
    font-size:clamp(17px,4.5vw,22px); font-weight:900;
    color:white; line-height:1.5; margin-bottom:14px;
  }
  .story-oneliner-to {
    font-size:13px; color:rgba(255,255,255,.7); line-height:1.8;
    padding:12px 14px;
    background:rgba(255,255,255,.07);
    border-radius:12px; border-left:3px solid rgba(255,255,255,.3);
    font-style:italic;
  }

  /* â•â• CHARACTER CARD MINI â•â• */
  .character-card-mini {
    display:flex; gap:16px; align-items:flex-start;
    background:white; border-radius:20px; padding:20px;
    border:1.5px solid var(--story-border);
    box-shadow:0 4px 20px rgba(44,24,16,.06);
    margin-bottom:14px;
    animation:popIn .5s .05s cubic-bezier(.34,1.56,.64,1) both;
  }
  .character-card-mini .char-img-wrap {
    width:100px; height:100px; border-radius:16px; flex-shrink:0;
  }
</style>
</head>
<body>
<div class="deco" style="left:5%;animation-duration:18s;animation-delay:-3s">ğŸœ</div>
<div class="deco" style="left:85%;animation-duration:22s;animation-delay:-8s">ğŸ</div>
<div class="deco" style="left:55%;animation-duration:15s;animation-delay:-12s">ğŸ¥š</div>
<div class="deco" style="left:70%;animation-duration:19s;animation-delay:-15s">ğŸ§…</div>

<!-- â•â•â•â•â•â•â•â•â•â•â•â• SPLASH â•â•â•â•â•â•â•â•â•â•â•â• -->
<div class="page active" id="page-splash">
  <div class="splash-title">ì°í‘¸ë“œ!!<br><em>ë‹¹ì‹ ì˜ ìŒì‹ê³¼ ì°ì€??</em></div>
  <div class="splash-sub">ë‚˜ë¥¼ ë‹®ì€ ìŒì‹ ìºë¦­í„°ì™€ í•¨ê»˜ ì°ì„ í’€ì–´ë´ìš” ğŸ½ï¸</div>
  <div class="splash-chars">
    <div class="splash-char">
      <svg viewBox="0 0 72 80" xmlns="http://www.w3.org/2000/svg">
        <ellipse cx="36" cy="44" rx="26" ry="22" fill="#fff8f0"/>
        <rect x="10" y="38" width="52" height="16" rx="4" fill="#f9d0a0"/>
        <rect x="10" y="28" width="52" height="12" rx="4" fill="#fff"/>
        <rect x="10" y="20" width="52" height="10" rx="4" fill="#f9d0a0"/>
        <path d="M12 20 Q20 12 28 18 Q36 10 44 18 Q52 12 60 20" stroke="#fff" stroke-width="3" fill="none"/>
        <ellipse cx="24" cy="17" rx="5" ry="4" fill="#e8504a"/>
        <ellipse cx="36" cy="13" rx="5" ry="4" fill="#e8504a"/>
        <ellipse cx="48" cy="17" rx="5" ry="4" fill="#e8504a"/>
        <rect x="34" y="5" width="4" height="9" rx="2" fill="#f9c74f"/>
        <circle cx="28" cy="36" r="2" fill="#2c1810"/><circle cx="44" cy="36" r="2" fill="#2c1810"/>
        <path d="M30 41 Q36 46 42 41" stroke="#2c1810" stroke-width="1.5" fill="none" stroke-linecap="round"/>
        <line x1="10" y1="38" x2="2" y2="30" stroke="#2c1810" stroke-width="2" stroke-linecap="round"/>
        <line x1="62" y1="38" x2="70" y2="30" stroke="#2c1810" stroke-width="2" stroke-linecap="round"/>
        <line x1="28" y1="60" x2="24" y2="72" stroke="#2c1810" stroke-width="2" stroke-linecap="round"/>
        <line x1="44" y1="60" x2="48" y2="72" stroke="#2c1810" stroke-width="2" stroke-linecap="round"/>
      </svg>
      <span class="splash-char-name">ì¼€ì´í¬</span>
    </div>
    <div class="splash-char" style="animation-delay:.2s">
      <svg viewBox="0 0 72 80" xmlns="http://www.w3.org/2000/svg">
        <path d="M10 46 Q10 68 36 68 Q62 68 62 46 Z" fill="#2a1408"/>
        <path d="M12 46 Q12 64 36 64 Q60 64 60 46 Z" fill="#8db87a"/>
        <circle cx="36" cy="36" r="26" fill="#5c2e10"/>
        <circle cx="28" cy="34" r="2.5" fill="#1a0a04"/><circle cx="44" cy="34" r="2.5" fill="#1a0a04"/>
        <path d="M30 40 Q36 45 42 40" stroke="#1a0a04" stroke-width="1.8" fill="none" stroke-linecap="round"/>
        <line x1="10" y1="38" x2="2" y2="30" stroke="#2c1810" stroke-width="2" stroke-linecap="round"/>
        <line x1="62" y1="38" x2="70" y2="30" stroke="#2c1810" stroke-width="2" stroke-linecap="round"/>
        <line x1="28" y1="62" x2="24" y2="74" stroke="#2c1810" stroke-width="2" stroke-linecap="round"/>
        <line x1="44" y1="62" x2="48" y2="74" stroke="#2c1810" stroke-width="2" stroke-linecap="round"/>
      </svg>
      <span class="splash-char-name">ë‘ì«€ì¿ </span>
    </div>
    <div class="splash-char" style="animation-delay:.4s;margin-bottom:8px">
      <svg viewBox="0 0 72 80" xmlns="http://www.w3.org/2000/svg">
        <rect x="34" y="58" width="4" height="22" rx="2" fill="#8B6347"/>
        <ellipse cx="36" cy="56" rx="10" ry="10" fill="#e03c31"/>
        <ellipse cx="36" cy="40" rx="9" ry="9" fill="#7b4fa6"/>
        <ellipse cx="36" cy="26" rx="8" ry="8" fill="#f4a261"/>
        <circle cx="30" cy="40" r="2" fill="#2c1810"/><circle cx="42" cy="40" r="2" fill="#2c1810"/>
        <path d="M32 45 Q36 49 40 45" stroke="#2c1810" stroke-width="1.5" fill="none" stroke-linecap="round"/>
      </svg>
      <span class="splash-char-name">íƒ•í›„ë£¨</span>
    </div>
    <div class="splash-char" style="animation-delay:.6s">
      <svg viewBox="0 0 72 80" xmlns="http://www.w3.org/2000/svg">
        <path d="M10 52 Q10 70 36 70 Q62 70 62 52 Z" fill="#d4956a"/>
        <ellipse cx="36" cy="40" rx="26" ry="20" fill="#fdfaf6"/>
        <ellipse cx="36" cy="52" rx="26" ry="6" fill="#b8622a"/>
        <circle cx="28" cy="42" r="2" fill="#2c1810"/><circle cx="44" cy="42" r="2" fill="#2c1810"/>
        <path d="M30 48 Q36 53 42 48" stroke="#2c1810" stroke-width="1.5" fill="none" stroke-linecap="round"/>
        <line x1="10" y1="46" x2="2" y2="38" stroke="#2c1810" stroke-width="2" stroke-linecap="round"/>
        <line x1="62" y1="46" x2="70" y2="38" stroke="#2c1810" stroke-width="2" stroke-linecap="round"/>
        <line x1="28" y1="70" x2="24" y2="80" stroke="#2c1810" stroke-width="2" stroke-linecap="round"/>
        <line x1="44" y1="70" x2="48" y2="80" stroke="#2c1810" stroke-width="2" stroke-linecap="round"/>
      </svg>
      <span class="splash-char-name">ê³µê¹ƒë°¥</span>
    </div>
  </div>
  <button class="splash-btn" onclick="goTo('page-quiz')">ì‹œì‘í•˜ê¸° ğŸ½ï¸</button>
</div>

<!-- â•â•â•â•â•â•â•â•â•â•â•â• QUIZ â•â•â•â•â•â•â•â•â•â•â•â• -->
<div class="page" id="page-quiz">
  <div class="page-wrap">
    <div class="page-header">
      <div class="page-tag">ğŸ² ì„±í–¥ í…ŒìŠ¤íŠ¸</div>
      <h2>ë‚˜ëŠ” ì–´ë–¤ <em>ìŒì‹</em>ì¼ê¹Œ?</h2>
      <p>7ê°€ì§€ ì§ˆë¬¸ì— ì†”ì§í•˜ê²Œ ë‹µí•´ì£¼ì„¸ìš”!</p>
    </div>
    <div class="quiz-card">
      <div class="quiz-progress" id="quiz-progress"></div>
      <div class="quiz-step-label" id="quiz-step-label"></div>
      <div id="quiz-body"></div>
    </div>
  </div>
</div>

<!-- â•â•â•â•â•â•â•â•â•â•â•â• CHOICE (ì° ë…¹ìŒ ì—¬ë¶€ ì„ íƒ) â•â•â•â•â•â•â•â•â•â•â•â• -->
<div class="page" id="page-choice">
  <div class="page-wrap">
    <div class="page-header" style="padding-bottom:16px">
      <div class="page-tag">ğŸ‰ í€´ì¦ˆ ì™„ë£Œ!</div>
      <h2>ê²°ê³¼ë¥¼ <em>ì–´ë–»ê²Œ</em> ë³¼ê¹Œìš”?</h2>
      <p>ì°ì„ ë…¹ìŒí•˜ë©´ AIê°€ ë” ì¬ë°Œê²Œ ë¶„ì„í•´ë“œë ¤ìš” ğŸ™ï¸</p>
    </div>

    <div class="choice-card" onclick="goTo('page-result');buildResult(null)">
      <div class="choice-icon">ğŸ“Š</div>
      <div class="choice-body">
        <div class="choice-title">ê²°ê³¼ ë°”ë¡œ ë³´ê¸°</div>
        <div class="choice-desc">7ê°€ì§€ ì§ˆë¬¸ ë¶„ì„ìœ¼ë¡œ<br>ë‚˜ì˜ ìŒì‹ ì„±í–¥ ì•Œì•„ë³´ê¸°</div>
      </div>
      <div class="choice-arrow">â†’</div>
    </div>

    <div class="choice-or">ë˜ëŠ”</div>

    <div class="choice-card choice-card-highlight" onclick="goTo('page-record')">
      <div class="choice-icon">ğŸ™ï¸</div>
      <div class="choice-body">
        <div class="choice-title">ì° ë…¹ìŒí•˜ê³  ê²°ê³¼ ë³´ê¸°</div>
        <div class="choice-desc">ìŒì‹ ìºë¦­í„° ìƒì„± + AI ì° ë¶„ì„ê¹Œì§€<br><span style="font-size:11px;color:var(--accent);font-weight:700">âœ¦ ë” ì¬ë°ŒëŠ” ê²°ê³¼ë¥¼ ë³¼ ìˆ˜ ìˆì–´ìš”</span></div>
      </div>
      <div class="choice-arrow">â†’</div>
    </div>
  </div>
</div>

<!-- â•â•â•â•â•â•â•â•â•â•â•â• RECORD (ì° ë…¹ìŒ) â•â•â•â•â•â•â•â•â•â•â•â• -->
<div class="page" id="page-record">
  <div class="record-wrap">
    <div class="page-header">
      <div class="page-tag">ğŸ™ï¸ ì° ë…¹ìŒ</div>
      <h2>ì°ì„ <em>ë§ë¡œ</em> í’€ì–´ë´ìš”</h2>
      <p>ìŒì„±ìœ¼ë¡œ ë…¹ìŒí•˜ë©´ AIê°€ ìºë¦­í„°ë¥¼ ê·¸ë ¤ë“œë ¤ìš” ğŸ¨</p>
    </div>

    <!-- Food input -->
    <div class="food-input-card">
      <label>ğŸ½ï¸ ì°ì˜ ì£¼ì¸ê³µ ìŒì‹ì€? <span style="color:var(--accent)">*</span></label>
      <div class="food-input-row">
        <input type="text" id="food-input" class="food-text-input"
          placeholder="ì˜ˆ) ë–¡ë³¶ì´, ì¹˜í‚¨, ë¼ë©´, ì‚¼ê²¹ì‚´..."
          oninput="this.style.borderColor=this.value.trim()?'var(--caramel)':'var(--border)'">
        <span class="food-emoji-btn">ğŸ½ï¸</span>
      </div>
      <p style="font-size:11px;color:var(--muted);margin-top:8px;padding-left:2px">ì´ ìŒì‹ìœ¼ë¡œ ê·€ì—¬ìš´ ìºë¦­í„°ë¥¼ AIê°€ ê·¸ë ¤ë“œë ¤ìš” ğŸ¨</p>
      <div class="theme-row">
        <div class="theme-chips-label">ì°ì˜ ì£¼ì œ</div>
        <div class="theme-chips">
          <button class="theme-chip" onclick="toggleChip(this)">ğŸ’˜ ì—°ì•  ì°</button>
          <button class="theme-chip" onclick="toggleChip(this)">âœ‚ï¸ ì¸ê°„ê´€ê³„ ì°</button>
          <button class="theme-chip" onclick="toggleChip(this)">ğŸ˜µ ì§ì¥/í•™êµ ì°</button>
          <button class="theme-chip" onclick="toggleChip(this)">ğŸ‘¨â€ğŸ‘©â€ğŸ‘§ ê°€ì¡± ì°</button>
          <button class="theme-chip" onclick="toggleChip(this)">ğŸ›ï¸ í‘ì—­ì‚¬ ì°</button>
          <button class="theme-chip" onclick="toggleChip(this)">â˜€ï¸ ì¼ìƒ ì°</button>
        </div>
      </div>
    </div>

    <!-- Recorder -->
    <div class="recorder-zone" id="recorder-zone">
      <div class="waveform-container" id="waveform"></div>
      <div class="rec-timer" id="rec-timer">00:00</div>
      <div class="rec-status-row">
        <div class="rec-live-dot"></div>
        <span class="rec-status-text" id="rec-status-text">ë²„íŠ¼ì„ ëˆŒëŸ¬ ë…¹ìŒ ì‹œì‘</span>
      </div>
      <div class="rec-btn-outer">
        <button class="rec-btn" id="rec-btn" onclick="toggleRecording()">ğŸ™ï¸</button>
        <span class="rec-btn-label" id="rec-btn-label">ë…¹ìŒ ì‹œì‘</span>
      </div>
      <div class="rec-processing" id="rec-processing">
        <div class="proc-spinner"></div>
        <div class="proc-text">AIê°€ ë¶„ì„ ì¤‘ì´ì—ìš”...</div>
      </div>
    </div>

    <p style="text-align:center;font-size:11px;color:var(--muted);margin-top:-8px;margin-bottom:20px;">
      âš ï¸ ë§ˆì´í¬ ì‚¬ìš©ì€ <strong>localhost ë˜ëŠ” https</strong> í™˜ê²½ì—ì„œë§Œ ê°€ëŠ¥í•´ìš”
    </p>

  </div>
</div>

<!-- â•â•â•â•â•â•â•â•â•â•â•â• RESULT â•â•â•â•â•â•â•â•â•â•â•â• -->
<div class="page" id="page-result">
  <div class="result-wrap">
    <div id="result-loading-screen" class="result-loading-screen">
      <div class="big-spinner"></div>
      <p id="loading-msg">ë¶„ì„ ì¤‘...<br><span style="font-size:12px;opacity:.6">ë‚˜ì˜ ìŒì‹ ì„±í–¥ì„ íŒŒì•…í•˜ëŠ” ì¤‘ ğŸ½ï¸</span></p>
      <div class="loading-steps">
        <div class="loading-step-item" id="lstep-stt"><span class="loading-step-icon">ğŸ“</span>ìŒì„± â†’ í…ìŠ¤íŠ¸ ë³€í™˜ ì¤‘</div>
        <div class="loading-step-item" id="lstep-mood"><span class="loading-step-icon">ğŸ­</span>ë¶„ìœ„ê¸° íŒŒì•… ì¤‘</div>
        <div class="loading-step-item" id="lstep-img"><span class="loading-step-icon">ğŸ¨</span>ìºë¦­í„° ê·¸ë¦¬ëŠ” ì¤‘</div>
        <div class="loading-step-item" id="lstep-analysis"><span class="loading-step-icon">ğŸ§ </span>ì‹¬ì¸µ ë¶„ì„ ì¤‘</div>
      </div>
    </div>

    <div id="result-content" style="display:none">

      <!-- â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â• -->
      <!--  ZONE A: ì° ë…¹ìŒ ê²°ê³¼  (hasStory ì¼ ë•Œë§Œ)  -->
      <!-- â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â• -->
      <div id="story-oneliner-block" style="display:none">
        <div class="result-zone result-zone-story">

          <div class="result-zone-header">
            <div class="result-zone-badge story">ğŸ™ï¸ ì° ë¶„ì„</div>
            <div class="result-zone-title">AIê°€ ë‚´ ì°ì„ ì½ê³ <br>ë‚´ë¦° ì§„ë‹¨</div>
          </div>

          <!-- ì° í•œ ì¤„ â€” ë©”ì¸ ì¹´ë“œ -->
          <div class="story-oneliner-card">
            <div class="story-oneliner-label">ğŸ”¥ ì´ ì°, í•œ ì¤„ë¡œ ìš”ì•½í•˜ë©´</div>
            <div class="loading-row" id="oneliner-loading" style="min-height:64px;justify-content:center">
              <div class="ai-dots"><span></span><span></span><span></span></div>
              <span style="color:rgba(255,255,255,.5);font-size:13px">ì° ì½ëŠ” ì¤‘...</span>
            </div>
            <div class="story-oneliner-text" id="story-oneliner-text" style="display:none"></div>
            <div class="story-oneliner-to" id="story-oneliner-to" style="display:none"></div>
            <div id="story-oneliner-tags" style="display:none;margin-top:12px"></div>
          </div>

          <!-- ìºë¦­í„° ë¯¸ë‹ˆ ì¹´ë“œ -->
          <div class="character-card-mini">
            <div class="char-img-wrap" id="char-img-wrap">
              <div class="char-loading-inner" id="char-loading-inner">
                <div class="small-spinner"></div>
                <p>ê·¸ë¦¬ëŠ” ì¤‘...</p>
              </div>
              <img class="char-img" id="char-img" src="" alt="" style="display:none">
            </div>
            <div class="character-info">
              <div class="character-food-name" id="char-food-name"></div>
              <div id="mood-badge-wrap"></div>
              <div class="character-sub-tag" id="char-sub-tag"></div>
              <div id="char-quote-wrap" style="display:none;margin-top:10px;padding:9px 12px;background:rgba(100,130,220,.1);border-radius:10px;border-left:3px solid var(--story-blue)">
                <div style="font-size:10px;font-weight:700;color:var(--story-blue);letter-spacing:1px;margin-bottom:4px">ğŸ’¬ ìºë¦­í„° í•œë§ˆë””</div>
                <div id="char-quote-text" style="font-size:13px;color:#1a2a6a;font-style:italic;line-height:1.6"></div>
              </div>
            </div>
          </div>

          <!-- ìŒì‹ ì‹¬ë¦¬ -->
          <div class="story-ai-box">
            <div class="story-ai-box-title">ğŸ½ï¸ ì™œ í•˜í•„ ê·¸ ìŒì‹ì´ì—ˆì„ê¹Œ?</div>
            <div class="loading-row" id="story-ai-loading">
              <div class="ai-dots"><span></span><span></span><span></span></div>
              <span>ë¶„ì„ ì¤‘...</span>
            </div>
            <div class="story-ai-content" id="story-ai-content" style="display:none"></div>
          </div>

          <!-- ì›ë¬¸ -->
          <div class="story-recap-card" id="story-recap-card" style="display:none">
            <div class="recap-title">ğŸ“ AIê°€ ë°›ì•„ì“´ ë‚´ ì°</div>
            <div class="recap-story">
              <div class="recap-story-label">ë…¹ìŒëœ ë‚´ìš©</div>
              <div class="recap-story-content" id="story-recap-content"></div>
            </div>
            <div id="keywords-wrap" style="display:none;margin-top:12px">
              <div style="font-size:11px;font-weight:700;color:var(--muted);letter-spacing:.5px;margin-bottom:7px">í•µì‹¬ í‚¤ì›Œë“œ</div>
              <div class="keywords-row" id="keywords-row"></div>
            </div>
          </div>
        </div><!-- /result-zone-story -->

        <!-- â”€â”€ ì„¹ì…˜ ì „í™˜ êµ¬ë¶„ì„  â”€â”€ -->
        <div class="zone-transition">
          <div class="zone-transition-label">ğŸ“Š ì„±í–¥ ë¶„ì„ ê²°ê³¼ë¡œ</div>
          <div class="zone-transition-arrow">â†“</div>
        </div>
      </div>
      <!-- /story-oneliner-block -->

      <!-- â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â• -->
      <!--  ZONE B: 7ê°œ ì§ˆë¬¸ ì„±í–¥ ë¶„ì„ (í•­ìƒ í‘œì‹œ)   -->
      <!-- â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â• -->
      <div class="result-zone result-zone-quiz">

        <div class="result-zone-header">
          <div class="result-zone-badge quiz">ğŸ² ì„±í–¥ ë¶„ì„</div>
          <div class="result-zone-title" id="quiz-zone-title">7ê°œ ì§ˆë¬¸ìœ¼ë¡œ ì•Œì•„ë³´ëŠ”<br>ë‚˜ì˜ ìŒì‹ ì„±í–¥</div>
        </div>

        <!-- ì„±í–¥ íƒ€ì… ì¹´ë“œ -->
        <div class="personality-card">
          <div class="personality-char-svg" id="personality-emoji"></div>
          <div class="personality-food-type" id="personality-food-type"></div>
          <div class="personality-type-tag" id="personality-type-tag"></div>
          <div class="personality-desc" id="personality-desc"></div>
        </div>

        <!-- ì„±í–¥ AI ë¶„ì„ -->
        <div class="quiz-ai-box">
          <div class="quiz-ai-box-title">ğŸ” 7ê°œ ì§ˆë¬¸ì´ ë§í•´ì£¼ëŠ” ë‚˜</div>
          <div class="loading-row" id="quiz-ai-loading">
            <div class="ai-dots"><span></span><span></span><span></span></div>
            <span>ì„±í–¥ íŒ¨í„´ ë¶„ì„ ì¤‘...</span>
          </div>
          <div class="quiz-ai-content" id="quiz-ai-content" style="display:none"></div>
        </div>

        <!-- ë‹µë³€ ë¦¬ìº¡ -->
        <div class="quiz-recap-card">
          <div class="recap-title">ğŸ“‹ ë‚´ê°€ ê³ ë¥¸ 7ê°€ì§€ ë‹µë³€</div>
          <div id="quiz-recap-body"></div>
        </div>

      </div><!-- /result-zone-quiz -->

      <div style="padding:20px 0">
        <button class="btn-to-phone" onclick="goTo('page-phone')">ë§ˆì§€ë§‰ì´ì—ìš”!!</button>
        <div style="text-align:center;margin-top:14px">
          <button onclick="restartAll()" style="padding:9px 22px;border-radius:20px;border:1.5px solid var(--toast);background:transparent;color:var(--toast);font-size:13px;cursor:pointer;font-family:'Noto Sans KR',sans-serif;">â†© ì²˜ìŒë¶€í„° ë‹¤ì‹œ</button>
        </div>
      </div>
    </div>
  </div>
</div>

<!-- â•â•â•â•â•â•â•â•â•â•â•â• PHONE â•â•â•â•â•â•â•â•â•â•â•â• -->
<div class="page" id="page-phone">
  <div class="phone-wrap">
    <div class="phone-emoji">ğŸ“±</div>
    <div class="phone-title">ë§ˆì§€ë§‰ìœ¼ë¡œ<br>ì—°ë½ì²˜ë¥¼ ë‚¨ê²¨ì£¼ì„¸ìš”!</div>
    <div class="phone-desc">ë‹¹ì‹ ì˜ ì°ì´ ì›¹íˆ°ìœ¼ë¡œ ì œì‘ë  ê²½ìš°<br>ê°€ì¥ ë¨¼ì € ì—°ë½ë“œë¦´ê²Œìš” ğŸ¨<br><span style="font-size:12px;opacity:.7">(ì„ íƒ ì‚¬í•­ì´ì—ìš”)</span></div>
    <input type="tel" class="phone-input" id="phone-input" placeholder="010-0000-0000" inputmode="numeric" oninput="formatPhone(this)">
    <span class="phone-skip" onclick="goTo('page-done')">ê±´ë„ˆë›°ê¸°</span>
    <div class="permission-row">
      <div class="custom-cb" id="consent-cb" onclick="toggleConsent()"></div>
      <div class="permission-text"><strong>ì‚¬ì—° ë° ì—°ë½ì²˜ í™œìš©ì— ë™ì˜í•©ë‹ˆë‹¤.</strong><br>ì œì¶œëœ ë‚´ìš©ì€ ì›¹íˆ° ìŠ¤í† ë¦¬ ì œì‘ì— ì°¸ê³ ë  ìˆ˜ ìˆìœ¼ë©°, ì‹¤ëª…/ê°œì¸ì •ë³´ëŠ” ê³µê°œë˜ì§€ ì•ŠìŠµë‹ˆë‹¤.</div>
    </div>
    <button class="btn-finish" onclick="submitPhone()">ğŸ½ï¸ ì™„ë£Œí•˜ê¸°</button>
  </div>
</div>

<!-- â•â•â•â•â•â•â•â•â•â•â•â• DONE â•â•â•â•â•â•â•â•â•â•â•â• -->
<div class="page" id="page-done">
  <div class="done-wrap">
    <div class="done-emoji">ğŸ«¶</div>
    <div class="done-title">ê³ ë§ˆì›Œìš”, ì†Œì¤‘í•œ ì°!</div>
    <div class="done-desc">ë‹¹ì‹ ì˜ ì´ì•¼ê¸°ê°€ ë”°ëœ»í•œ ìŒì‹ ìºë¦­í„°ë¡œ<br>ë‹¤ì‹œ ì„¸ìƒì— ë‚˜ì˜¬ ë‚ ì„ ê¸°ë‹¤ë ¤ì£¼ì„¸ìš”.<br><br>ì°í‘¸ë“œê°€ ì‘ì›í• ê²Œìš” ğŸ½ï¸</div>
    <div class="done-tag">#ì°í‘¸ë“œ #ë‹¹ì‹ ì˜ìŒì‹ê³¼ì°ì€</div>
  </div>
</div>

<!-- â•â•â•â•â•â•â•â•â•â•â•â• NETLIFY HIDDEN FORM (ë¹Œë“œ íƒ€ì„ ê°ì§€ìš©) â•â•â•â•â•â•â•â•â•â•â•â• -->
<form name="ssulFood" netlify netlify-honeypot="bot-field" hidden>
  <input type="hidden" name="form-name" value="ssulFood"/>
  <input type="hidden" name="bot-field"/>
  <input type="hidden" name="ì œì¶œì¼ì‹œ"/>
  <input type="hidden" name="ì—°ë½ì²˜"/>
  <input type="hidden" name="ìŒì‹ìœ í˜•"/>
  <input type="hidden" name="ì„±í–¥íƒœê·¸"/>
  <input type="hidden" name="ì°_ì£¼ì¸ê³µìŒì‹"/>
  <input type="hidden" name="ë…¹ìŒ_í…ìŠ¤íŠ¸"/>
  <input type="hidden" name="ê°ì •"/>
  <input type="hidden" name="Q1_ë‹µë³€"/>
  <input type="hidden" name="Q2_ë‹µë³€"/>
  <input type="hidden" name="Q3_ë‹µë³€"/>
  <input type="hidden" name="Q4_ë‹µë³€"/>
  <input type="hidden" name="Q5_ë‹µë³€"/>
  <input type="hidden" name="Q6_ë‹µë³€"/>
  <input type="hidden" name="Q7_ë‹µë³€"/>
</form>

<script>
// â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
//  NAV
// â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
function goTo(id){document.querySelectorAll('.page').forEach(p=>p.classList.remove('active'));document.getElementById(id).classList.add('active');window.scrollTo(0,0);}
function restartAll(){
  answers=[];answerLabels=[];currentQ=0;selectedIdx=null;
  initQuiz();
  document.getElementById('food-input').value='';
  // reset recorder
  isRecording=false; recordingSeconds=0;
  clearInterval(recordingInterval);
  if(mediaRecorder&&mediaRecorder.state!=='inactive'){try{mediaRecorder.stop();}catch(e){}}
  document.getElementById('rec-timer').textContent='00:00';
  document.getElementById('rec-status-text').textContent='ë²„íŠ¼ì„ ëˆŒëŸ¬ ë…¹ìŒ ì‹œì‘';
  document.getElementById('rec-btn').classList.remove('recording-active');
  document.getElementById('rec-btn').textContent='ğŸ™ï¸';
  document.getElementById('rec-btn-label').textContent='ë…¹ìŒ ì‹œì‘';
  document.getElementById('recorder-zone').classList.remove('recording');
  document.getElementById('rec-processing').classList.remove('show');
  buildWaveform();
  goTo('page-quiz');
}

// â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
//  QUIZ DATA
// â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
const questions=[
  {q:"ì§€ê¸ˆ ë‹¹ì¥ ë¨¹ê³  ì‹¶ì€ ê±´?",opts:[{e:"ğŸŒ¶ï¸",t:"ë§¤ì½¤í•œ ê±°",score:{A:2}},{e:"ğŸ°",t:"ë‹¬ë‹¬í•œ ê±°",score:{B:2}},{e:"ğŸ§‚",t:"ì§­ì§¤í•œ ê±°",score:{C:2}},{e:"ğŸ²",t:"ëœ¨ëˆí•œ êµ­ë¬¼",score:{D:2}}]},
  {q:"ë„ˆëŠ” ì–´ë–¤ \"ë¼\"ì•¼?",opts:[{e:"ğŸ•",t:"ì„¸ë¼ â€” ê·œì¹™ì ì´ê³  ë£¨í‹´ ìˆëŠ” ìƒí™œ",score:{C:2}},{e:"ğŸ•‘",t:"ë‘ë¼ â€” ë°”ì˜ì§€ë§Œ ì±™ê¸¸ ê±´ ì±™ê¹€",score:{B:2}},{e:"ğŸ•’",t:"í•œë¼ â€” ì •ì‹ ì—†ì´ í•˜ë£¨ ë³´ëƒ„",score:{A:2}},{e:"ğŸ’¨",t:"ë–¼ë¼ â€” ëŒ€ì¶© ë•Œìš°ëŠ” ìš”ì¦˜",score:{D:2}}]},
  {q:"ë°°ê³ í”„ë©´ ë‚˜ëŠ”?",opts:[{e:"ğŸ˜¤",t:"ì˜ˆë¯¼í•´ì§",score:{A:2}},{e:"ğŸ¤",t:"ì¡°ìš©í•´ì§",score:{B:2}},{e:"ğŸ—£ï¸",t:"ì•„ë¬´ ë§ì´ë‚˜ í•¨",score:{C:2}},{e:"ğŸ´",t:"ê·¸ëƒ¥ ì•„ë¬´ê±°ë‚˜ ë¨¹ìŒ",score:{D:2}}]},
  {q:"ì¹œêµ¬ë‘ ë©”ë‰´ ê³ ë¥¼ ë•Œ ë‚˜ëŠ”?",opts:[{e:"ğŸ‘†",t:"ë‚´ê°€ ì •í•¨",score:{A:2}},{e:"ğŸ™ƒ",t:"\"ì•„ë¬´ê±°ë‚˜\" í•´ë†“ê³  ê²°êµ­ ì˜ê²¬ ëƒ„",score:{B:2}},{e:"ğŸ«¶",t:"ìƒëŒ€ ì˜ê²¬ ì¡´ì¤‘",score:{C:2}},{e:"ğŸ’­",t:"ì†ìœ¼ë¡œ ë”´ ë©”ë‰´ ìƒê°í•¨",score:{D:2}}]},
  {q:"ì—°ì• ë¥¼ ìŒì‹ì— ë¹„ìœ í•˜ë©´?",opts:[{e:"ğŸ«•",t:"ë§ˆë¼íƒ• (ì¤‘ë…ì ì´ê³  ìê·¹ì )",score:{A:3}},{e:"ğŸ‚",t:"ì¼€ì´í¬ (ê¸°ë…ì¼ ë§ê³  ë‹¬ë‹¬)",score:{B:3}},{e:"ğŸ·",t:"ì™€ì¸ (ì‹œê°„ ì§€ë‚˜ì•¼ ê¹Šì–´ì§)",score:{C:3}},{e:"ğŸ”º",t:"ì‚¼ê°ê¹€ë°¥ (ê°‘ìê¸° ì‹œì‘, ê°‘ìê¸° ë)",score:{D:3}}]},
  {q:"ìŠ¤íŠ¸ë ˆìŠ¤ ë°›ì„ ë•Œ ë‹¹ì‹ ì€?",opts:[{e:"ğŸ”¥",t:"ë§¤ìš´ ê±°ë¡œ í’€ì–´ë²„ë¦°ë‹¤",score:{A:2}},{e:"ğŸ«",t:"ë‹¬ë‹¬í•œ ë””ì €íŠ¸ ì°¾ëŠ”ë‹¤",score:{B:2}},{e:"âš¡",t:"ê·¸ëƒ¥ ì•„ë¬´ê±°ë‚˜ ë¹¨ë¦¬ ë¨¹ëŠ”ë‹¤",score:{C:2}},{e:"ğŸš«",t:"ì•„ì˜ˆ ì•ˆ ë¨¹ëŠ”ë‹¤",score:{D:2}}]},
  {q:"ìš”ì¦˜ ë‚´ê°€ ë§ì´ í‘¸ëŠ” ì°ì€?",opts:[{e:"ğŸ’˜",t:"ë§¤ìš´ ì—°ì•  ì° (ì—°ì• )",score:{A:3}},{e:"âœ‚ï¸",t:"ì¹œêµ¬ ì†ì ˆ ì° (ì¸ê°„ê´€ê³„)",score:{D:3}},{e:"ğŸ˜µ",t:"ìŠ¤íŠ¸ë ˆìŠ¤ì¸ íšŒì‚¬/í•™êµ ì° (ì§„ë¡œ ê³ ë¯¼)",score:{C:3}},{e:"ğŸ›ï¸",t:"ì´ë¶ˆí‚¥ í‘ì—­ì‚¬ ì° (ê¸°íƒ€)",score:{B:3}}]},
];
const scoreResults=[
  {type:"A",e:"ğŸŒ¶ï¸",food:"ë§ˆë¼íƒ•",desc:"ìê·¹ì ì´ê³  ê°•ë ¬í•œ ë§¤ë ¥ì˜ ì†Œìœ ì! í•œ ë²ˆ ë¹ ì§€ë©´ ëª» í—¤ì–´ë‚˜ì˜¤ëŠ” ì¤‘ë…ì ì¸ ì¡´ì¬ì˜ˆìš”. ë‹¤ìŒì— ë˜ ì°¾ê²Œ ë˜ëŠ” ì‚¬ëŒ.",tag:"#ì¤‘ë…ì£¼ì˜ #ìê·¹ë‚¨ì_ìê·¹ì—¬ì"},
  {type:"B",e:"ğŸ‚",food:"ë”¸ê¸° ì¼€ì´í¬",desc:"ë‹¬ë‹¬í•˜ê³  ì‚¬ë‘ìŠ¤ëŸ¬ìš´ ì—ë„ˆì§€ë¥¼ ê°€ì§„ ì‚¬ëŒ. íŠ¹ë³„í•œ ìˆœê°„ë§ˆë‹¤ ìƒê°ë‚˜ëŠ”, ì†Œì¤‘í•œ ë‚ ì˜ ì£¼ì¸ê³µ ê°™ì€ ì¡´ì¬ì˜ˆìš”.",tag:"#ë‹¬ë‹¬í•¨ì£¼ì˜ #ê¸°ë…ì¼ì¥ì¸"},
  {type:"C",e:"ğŸ·",food:"ì™€ì¸",desc:"ì²˜ìŒì—” ë‚¯ì„¤ì§€ë§Œ ì•Œì•„ê°ˆìˆ˜ë¡ ê¹Šì–´ì§€ëŠ” ì‚¬ëŒ. ì„£ë¶ˆë¦¬ íŒë‹¨í•˜ë©´ ì†í•´ì˜ˆìš”. ì‹œê°„ì´ ì§€ë‚ ìˆ˜ë¡ ì§„ê°€ê°€ ë“œëŸ¬ë‚©ë‹ˆë‹¤.",tag:"#ìˆ™ì„±í˜•ì¸ê°„ #ì²œì²œíˆì•Œì•„ê°€ì"},
  {type:"D",e:"ğŸ²",food:"í•´ì¥êµ­",desc:"í˜ë“  ë‚  ê°€ì¥ ë¨¼ì € ìƒê°ë‚˜ëŠ” ì‚¬ëŒ. ë§ ì—†ì–´ë„ ê³ì— ìˆìœ¼ë©´ ë“ ë“ í•˜ê³ , ê±°ì°½í•˜ì§€ ì•Šì•„ë„ ì§„ì‹¬ì´ ëŠê»´ì§€ëŠ” ì¡´ì¬ì˜ˆìš”.",tag:"#ì§„êµ­ì¸ìƒ #ìˆì–´ì•¼ì™„ì„±"},
];
let answers=[],answerLabels=[],currentQ=0,selectedIdx=null;
// ê²°ê³¼ ì €ì¥ìš© ê¸€ë¡œë²Œ
let savedResult={type:'',food:'',tag:''},savedStory='',savedFoodName='',savedMood='',savedKeywords=[],savedStoryContext={};

function initQuiz(){answers=[];answerLabels=[];currentQ=0;selectedIdx=null;renderProgress();renderQuestion();}
function renderProgress(){const p=document.getElementById('quiz-progress');p.innerHTML='';questions.forEach((_,i)=>{const d=document.createElement('div');d.className='quiz-dot'+(i===currentQ?' active':i<currentQ?' done':'');p.appendChild(d);});document.getElementById('quiz-step-label').textContent=`${currentQ+1} / ${questions.length}`;}
function renderQuestion(){const q=questions[currentQ];const isLast=currentQ===questions.length-1;const isFirst=currentQ===0;const prevBtn=isFirst?'':`<button class="btn-prev" onclick="goPrev()">â† ì´ì „</button>`;document.getElementById('quiz-body').innerHTML=`<div class="quiz-question fade-in">${q.q}</div><div class="quiz-options fade-in">${q.opts.map((o,i)=>`<button class="quiz-option${answers[currentQ]&&answerLabels[currentQ]&&answerLabels[currentQ].chosen===i?' selected':''}" onclick="selectOption(${i},this)"><span class="opt-emoji">${o.e}</span>${o.t}</button>`).join('')}</div><div id="next-wrap" style="display:${isFirst?'none':selectedIdx!==null||answers[currentQ]!==undefined?'block':'none'}"><div class="quiz-nav-row">${prevBtn}<button class="btn-next" onclick="goNext()">${isLast?'ê²°ê³¼ ë³´ê¸° âœ¨':'ë‹¤ìŒ ì§ˆë¬¸ â†’'}</button></div></div>${isFirst&&selectedIdx===null&&answers[currentQ]===undefined?'':`<div id="prev-only-wrap" style="display:${!isFirst&&selectedIdx===null&&answers[currentQ]===undefined?'block':'none'}">${prevBtn}</div>`}`;if(!isFirst){const prevOnlyWrap=document.getElementById('prev-only-wrap');if(prevOnlyWrap)prevOnlyWrap.style.display=(selectedIdx===null&&!answerLabels[currentQ])?'block':'none';}const chosen=answerLabels[currentQ]?.chosen;if(chosen!==undefined){selectedIdx=chosen;document.querySelectorAll('.quiz-option').forEach((b,i)=>{if(i===chosen)b.classList.add('selected');});document.getElementById('next-wrap').style.display='block';}}
function selectOption(idx,btn){document.querySelectorAll('.quiz-option').forEach(b=>b.classList.remove('selected'));btn.classList.add('selected');selectedIdx=idx;document.getElementById('next-wrap').style.display='block';const pOw=document.getElementById('prev-only-wrap');if(pOw)pOw.style.display='none';}
function goNext(){if(selectedIdx===null)return;const q=questions[currentQ];const sc=q.opts[selectedIdx].score;const lb={q:q.q,opts:q.opts,chosen:selectedIdx};if(currentQ<answers.length){answers[currentQ]=sc;answerLabels[currentQ]=lb;}else{answers.push(sc);answerLabels.push(lb);}selectedIdx=null;currentQ++;if(currentQ>=questions.length)goTo('page-choice');else{renderProgress();renderQuestion();}}
function goPrev(){if(currentQ===0)return;currentQ--;selectedIdx=null;renderProgress();renderQuestion();}

// â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
//  STORY UTILS
// â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
function toggleChip(btn){btn.classList.toggle('active');}

// â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
//  WAVEFORM
// â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
function buildWaveform(){
  const c=document.getElementById('waveform');
  c.innerHTML='';
  for(let i=0;i<28;i++){
    const b=document.createElement('div');
    b.className='wave-bar';
    const h=6+Math.random()*30;
    b.style.setProperty('--max-h',h+'px');
    b.style.setProperty('--dur',(0.4+Math.random()*0.5).toFixed(2)+'s');
    b.style.setProperty('--delay',(i*0.035).toFixed(2)+'s');
    b.style.height='4px';
    c.appendChild(b);
  }
}
buildWaveform();

// â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
//  AUDIO RECORDER
// â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
let mediaRecorder=null, audioChunks=[], recordingInterval=null, recordingSeconds=0, isRecording=false;
let currentBlob=null;

function getSupportedMimeType(){
  const types=['audio/webm;codecs=opus','audio/webm','audio/ogg;codecs=opus','audio/mp4'];
  return types.find(t=>MediaRecorder.isTypeSupported(t))||'';
}

async function toggleRecording(){
  if(!isRecording) await startRecording();
  else stopRecording();
}

async function startRecording(){
  try{
    const stream=await navigator.mediaDevices.getUserMedia({audio:true,video:false});
    audioChunks=[];
    const mime=getSupportedMimeType();
    mediaRecorder=new MediaRecorder(stream,mime?{mimeType:mime}:{});
    mediaRecorder.ondataavailable=e=>{if(e.data.size>0)audioChunks.push(e.data);};
    mediaRecorder.onstop=handleRecordingStop;
    mediaRecorder.start(100);
    isRecording=true; recordingSeconds=0;

    const zone=document.getElementById('recorder-zone');
    const btn=document.getElementById('rec-btn');
    zone.classList.add('recording');
    btn.classList.add('recording-active');
    btn.textContent='â¹ï¸';
    document.getElementById('rec-btn-label').textContent='íƒ­í•˜ë©´ ë…¹ìŒ ì¢…ë£Œ';
    document.getElementById('rec-status-text').textContent='ë…¹ìŒ ì¤‘...';

    recordingInterval=setInterval(()=>{
      recordingSeconds++;
      const m=String(Math.floor(recordingSeconds/60)).padStart(2,'0');
      const s=String(recordingSeconds%60).padStart(2,'0');
      document.getElementById('rec-timer').textContent=`${m}:${s}`;
    },1000);
  }catch(err){
    alert('ë§ˆì´í¬ ê¶Œí•œì´ í•„ìš”í•´ìš”!\në¸Œë¼ìš°ì € ì„¤ì •ì—ì„œ ë§ˆì´í¬ë¥¼ í—ˆìš©í•˜ê±°ë‚˜,\nlocalhost ë˜ëŠ” HTTPS í™˜ê²½ì—ì„œ ì ‘ì†í•´ì£¼ì„¸ìš”.');
    console.error(err);
  }
}

function stopRecording(){
  if(!mediaRecorder||!isRecording)return;
  isRecording=false;
  clearInterval(recordingInterval);
  mediaRecorder.stop();
  mediaRecorder.stream.getTracks().forEach(t=>t.stop());

  const zone=document.getElementById('recorder-zone');
  const btn=document.getElementById('rec-btn');
  zone.classList.remove('recording');
  btn.classList.remove('recording-active');
  btn.textContent='â³';
  btn.disabled=true;
  document.getElementById('rec-btn-label').textContent='ë¶„ì„ ì¤‘...';
  document.getElementById('rec-status-text').textContent='AIê°€ ì°ì„ ë¶„ì„í•˜ê³  ìˆì–´ìš”';
  document.getElementById('rec-processing').classList.add('show');
}

async function handleRecordingStop(){
  const foodName=document.getElementById('food-input').value.trim();
  if(!foodName){
    alert('ì°ì˜ ì£¼ì¸ê³µ ìŒì‹ì„ ì…ë ¥í•´ì£¼ì„¸ìš”! ğŸ½ï¸');
    resetRecorder(); return;
  }

  const mime=getSupportedMimeType()||'audio/webm';
  currentBlob=new Blob(audioChunks,{type:mime});

  // ê²°ê³¼ í™”ë©´ìœ¼ë¡œ ì´ë™ í›„ ë¶„ì„ ì‹œì‘
  goTo('page-result');
  await buildResult(foodName);
}

function resetRecorder(){
  const btn=document.getElementById('rec-btn');
  btn.textContent='ğŸ™ï¸'; btn.disabled=false;
  document.getElementById('rec-btn-label').textContent='ë…¹ìŒ ì‹œì‘';
  document.getElementById('rec-status-text').textContent='ë²„íŠ¼ì„ ëˆŒëŸ¬ ë…¹ìŒ ì‹œì‘';
  document.getElementById('rec-timer').textContent='00:00';
  document.getElementById('rec-processing').classList.remove('show');
  buildWaveform();
}

// â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
//  API_BASE & Gemini helpers
// â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
const API_BASE='/api';

const FOOD_HINTS={
  'ë–¡ë³¶ì´':'glossy red gochujang-coated cylindrical rice cakes, bright red sauce',
  'ë¼ë©´':'wavy yellow instant noodles, red soup base, floating green onion',
  'ì¹˜í‚¨':'golden-brown crispy fried chicken, crunchy breading',
  'ì‚¼ê²¹ì‚´':'thick grilled pork belly slices with fat layers, charred grill marks',
  'í”¼ì':'round pizza with thick melted cheese, red tomato sauce',
  'í–„ë²„ê±°':'tall stacked burger with sesame bun, lettuce, tomato, beef patty',
  'ì´ˆë°¥':'nigiri sushi with salmon or tuna on white rice',
  'ë§ˆë¼íƒ•':'deep red spicy broth with chili peppers, heavy red oil sheen',
  'ì¼€ì´í¬':'layered cake with pink strawberry cream frosting, whole strawberries',
  'ì•„ì´ìŠ¤í¬ë¦¼':'soft-serve ice cream swirl in a cone, pastel colors',
  'ë„ë„›':'ring-shaped donut with pink glaze and rainbow sprinkles',
  'ê¹€ë°¥':'cylindrical gimbap sliced showing colorful cross-section',
  'ë§Œë‘':'plump pleated dumpling with pinched folds',
  'ì§œì¥ë©´':'black bean paste noodles with dark brown glossy sauce, julienned cucumber',
};
function getFoodHint(n){if(FOOD_HINTS[n])return FOOD_HINTS[n];for(const[k,v]of Object.entries(FOOD_HINTS)){if(n.includes(k)||k.includes(n))return v;}return`recognizable Korean dish called "${n}" with its most distinctive colors and textures`;}

const MOOD_MAP={
  happy:   {label:'í–‰ë³µí•´ìš”',emoji:'ğŸ˜Š',bg:'linear-gradient(135deg,#fffbe0,#fff8cc)',border:'rgba(255,200,50,.35)',badgeColor:'#e6a800',badgeBg:'rgba(255,220,50,.15)'},
  excited: {label:'ì„¤ë ˆìš”',emoji:'ğŸ¥°',bg:'linear-gradient(135deg,#fff0f8,#ffe8f4)',border:'rgba(220,100,180,.3)',badgeColor:'#c0508a',badgeBg:'rgba(220,100,180,.1)'},
  sad:     {label:'ìŠ¬í¼ìš”',emoji:'ğŸ˜¢',bg:'linear-gradient(135deg,#e8f0ff,#dce8ff)',border:'rgba(80,120,220,.25)',badgeColor:'#3a5cc0',badgeBg:'rgba(80,120,220,.1)'},
  angry:   {label:'ì–µìš¸í•´ìš”',emoji:'ğŸ˜¤',bg:'linear-gradient(135deg,#fff0f0,#ffe8e8)',border:'rgba(220,80,80,.25)',badgeColor:'#c04040',badgeBg:'rgba(220,80,80,.1)'},
  lonely:  {label:'ê·¸ë¦¬ì›Œìš”',emoji:'ğŸ¥º',bg:'linear-gradient(135deg,#f4f0ff,#ece4ff)',border:'rgba(130,90,220,.25)',badgeColor:'#7040c0',badgeBg:'rgba(130,90,220,.1)'},
  nostalgic:{label:'ì¶”ì–µì´ì—ìš”',emoji:'ğŸŒ™',bg:'linear-gradient(135deg,#fdf5e0,#f9edd0)',border:'rgba(180,140,60,.25)',badgeColor:'#906030',badgeBg:'rgba(180,140,60,.1)'},
  nervous: {label:'ê¸´ì¥ë¼ìš”',emoji:'ğŸ˜…',bg:'linear-gradient(135deg,#f0fff4,#e4fce8)',border:'rgba(60,160,90,.25)',badgeColor:'#307040',badgeBg:'rgba(60,160,90,.1)'},
  neutral: {label:'ë‹´ë‹´í•´ìš”',emoji:'ğŸ˜Œ',bg:'linear-gradient(135deg,#f8f8f8,#f2f2f2)',border:'rgba(150,150,150,.2)',badgeColor:'#606060',badgeBg:'rgba(150,150,150,.08)'},
};
const MOOD_FACE={
  happy:'big joyful smile with rosy blush cheeks, sparkle star highlights in eyes (âœ¨), eyebrows raised happily',
  excited:'wide open star-shaped eyes (â˜…â˜…), huge open grin showing tiny teeth, eyebrows raised high, small hearts floating around',
  sad:'teardrop rolling down one cheek, eyes curved downward with droopy pupils, small trembling mouth, eyebrows slanted sad',
  angry:'sharp furrowed brow lines drawn on forehead, angular narrow eyes showing frustration, tight firm mouth, tiny steam puffs from top',
  lonely:'soft half-closed eyes looking slightly down, gentle wistful small smile, single floating heart nearby, eyebrows slightly down',
  nostalgic:'warm closed-eye peaceful smile, tear of joy on one cheek, eyebrows gently curved upward, soft glow expression',
  nervous:'large sweat drop on forehead, wide uncertain wobbly eyes, zigzag nervous mouth, one eyebrow raised',
  neutral:'calm simple dot eyes, small relaxed smile, smooth neutral eyebrows, peaceful gentle face',
};

function detectMoodLocal(story){
  if(!story)return'neutral';
  const s=story;
  if(/ì„¤ë ˆ|ë‘ê·¼|ì¢‹ì•„|í–‰ë³µ|ì›ƒìŒ|ê¸°ë»|ì¦ê±°|ìµœê³ |ëŒ€ë°•|ì‹ ë‚¬|ì™„ë²½/.test(s))return'excited';
  if(/ê·¸ë¦½|ë³´ê³ ì‹¶|ì¶”ì–µ|ê·¸ë•Œ|ì˜›ë‚ |ë‹¤ì‹œ|ëŒì•„ê°€|ìŠí˜€ì§€ì§€|ê¸°ì–µ/.test(s))return'nostalgic';
  if(/ì™¸ë¡œ|í˜¼ì|ì“¸ì“¸|ê³ ë…|ì•„ë¬´ë„|ìš¸ì—ˆ|ëˆˆë¬¼/.test(s))return'lonely';
  if(/í™”ë‚˜|ì–µìš¸|ì§œì¦|ì—´ë°›|ë¶„í•´|ë¶ˆê³µí‰|ì™œë‚˜ë§Œ|ì§„ì§œ/.test(s))return'angry';
  if(/ê¸´ì¥|ë–¨ë ¤|ë¬´ì„œ|ê±±ì •|ë¶ˆì•ˆ|ì–´ë–¡í•´|ë§í–ˆ|ì‹¤ìˆ˜/.test(s))return'nervous';
  if(/ìŠ¬í”„|ìš¸ê³ |í˜ë“¤ì—ˆ|ì§€ì³|í¬ê¸°|ì‹¤íŒ¨|ì•„íŒ |ì•„í”„/.test(s))return'sad';
  if(/ê°ì‚¬|ë”°ëœ»|ë“ ë“ |ê³ ë§ˆì›Œ|ì‚¬ë‘|ì†Œì¤‘|í–‰ìš´|ìœ„ë¡œ/.test(s))return'happy';
  return'neutral';
}

// â”€â”€â”€ ê³µí†µ Gemini í…ìŠ¤íŠ¸ í˜¸ì¶œ (ì„œë²„ or ì§ì ‘) â”€â”€â”€
async function callGemini(prompt,maxTokens=600){
  try{
    const r=await fetch(`${API_BASE}/gemini`,{method:'POST',headers:{'Content-Type':'application/json'},body:JSON.stringify({prompt,maxTokens,temperature:0.92})});
    if(!r.ok)throw new Error(`${r.status}`);
    const d=await r.json();return d.text||null;
  }catch(e){console.warn('[text]',e);return null;}
}

// â”€â”€â”€ ìŒì„± â†’ ì„œë²„ ë¼ìš°íŠ¸(/api/gemini-audio)ë¡œ ì „ë‹¬ â”€â”€â”€
async function transcribeAudio(blob,mimeType){
  try{
    const base64=await blobToBase64(blob);
    const cleanMime=mimeType.split(';')[0]||'audio/webm';
    const r=await fetch(`${API_BASE}/gemini-audio`,{
      method:'POST',
      headers:{'Content-Type':'application/json'},
      body:JSON.stringify({
        audioData:base64,
        mimeType:cleanMime,
        prompt:`ì•„ë˜ ì˜¤ë””ì˜¤ë¥¼ í•œêµ­ì–´ë¡œ ë°›ì•„ì“°ê¸°í•˜ê³ , ë‚´ìš©ì„ ê¹Šì´ ë¶„ì„í•˜ì—¬ ì•„ë˜ JSON í˜•ì‹ìœ¼ë¡œë§Œ ì‘ë‹µí•˜ì„¸ìš”.

{
  "transcript": "ì „ì²´ ë°›ì•„ì“°ê¸° ë‚´ìš© (ìµœëŒ€í•œ ì›ë¬¸ ê·¸ëŒ€ë¡œ)",
  "keywords": ["í•µì‹¬ í‚¤ì›Œë“œ1", "í‚¤ì›Œë“œ2", "í‚¤ì›Œë“œ3", "í‚¤ì›Œë“œ4", "í‚¤ì›Œë“œ5"],
  "mood": "happy|excited|sad|angry|lonely|nostalgic|nervous|neutral ì¤‘ ê°ì •ì´ ê°€ì¥ ê°•í•˜ê²Œ ë“œëŸ¬ë‚œ í•˜ë‚˜",
  "mood_intensity": "low|medium|high (ê°ì •ì˜ ê°•ë„)",
  "emotion_detail": "ì´ ì°ì—ì„œ ëŠê»´ì§€ëŠ” ê°ì •ì„ 2~3ë¬¸ì¥ìœ¼ë¡œ ì„¬ì„¸í•˜ê²Œ ë¬˜ì‚¬. ì˜ˆ: ì–µìš¸í•¨ ì†ì— ì„œìš´í•¨ì´ ì„ì¸ ë³µì¡í•œ ê°ì •, ì›ƒê¸°ì§€ë§Œ ì°¡í•œ ê³µê°ê°ì  ì´ì•¼ê¸° ë“±",
  "story_context": {
    "situation": "ì–´ë–¤ ìƒí™©ì¸ì§€ í•œ ì¤„ (ì˜ˆ: ì „ ë‚¨ìì¹œêµ¬ì™€ì˜ ì´ë³„ ì°, ì§ì¥ ìƒì‚¬ì—ê²Œ ì¹˜ì¸ ë‚ )",
    "relation": "ë“±ì¥í•˜ëŠ” ê´€ê³„ (ì˜ˆ: ì—°ì¸, ì¹œêµ¬, ê°€ì¡±, ì§ì¥ë™ë£Œ, ëª¨ë¥´ëŠ”ì‚¬ëŒ ë“±)",
    "turning_point": "ì°ì˜ ë°˜ì „ ë˜ëŠ” í•µì‹¬ ì‚¬ê±´ í•œ ì¤„",
    "tone": "ìœ ë¨¸ëŸ¬ìŠ¤|ê°ë™ì |ê³µê°í˜•|í™©ë‹¹í•¨|ì–µìš¸í•¨|ë­‰í´í•¨|ì”ì“¸í•¨|ì„¤ë ˜ ì¤‘ í•˜ë‚˜"
  }
}

JSON ì™¸ ë‹¤ë¥¸ í…ìŠ¤íŠ¸ ì—†ì´. ì˜¤ë””ì˜¤ê°€ ì§§ê±°ë‚˜ ë¶ˆëª…í™•í•´ë„ ë“¤ë¦° ë‚´ìš© ìµœëŒ€í•œ ë°˜ì˜.`
      })
    });
    if(!r.ok)throw new Error(`${r.status}`);
    const d=await r.json();
    return d.result||null;
  }catch(e){console.warn('[STT]',e);return null;}
}

function blobToBase64(blob){
  return new Promise((res,rej)=>{
    const reader=new FileReader();
    reader.onload=()=>res(reader.result.split(',')[1]);
    reader.onerror=rej;
    reader.readAsDataURL(blob);
  });
}

// ì´ë¯¸ì§€ ìƒì„± â€” ì° ê°ì •/ìƒí™©ì„ í‘œì •ì— ì™„ì „ ë°˜ì˜
async function generateCharImage(foodName,mood,moodIntensity='medium',emotionDetail='',storyContext={}){
  const face=MOOD_FACE[mood]||MOOD_FACE.neutral;

  // ê°ì • ê°•ë„ì— ë”°ë¥¸ í‘œì • ê°•ì¡° ë ˆë²¨
  const intensityNote={
    low:'Subtle, understated expression â€” the emotion is there but quietly simmering beneath the surface.',
    medium:'Clear and readable expression â€” the emotion is evident and naturally displayed.',
    high:'VERY EXAGGERATED expression â€” push the emotion to its visual extreme, maximum kawaii expressiveness!'
  }[moodIntensity]||'Clear and readable expression.';

  // ì° ë§¥ë½ì—ì„œ ì¶”ê°€ í‘œì • íŒíŠ¸ ì¶”ì¶œ
  const toneMap={
    'ìœ ë¨¸ëŸ¬ìŠ¤':'Add a tiny mischievous smirk or one raised eyebrow for comic effect.',
    'ê°ë™ì ':'Eyes slightly glistening, warm gentle smile, soft glow around character.',
    'ê³µê°í˜•':'Knowing nod-like expression, warm open eyes, understanding smile.',
    'í™©ë‹¹í•¨':'One eyebrow raised dramatically, mouth slightly open in disbelief, sweat drop.',
    'ì–µìš¸í•¨':'Furrowed brow, watery frustrated eyes, mouth tight with suppressed feelings.',
    'ë­‰í´í•¨':'Soft eyes with a single glimmering tear, gentle trembling smile.',
    'ì”ì“¸í•¨':'Wry half-smile, slightly downcast eyes, nostalgic distant gaze.',
    'ì„¤ë ˜':'Cheeks flushed bright pink, sparkles in eyes, small involuntary smile.',
  };
  const toneHint=storyContext.tone?toneMap[storyContext.tone]||'':'';
  const situationHint=storyContext.situation?`STORY CONTEXT: This character just experienced â€” "${storyContext.situation}". Let that backstory show in the posture and expression.`:'';

  const prompt=`Create a cute kawaii chibi food character illustration.

CHARACTER IDENTITY: The entire body IS a "${foodName}". Visual reference: ${getFoodHint(foodName)}. The food must be INSTANTLY RECOGNIZABLE â€” this is the most important visual rule.

FACIAL EXPRESSION (second most critical element):
Base emotion: ${face}
Intensity level: ${intensityNote}
${toneHint?`Tone nuance: ${toneHint}`:''}
${emotionDetail?`Emotional layer: "${emotionDetail}" â€” translate this nuanced feeling into the face.`:''}
${situationHint}

BODY LANGUAGE: Thin stick arms and legs. Arm position should subtly reflect the mood â€” e.g. arms crossed for anger, one hand on cheek for sadness, arms spread wide for excitement, hands clasped nervously. Small rosy blush circles on cheeks.

STYLE RULES: Clean flat kawaii illustration, LINE Friends / Kakao Friends aesthetic. Bold black outlines. Pure white (#FFFFFF) background. No text, no shadows, perfectly centered. The character must feel ALIVE with unmistakable personality that matches the emotional story.`;

  try{
    const r=await fetch(`${API_BASE}/gemini-image`,{method:'POST',headers:{'Content-Type':'application/json'},body:JSON.stringify({prompt})});
    if(!r.ok)throw new Error(`${r.status}`);
    const d=await r.json();
    if(d.imageData)return`data:${d.mimeType};base64,${d.imageData}`;
  }catch(e){console.warn('[image]',e);}
  throw new Error('ì´ë¯¸ì§€ ìƒì„± ì‹¤íŒ¨');
}

function getField(text,key){const m=text.match(new RegExp(key+':\\s*(.+?)(?=\\n[ê°€-í£A-Za-z0-9]+:|$)','s'));return m?m[1].trim().replace(/\n/g,' '):'';}

// â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
//  LOADING STEPS
// â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
function setLoadingStep(id){
  ['lstep-stt','lstep-mood','lstep-img','lstep-analysis'].forEach(sid=>{
    const el=document.getElementById(sid);
    el.classList.remove('active','done');
    if(sid===id)el.classList.add('active');
    // mark previous as done
  });
  const order=['lstep-stt','lstep-mood','lstep-img','lstep-analysis'];
  const idx=order.indexOf(id);
  order.slice(0,idx).forEach(sid=>document.getElementById(sid).classList.add('done'));
}
function doneLoadingStep(id){document.getElementById(id)?.classList.replace('active','done');}

// â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
//  MAIN BUILD RESULT
// â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
async function buildResult(foodName){
  const hasStory=!!foodName;

  document.getElementById('result-loading-screen').style.display='flex';
  document.getElementById('result-content').style.display='none';
  ['lstep-stt','lstep-mood','lstep-img','lstep-analysis'].forEach(id=>{
    const el=document.getElementById(id);
    el.classList.remove('active','done');
    el.style.display=(id==='lstep-stt'||id==='lstep-img')&&!hasStory?'none':'';
  });

  const totals={A:0,B:0,C:0,D:0};
  answers.forEach(sc=>Object.entries(sc).forEach(([k,v])=>totals[k]+=v));
  const topType=Object.entries(totals).sort((a,b)=>b[1]-a[1])[0][0];
  const res=scoreResults.find(r=>r.type===topType);
  const loadingMsg=document.getElementById('loading-msg');

  let story='',keywords=[],emotionDetail='',storyContext={},moodIntensity='medium',mood='neutral';

  if(hasStory){
    setLoadingStep('lstep-stt');
    loadingMsg.innerHTML='ìŒì„±ì„ í…ìŠ¤íŠ¸ë¡œ ë³€í™˜ ì¤‘...<br><span style="font-size:12px;opacity:.6">Geminiê°€ ë°›ì•„ì“°ê³  ìˆì–´ìš” ğŸ“</span>';
    const mime=getSupportedMimeType()||'audio/webm';
    const sttResult=currentBlob?await transcribeAudio(currentBlob,mime):null;
    story=sttResult?.transcript||''; savedStory=story;
    keywords=sttResult?.keywords||[];
    emotionDetail=sttResult?.emotion_detail||'';
    storyContext=sttResult?.story_context||{};
    moodIntensity=sttResult?.mood_intensity||'medium';
    const sttMood=sttResult?.mood;
    doneLoadingStep('lstep-stt');

    setLoadingStep('lstep-mood');
    loadingMsg.innerHTML='ì°ì˜ ê°ì •ì„ ì½ëŠ” ì¤‘...<br><span style="font-size:12px;opacity:.6">ë¶„ìœ„ê¸° íŒŒì•… â†’ ìºë¦­í„° í‘œì • ê²°ì • ì¤‘ ğŸ­</span>';
    if(sttMood&&MOOD_MAP[sttMood])mood=sttMood;
    else{
      const moodFromApi=await callGemini(`ì•„ë˜ ì°ì˜ í•µì‹¬ ê°ì •ì„ ë”± í•˜ë‚˜ë§Œ ê³¨ë¼ì£¼ì„¸ìš”.\nì„ íƒì§€: happy / excited / sad / angry / lonely / nostalgic / nervous / neutral\n[ì°] "${story.slice(0,200)}"\në°˜ë“œì‹œ ìœ„ ì„ íƒì§€ ì¤‘ ì˜ì–´ í•˜ë‚˜ë§Œ ë‹µí•˜ì„¸ìš”. ì„¤ëª… ì—†ì´.`,10);
      const parsedMood=moodFromApi?.trim().toLowerCase().split(/\W/)[0];
      mood=MOOD_MAP[parsedMood]?parsedMood:detectMoodLocal(story);
    }
    doneLoadingStep('lstep-mood');
  } else {
    loadingMsg.innerHTML='ì„±í–¥ ë¶„ì„ ì¤‘...<br><span style="font-size:12px;opacity:.6">ë‚˜ì˜ ìŒì‹ ìœ í˜•ì„ íŒŒì•…í•˜ëŠ” ì¤‘ ğŸ½ï¸</span>';
    setLoadingStep('lstep-analysis');
    await new Promise(r=>setTimeout(r,400));
  }

  const moodData=MOOD_MAP[mood]||MOOD_MAP.neutral;

  document.getElementById('result-loading-screen').style.display='none';
  document.getElementById('result-content').style.display='block';

  // ì„±í–¥ ì¹´ë“œ
  const charSVGs={
    A:`<svg viewBox="0 0 120 130" xmlns="http://www.w3.org/2000/svg">
  <defs>
    <radialGradient id="broth" cx="50%" cy="40%">
      <stop offset="0%" stop-color="#ff8c40"/>
      <stop offset="100%" stop-color="#c0390a"/>
    </radialGradient>
    <radialGradient id="pot" cx="40%" cy="30%">
      <stop offset="0%" stop-color="#e84040"/>
      <stop offset="100%" stop-color="#9a1010"/>
    </radialGradient>
  </defs>
  <!-- ëƒ„ë¹„ ê·¸ë¦¼ì -->
  <ellipse cx="60" cy="118" rx="38" ry="7" fill="#600" opacity=".18"/>
  <!-- ëƒ„ë¹„ ë°”ë‹¥/ëª¸í†µ -->
  <path d="M18 72 Q16 108 60 110 Q104 108 102 72 Z" fill="url(#pot)"/>
  <!-- ëƒ„ë¹„ ì¸¡ë©´ í•˜ì´ë¼ì´íŠ¸ -->
  <path d="M22 72 Q20 102 60 106 Q100 102 98 72" fill="none" stroke="#ff6060" stroke-width="1.5" opacity=".4"/>
  <!-- ì†ì¡ì´ L -->
  <path d="M18 74 Q6 74 5 82 Q4 90 14 90" stroke="#b01010" stroke-width="7" fill="none" stroke-linecap="round"/>
  <!-- ì†ì¡ì´ R -->
  <path d="M102 74 Q114 74 115 82 Q116 90 106 90" stroke="#b01010" stroke-width="7" fill="none" stroke-linecap="round"/>
  <!-- êµ­ë¬¼ í‘œë©´ -->
  <ellipse cx="60" cy="72" rx="42" ry="13" fill="url(#broth)"/>
  <!-- êµ­ë¬¼ ìœ¤ìŠ¬ -->
  <ellipse cx="48" cy="68" rx="10" ry="4" fill="#ffb060" opacity=".45" transform="rotate(-15 48 68)"/>
  <ellipse cx="72" cy="75" rx="7" ry="2.5" fill="#ffb060" opacity=".3" transform="rotate(10 72 75)"/>
  <!-- ë¹¨ê°„ ê³ ì¶”ê¸°ë¦„ ë°©ìš¸ë“¤ -->
  <circle cx="38" cy="70" r="4" fill="#e02020" opacity=".85"/>
  <circle cx="55" cy="64" r="3" fill="#c01010" opacity=".8"/>
  <circle cx="76" cy="68" r="5" fill="#e02020" opacity=".9"/>
  <circle cx="65" cy="78" r="3.5" fill="#d01818" opacity=".75"/>
  <!-- ë‘ë¶€ ì¡°ê° -->
  <rect x="28" y="60" width="16" height="10" rx="2" fill="#fff8e8" opacity=".9"/>
  <rect x="29" y="61" width="14" height="8" rx="1" fill="none" stroke="#e8d0a0" stroke-width="0.8"/>
  <!-- ë²„ì„¯ -->
  <path d="M82 65 Q86 56 94 62 Q92 68 82 65Z" fill="#c8a070"/>
  <line x1="88" y1="62" x2="88" y2="70" stroke="#c8a070" stroke-width="2"/>
  <!-- ë–¡ë³¶ì´ ë–¡ (ì›í†µ) -->
  <rect x="42" y="58" width="8" height="20" rx="4" fill="#fff0d8"/>
  <ellipse cx="46" cy="58" rx="4" ry="2.5" fill="#ffe0b0"/>
  <ellipse cx="46" cy="78" rx="4" ry="2.5" fill="#ffe0b0"/>
  <!-- ìˆ™ì£¼ë‚˜ë¬¼ -->
  <path d="M60 62 Q64 55 68 60" stroke="#a0c870" stroke-width="2" fill="none" stroke-linecap="round"/>
  <path d="M56 66 Q58 58 62 63" stroke="#a0c870" stroke-width="2" fill="none" stroke-linecap="round"/>
  <!-- ê¹€(ì¦ê¸°) -->
  <path d="M34 60 Q31 50 34 40 Q37 32 34 22" stroke="#ddd" stroke-width="2.5" fill="none" stroke-linecap="round" opacity=".5"/>
  <path d="M60 58 Q57 48 60 38 Q63 28 60 18" stroke="#ddd" stroke-width="2.5" fill="none" stroke-linecap="round" opacity=".45"/>
  <path d="M86 60 Q83 50 86 40 Q89 32 86 22" stroke="#ddd" stroke-width="2.5" fill="none" stroke-linecap="round" opacity=".5"/>
  <!-- ëƒ„ë¹„ í…Œë‘ë¦¬ -->
  <ellipse cx="60" cy="72" rx="42" ry="13" fill="none" stroke="#ff4040" stroke-width="2.5"/>
  <ellipse cx="60" cy="72" rx="38" ry="10" fill="none" stroke="#ff8060" stroke-width="1" opacity=".5"/>
</svg>`,
    B:`<svg viewBox="0 0 120 130" xmlns="http://www.w3.org/2000/svg">
  <defs>
    <linearGradient id="cakeBase" x1="0" y1="0" x2="0" y2="1">
      <stop offset="0%" stop-color="#fff0f5"/>
      <stop offset="100%" stop-color="#ffd6e0"/>
    </linearGradient>
    <linearGradient id="cakeMid" x1="0" y1="0" x2="0" y2="1">
      <stop offset="0%" stop-color="#fff"/>
      <stop offset="100%" stop-color="#ffe8f0"/>
    </linearGradient>
    <radialGradient id="strawberry" cx="40%" cy="30%">
      <stop offset="0%" stop-color="#ff6070"/>
      <stop offset="100%" stop-color="#cc1030"/>
    </radialGradient>
  </defs>
  <!-- ê·¸ë¦¼ì -->
  <ellipse cx="60" cy="122" rx="38" ry="6" fill="#e090a0" opacity=".2"/>
  <!-- ì¼€ì´í¬ í•˜ë‹¨ ë ˆì´ì–´ -->
  <rect x="14" y="85" width="92" height="30" rx="10" fill="url(#cakeBase)"/>
  <rect x="14" y="85" width="92" height="8" rx="5" fill="#ffc0d0"/>
  <!-- í•˜ë‹¨ í¬ë¦¼ íŒŒì´í•‘ -->
  <path d="M14 85 Q20 78 26 85 Q32 78 38 85 Q44 78 50 85 Q56 78 62 85 Q68 78 74 85 Q80 78 86 85 Q92 78 98 85 Q104 78 106 85" fill="#ffb3c6" stroke="none"/>
  <!-- í•˜ë‹¨ ì¼ -->
  <rect x="20" y="93" width="80" height="5" rx="2" fill="#ff6080" opacity=".5"/>
  <!-- ì¤‘ë‹¨ ë ˆì´ì–´ -->
  <rect x="18" y="60" width="84" height="27" rx="8" fill="url(#cakeMid)"/>
  <!-- ì¤‘ë‹¨ í¬ë¦¼ íŒŒì´í•‘ -->
  <path d="M18 60 Q24 53 30 60 Q36 53 42 60 Q48 53 54 60 Q60 53 66 60 Q72 53 78 60 Q84 53 90 60 Q96 53 102 60" fill="#ffb3c6" stroke="none"/>
  <!-- ì¤‘ë‹¨ ìŠ¤íŠ¸ë¡œë² ë¦¬ì¼ -->
  <rect x="24" y="68" width="72" height="4" rx="2" fill="#ff4060" opacity=".4"/>
  <!-- ìƒë‹¨ í¬ë¦¼ ë ˆì´ì–´ -->
  <rect x="22" y="38" width="76" height="24" rx="8" fill="#fff"/>
  <!-- ìƒë‹¨ í¬ë¦¼ íŒŒì´í•‘ -->
  <path d="M22 38 Q28 31 34 38 Q40 31 46 38 Q52 31 58 38 Q64 31 70 38 Q76 31 82 38 Q88 31 94 38 Q98 34 98 38" fill="#ffc8d8" stroke="none"/>
  <!-- ë”¸ê¸°ë“¤ (ìƒë‹¨) -->
  <path d="M36 34 Q34 22 42 20 Q50 22 48 34 Q44 38 36 34Z" fill="url(#strawberry)"/>
  <path d="M37 22 Q40 17 43 22" stroke="#228820" stroke-width="1.5" fill="none" stroke-linecap="round"/>
  <circle cx="39" cy="28" r="1" fill="#fff" opacity=".5"/>
  <circle cx="44" cy="25" r="0.8" fill="#fff" opacity=".45"/>
  <path d="M58 32 Q56 22 63 20 Q70 22 68 32 Q64 36 58 32Z" fill="url(#strawberry)"/>
  <path d="M59 22 Q62 17 65 22" stroke="#228820" stroke-width="1.5" fill="none" stroke-linecap="round"/>
  <circle cx="61" cy="27" r="1" fill="#fff" opacity=".5"/>
  <path d="M78 35 Q76 25 83 23 Q90 25 88 35 Q84 39 78 35Z" fill="url(#strawberry)"/>
  <path d="M79 25 Q82 20 85 25" stroke="#228820" stroke-width="1.5" fill="none" stroke-linecap="round"/>
  <circle cx="81" cy="30" r="1" fill="#fff" opacity=".5"/>
  <!-- ìƒí¬ë¦¼ ë°©ìš¸ -->
  <ellipse cx="52" cy="37" rx="4" ry="3" fill="white"/>
  <ellipse cx="70" cy="38" rx="3.5" ry="2.5" fill="white"/>
  <!-- ì´ˆ -->
  <rect x="56" y="12" width="8" height="26" rx="4" fill="#ffe066"/>
  <path d="M60 12 Q58 6 60 4 Q62 2 64 5 Q62 8 60 12Z" fill="#ff8c00"/>
  <ellipse cx="60" cy="5" rx="2.5" ry="3.5" fill="#ffee44" opacity=".9"/>
  <!-- ë¶„í™ ë¦¬ë³¸ ì¥ì‹ -->
  <path d="M14 95 Q60 100 106 95" stroke="#ffb3c6" stroke-width="3" fill="none" stroke-dasharray="4 3" opacity=".7"/>
</svg>`,
    C:`<svg viewBox="0 0 120 130" xmlns="http://www.w3.org/2000/svg">
  <defs>
    <linearGradient id="wineColor" x1="0" y1="0" x2="0" y2="1">
      <stop offset="0%" stop-color="#b030d0"/>
      <stop offset="100%" stop-color="#6a0080"/>
    </linearGradient>
    <linearGradient id="glassBody" x1="0" y1="0" x2="1" y2="0">
      <stop offset="0%" stop-color="#e8d0f8" stop-opacity=".9"/>
      <stop offset="50%" stop-color="#fff" stop-opacity=".15"/>
      <stop offset="100%" stop-color="#c8a8e8" stop-opacity=".8"/>
    </linearGradient>
    <radialGradient id="wineShine" cx="35%" cy="35%">
      <stop offset="0%" stop-color="#e878ff" stop-opacity=".6"/>
      <stop offset="100%" stop-color="#9000c0" stop-opacity="0"/>
    </radialGradient>
  </defs>
  <!-- ê·¸ë¦¼ì -->
  <ellipse cx="60" cy="124" rx="28" ry="5" fill="#9040b0" opacity=".18"/>
  <!-- ë°›ì¹¨ëŒ€ -->
  <ellipse cx="60" cy="120" rx="26" ry="6" fill="#d0a0e8"/>
  <ellipse cx="60" cy="118" rx="22" ry="4" fill="#e8c0f8"/>
  <!-- ê¸°ë‘¥ -->
  <rect x="56" y="88" width="8" height="32" rx="4" fill="#d8b0ec"/>
  <!-- ì” í•˜ë‹¨ ë²Œì–´ì§€ëŠ” ë¶€ë¶„ -->
  <path d="M40 88 Q48 96 56 92 L64 92 Q72 96 80 88 Q72 82 60 80 Q48 82 40 88Z" fill="#d8b0ec"/>
  <!-- ì™€ì¸ ì•¡ì²´ -->
  <path d="M28 50 Q26 75 40 85 Q48 90 60 90 Q72 90 80 85 Q94 75 92 50 Z" fill="url(#wineColor)"/>
  <!-- ì™€ì¸ í‘œë©´ -->
  <ellipse cx="60" cy="50" rx="32" ry="10" fill="#c040e0"/>
  <!-- ì™€ì¸ í‘œë©´ ê´‘íƒ -->
  <ellipse cx="50" cy="47" rx="12" ry="4" fill="#d878f0" opacity=".5" transform="rotate(-10 50 47)"/>
  <!-- ì™€ì¸ ë‚´ë¶€ ë°˜ì‚¬ê´‘ -->
  <path d="M36 60 Q40 70 44 80" stroke="#e060f0" stroke-width="3" fill="none" stroke-linecap="round" opacity=".35"/>
  <!-- ì” ìœ ë¦¬ (íˆ¬ëª…) -->
  <path d="M28 50 Q24 76 40 86 Q48 92 60 92 Q72 92 80 86 Q96 76 92 50 Q80 30 60 26 Q40 30 28 50Z" fill="url(#glassBody)"/>
  <!-- ì” ìœ ë¦¬ í…Œë‘ë¦¬ -->
  <path d="M28 50 Q24 76 40 86 Q48 92 60 92 Q72 92 80 86 Q96 76 92 50" fill="none" stroke="#c8a0e0" stroke-width="2"/>
  <!-- ìœ ë¦¬ í•˜ì´ë¼ì´íŠ¸ (ì™¼ìª½) -->
  <path d="M32 48 Q28 65 34 80" stroke="white" stroke-width="4" fill="none" stroke-linecap="round" opacity=".35"/>
  <!-- ìœ ë¦¬ í•˜ì´ë¼ì´íŠ¸ (ì‘ì€) -->
  <path d="M36 38 Q33 45 35 52" stroke="white" stroke-width="2.5" fill="none" stroke-linecap="round" opacity=".25"/>
  <!-- ì” í…Œë‘ë¦¬ -->
  <ellipse cx="60" cy="26" rx="32" ry="8" fill="none" stroke="#d0b0e8" stroke-width="2.5"/>
  <ellipse cx="60" cy="50" rx="32" ry="10" fill="none" stroke="#c090d8" stroke-width="1.5" opacity=".6"/>
  <!-- ê¸°í¬ë“¤ -->
  <circle cx="50" cy="70" r="2.5" fill="none" stroke="#e080ff" stroke-width="1.2" opacity=".7"/>
  <circle cx="65" cy="60" r="2" fill="none" stroke="#e080ff" stroke-width="1" opacity=".6"/>
  <circle cx="55" cy="55" r="1.5" fill="none" stroke="#e080ff" stroke-width="0.8" opacity=".5"/>
  <circle cx="72" cy="72" r="3" fill="none" stroke="#e080ff" stroke-width="1.2" opacity=".6"/>
  <circle cx="44" cy="80" r="2" fill="none" stroke="#e080ff" stroke-width="1" opacity=".5"/>
  <!-- ë°˜ì§ì´ ë³„ -->
  <path d="M100 30 L101.5 34 L106 34 L102.5 37 L104 41 L100 38.5 L96 41 L97.5 37 L94 34 L98.5 34Z" fill="#d4a0f0" opacity=".75" transform="scale(0.7) translate(45 18)"/>
  <path d="M15 45 L16 48 L19 48 L16.5 50 L17.5 53 L15 51.5 L12.5 53 L13.5 50 L11 48 L14 48Z" fill="#d4a0f0" opacity=".6" transform="scale(0.65) translate(-8 14)"/>
</svg>`,
    D:`<svg viewBox="0 0 120 130" xmlns="http://www.w3.org/2000/svg">
  <defs>
    <radialGradient id="haejang" cx="50%" cy="40%">
      <stop offset="0%" stop-color="#ff9050"/>
      <stop offset="100%" stop-color="#c04010"/>
    </radialGradient>
    <radialGradient id="dduk" cx="40%" cy="30%">
      <stop offset="0%" stop-color="#5c3015"/>
      <stop offset="100%" stop-color="#3a1a08"/>
    </radialGradient>
  </defs>
  <!-- ê·¸ë¦¼ì -->
  <ellipse cx="60" cy="122" rx="40" ry="6" fill="#6b3010" opacity=".18"/>
  <!-- ëšë°°ê¸° ë°”ë‹¥/ëª¸í†µ -->
  <path d="M16 68 Q12 108 60 112 Q108 108 104 68 Z" fill="url(#dduk)"/>
  <!-- ëšë°°ê¸° ì˜†ë©´ í…ìŠ¤ì²˜ -->
  <path d="M20 68 Q17 100 60 108 Q103 100 100 68" fill="none" stroke="#7a4820" stroke-width="1.2" opacity=".5"/>
  <path d="M24 70 Q22 98 60 105" fill="none" stroke="#8a5020" stroke-width="0.8" opacity=".35"/>
  <!-- ì†ì¡ì´ L -->
  <path d="M16 70 Q4 72 3 82 Q2 92 14 92" stroke="#4a2008" stroke-width="8" fill="none" stroke-linecap="round"/>
  <path d="M16 70 Q5 72 4 82 Q3 91 14 92" stroke="#6a3010" stroke-width="5" fill="none" stroke-linecap="round"/>
  <!-- ì†ì¡ì´ R -->
  <path d="M104 70 Q116 72 117 82 Q118 92 106 92" stroke="#4a2008" stroke-width="8" fill="none" stroke-linecap="round"/>
  <path d="M104 70 Q115 72 116 82 Q117 91 106 92" stroke="#6a3010" stroke-width="5" fill="none" stroke-linecap="round"/>
  <!-- êµ­ë¬¼ í‘œë©´ -->
  <ellipse cx="60" cy="68" rx="44" ry="13" fill="url(#haejang)"/>
  <!-- êµ­ë¬¼ ê´‘íƒ -->
  <ellipse cx="46" cy="63" rx="12" ry="4" fill="#ffb870" opacity=".4" transform="rotate(-12 46 63)"/>
  <!-- ëšë°°ê¸° í…Œë‘ë¦¬ -->
  <ellipse cx="60" cy="68" rx="44" ry="13" fill="none" stroke="#8a4820" stroke-width="3"/>
  <ellipse cx="60" cy="68" rx="40" ry="10" fill="none" stroke="#c07040" stroke-width="1.2" opacity=".5"/>
  <!-- íŒŒ (ê³ ëª…) -->
  <path d="M28 64 Q34 58 40 64" stroke="#4a9040" stroke-width="3" fill="none" stroke-linecap="round"/>
  <path d="M30 66 Q36 60 42 66" stroke="#60a850" stroke-width="2" fill="none" stroke-linecap="round"/>
  <circle cx="28" cy="64" r="2.5" fill="#3a7830"/>
  <circle cx="42" cy="64" r="2.5" fill="#3a7830"/>
  <!-- íŒŒ (ì˜¤ë¥¸ìª½) -->
  <path d="M74 62 Q80 56 86 62" stroke="#4a9040" stroke-width="3" fill="none" stroke-linecap="round"/>
  <path d="M76 65 Q82 59 88 65" stroke="#60a850" stroke-width="2" fill="none" stroke-linecap="round"/>
  <!-- ê³ ê¸° ë©ì–´ë¦¬ -->
  <path d="M48 60 Q58 54 68 60 Q70 68 60 70 Q50 68 48 60Z" fill="#c06840"/>
  <path d="M50 61 Q58 56 66 61" stroke="#e08858" stroke-width="1.5" fill="none" opacity=".6"/>
  <!-- ë‹¬ê±€ ë°˜ìª½ -->
  <ellipse cx="48" cy="74" rx="10" ry="7" fill="#fff8e0"/>
  <ellipse cx="48" cy="74" rx="5" ry="4" fill="#f5c040"/>
  <!-- ë‘ë¶€ -->
  <rect x="74" y="68" width="16" height="10" rx="2" fill="#fff8e8"/>
  <rect x="75" y="69" width="14" height="8" rx="1" fill="none" stroke="#e0d0a8" stroke-width="0.8"/>
  <!-- ê¹€(ì¦ê¸°) -->
  <path d="M36 56 Q33 46 36 36 Q39 26 36 16" stroke="#ccc" stroke-width="2.5" fill="none" stroke-linecap="round" opacity=".5"/>
  <path d="M60 54 Q57 44 60 34 Q63 24 60 14" stroke="#ccc" stroke-width="2.5" fill="none" stroke-linecap="round" opacity=".45"/>
  <path d="M84 56 Q81 46 84 36 Q87 26 84 16" stroke="#ccc" stroke-width="2.5" fill="none" stroke-linecap="round" opacity=".5"/>
</svg>`
  };
  document.getElementById('personality-emoji').innerHTML=charSVGs[res.type]||res.e;
  savedResult=res; savedFoodName=foodName||''; savedMood=mood;
  document.getElementById('personality-food-type').textContent=`${res.food} íƒ€ì…`;
  document.getElementById('personality-type-tag').textContent=res.tag;
  document.getElementById('personality-desc').textContent=res.desc;

  // ë‹µë³€ ë¦¬ìº¡
  let recapHtml='';
  answerLabels.forEach((item,qi)=>{const c=item.opts[item.chosen];recapHtml+=`<div class="recap-q"><div class="recap-q-text">Q${qi+1}. ${item.q}</div><div class="recap-opt-chosen"><span class="recap-check">âœ“</span><span style="font-size:16px">${c.e}</span><span>${c.t}</span></div></div>`;});
  document.getElementById('quiz-recap-body').innerHTML=recapHtml;

  if(hasStory){
    document.getElementById('story-oneliner-block').style.display='block';
    document.getElementById('quiz-zone-title').textContent='7ê°œ ì§ˆë¬¸ì´ ë§í•˜ëŠ” ë‚˜';

    const intensityLabel={'low':'ì”ì”í•˜ê²Œ ','medium':'','high':'ê°•ë ¬í•˜ê²Œ '}[moodIntensity]||'';
    document.getElementById('char-food-name').textContent=`${foodName} ìºë¦­í„°`;
    document.getElementById('mood-badge-wrap').innerHTML=`<div class="mood-badge" style="background:${moodData.badgeBg};border-color:${moodData.border};color:${moodData.badgeColor}">${moodData.emoji} ${intensityLabel}${moodData.label}</div>`;
    document.getElementById('char-sub-tag').textContent=`#${foodName}ìºë¦­í„° #ì°í‘¸ë“œ${storyContext.tone?` #${storyContext.tone}`:''}`;
    document.getElementById('char-img-wrap').style.background=moodData.bg;

    if(story){
      document.getElementById('story-recap-content').textContent=story;
      document.getElementById('story-recap-card').style.display='block';
      if(storyContext.situation||storyContext.tone){
        const ctxEl=document.createElement('div');
        ctxEl.style.cssText='display:flex;flex-wrap:wrap;gap:6px;margin-bottom:10px;';
        const ctxItems=[storyContext.situation?`ğŸ“ ${storyContext.situation}`:'',storyContext.relation?`ğŸ‘¥ ${storyContext.relation}`:'',storyContext.tone?`ğŸ­ ${storyContext.tone}`:''].filter(Boolean);
        ctxEl.innerHTML=ctxItems.map(c=>`<span style="padding:4px 10px;background:rgba(212,149,106,.1);border:1px solid rgba(212,149,106,.25);border-radius:20px;font-size:11px;color:var(--caramel);font-weight:600">${c}</span>`).join('');
        document.getElementById('story-recap-card').querySelector('.recap-story').before(ctxEl);
      }
      if(keywords.length){
        document.getElementById('keywords-row').innerHTML=keywords.map(k=>`<span class="kw-chip"># ${k}</span>`).join('');
        document.getElementById('keywords-wrap').style.display='block';
      }
    }

    setLoadingStep('lstep-img');
    generateCharImage(foodName,mood,moodIntensity,emotionDetail,storyContext).then(url=>{
      doneLoadingStep('lstep-img');
      document.getElementById('char-img').src=url;
      document.getElementById('char-img').style.display='block';
      document.getElementById('char-loading-inner').style.display='none';
    }).catch(()=>{
      doneLoadingStep('lstep-img');
      document.getElementById('char-loading-inner').innerHTML=`<span style="font-size:36px">${moodData.emoji}</span>`;
    });

    doStoryOneliner(res,story,foodName,mood,emotionDetail,storyContext,moodIntensity).then(text=>{
      document.getElementById('oneliner-loading').style.display='none';
      const olText=document.getElementById('story-oneliner-text');
      const olTo=document.getElementById('story-oneliner-to');
      const olTags=document.getElementById('story-oneliner-tags');
      if(text){
        const summary=getField(text,'ì°í•œì¤„');
        const toYou=getField(text,'ì´ì‚¬ëŒì—ê²Œ');
        const tags=(getField(text,'íƒœê·¸').match(/#[^\s#]+/g)||[]).slice(0,5);
        const charQuote=getField(text,'ìºë¦­í„°í•œë§ˆë””');
        const foodPsy=getField(text,'ìŒì‹ì‹¬ë¦¬');
        if(summary){olText.textContent=summary;olText.style.display='block';}
        if(toYou){olTo.textContent=`"${toYou}"`;olTo.style.display='block';}
        if(tags.length){olTags.innerHTML=tags.map(t=>`<span class="ai-tag" style="background:rgba(255,255,255,.12);color:rgba(255,255,255,.8);border:none">${t}</span>`).join('');olTags.style.display='block';}
        if(charQuote){document.getElementById('char-quote-text').textContent=charQuote;document.getElementById('char-quote-wrap').style.display='block';}
        if(foodPsy){document.getElementById('story-ai-loading').style.display='none';const el=document.getElementById('story-ai-content');el.innerHTML=`<p style="color:#2a3a6a;line-height:1.9;font-size:13px">${foodPsy}</p>`;el.style.display='block';}
      } else {
        olText.textContent='ë‚´ ì°, AIë„ ì–´ì´ì—†ì—ˆë‚˜ë´ìš” ğŸ˜…';olText.style.display='block';
        document.getElementById('story-ai-loading').style.display='none';
        document.getElementById('story-ai-content').innerHTML=`<p style="color:#4a5fa0;line-height:1.8">ë…¹ìŒì´ ì—†ê±°ë‚˜ ì¸ì‹ë˜ì§€ ì•Šì•˜ì–´ìš”.<br>ë” í¬ê²Œ ë§ì”€í•´ë³´ì„¸ìš” ğŸ™ï¸</p>`;
        document.getElementById('story-ai-content').style.display='block';
      }
    });
  }

  setLoadingStep('lstep-analysis');
  setTimeout(()=>{
    doneLoadingStep('lstep-analysis');
    document.getElementById('quiz-ai-loading').style.display='none';
    const el=document.getElementById('quiz-ai-content');
    el.innerHTML=deepLocalAnalysis(answerLabels,res);
    el.style.display='block';
  },600);

  resetRecorder();
}

// â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
//  STORY ONELINER (AI)
// â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
async function doStoryOneliner(res,story,foodName,mood,emotionDetail='',storyContext={},moodIntensity='medium'){
  if(!story)return null;
  const moodData=MOOD_MAP[mood]||MOOD_MAP.neutral;
  const intensityDesc=moodIntensity==='high'?'ê°ì •ì´ í„°ì§ˆ ë“¯ ê°•ë ¬í•˜ê²Œ':moodIntensity==='low'?'ê°ì •ì´ ì”ì”í•˜ê²Œ':'ê°ì •ì´ ì ë‹¹íˆ';
  const prompt=`ë‹¹ì‹ ì€ ì° ì „ë¬¸ ì½˜í…ì¸  í¬ë¦¬ì—ì´í„°ì˜ˆìš”.
ì´ ì‚¬ëŒ ì°ì„ ì½ê³  ë‚˜ì„œ "ã…‹ã…‹ã…‹ã…‹ ì´ê±° ì™„ì „ ë‚˜ì–ì•„" ë˜ëŠ” "í—‰ ì§„ì§œ?" ë°˜ì‘ì„ ì´ëŒì–´ë‚´ëŠ” ê²Œ ëª©í‘œì˜ˆìš”.
ìœ ë¨¸, ë°ˆ, í˜„ì‹¤ ê³µê°, ì•½ê°„ì˜ ë“œë¦½ì´ í•µì‹¬ì´ì—ìš”.

â”â” ì° ì •ë³´ â”â”
[ì „ì²´ ë‚´ìš©] "${story}"
[ì£¼ì¸ê³µ ìŒì‹] ${foodName}
[ê°ì •] ${moodData.label} ${moodData.emoji} â€” ${intensityDesc} ë“œëŸ¬ë‚¨
[ê°ì • ë‰˜ì•™ìŠ¤] ${emotionDetail||moodData.label}
[ìƒí™©] ${storyContext.situation||'ë¯¸íŒŒì•…'}
[ë“±ì¥ ê´€ê³„] ${storyContext.relation||'ë¯¸íŒŒì•…'}
[í•µì‹¬ ì‚¬ê±´] ${storyContext.turning_point||'ë¯¸íŒŒì•…'}
[ì°ì˜ í†¤] ${storyContext.tone||'ë¯¸íŒŒì•…'}
[ì‘ì„±ì ì„±í–¥] ${res.food} íƒ€ì…

â”â” ì¶œë ¥ í˜•ì‹ (ë¼ë²¨ ì •í™•íˆ, ì ˆëŒ€ ë¹ ëœ¨ë¦¬ì§€ ë§ ê²ƒ) â”â”

ì°í•œì¤„: [ì´ ì°ì„ í•œ ì¤„ë¡œ ì••ì¶•. ìœ ë¨¸/ë°ˆ ìŠ¤íƒ€ì¼ë¡œ. ì½ìœ¼ë©´ í”¼ì‹ or ì°¡ or ë‚©ë“. ì´ëª¨ì§€ 1-2ê°œ í¬í•¨]

ì´ì‚¬ëŒì—ê²Œ: [ë»”í•œ ìœ„ë¡œ ë§ê³ , ì´ ì° ë‹¹ì‚¬ìì—ê²Œë§Œ í•´ì£¼ëŠ” í˜„ì‹¤ ê³µê° í•œ ë§ˆë””. 1-2ë¬¸ì¥]

ìŒì‹ì‹¬ë¦¬: [ì™œ í•˜í•„ "${foodName}"ì´ ì´ ì°ì˜ ì£¼ì¸ê³µì¸ì§€. ${foodName}ì˜ íŠ¹ì„±ì´ ì´ ê°ì •/ìƒí™©ê³¼ ì–´ë–»ê²Œ ê²¹ì¹˜ëŠ”ì§€. 3ë¬¸ì¥]

ìºë¦­í„°í•œë§ˆë””: [${foodName} ìºë¦­í„°ê°€ ì´ ìƒí™©ì—ì„œ í•  ë²•í•œ ë§ í•œ ë§ˆë””. ê·€ì—½ê±°ë‚˜ ì›ƒê¸°ê±°ë‚˜ ê³µê°ë˜ê²Œ. ë”°ì˜´í‘œ ì—†ì´]

íƒœê·¸: #íƒœê·¸1 #íƒœê·¸2 #íƒœê·¸3 #íƒœê·¸4 #íƒœê·¸5

"í˜ë‚´ì„¸ìš”" ê¸ˆì§€. ë»”í•œ ìœ„ë¡œ ê¸ˆì§€.`;
  return await callGemini(prompt,900);
}

// â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
//  DEEP LOCAL ANALYSIS (ì¡°í•© ê¸°ë°˜)
// â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
function deepLocalAnalysis(answerLabels, res) {
  // ê° ì§ˆë¬¸ë³„ ì„ íƒ ì¸ë±ìŠ¤ ì¶”ì¶œ
  const c = answerLabels.map(a => a.chosen); // 0~3, 7ê°œ
  // Qì¸ë±ìŠ¤: 0=ì§€ê¸ˆë¨¹ê³ ì‹¶ì€ê²ƒ 1=ëª‡ë¼ 2=ë°°ê³ í”„ë©´ 3=ë©”ë‰´ê³ ë¥¼ë•Œ 4=ì—°ì• ë¹„ìœ  5=ìŠ¤íŠ¸ë ˆìŠ¤ 6=ìš”ì¦˜í‘¸ëŠ”ì°

  // â”€â”€ í•œì¤„ìš”ì•½: type + Q2(ë°°ê³ í”„ë©´) + Q3(ë©”ë‰´) ì¡°í•© â”€â”€
  const hlMap = {
    A: [
      ['ğŸŒ¶ï¸ğŸ”¥ ë°°ê³ í”„ë©´ í­ë°œí•˜ëŠ”ë° ë§›ìˆìœ¼ë©´ ë‹¤ ìš©ì„œë˜ëŠ” ë§ˆë¼íƒ•í˜• ì¸ê°„', // ì˜ˆë¯¼
       'ğŸŒ¶ï¸ğŸ˜¶ ë°°ê³ íŒŒë„ ë§ ì—†ì´ ì†ìœ¼ë¡œë§Œ ë“ëŠ” ë§ˆë¼íƒ•í˜• ì¸ê°„',
       'ğŸŒ¶ï¸ğŸ—£ï¸ ë°°ê³ í”„ë©´ ì¼ë‹¨ ì•„ë¬´ ë§ì´ë‚˜ í•˜ê³  ë³´ëŠ” ë§ˆë¼íƒ•í˜• ì¸ê°„',
       'ğŸŒ¶ï¸âš¡ ë°°ê³ íŒŒë„ ê·¸ëƒ¥ ì•„ë¬´ê±°ë‚˜ ë¨¹ê³  í•´ê²°í•˜ëŠ” ë§ˆë¼íƒ•í˜• ì¸ê°„'],
      ['ğŸ‘†ğŸŒ¶ï¸ ë©”ë‰´ëŠ” ë‚´ê°€ ì •í•˜ê³  ë§µê¸°ë„ ë‚´ê°€ ì •í•˜ëŠ” ë§ˆë¼íƒ•í˜• ì¸ê°„',
       'ğŸ™ƒğŸŒ¶ï¸ ì•„ë¬´ê±°ë‚˜ í•´ë†“ê³  ê²°êµ­ ë§ˆë¼íƒ• ëŒê³  ì˜¤ëŠ” ë§ˆë¼íƒ•í˜• ì¸ê°„',
       'ğŸ«¶ğŸŒ¶ï¸ ìƒëŒ€ ì˜ê²¬ ì¡´ì¤‘í•˜ì§€ë§Œ ì†ìœ¼ë¡  ë§ˆë¼íƒ• ì™¸ì¹˜ëŠ” ë§ˆë¼íƒ•í˜• ì¸ê°„',
       'ğŸ’­ğŸŒ¶ï¸ ì†ìœ¼ë¡œ ë§ˆë¼íƒ• ìƒê°í•˜ë©´ì„œ ê²‰ìœ¼ë¡  ì•„ë¬´ê±°ë‚˜ì¸ ì²™í•˜ëŠ” ì¸ê°„']
    ],
    B: [
      ['ğŸ‚ğŸ˜¤ ë°°ê³ í”„ë©´ ì˜ˆë¯¼í•´ì§€ì§€ë§Œ ë‹¬ë‹¬í•œ ê±° ë¨¹ìœ¼ë©´ ì„¸ìƒì´ ì¢‹ì•„ì§€ëŠ” ì¼€ì´í¬í˜• ì¸ê°„',
       'ğŸ‚ğŸ¤ í˜¼ì ì¡°ìš©íˆ ë°°ê³ í”” ì°¸ë‹¤ê°€ í¸ì˜ì  ë””ì €íŠ¸ë¡œ í•´ê²°í•˜ëŠ” ì¼€ì´í¬í˜• ì¸ê°„',
       'ğŸ‚ğŸ—£ï¸ ë°°ê³ í”„ë©´ ì•„ë¬´ ë§ì´ë‚˜ í•˜ë‹¤ê°€ë„ ì¼€ì´í¬ ë³´ëŠ” ìˆœê°„ ëˆˆë¹› ë‹¬ë¼ì§€ëŠ” ì¸ê°„',
       'ğŸ‚ğŸ´ ëŒ€ì¶© ë•Œìš°ë‹¤ê°€ë„ ë””ì €íŠ¸ë§Œí¼ì€ ì§„ì§€í•˜ê²Œ ê³ ë¥´ëŠ” ì¼€ì´í¬í˜• ì¸ê°„'],
      ['ğŸ‘†ğŸ‚ ë©”ë‰´ ë‚´ê°€ ì •í•˜ëŠ”ë° ë””ì €íŠ¸ë§Œí¼ì€ ì˜¤ë˜ ê³ ë¯¼í•˜ëŠ” ì¼€ì´í¬í˜• ì¸ê°„',
       'ğŸ™ƒğŸ‚ ì•„ë¬´ê±°ë‚˜ í•´ë†“ê³  ê²°êµ­ ì¹´í˜ ë°ë ¤ê°€ëŠ” ì¼€ì´í¬í˜• ì¸ê°„',
       'ğŸ«¶ğŸ‚ ìƒëŒ€ ì˜ê²¬ ì¡´ì¤‘í•˜ì§€ë§Œ ìƒì¼ ë•Œë§Œí¼ì€ ì¼€ì´í¬ ì ˆëŒ€ ì–‘ë³´ ì•ˆ í•˜ëŠ” ì¸ê°„',
       'ğŸ’­ğŸ‚ ì†ìœ¼ë¡  ì¹´í˜ ê°€ê³  ì‹¶ì€ë° ë§ ëª» í•˜ê³  ìˆëŠ” ì¼€ì´í¬í˜• ì¸ê°„']
    ],
    C: [
      ['ğŸ·ğŸ˜¤ ë°°ê³ í”„ë©´ ì˜ˆë¯¼í•´ì§€ëŠ”ë° ì ˆëŒ€ í‹° ì•ˆ ë‚´ë ¤ê³  í•˜ëŠ” ì™€ì¸í˜• ì¸ê°„',
       'ğŸ·ğŸ¤ ë°°ê³ íŒŒë„ ì¡°ìš©íˆ ì°¸ëŠ”ë° ì•Œê³  ë³´ë©´ ì†ì´ ê½‰ ì°¬ ì™€ì¸í˜• ì¸ê°„',
       'ğŸ·ğŸ—£ï¸ ë°°ê³ í”„ë©´ ë§ì´ ë§ì•„ì§€ëŠ”ë° ë‚˜ì¤‘ì—” ë‹¤ ë…¼ë¦¬ì  ëŒ€í™”ì˜€ë˜ ì™€ì¸í˜• ì¸ê°„',
       'ğŸ·âš¡ ë°°ê³ í”„ë©´ ë¹ ë¥´ê²Œ í•´ê²°í•˜ëŠ” íš¨ìœ¨ì£¼ì˜ ì™€ì¸í˜• ì¸ê°„'],
      ['ğŸ‘†ğŸ· ë©”ë‰´ ë‚´ê°€ ì •í•˜ì§€ë§Œ ì´ìœ ê°€ ë‹¤ ìˆëŠ” ì™€ì¸í˜• ì¸ê°„',
       'ğŸ™ƒğŸ· ì•„ë¬´ê±°ë‚˜ í•´ë†“ê³  ê²°êµ­ ì œì¼ í•©ë¦¬ì ì¸ ì„ íƒ ëŒê³  ì˜¤ëŠ” ì™€ì¸í˜• ì¸ê°„',
       'ğŸ«¶ğŸ· ìƒëŒ€ ë°°ë ¤í•˜ë©´ì„œë„ ì™€ì¸ì²˜ëŸ¼ ì€ê·¼íˆ ì·¨í–¥ ê´€ì² ì‹œí‚¤ëŠ” ì¸ê°„',
       'ğŸ’­ğŸ· ì†ìœ¼ë¡œ ì´ë¯¸ ë‹¤ ì •í•´ë†“ê³  ìƒëŒ€ê°€ ë¨¼ì € ë§í•˜ê¸¸ ê¸°ë‹¤ë¦¬ëŠ” ì™€ì¸í˜• ì¸ê°„']
    ],
    D: [
      ['ğŸ²ğŸ˜¤ ë°°ê³ í”„ë©´ ì˜ˆë¯¼í•´ì§€ëŠ” ì²™ í•˜ì§€ë§Œ ì‚¬ì‹¤ ê·¸ëƒ¥ ë°°ê³ í”ˆ í•´ì¥êµ­í˜• ì¸ê°„',
       'ğŸ²ğŸ¤ ë°°ê³ íŒŒë„ ë§ ì—†ì´ ê·¸ëƒ¥ ì°¸ëŠ” í•´ì¥êµ­í˜• ì¸ê°„',
       'ğŸ²ğŸ—£ï¸ ë°°ê³ í”„ë©´ ì•„ë¬´ ë§ì´ë‚˜ í•˜ëŠ”ë° ë‚˜ì¤‘ì—” ê¸°ì–µ ëª» í•˜ëŠ” í•´ì¥êµ­í˜• ì¸ê°„',
       'ğŸ²âš¡ ë°°ê³ í”„ë©´ ê·¸ëƒ¥ ì œì¼ ë¹ ë¥¸ ê±° ë¨¹ëŠ” í•´ì¥êµ­í˜• ì¸ê°„'],
      ['ğŸ‘†ğŸ² ì¼ë‹¨ ë‚´ê°€ ì •í•˜ê³  ë§›ì—†ìœ¼ë©´ ë‚´ ì±…ì„ì§€ëŠ” í•´ì¥êµ­í˜• ì¸ê°„',
       'ğŸ™ƒğŸ² ì•„ë¬´ê±°ë‚˜ í•´ë†“ê³  ê²°êµ­ ì•„ë¬´ê±°ë‚˜ ë¨¹ëŠ” ì§„ì§œ ì•„ë¬´ê±°ë‚˜í˜• ì¸ê°„ ã…‹ã…‹',
       'ğŸ«¶ğŸ² ìƒëŒ€ê°€ ì¢‹ìœ¼ë©´ ë©”ë‰´ë„ ë‹¤ ì¢‹ì€ í•´ì¥êµ­í˜• ì¸ê°„',
       'ğŸ’­ğŸ² ì†ìœ¼ë¡œ ë”´ ê±° ìƒê°í•˜ë©´ì„œ ê²°êµ­ ê·¸ëƒ¥ ì•„ë¬´ê±°ë‚˜ ë¨¹ëŠ” í•´ì¥êµ­í˜• ì¸ê°„']
    ]
  };

  const typeHl = hlMap[res.type] || hlMap.A;
  const hl = typeHl[Math.floor(c[2])] ?
    typeHl[c[2] < 4 ? c[2] : 0] :
    typeHl[0][0];
  // Q2 ê¸°ë°˜ í•œì¤„ìš”ì•½ ìš°ì„ , Q3ë¡œ ë³´ì¡°
  const hlFinal = (typeHl[0] && typeHl[0][c[2] !== undefined ? Math.min(c[2],3) : 0]) || typeHl[0][0];

  // â”€â”€ ì‹ìŠµê´€ì‹¬ë¦¬ â”€â”€
  const foodPsyData = {
    A: {
      meal: [
        'í•œ ë¼ë„ ë¹¼ë¨¹ì§€ ì•ŠëŠ” ê·œì¹™ì ì¸ ì‹ì‚¬ê°€ ì—ë„ˆì§€ì™€ ê¸°ë¶„ì„ ê²°ì •í•´ìš”. ì„¸ë¼ ë‹¤ ì±™ê¸°ëŠ” ê±´ ë£¨í‹´ì´ ì•„ë‹ˆë¼ ìê¸° í†µì œì˜ ì¼ë¶€ì˜ˆìš”. ë°¥ì„ ì œë•Œ ëª» ë¨¹ìœ¼ë©´ ë‹¤ë¥¸ ê²ƒë„ ë‹¤ í‹€ì–´ì§€ëŠ” ê¸°ë¶„ì´ ë“œëŠ” íƒ€ì…ì´ì—ìš”.',
        'í•˜ë£¨ ë‘ ë¼ë¡œë„ ì¶©ë¶„íˆ ì‚´ì§€ë§Œ, ì±™ê¸¸ ë•ŒëŠ” ì œëŒ€ë¡œ ì±™ê¸°ëŠ” ìŠ¤íƒ€ì¼ì´ì—ìš”. ë°”ì˜ë‹¤ëŠ” í•‘ê³„ë¡œ ëŒ€ì¶© ë•Œìš°ëŠ” ê²ƒì²˜ëŸ¼ ë³´ì—¬ë„, ì •ì‘ ë¨¹ëŠ” ìˆœê°„ë§Œí¼ì€ ì§„ì§€í•´ìš”. ë°¥ì— íˆ¬ìí•˜ëŠ” ì‹œê°„ì´ ê³§ ìê¸°ì—ê²Œ íˆ¬ìí•˜ëŠ” ì‹œê°„ì´ì—ìš”.',
        'í•˜ë£¨ í•œ ë¼ë¼ë„ ì œëŒ€ë¡œ ëœ ê±¸ ë¨¹ì–´ì•¼ ì§ì„±ì´ í’€ë¦¬ëŠ” íƒ€ì…ì´ì—ìš”. ì •ì‹ ì—†ì´ ì‚´ë©´ì„œë„ ê·¸ í•œ ë¼ë§Œí¼ì€ íƒ€í˜‘ ì•ˆ í•˜ëŠ” ê³ ì§‘ì´ ìˆì–´ìš”. ì‹ì‚¬ì— ëŒ€í•œ ê¸°ì¤€ì´ ë†’ì€ ì‚¬ëŒì´ ì‚¶ì˜ ê¸°ì¤€ë„ ë†’ì•„ìš”.',
        'ë–¼ë¼ ë•Œìš°ëŠ” ìš”ì¦˜ì´ì§€ë§Œ, ê·¸ê²Œ ìì±…ê±°ë¦¬ê°€ ì•„ë‹ˆì—ìš”. ì§€ê¸ˆ ëª¸ì´ ì›í•˜ëŠ” ê²Œ ë­”ì§€ ì•Œë©´ì„œ ê·¸ëƒ¥ ë•Œìš°ëŠ” ê±°ë‹ˆê¹Œìš”. ëŒ€ì¶© ë•Œìš°ëŠ” ê²ƒì²˜ëŸ¼ ë³´ì—¬ë„ ì§„ì§œ ë°°ê³ í”Œ ë•Œ ë­˜ ë¨¹ì–´ì•¼ í•˜ëŠ”ì§€ëŠ” ì •í™•í•˜ê²Œ ì•Œê³  ìˆì–´ìš”.'
      ],
      stress: [
        'ë§¤ìš´ ìŒì‹ìœ¼ë¡œ ìŠ¤íŠ¸ë ˆìŠ¤ë¥¼ í‘¸ëŠ” ì‚¬ëŒì€ ê°ì •ì„ ì–µëˆ„ë¥´ì§€ ì•Šì•„ìš”. ì†ì—ì„œ ë­”ê°€ ë“ì–´ì˜¤ë¥¼ ë•Œ ê·¸ ì—´ê¸°ë¥¼ ìŒì‹ìœ¼ë¡œ ë°œì‚°í•˜ëŠ” ë°©ì‹ì´ì—ìš”. ë§ˆë¼íƒ•ì§‘ì—ì„œ ì œì¼ ë§¤ìš´ ë‹¨ê³„ ê³ ë¥´ë©´ì„œ ì˜¤ëŠ˜ ìˆì—ˆë˜ ì¼ í˜¼ì ë³µê¸°í•˜ëŠ” íƒ€ì…ì´ì—ìš”.',
        'ë‹¬ë‹¬í•œ ë””ì €íŠ¸ë¡œ ê°ì •ì„ ë‹¬ë˜ëŠ” ì‚¬ëŒì€ ìê¸° ìì‹ ì—ê²Œ ì¹œì ˆí•œ ì‚¬ëŒì´ì—ìš”. í˜ë“  í•˜ë£¨ ëì— í¸ì˜ì  ì¼€ì´í¬ í•˜ë‚˜ ì‚¬ëŠ” ê²ƒë„ ìê¸° ëŒë´„ì´ì—ìš”. ë‹¨ ê±° ë¨¹ìœ¼ë©´ì„œ ê¸°ë¶„ í’€ë¦¬ëŠ” ê±¸ ì°½í”¼í•´í•˜ì§€ ì•Šì•„ë„ ë¼ìš”.',
        'ìŠ¤íŠ¸ë ˆìŠ¤ ë°›ìœ¼ë©´ ë­ë“  ë¹¨ë¦¬ ë¨¹ê³  í•´ê²°í•˜ëŠ” íƒ€ì…ì´ì—ìš”. ìŒì‹ì„ ì¦ê¸°ê¸°ë³´ë‹¤ ì—°ë£Œë¡œ ì“°ëŠ” ê²½í–¥ì´ ìˆëŠ”ë°, ì‚¬ì‹¤ ê·¸ê²Œ ë” íš¨ìœ¨ì ì¼ ë•Œë„ ìˆì–´ìš”. ë°¥ ë¹¨ë¦¬ ë¨¹ê³  ë¬¸ì œ í•´ê²°í•˜ëŸ¬ ê°€ëŠ” í–‰ë™ë ¥ì´ ì§„ì§œ ë§¤ë ¥ì´ì—ìš”.',
        'ì•„ì˜ˆ ì•ˆ ë¨¹ëŠ” íƒ€ì…ì€ ë°°ê³ í””ë³´ë‹¤ ìŠ¤íŠ¸ë ˆìŠ¤ê°€ ë” ê°•í•œ ì‚¬ëŒì´ì—ìš”. ì†ì´ ë’¤ì§‘íˆë©´ ìŒì‹ì´ ì•ˆ ë„˜ì–´ê°€ëŠ” ê±´ ì˜ˆë¯¼í•˜ë‹¤ëŠ” ê²Œ ì•„ë‹ˆë¼ ê°ê°ì´ ì†”ì§í•˜ë‹¤ëŠ” ëœ»ì´ì—ìš”. ìŠ¤íŠ¸ë ˆìŠ¤ í•´ì†Œë˜ë©´ ê°‘ìê¸° í­ì‹í•˜ëŠ” íŒ¨í„´ ìˆì„ ìˆ˜ë„ ìˆì–´ìš”.'
      ]
    },
    B: {
      meal: [
        'ì„¸ë¼ ê¼¬ë°•ê¼¬ë°• ì±™ê¸°ëŠ” ì‚¬ëŒì€ ê·œì¹™ê³¼ ë£¨í‹´ ì•ˆì—ì„œ ì•ˆì •ê°ì„ ì°¾ì•„ìš”. ì‹ì‚¬ ì‹œê°„ì´ í•˜ë£¨ì˜ ì¤‘ì‹¬ì¶•ì´ê³ , ê·¸ ë¦¬ë“¬ì´ ë¬´ë„ˆì§€ë©´ í•˜ë£¨ ì „ì²´ê°€ í”ë“¤ë¦¬ëŠ” ëŠë‚Œì´ ë“œëŠ” íƒ€ì…ì´ì—ìš”. ë°¥ìƒì„ ì°¨ë¦¬ëŠ” ê²Œ ê³§ ìê¸° ìì‹ ì„ ëŒë³´ëŠ” ì˜ì‹ì´ì—ìš”.',
        'ë‘ ë¼ ë¨¹ëŠ” ì‚¬ëŒì€ íš¨ìœ¨ì ì´ë©´ì„œë„ ì±™ê¸¸ ê±´ ì±™ê¸°ëŠ” ê· í˜•íŒŒì˜ˆìš”. ì•„ì¹¨ì„ ê±°ë¥´ë”ë¼ë„ ì ì‹¬ì€ ì œëŒ€ë¡œ, ì €ë…ë„ ì ë‹¹íˆ ì±™ê¸°ëŠ” ë¦¬ë“¬ì´ ìˆì–´ìš”. ë°”ìœ ì™€ì¤‘ì—ë„ ë°¥ ë¨¹ì„ ì‹œê°„ì„ ì¼ë¶€ëŸ¬ ë§Œë“œëŠ” ì‚¬ëŒì´ì—ìš”.',
        'í•œ ë¼ë¡œ ë²„í‹°ëŠ” ë‚ ì´ ë§ì§€ë§Œ, ê·¸ í•œ ë¼ì— ì˜¨ ì—ë„ˆì§€ë¥¼ ì§‘ì¤‘í•˜ëŠ” ìŠ¤íƒ€ì¼ì´ì—ìš”. í•˜ë£¨ ì¤‘ ê·¸ ì‹ì‚¬ ì‹œê°„ë§Œí¼ì€ ì§„ì‹¬ìœ¼ë¡œ ì¦ê¸°ë ¤ í•˜ëŠ” ì‚¬ëŒì´ì—ìš”. ë§ì´ ë¨¹ëŠ” ê²ƒë³´ë‹¤ ì œëŒ€ë¡œ ë¨¹ëŠ” ê²ƒì— ì˜ë¯¸ë¥¼ ë‘ëŠ” íƒ€ì…ì´ì—ìš”.',
        'ëŒ€ì¶© ë•Œìš°ëŠ” ìš”ì¦˜ì´ì§€ë§Œ, ë­”ê°€ í—ˆì „í•œ ëŠë‚Œì´ ë“œëŠ” ê±´ ì•Œê³  ìˆì–´ìš”. í¸ì˜ì  ì‚¼ê°ê¹€ë°¥ìœ¼ë¡œ ë•Œìš°ë©´ì„œë„ "ë‚˜ì¤‘ì— ì œëŒ€ë¡œ ë¨¹ì–´ì•¼ì§€"ë¼ëŠ” ìƒê°ì„ ë‹¬ê³  ì‚¬ëŠ” íƒ€ì…ì´ì—ìš”. ì§€ê¸ˆì€ ì§€ì³ ìˆëŠ” ê±°ê³ , ê³§ ë‹¤ì‹œ ìê¸°ë¥¼ ì±™ê¸°ê²Œ ë  ê±°ì˜ˆìš”.'
      ],
      stress: [
        'ë§¤ìš´ ê±°ë¡œ í‘¸ëŠ” íƒ€ì… â€” ë‹¬ë‹¬í•œ ê±¸ ì¢‹ì•„í•˜ëŠ” ì‚¬ëŒì´ ë§¤ìš´ ê±¸ ì°¾ëŠ”ë‹¤ëŠ” ê±´ ê°ì •ì´ ê·¸ë§Œí¼ ê°•í•˜ê²Œ ìš”ë™ì¹˜ê³  ìˆë‹¤ëŠ” ëœ»ì´ì—ìš”. í‰ì†Œì™€ ë‹¤ë¥¸ ìŒì‹ì„ ì°¾ëŠ” ê±´ ë‚´ê°€ ì§€ê¸ˆ í‰ì†Œì™€ ë‹¤ë¥¸ ìƒíƒœë¼ëŠ” ëª¸ì˜ ì‹ í˜¸ì˜ˆìš”.',
        'ë‹¬ë‹¬í•œ ê±¸ ì°¾ëŠ” íƒ€ì… â€” ê°ì •ì´ í˜ë“¤ ë•Œ ë‹¨ ê±¸ ë‹¹ê¸°ëŠ” ê±´ ë‡Œê°€ ë³´ìƒì„ ì›í•˜ëŠ” ê±°ì˜ˆìš”. í¸ì˜ì  ì´ˆì½”ê³¼ì í•˜ë‚˜ë¡œ ì˜¤ëŠ˜ í•˜ë£¨ë¥¼ ë²„í‹°ëŠ” ë°©ë²•ì„ ì•„ëŠ” ì‚¬ëŒì´ì—ìš”. ê·¸ ì‘ì€ ìœ„ë¡œê°€ ì‚¬ì‹¤ ê½¤ í° í˜ì´ ë¼ìš”.',
        'ë¹¨ë¦¬ ë¨¹ê³  í•´ê²°í•˜ëŠ” íƒ€ì… â€” ìŠ¤íŠ¸ë ˆìŠ¤ë¥¼ ìŒì‹ìœ¼ë¡œ í•´ê²°í•˜ë˜ ì˜¤ë˜ ë¶™ì¡ì§€ ì•ŠëŠ” ìŠ¤íƒ€ì¼ì´ì—ìš”. ê°ì •ì„ ì²˜ë¦¬í•˜ëŠ” ì†ë„ê°€ ë¹ ë¥¸ í¸ì´ê³ , ìŒì‹ì´ ê·¸ ì „í™˜ì  ì—­í• ì„ í•´ìš”. ë¨¹ê³  ë‚˜ì„œ ê¸°ë¶„ì´ ë¦¬ì…‹ë˜ëŠ” ê²½í—˜ì´ ë§ì„ ê±°ì˜ˆìš”.',
        'ì•„ì˜ˆ ì•ˆ ë¨¹ëŠ” íƒ€ì… â€” ìŠ¤íŠ¸ë ˆìŠ¤ê°€ ì‹ìš•ê¹Œì§€ ì¡ì•„ë¨¹ëŠ” ê°•ë„ë¼ëŠ” ëœ»ì´ì—ìš”. ë°¥ì„ ê±°ë¥¼ ë•Œ ìê¸° ìì‹ ë„ ê°™ì´ ë°©ì¹˜ë˜ê³  ìˆëŠ” ê±´ ì•„ë‹Œì§€ í•œ ë²ˆì¯¤ ëŒì•„ë´ì•¼ í•´ìš”. ì‘ì€ ê²ƒ í•˜ë‚˜ë¼ë„ ë¨¹ëŠ” ê²Œ ìê¸°í•œí…Œ ë³´ë‚´ëŠ” ì‹ í˜¸ê°€ ë  ìˆ˜ ìˆì–´ìš”.'
      ]
    },
    C: {
      meal: [
        'ì„¸ë¼ ë£¨í‹´ì´ ì‚¶ì˜ ê¸°ì¤€ì´ì—ìš”. ì‹ì‚¬ ìŠ¤ì¼€ì¤„ì´ ê³§ í•˜ë£¨ ìŠ¤ì¼€ì¤„ì´ê³ , ê·¸ ì•ˆì—ì„œ ë‹¤ë¥¸ ëª¨ë“  ê²ƒì„ ì¡°ìœ¨í•´ìš”. ì•½ì† ì¡ì„ ë•Œ ë°¥ ì‹œê°„ ë¨¼ì € ê³ ë ¤í•˜ëŠ” ì‚¬ëŒì´ì—ìš”.',
        'ë‘ ë¼ë¡œ í•˜ë£¨ë¥¼ ëŒë¦¬ì§€ë§Œ ê·¸ ë‘ ë¼ ì•ˆì—ì„œ ìµœëŒ€í•œ ì˜ì–‘ê³¼ ë§›ì„ ì±™ê¸°ëŠ” íƒ€ì…ì´ì—ìš”. ë¨¹ëŠ” ê²Œ ì¼ì¸ ê²ƒì²˜ëŸ¼ ì§„ì§€í•˜ê²Œ ë©”ë‰´ë¥¼ ê³ ë¥´ëŠ” í¸ì´ì—ìš”. ëŒ€ì¶© ë¨¹ëŠ” ë‚ ì´ ì—†ëŠ” ê±´ ì•„ë‹Œë°, ëŒ€ì¶© ë¨¹ìœ¼ë©´ ë­”ê°€ ì°œì°œí•œ ì‚¬ëŒì´ì—ìš”.',
        'í•œ ë¼ë°–ì— ëª» ë¨¹ëŠ” ë‚ ì´ ë§ì§€ë§Œ ê·¸ í•œ ë¼ë¥¼ ì œëŒ€ë¡œ ë¨¹ìœ¼ë ¤ê³  í•˜ëŠ” ì™„ë²½ì£¼ì˜ì  ë©´ì´ ìˆì–´ìš”. ì‹œê°„ì´ ì—†ì–´ì„œê°€ ì•„ë‹ˆë¼ ì™„ë²½í•œ ì‹ì‚¬ê°€ ì•„ë‹ˆë©´ êµ³ì´ ë¨¹ê³  ì‹¶ì§€ ì•Šì€ ë§ˆìŒë„ ìˆì–´ìš”.',
        'ëŒ€ì¶© ë•Œìš°ëŠ” ìš”ì¦˜ì´ì§€ë§Œ ì‚¬ì‹¤ ì´ ìƒíƒœê°€ ì¢€ ë¶ˆí¸í•œ ì‚¬ëŒì´ì—ìš”. ë£¨í‹´ì´ ë¬´ë„ˆì§„ ê²ƒ ê°™ì€ ì°œì°œí•¨ì´ ìˆëŠ”ë°, ê·¸ê±¸ í•´ê²°í•˜ë ¤ë©´ ë‹¤ì‹œ ì‹ì‚¬ ê·œì¹™ì„ ë§Œë“œëŠ” ê²Œ ì œì¼ ë¹ ë¥¸ ë°©ë²•ì´ì—ìš”.'
      ],
      stress: [
        'ë§¤ìš´ ê±°ë¡œ í‘¸ëŠ” ê²ƒ â€” í‰ì†Œì—” ì´ì„±ì ì¸ ì‚¬ëŒì´ ë§¤ìš´ ê±¸ ì°¾ëŠ”ë‹¤ëŠ” ê±´ ì§€ê¸ˆ ê°ì •ì´ ë…¼ë¦¬ë¥¼ ë„˜ì–´ì„œê³  ìˆë‹¤ëŠ” ëœ»ì´ì—ìš”. ë§ˆë¼íƒ• í•œ ê·¸ë¦‡ìœ¼ë¡œ ì˜¤ëŠ˜ì˜ ì–µìš¸í•¨ì„ ì”»ì–´ë‚´ëŠ” ì˜ì‹ì„ ì¹˜ë¥´ëŠ” ê±°ì˜ˆìš”.',
        'ë‹¬ë‹¬í•œ ê±¸ ì°¾ëŠ” ê²ƒ â€” íš¨ìœ¨ì£¼ì˜ìê°€ ë””ì €íŠ¸ë¥¼ ì°¾ëŠ”ë‹¤ëŠ” ê±´ ì§€ê¸ˆ ìì‹ ì—ê²Œ ë³´ìƒì´ í•„ìš”í•˜ë‹¤ëŠ” ê±¸ ì¸ì •í•˜ëŠ” ìˆœê°„ì´ì—ìš”. ê·¸ ì†”ì§í•¨ì´ ì‚¬ì‹¤ ê·€ì—¬ìš´ ë©´ì´ì—ìš”.',
        'ë¹¨ë¦¬ ë¨¹ê³  í•´ê²° â€” ìŠ¤íŠ¸ë ˆìŠ¤ë¥¼ í•´ê²°í•´ì•¼ í•˜ëŠ” ë¬¸ì œë¡œ ë³´ëŠ” ì‚¬ëŒì´ì—ìš”. ë°¥ë„ ë¹¨ë¦¬ ë¨¹ê³ , ê°ì •ë„ ë¹¨ë¦¬ ì •ë¦¬í•˜ê³ , ë‹¤ìŒ ìŠ¤í…ìœ¼ë¡œ ê°€ë ¤ëŠ” ê±°ì˜ˆìš”. ë‹¤ë§Œ ë„ˆë¬´ ë¹¨ë¦¬ ì²˜ë¦¬í•˜ë‹¤ ë³´ë©´ ê°ì •ì´ ëœ ì†Œí™”ë  ìˆ˜ ìˆì–´ìš”.',
        'ì•„ì˜ˆ ì•ˆ ë¨¹ëŠ” ê²ƒ â€” ê°ì •ì´ ì‹ ì²´ ë°˜ì‘ê¹Œì§€ ì´ì–´ì§€ëŠ” íƒ€ì…ì´ì—ìš”. ë°°ê°€ ê³ í”ˆì§€ ì•ˆ ê³ í”ˆì§€ë³´ë‹¤ ë§ˆìŒì´ ê´œì°®ì€ì§€ê°€ ë” ì¤‘ìš”í•œ ìˆœê°„ì´ì—ìš”.'
      ]
    },
    D: {
      meal: [
        'ì„¸ë¼ ì±™ê¸°ëŠ” ë£¨í‹´ ì•ˆì—ì„œ í•˜ë£¨ë¥¼ ì‚´ì•„ê°€ì§€ë§Œ, ê·¸ ë£¨í‹´ì´ ë¬´ë„ˆì ¸ë„ í¬ê²Œ ë™ìš”í•˜ì§€ ì•ŠëŠ” ì‚¬ëŒì´ì—ìš”. ë¨¹ëŠ” ê²Œ ì¤‘ìš”í•˜ê¸´ í•œë°, ê·¸ê²Œ ì‚¶ì˜ ì „ë¶€ëŠ” ì•„ë‹Œ ê±° ì•Œê³  ìˆì–´ìš”. ë°¥ ìë¦¬ê°€ ì‚¬ëŒì„ ë§Œë‚˜ëŠ” ì´ìœ ê°€ ë˜ëŠ” íƒ€ì…ì´ì—ìš”.',
        'ë‘ ë¼ë©´ ì¶©ë¶„í•´ìš”. ë§ì´ ë¨¹ëŠ” ê²ƒë³´ë‹¤ í•„ìš”í•  ë•Œ ì œëŒ€ë¡œ ë¨¹ëŠ” ê²Œ ë” ì¤‘ìš”í•œ ì‚¬ëŒì´ì—ìš”. ì‹ì‚¬ì— ì˜ë¯¸ë¥¼ ë‘ë˜ ì§‘ì°©í•˜ì§€ ì•ŠëŠ” ê· í˜•ì´ ìˆì–´ìš”.',
        'í•œ ë¼ë©´ ë²„í‹°ëŠ” ë‚ ì´ ë§ì§€ë§Œ ê·¸ê²Œ í˜ë“  ê±´ ì•„ë‹ˆì—ìš”. ìŒì‹ë³´ë‹¤ í•´ì•¼ í•  ì¼, ë§Œë‚˜ì•¼ í•  ì‚¬ëŒì´ ë” ì¤‘ìš”í•œ ìˆœê°„ì´ ë§ì€ íƒ€ì…ì´ì—ìš”. ë°°ê³ í””ë³´ë‹¤ í•˜ê³  ì‹¶ì€ ê²Œ ë” ê°•í•œ ì‚¬ëŒì´ì—ìš”.',
        'ëŒ€ì¶© ë•Œìš°ëŠ” ìš”ì¦˜ì¸ë°, ì‚¬ì‹¤ ê·¸ê²Œ í¸í•˜ê¸°ë„ í•´ìš”. ë°¥ì— ì—ë„ˆì§€ë¥¼ ìŸê¸°ë³´ë‹¤ ë‹¤ë¥¸ ë° ìŸê³  ì‹¶ì€ ê±°ë‹ˆê¹Œìš”. ì§€ê¸ˆ ë­”ê°€ì— ë” ì§‘ì¤‘í•˜ê³  ìˆëŠ” ì‹œê¸°ì¼ ê±°ì˜ˆìš”.'
      ],
      stress: [
        'ë§¤ìš´ ê±°ë¡œ í‘¸ëŠ” íƒ€ì… â€” ìê·¹ì ì¸ ê±¸ ì°¾ëŠ”ë‹¤ëŠ” ê±´ ì§€ê¸ˆ ê°ê°ì´ ë¬´ëŒì§„ ëŠë‚Œì´ë¼ëŠ” ëœ»ì´ì—ìš”. ë­”ê°€ ê°•ë ¬í•œ ê±¸ë¡œ ë‹¤ì‹œ ì‚´ì•„ìˆëŠ” ëŠë‚Œì„ ì°¾ê³  ì‹¶ì€ ê±°ì˜ˆìš”.',
        'ë‹¬ë‹¬í•œ ê±¸ ì°¾ëŠ” íƒ€ì… â€” í•´ì¥êµ­ ê°™ì€ ì‚¬ëŒì´ ë‹¨ ê±¸ ì°¾ëŠ”ë‹¤ëŠ” ê±´ ì§€ê¸ˆ ìì‹ ì—ê²Œ ë¶€ë“œëŸ¬ìš´ ìœ„ë¡œê°€ í•„ìš”í•˜ë‹¤ëŠ” ì‹ í˜¸ì˜ˆìš”.',
        'ë¹¨ë¦¬ ë¨¹ê³  í•´ê²° â€” ìŠ¤íŠ¸ë ˆìŠ¤ë„ ë°¥ë„ íš¨ìœ¨ì ìœ¼ë¡œ ì²˜ë¦¬í•˜ëŠ” íƒ€ì…ì´ì—ìš”. ê°ì •ì— ì˜¤ë˜ ë¨¸ë¬¼ì§€ ì•Šê³  ë‹¤ìŒìœ¼ë¡œ ë„˜ì–´ê°€ëŠ” í˜ì´ ìˆì–´ìš”.',
        'ì•„ì˜ˆ ì•ˆ ë¨¹ëŠ” íƒ€ì… â€” ì†ì´ í¸í•´ì•¼ ë°¥ì´ ë„˜ì–´ê°€ëŠ” ì‚¬ëŒì´ì—ìš”. ëª¸ë³´ë‹¤ ë§ˆìŒì´ ë¨¼ì €ì¸ íƒ€ì…ì´ì—ìš”.'
      ]
    }
  };

  const mealIdx = Math.min(c[1] !== undefined ? c[1] : 0, 3);
  const stressIdx = Math.min(c[5] !== undefined ? c[5] : 0, 3);
  const foodPsy = (foodPsyData[res.type]?.meal[mealIdx] || foodPsyData.A.meal[0])
    + ' ' + (foodPsyData[res.type]?.stress[stressIdx] || foodPsyData.A.stress[0]);

  // â”€â”€ ê´€ê³„íŒ¨í„´: Q3(ë©”ë‰´ê³ ë¥¼ë•Œ) + Q4(ì—°ì• ë¹„ìœ ) â”€â”€
  const relData = {
    A: {
      menu: [
        'ë©”ë‰´ë¥¼ ì§ì ‘ ì •í•˜ëŠ” ì‚¬ëŒì€ ê´€ê³„ì—ì„œë„ ë¨¼ì € ì›€ì§ì´ëŠ” íƒ€ì…ì´ì—ìš”. "ë­ ë¨¹ì„ë˜?" ë¬¼ìŒì— ë°”ë¡œ ë‹µí•˜ëŠ” ê²ƒì²˜ëŸ¼, ì¢‹ì•„í•˜ëŠ” ì‚¬ëŒí•œí…Œë„ ë¨¼ì € ì—°ë½í•˜ëŠ” í¸ì´ì—ìš”. ì£¼ë„ê¶Œì„ ê°–ëŠ” ê²Œ ë¶ˆí¸í•˜ì§€ ì•Šê³  ì˜¤íˆë ¤ ì±…ì„ê°ìœ¼ë¡œ ëŠë¼ëŠ” ì‚¬ëŒì´ì—ìš”.',
        '"ì•„ë¬´ê±°ë‚˜"ë¼ê³  í–ˆì§€ë§Œ ê²°êµ­ ì˜ê²¬ ë‚´ëŠ” íƒ€ì… â€” ê´€ê³„ì—ì„œë„ ë¹„ìŠ·í•´ìš”. ì²˜ìŒì—” ìƒëŒ€ì—ê²Œ ë§¡ê¸°ëŠ” ì²™í•˜ë‹¤ê°€ ì •ë§ ì´ìƒí•œ ë°©í–¥ìœ¼ë¡œ ê°€ë©´ ìŠ¬ì© í•¸ë“¤ ì¡ëŠ” ìŠ¤íƒ€ì¼ì´ì—ìš”. ê²‰ìœ¼ë¡œëŠ” ìœ ì—°í•´ ë³´ì´ì§€ë§Œ ì†ìœ¼ë¡  ë¶„ëª…í•œ ê¸°ì¤€ì´ ìˆì–´ìš”.',
        'ìƒëŒ€ ì˜ê²¬ ì¡´ì¤‘í•˜ëŠ” íƒ€ì… â€” ê´€ê³„ì—ì„œë„ ë¨¼ì € ë§ì¶°ì£¼ëŠ” ê²½í–¥ì´ ìˆì–´ìš”. ê·¼ë° ì´ ì‚¬ëŒì´ ì§„ì§œ ì›í•˜ëŠ” ê²Œ ë­”ì§€ ë¬¼ì–´ë´ ì£¼ëŠ” ì‚¬ëŒì´ ì—†ì–´ì„œ ë‹µë‹µí•  ë•Œê°€ ìˆì–´ìš”. ë§ì¶°ì£¼ë‹¤ ë³´ë©´ ì •ì‘ ìê¸°ê°€ ì§€ì³ìˆëŠ” ì¤„ ëª¨ë¥¼ ìˆ˜ ìˆì–´ìš”.',
        'ì†ìœ¼ë¡œ ë”´ ë©”ë‰´ ìƒê°í•˜ëŠ” íƒ€ì… â€” ê´€ê³„ì—ì„œë„ ì†ë§ˆìŒì„ ì˜ ì•ˆ êº¼ë‚´ìš”. ì›í•˜ëŠ” ê²Œ ìˆì–´ë„ ë§ë¡œ ë¨¼ì € êº¼ë‚´ëŠ” ê²Œ ì–´ìƒ‰í•œ ì‚¬ëŒì´ì—ìš”. ê°€ê¹Œìš´ ì‚¬ëŒì´ ë¨¼ì € ë¬¼ì–´ë´ì¤„ ë•Œ ë¹„ë¡œì†Œ ì§„ì§œ ìƒê°ì„ ì–˜ê¸°í•˜ëŠ” íƒ€ì…ì´ì—ìš”.'
      ],
      love: [
        'ë§ˆë¼íƒ• ì—°ì•  â€” ì¤‘ë…ì ì´ê³  ê°•ë ¬í•œ ì—°ì• ë¥¼ ì›í•˜ëŠ” ì‚¬ëŒì´ì—ìš”. ì„¤ë ˆì§€ ì•Šìœ¼ë©´ ì—°ì• ê°€ ì•„ë‹Œ ê²ƒ ê°™ê³ , ìê·¹ì´ ì—†ìœ¼ë©´ ê¸ˆë°© ì§€ë£¨í•´ì§€ëŠ” íƒ€ì…ì´ì—ìš”. ê·¼ë° ê·¸ ê°•ë„ê°€ ë†’ë‹¤ ë³´ë‹ˆ ì†Œì§„ë˜ê¸°ë„ ë¹ ë¥¸ í¸ì´ì—ìš”.',
        'ì¼€ì´í¬ ì—°ì•  â€” ê¸°ë…ì¼ ì±™ê¸°ê³  ë‹¬ë‹¬í•œ ìˆœê°„ì„ ì†Œì¤‘íˆ ì—¬ê¸°ëŠ” ë¡œë§¨í‹± íƒ€ì…ì´ì—ìš”. ì‘ì€ ì´ë²¤íŠ¸ í•˜ë‚˜ì—ë„ í° ì˜ë¯¸ë¥¼ ë‘ê³ , ìƒëŒ€ê°€ ê¸°ì–µí•´ì£¼ëŠ” ê²ƒì— ê°ë™ë°›ëŠ” ì‚¬ëŒì´ì—ìš”.',
        'ì™€ì¸ ì—°ì•  â€” ì²˜ìŒì—” ì–´ìƒ‰í•˜ê³  ëŠë¦¬ì§€ë§Œ ì‹œê°„ì´ ì§€ë‚ ìˆ˜ë¡ ê¹Šì–´ì§€ëŠ” ì—°ì• ë¥¼ í•´ìš”. ì²«ëˆˆì— ë°˜í•˜ê¸°ë³´ë‹¤ëŠ” ì•Œì•„ê°ˆìˆ˜ë¡ ì¢‹ì•„ì§€ëŠ” ì‚¬ëŒê³¼ ì˜ ë§ëŠ” íƒ€ì…ì´ì—ìš”.',
        'ì‚¼ê°ê¹€ë°¥ ì—°ì•  â€” ë¹ ë¥´ê²Œ ì‹œì‘í•˜ê³  ë¹ ë¥´ê²Œ ëë‚˜ëŠ” íŒ¨í„´ì„ ê²½í—˜í•´ë´¤ì„ ê±°ì˜ˆìš”. ê·¸ëŸ¬ë©´ì„œ ì´ì œ ë­˜ ì›í•˜ëŠ”ì§€ ë” ëª…í™•í•´ì§„ ì‚¬ëŒì´ì—ìš”. ë°˜ë³µ ì†ì—ì„œ ìê¸° ìì‹ ì„ ë” ì˜ ì•Œê²Œ ëœ íƒ€ì…ì´ì—ìš”.'
      ]
    },
    B: {
      menu: [
        'ë©”ë‰´ ì§ì ‘ ì •í•˜ëŠ” íƒ€ì… â€” ë‹¬ë‹¬í•˜ê³  ë¶€ë“œëŸ¬ìš´ ì‚¬ëŒ ê°™ì§€ë§Œ ë§‰ìƒ ê²°ì •í•  ë•ŒëŠ” í™•ì‹¤í•œ ë©´ì´ ìˆì–´ìš”. ê´€ê³„ì—ì„œë„ í•„ìš”í•  ë•ŒëŠ” ë¨¼ì € ë‚˜ì„œëŠ” ì‚¬ëŒì´ì—ìš”.',
        '"ì•„ë¬´ê±°ë‚˜" í•˜ì§€ë§Œ ê²°êµ­ ì˜ê²¬ ë‚´ëŠ” íƒ€ì… â€” ìƒëŒ€ë°©ì´ ë¶ˆí¸í•˜ì§€ ì•Šê²Œ ë°°ë ¤í•˜ë©´ì„œë„ ê²°êµ­ ì›í•˜ëŠ” ë°©í–¥ìœ¼ë¡œ ê°€ëŠ” ë¶€ë“œëŸ¬ìš´ ë¦¬ë”ì‹­ì´ ìˆì–´ìš”.',
        'ìƒëŒ€ ì¡´ì¤‘ íƒ€ì… â€” ìƒëŒ€ê°€ ì¢‹ì•„í•˜ëŠ” ê²Œ ë­”ì§€ ë¨¼ì € ì‚´í”¼ëŠ” ì‚¬ëŒì´ì—ìš”. ë°¥ ë¨¹ì„ ë•Œ ìƒëŒ€ ê·¸ë¦‡ì´ ë¹„ì—ˆë‚˜ ë¨¼ì € í™•ì¸í•˜ëŠ” íƒ€ì…ì´ì—ìš”.',
        'ì†ìœ¼ë¡œ ë”´ ê±° ìƒê°í•˜ëŠ” íƒ€ì… â€” ê²‰ìœ¼ë¡œëŠ” ì¡°ìš©í•˜ê²Œ ë§ì¶°ì£¼ëŠ” ê²ƒ ê°™ì§€ë§Œ ì†ì—ëŠ” ìê¸°ë§Œì˜ ì„¸ê³„ê°€ ë‹¨ë‹¨í•˜ê²Œ ìˆì–´ìš”.'
      ],
      love: [
        'ë§ˆë¼íƒ• ì—°ì•  â€” ë‹¬ë‹¬í•œ ì‚¬ëŒì´ ë§ˆë¼íƒ• ì—°ì• ë¥¼ ê¿ˆê¾¼ë‹¤ëŠ” ê±´ ìê·¹ê³¼ ì„¤ë ˜ì— ëŒ€í•œ ê°ˆë§ì´ ìˆ¨ì–´ìˆë‹¤ëŠ” ê±°ì˜ˆìš”. ì•ˆì •ì ì´ë©´ì„œë„ ê°€ë”ì€ ì‹¬ì¥ ë›°ëŠ” ìˆœê°„ì„ ì›í•˜ëŠ” ì‚¬ëŒì´ì—ìš”.',
        'ì¼€ì´í¬ ì—°ì•  â€” ê¸°ë…ì¼ì„ ì±™ê¸°ê³  ì†Œì¤‘í•œ ìˆœê°„ì— ì´ë¦„ì„ ë¶™ì´ëŠ” ì—°ì• ë¥¼ ì›í•´ìš”. ì—°ì• ê°€ ê³§ ì¶”ì–µì„ ë§Œë“œëŠ” ì¼ì´ë¼ê³  ìƒê°í•˜ëŠ” ë¡œë§¨í‹°ìŠ¤íŠ¸ì˜ˆìš”.',
        'ì™€ì¸ ì—°ì•  â€” ê¸‰í•˜ê²Œ ê°€ì§€ ì•Šê³  ì²œì²œíˆ ì„œë¡œë¥¼ ì•Œì•„ê°€ëŠ” ì—°ì• ë¥¼ ì›í•´ìš”. ì²˜ìŒë¶€í„° ë‹¤ ë³´ì—¬ì£¼ê¸°ë³´ë‹¤ ì¡°ê¸ˆì”© ì•Œì•„ê°€ëŠ” ê³¼ì •ì„ ì¦ê¸°ëŠ” íƒ€ì…ì´ì—ìš”.',
        'ì‚¼ê°ê¹€ë°¥ ì—°ì•  â€” ì˜ˆìƒ ëª» í•œ ì—°ì• ê°€ ê°‘ìê¸° ì‹œì‘ë˜ê³  ê°‘ìê¸° ëë‚˜ëŠ” ê²½í—˜ì„ í•´ë´¤ì„ ê±°ì˜ˆìš”. ê·¸ë˜ì„œ ì§€ê¸ˆì€ ì¢€ ë” ì•ˆì •ì ì¸ ì—°ì• ë¥¼ ì›í•˜ëŠ” ë§ˆìŒì´ ìˆì–´ìš”.'
      ]
    },
    C: {
      menu: [
        'ë©”ë‰´ ë‚´ê°€ ì •í•˜ëŠ” íƒ€ì… â€” ê´€ê³„ì—ì„œë„ ì£¼ë„ì ì´ì—ìš”. ì–´ë”” ê°ˆì§€, ë­ í• ì§€ ê³„íš ì„¸ìš°ëŠ” ê±¸ ë‹¹ì—°í•˜ê²Œ ì—¬ê¸°ê³  ê·¸ ì—­í• ì—ì„œ ì˜¤íˆë ¤ ì•ˆì •ê°ì„ ëŠê»´ìš”.',
        '"ì•„ë¬´ê±°ë‚˜" í–ˆì§€ë§Œ ê²°êµ­ ì˜ê²¬ ë‚´ëŠ” íƒ€ì… â€” ì‚¬ì‹¤ ë‹¤ ìƒê°ì´ ìˆëŠ” ì‚¬ëŒì´ì—ìš”. ì²˜ìŒë¶€í„° ì˜ê²¬ ë‚´ê¸° ì‹«ì–´ì„œ ê¸°ë‹¤ë¦¬ëŠ” ê±°ì§€, ì§„ì§œ ì•„ë¬´ ìƒê°ì´ ì—†ëŠ” ê²Œ ì•„ë‹ˆì—ìš”.',
        'ìƒëŒ€ ì˜ê²¬ ì¡´ì¤‘ íƒ€ì… â€” ê´€ê³„ì—ì„œ ë°°ë ¤ê°€ ìì—°ìŠ¤ëŸ¬ìš´ ì‚¬ëŒì´ì—ìš”. ê·¼ë° ë°°ë ¤ì— ìµìˆ™í•œ ì‚¬ëŒë„ ë°›ì•„ì•¼ í•  ë•Œê°€ ìˆì–´ìš”. ìƒëŒ€ê°€ ë¨¼ì € ì±™ê²¨ì¤„ ë•Œ ì–´ìƒ‰í•´í•˜ì§€ ì•Šì•„ë„ ë¼ìš”.',
        'ì†ìœ¼ë¡œ ë”´ ê±° ìƒê°í•˜ëŠ” íƒ€ì… â€” ê²‰ìœ¼ë¡œ ë“œëŸ¬ë‚˜ì§€ ì•ŠëŠ” ìê¸° ì„¸ê³„ê°€ ìˆì–´ìš”. ì²˜ìŒ ë³¸ ì‚¬ëŒì€ ì´ ì‚¬ëŒ ì†ì„ ì˜ ëª» ì½ëŠ”ë°, ê°€ê¹Œì›Œì§€ë©´ ì™„ì „íˆ ë‹¤ë¥¸ ë©´ì´ ë‚˜ì˜¤ëŠ” íƒ€ì…ì´ì—ìš”.'
      ],
      love: [
        'ë§ˆë¼íƒ• ì—°ì•  â€” ë…¼ë¦¬ì ì¸ ì‚¬ëŒì´ ìê·¹ì ì¸ ì—°ì• ë¥¼ ì›í•œë‹¤ëŠ” ê±´ ê°ì •ì ìœ¼ë¡œ ì‚´ì•„ìˆê³  ì‹¶ë‹¤ëŠ” ëœ»ì´ì—ìš”. ì´ì„±ê³¼ ê°ì •ì´ ê³µì¡´í•˜ëŠ” ì—°ì• ë¥¼ í•˜ëŠ” ì‚¬ëŒì´ì—ìš”.',
        'ì¼€ì´í¬ ì—°ì•  â€” ê¸°ë…ì¼ì„ ì±™ê¸°ê³  ê³„íšì ì¸ ë°ì´íŠ¸ë¥¼ ì„ í˜¸í•˜ëŠ” íƒ€ì…ì´ì—ìš”. ë‹¬ë ¥ì— ê¸°ë…ì¼ í‘œì‹œí•´ë‘ëŠ” ê±° ì ˆëŒ€ ë¹ ëœ¨ë¦¬ì§€ ì•ŠëŠ” ì‚¬ëŒì´ì—ìš”.',
        'ì™€ì¸ ì—°ì•  â€” ì´ ì‚¬ëŒì´ ì œì¼ ì˜í•˜ëŠ” ì—°ì•  ìŠ¤íƒ€ì¼ì´ì—ìš”. ì²œì²œíˆ ì•Œì•„ê°€ë©´ì„œ ê¹Šì–´ì§€ëŠ” ì—°ì• ê°€ ë³¸ì¸ ì„±í–¥ì— ë”± ë§ì•„ìš”.',
        'ì‚¼ê°ê¹€ë°¥ ì—°ì•  â€” ê°‘ì‘ìŠ¤ëŸ½ê²Œ ì‹œì‘ë˜ê³  ëë‚˜ëŠ” ì—°ì•  ê²½í—˜ì´ ìˆì„ ê±°ì˜ˆìš”. ê·¸ ê²½í—˜ì´ ì§€ê¸ˆ ì‚¬ëŒì„ ë³´ëŠ” ëˆˆì„ ë” ë‚ ì¹´ë¡­ê²Œ ë§Œë“¤ì–´ì¤¬ì–´ìš”.'
      ]
    },
    D: {
      menu: [
        'ë‚´ê°€ ì •í•˜ëŠ” íƒ€ì… â€” ê´€ê³„ì—ì„œë„ êµ°ë§ ì—†ì´ ë¨¼ì € ì›€ì§ì´ëŠ” í¸ì´ì—ìš”. ë³µì¡í•˜ê²Œ ìƒê°í•˜ì§€ ì•Šê³  ì¼ë‹¨ ê°€ëŠ” ìŠ¤íƒ€ì¼ì´ì—ìš”.',
        '"ì•„ë¬´ê±°ë‚˜" í–ˆë‹¤ê°€ ì§„ì§œ ì•„ë¬´ê±°ë‚˜ ë¨¹ê²Œ ë˜ëŠ” íƒ€ì… ã…‹ã…‹ â€” ê´€ê³„ì—ì„œë„ ëŒ€ë¶€ë¶„ ìƒëŒ€ì—ê²Œ ë§ì¶°ì£¼ëŠ” í¸ì´ì—ìš”. í¬ê²Œ ê³ ì§‘ì´ ì—†ì–´ì„œ ì‚¬ëŒë“¤ì´ í¸í•˜ê²Œ ëŠë¼ëŠ” íƒ€ì…ì´ì—ìš”.',
        'ìƒëŒ€ ì˜ê²¬ ì¡´ì¤‘ íƒ€ì… â€” ê´€ê³„ì—ì„œ ì œì¼ ë¨¼ì € ìƒëŒ€ ê¸°ë¶„ì„ ì‚´í”¼ëŠ” ì‚¬ëŒì´ì—ìš”. ì—†ìœ¼ë©´ ì§„ì§œ í—ˆì „í•œ ì¡´ì¬ì˜ˆìš”.',
        'ì†ìœ¼ë¡œ ë”´ ê±° ìƒê°í•˜ëŠ” íƒ€ì… â€” ë§ì€ ì•ˆ í•´ë„ ì†ì— ìƒê°ì´ ë§ì€ ì‚¬ëŒì´ì—ìš”. ê°€ê¹Œìš´ ì‚¬ëŒì€ ì•Œì§€ë§Œ, ì²˜ìŒ ë³´ëŠ” ì‚¬ëŒì€ ì˜ ëª¨ë¥´ëŠ” ì¸µìœ„ê°€ ìˆì–´ìš”.'
      ],
      love: [
        'ë§ˆë¼íƒ• ì—°ì•  â€” ì”ì”í•œ ì‚¬ëŒì´ ìê·¹ì ì¸ ì—°ì• ë¥¼ ì›í•œë‹¤ëŠ” ê±´ ì§€ê¸ˆ ì¼ìƒì´ ì¡°ê¸ˆ ë‹¨ì¡°ë¡­ê²Œ ëŠê»´ì§„ë‹¤ëŠ” ëœ»ì¼ ìˆ˜ë„ ìˆì–´ìš”.',
        'ì¼€ì´í¬ ì—°ì•  â€” ì†Œë°•í•´ ë³´ì´ì§€ë§Œ ì•Œê³  ë³´ë©´ ê¸°ë…ì¼ ì±™ê¸°ëŠ” ë¡œë§¨í‹°ìŠ¤íŠ¸ì˜ˆìš”. ì ˆëŒ€ í‹° ì•ˆ ë‚´ì§€ë§Œ ìƒëŒ€ ìƒì¼ ì ˆëŒ€ ìŠì§€ ì•ŠëŠ” ì‚¬ëŒì´ì—ìš”.',
        'ì™€ì¸ ì—°ì•  â€” ì²œì²œíˆ ì•Œì•„ê°€ëŠ” ì—°ì• ê°€ í¸í•œ íƒ€ì…ì´ì—ìš”. ì²˜ìŒë¶€í„° ëª¨ë“  ê±¸ ë³´ì—¬ì£¼ì§€ ì•Šì•„ë„ ë˜ëŠ” ì—°ì• ë¥¼ ì›í•´ìš”.',
        'ì‚¼ê°ê¹€ë°¥ ì—°ì•  â€” ì§§ê²Œ ëœ¨ê²ê²Œ íƒ€ì˜¤ë¥´ëŠ” ì—°ì• ë¥¼ ê²½í—˜í•´ë´¤ì„ ê±°ì˜ˆìš”. ê·¸ ê²½í—˜ì´ ì§€ê¸ˆ ì´ ì‚¬ëŒì„ ë” ë‹¨ë‹¨í•˜ê²Œ ë§Œë“¤ì–´ì¤¬ì–´ìš”.'
      ]
    }
  };

  const menuIdx = Math.min(c[3] !== undefined ? c[3] : 0, 3);
  const loveIdx = Math.min(c[4] !== undefined ? c[4] : 0, 3);
  const relPsy = (relData[res.type]?.menu[menuIdx] || relData.A.menu[0])
    + ' ' + (relData[res.type]?.love[loveIdx] || relData.A.love[0]);

  // â”€â”€ ìˆ¨ì€ë§¤ë ¥: Q0(ë¨¹ê³ ì‹¶ì€ê²ƒ) + Q6(ìš”ì¦˜í‘¸ëŠ”ì°) â”€â”€
  const charmData = {
    A: {
      crave: [
        'ë§¤ì½¤í•œ ê²Œ ë‹¹ê¸´ë‹¤ëŠ” ê±´ ì§€ê¸ˆ ìê·¹ì´ í•„ìš”í•˜ë‹¤ëŠ” ëœ»ì´ì—ìš”. ê·¸ ì—ë„ˆì§€ê°€ ì£¼ë³€ ì‚¬ëŒë“¤ì„ ê¹¨ì–´ìˆê²Œ ë§Œë“œëŠ” í˜ì´ê¸°ë„ í•´ìš”.',
        'ë‹¬ë‹¬í•œ ê²Œ ë‹¹ê¸´ë‹¤ëŠ” ê±´ ì§€ê¸ˆ ìì‹ ì—ê²Œ ë¶€ë“œëŸ¬ìš´ ìœ„ë¡œë¥¼ ì£¼ê³  ì‹¶ë‹¤ëŠ” ëœ»ì´ì—ìš”. ìê¸° ê°ì •ì— ì†”ì§í•œ ì‚¬ëŒì´ì—ìš”.',
        'ì§­ì§¤í•œ ê²Œ ë‹¹ê¸´ë‹¤ëŠ” ê±´ ìê·¹ì ì´ë˜ ë¬µì§í•œ ê±¸ ì›í•˜ëŠ” ê±°ì˜ˆìš”. í™”ë ¤í•˜ì§„ ì•Šì§€ë§Œ ì§„ì§œ ë§›ì„ ì•„ëŠ” ì‚¬ëŒì´ì—ìš”.',
        'ëœ¨ëˆí•œ êµ­ë¬¼ì´ ë‹¹ê¸´ë‹¤ëŠ” ê±´ ì§€ê¸ˆ ì†ì´ í¸ì•ˆí•´ì§€ê³  ì‹¶ë‹¤ëŠ” ì‹ í˜¸ì˜ˆìš”. ê²‰ìœ¼ë¡œëŠ” ê°•í•´ ë³´ì—¬ë„ ì†ì€ ë”°ëœ»í•œ ê±¸ ì›í•˜ëŠ” ì‚¬ëŒì´ì—ìš”.'
      ],
      story: [
        'ì—°ì•  ì°ì„ ë§ì´ í’€ê³  ìˆë‹¤ëŠ” ê±´ ê´€ê³„ì— ëŒ€í•œ ìƒê°ì´ ë§ë‹¤ëŠ” ëœ»ì´ì—ìš”. ê·¸ ê²½í—˜ë“¤ì´ ìŒ“ì—¬ì„œ ì§€ê¸ˆ ì‚¬ëŒì„ ë³´ëŠ” ëˆˆì´ ìƒê¸´ ê±°ì˜ˆìš”. ì°ì´ ë§ë‹¤ëŠ” ê±´ ê·¸ë§Œí¼ ë§ì´ ì‚´ì•„ë´¤ë‹¤ëŠ” ì¦ê±°ì˜ˆìš”.',
        'ì†ì ˆ ì°ì„ ë§ì´ í‘¼ë‹¤ëŠ” ê±´ ì´ ì‚¬ëŒì˜ ê¸°ì¤€ì´ ìƒê²¼ë‹¤ëŠ” ëœ»ì´ì—ìš”. ë§ì§€ ì•Šìœ¼ë©´ ì •ë¦¬í•  ì¤„ ì•„ëŠ” ì‚¬ëŒì´ì—ìš”. ëƒ‰ì •í•œ ê²Œ ì•„ë‹ˆë¼ ìê¸° ìì‹ ì„ ì§€í‚¤ëŠ” ê±°ì˜ˆìš”.',
        'íšŒì‚¬/í•™êµ ì°ì´ ë§ë‹¤ëŠ” ê±´ ì§€ê¸ˆ ì¹˜ì—´í•˜ê²Œ ì‚´ê³  ìˆë‹¤ëŠ” ëœ»ì´ì—ìš”. ê·¸ ì¹˜ì—´í•¨ì´ ì–¸ì  ê°€ ê²½í—˜ê³¼ í†µì°°ë¡œ ë°”ë€ŒëŠ” ê²Œ ë³´ì—¬ìš”.',
        'í‘ì—­ì‚¬ ì°ì´ ë§ë‹¤ëŠ” ê±´ ê·¸ë§Œí¼ ë§ì´ ì‹œë„í•˜ê³  ì‹¤íŒ¨í•´ë´¤ë‹¤ëŠ” ëœ»ì´ì—ìš”. ì´ë¶ˆí‚¥í•  ê¸°ì–µì´ ë§ë‹¤ëŠ” ê±´ ì‚´ì•„ìˆë‹¤ëŠ” ì¦ê±°ì˜ˆìš”.'
      ]
    },
    B: {
      crave: [
        'ë§¤ì½¤í•œ ê²Œ ë‹¹ê¸´ë‹¤ â€” ë‹¬ë‹¬í•œ ì‚¬ëŒì¸ë° ë§¤ìš´ ê²Œ ë‹¹ê¸¸ ë•ŒëŠ” ë³€í™”ê°€ í•„ìš”í•œ ì‹œì ì´ì—ìš”. ì§€ê¸ˆ ìƒˆë¡œìš´ ìê·¹ì„ ì›í•˜ëŠ” ìƒíƒœì˜ˆìš”.',
        'ë‹¬ë‹¬í•œ ê²Œ ë‹¹ê¸´ë‹¤ â€” ìê¸° ìì‹ ì—ê²Œ ê°€ì¥ ì˜ ë§ëŠ” ê±¸ ê³ ë¥´ëŠ” ì‚¬ëŒì´ì—ìš”. ë‚¨ë“¤ ëˆˆì¹˜ ë³´ì§€ ì•Šê³  ë‚´ê°€ ë¨¹ê³  ì‹¶ì€ ê±¸ ë¨¹ëŠ” ì†”ì§í•¨ì´ ìˆì–´ìš”.',
        'ì§­ì§¤í•œ ê²Œ ë‹¹ê¸´ë‹¤ â€” ë‹¬ë‹¬í•œ ê²Œ ì•„ë‹Œ ì§­ì¡°ë¦„í•œ ê±¸ ì›í•  ë•ŒëŠ” í˜„ì‹¤ì ì¸ ë¬´ì–¸ê°€ê°€ í•„ìš”í•œ ì‹œì ì´ì—ìš”.',
        'êµ­ë¬¼ì´ ë‹¹ê¸´ë‹¤ â€” ì†ì´ ë”°ëœ»í•´ì§€ê³  ì‹¶ë‹¤ëŠ” ëœ»ì´ì—ìš”. ì§€ê¸ˆ ê°ì •ì ìœ¼ë¡œ ì¢€ ë¹„ì–´ìˆëŠ” ìƒíƒœì¼ ìˆ˜ ìˆì–´ìš”.'
      ],
      story: [
        'ì—°ì•  ì°ì´ ë§ë‹¤ â€” ë§ˆìŒì„ ë§ì´ ì¨ë´¤ë‹¤ëŠ” ëœ»ì´ì—ìš”. ê·¸ ê²½í—˜ì´ ì´ ì‚¬ëŒì„ ë” ê°ì„± ê¹Šê²Œ ë§Œë“¤ì–´ì¤¬ì–´ìš”.',
        'ì†ì ˆ ì°ì´ ë§ë‹¤ â€” ìƒì²˜ë¥¼ ë°›ì•˜ì§€ë§Œ ê·¸ ë’¤ë¡œ ì¼ì–´ì„œëŠ” ì‚¬ëŒì´ì—ìš”. ì†ì ˆì„ ê²°ì •í•˜ëŠ” ìš©ê¸°ê°€ ì‚¬ì‹¤ ëŒ€ë‹¨í•œ ê±°ì˜ˆìš”.',
        'ì§ì¥/í•™êµ ì°ì´ ë§ë‹¤ â€” ì§€ê¸ˆ ë§ì´ ì§€ì³ìˆë‹¤ëŠ” ì‹ í˜¸ì˜ˆìš”. ê·¸ ì•ˆì—ì„œë„ ë²„í‹°ê³  ìˆëŠ” ìì‹ ì„ í•œ ë²ˆì¯¤ ì¸ì •í•´ì¤˜ì•¼ í•´ìš”.',
        'í‘ì—­ì‚¬ ì°ì´ ë§ë‹¤ â€” ì›ƒìœ¼ë©´ì„œ í„¸ì–´ë‚¼ ì¤„ ì•„ëŠ” ì‚¬ëŒì´ì—ìš”. ë¶€ë„ëŸ¬ìš´ ê¸°ì–µì„ ì°ë¡œ ë§Œë“œëŠ” ì‚¬ëŒì€ íšŒë³µë ¥ì´ ê°•í•œ ê±°ì˜ˆìš”.'
      ]
    },
    C: {
      crave: [
        'ë§¤ì½¤í•œ ê²Œ ë‹¹ê¸´ë‹¤ â€” ì§€ê¸ˆ ê°ì •ì´ ê½¤ ê°•í•˜ê²Œ ë“ê³  ìˆë‹¤ëŠ” ì‹ í˜¸ì˜ˆìš”. ì´ì„±ì ì¸ ì‚¬ëŒì´ ìê·¹ì„ ì›í•  ë•ŒëŠ” ì§„ì§œë¡œ í˜ë“  ê±°ì˜ˆìš”.',
        'ë‹¬ë‹¬í•œ ê²Œ ë‹¹ê¸´ë‹¤ â€” íš¨ìœ¨ì ì¸ ì‚¬ëŒì´ ë‹¬ë‹¬í•œ ê±¸ ì›í•  ë•ŒëŠ” ìì‹ ì—ê²Œ ë³´ìƒì„ ì¤˜ì•¼ í•  ë•Œì˜ˆìš”. ê·¸ ì§ê´€ì´ ë§ì•„ìš”.',
        'ì§­ì§¤í•œ ê²Œ ë‹¹ê¸´ë‹¤ â€” ì œì¼ í˜„ì‹¤ì ì¸ ì„ íƒì„ í•˜ëŠ” ì‚¬ëŒì´ì—ìš”. ë§›ì—ì„œë„ ì‹¤ìš©ì„±ì„ ì°¾ëŠ” íƒ€ì…ì´ì—ìš”.',
        'êµ­ë¬¼ì´ ë‹¹ê¸´ë‹¤ â€” ê²‰ìœ¼ë¡œëŠ” ë‹¨ë‹¨í•´ ë³´ì—¬ë„ ë”°ëœ»í•¨ì„ ì›í•˜ëŠ” ì‚¬ëŒì´ì—ìš”. ê·¸ ì˜¨ê¸°ê°€ ì´ ì‚¬ëŒì„ ì›€ì§ì´ëŠ” ë™ë ¥ì´ì—ìš”.'
      ],
      story: [
        'ì—°ì•  ì°ì´ ë§ë‹¤ â€” ì´ì„±ì ì¸ ì‚¬ëŒì´ ì—°ì• ì—ì„œëŠ” ê½¤ ê°ì •ì ì¸ ë©´ì´ ë“œëŸ¬ë‚˜ëŠ” íƒ€ì…ì´ì—ìš”. ê·¸ ë°˜ì „ì´ ë§¤ë ¥ì´ì—ìš”.',
        'ì†ì ˆ ì°ì´ ë§ë‹¤ â€” ê¸°ì¤€ì´ ëª…í™•í•œ ì‚¬ëŒì´ì—ìš”. ë§ì§€ ì•Šìœ¼ë©´ ì„  ê¸‹ëŠ” ê²Œ ë¹ ë¥¸ íƒ€ì…ì´ì—ìš”.',
        'íšŒì‚¬/í•™êµ ì°ì´ ë§ë‹¤ â€” ì¹˜ì—´í•˜ê²Œ ì‚¬ëŠ” ì‚¬ëŒì´ì—ìš”. ê·¸ ì—ë„ˆì§€ê°€ ì´ ì‚¬ëŒì„ ì„±ì¥ì‹œí‚¤ëŠ” ì›ë™ë ¥ì´ ë˜ê³  ìˆì–´ìš”.',
        'í‘ì—­ì‚¬ ì°ì´ ë§ë‹¤ â€” ì™„ë²½ì£¼ì˜ìì²˜ëŸ¼ ë³´ì´ì§€ë§Œ ì‹¤ìˆ˜ë„ ë§ì´ í•´ë´¤ë‹¤ëŠ” ê±°ì˜ˆìš”. ê·¸ ì¸ê°„ì ì¸ ë©´ì´ ì‚¬ëŒë“¤ì´ ì¢‹ì•„í•˜ëŠ” í¬ì¸íŠ¸ì˜ˆìš”.'
      ]
    },
    D: {
      crave: [
        'ë§¤ì½¤í•œ ê²Œ ë‹¹ê¸´ë‹¤ â€” ìê·¹ì´ í•„ìš”í•œ ì‹œì ì´ì—ìš”. ë­”ê°€ ìƒˆë¡œìš´ ê±¸ ì‹œì‘í•˜ê³  ì‹¶ì€ ë§ˆìŒì´ ìˆì–´ìš”.',
        'ë‹¬ë‹¬í•œ ê²Œ ë‹¹ê¸´ë‹¤ â€” ì§€ê¸ˆ ìì‹ ì—ê²Œ ìœ„ë¡œê°€ í•„ìš”í•œ ìƒíƒœì˜ˆìš”. ê·¸ ì†”ì§í•œ ìê¸°ì¸ì‹ì´ ì´ ì‚¬ëŒì˜ ì§„ì§œ ì¥ì ì´ì—ìš”.',
        'ì§­ì§¤í•œ ê²Œ ë‹¹ê¸´ë‹¤ â€” êµ°ë”ë”ê¸° ì—†ê³  ì‹¤ì† ìˆëŠ” ê²ƒì„ ì¢‹ì•„í•˜ëŠ” ì„±í–¥ì´ ìŒì‹ ì·¨í–¥ì—ì„œë„ ë“œëŸ¬ë‚˜ìš”.',
        'êµ­ë¬¼ì´ ë‹¹ê¸´ë‹¤ â€” ë³¸ëŠ¥ì ìœ¼ë¡œ ë”°ëœ»í•¨ì„ ì°¾ëŠ” ì‚¬ëŒì´ì—ìš”. ê·¸ ë”°ëœ»í•¨ì´ ì£¼ë³€ ì‚¬ëŒë“¤ì„ ëŒì–´ë‹¹ê¸°ëŠ” ì´ìœ ì´ê¸°ë„ í•´ìš”.'
      ],
      story: [
        'ì—°ì•  ì°ì´ ë§ë‹¤ â€” ì”ì”í•´ ë³´ì´ì§€ë§Œ ì—°ì• ì—ì„œëŠ” ê½¤ ê¹Šì€ ê°ì •ì„ ì“°ëŠ” ì‚¬ëŒì´ì—ìš”.',
        'ì†ì ˆ ì°ì´ ë§ë‹¤ â€” êµ°ë§ ì—†ì´ ì •ë¦¬í•˜ëŠ” ì‚¬ëŒì´ì—ìš”. ë§ì´ ì—†ì–´ì„œ ì¿¨í•œ ê²Œ ì•„ë‹ˆë¼, ì´ë¯¸ ë‹¤ ìƒê°í•˜ê³  ê²°ì •í•œ ê±°ì˜ˆìš”.',
        'ì§ì¥/í•™êµ ì°ì´ ë§ë‹¤ â€” ì§€ê¸ˆ ë§ì´ ìŒ“ì—¬ìˆëŠ” ìƒíƒœì˜ˆìš”. ê·¸ ê°ì •ë“¤ ì–´ë”˜ê°€ì—ëŠ” í„¸ì–´ë‚¼ ì¶œêµ¬ê°€ í•„ìš”í•´ìš”.',
        'í‘ì—­ì‚¬ ì°ì´ ë§ë‹¤ â€” ë¶€ë„ëŸ¬ìš´ ê¸°ì–µë„ ì›ƒìœ¼ë©´ì„œ ì–˜ê¸°í•  ìˆ˜ ìˆëŠ” ì‚¬ëŒì´ì—ìš”. ê·¸ê²Œ ì§„ì§œ ì—¬ìœ  ìˆëŠ” ê±°ì˜ˆìš”.'
      ]
    }
  };

  const craveIdx = Math.min(c[0] !== undefined ? c[0] : 0, 3);
  const storyTypeIdx = Math.min(c[6] !== undefined ? c[6] : 0, 3);
  const hiddenCharm = (charmData[res.type]?.crave[craveIdx] || charmData.A.crave[0])
    + ' ' + (charmData[res.type]?.story[storyTypeIdx] || charmData.A.story[0]);

  // â”€â”€ ì•½ì : Q1(ëª‡ë¼) + Q2(ë°°ê³ í”„ë©´) ì¡°í•© â”€â”€
  const weakMap = {
    A: [
      ['ì—ë„ˆì§€ê°€ ë„˜ì³ì„œ ê°€ë” ì£¼ë³€ ì‚¬ëŒë“¤ì´ ì§€ì¹  ìˆ˜ ìˆì–´ìš”. í˜ì´ìŠ¤ ì¡°ì ˆì´ í•„ìš”í•œ ìˆœê°„ì„ ë†“ì¹˜ëŠ” ê²Œ ì•„í‚¬ë ˆìŠ¤ê±´ì´ì—ìš”.', 'ë°°ê³ í”Œ ë•Œ ì˜ˆë¯¼í•´ì§€ëŠ” ê²Œ ìì‹ ë„ ì•Œì§€ë§Œ, ê·¸ ìˆœê°„ ê°ì • ì¡°ì ˆì´ ì˜ ì•ˆ ë˜ëŠ” ê²Œ ì•„í‚¬ë ˆìŠ¤ê±´ì´ì—ìš”.'],
      ['í•œ ë¼ë¥¼ ê±°ë¥´ëŠ” ê²Œ ëª¸ë¿ ì•„ë‹ˆë¼ ê°ì •ì—ë„ ì˜í–¥ì„ ì£¼ëŠ” íƒ€ì…ì¸ë°, ê·¸ê±¸ ìŠ¤ìŠ¤ë¡œ ì˜ ëª» ì¸ì§€í•´ìš”.', 'ë‘ ë¼ ìƒí™œì´ ì§€ì†ë˜ë©´ ì—ë„ˆì§€ê°€ ë“¤ì‘¥ë‚ ì‘¥í•´ì§ˆ ìˆ˜ ìˆì–´ìš”.'],
      ['í•œ ë¼ë¡œ ë²„í‹°ë‹¤ ë³´ë©´ ì§‘ì¤‘ë ¥ì´ ë–¨ì–´ì§€ëŠ” ê±¸ ëŠë¼ëŠ”ë°, ê·¸ê²Œ ìƒì‚°ì„±ì— ì˜í–¥ì„ ì¤˜ìš”.', 'ì•„ë¬´ê±°ë‚˜ ë¨¹ëŠ” ìŠµê´€ì´ ì¥ê¸°ì ìœ¼ë¡œëŠ” ì—ë„ˆì§€ë¥¼ ë¬´ë„ˆëœ¨ë¦´ ìˆ˜ ìˆì–´ìš”.']
    ],
    B: [
      ['ê°ì •ì„ ìŒì‹ìœ¼ë¡œ ë‹¬ë˜ëŠ” íŒ¨í„´ì´ ìˆì–´ì„œ, í˜ë“  ê°ì •ì„ ì§ì ‘ ë‹¤ë£¨ê¸°ë³´ë‹¤ íšŒí”¼í•  ë•Œê°€ ìˆì–´ìš”.', 'ì†ìœ¼ë¡œ ìŒ“ë‹¤ê°€ í•œ ë²ˆì— í„°íŠ¸ë¦¬ëŠ” íŒ¨í„´ì´ ê´€ê³„ì—ì„œ ì˜¤í•´ë¥¼ ë§Œë“¤ ìˆ˜ ìˆì–´ìš”.'],
      ['ë‘ ë¼ ìƒí™œ ì¤‘ ì‹ì‚¬ ì‹œê°„ì„ ìŠ¤íŠ¸ë ˆìŠ¤ í•´ì†Œ ì‹œê°„ìœ¼ë¡œ ì“°ë‹¤ ë³´ë©´ ê³¼ì‹ìœ¼ë¡œ ì´ì–´ì§ˆ ìˆ˜ ìˆì–´ìš”.', 'ê¸°ë¶„ì´ ë‚˜ë¹ ë„ í‹° ì•ˆ ë‚´ë‹¤ê°€ ë‚˜ì¤‘ì— í•œêº¼ë²ˆì— ë§í•˜ëŠ” íŒ¨í„´ì´ ìƒëŒ€ë°©ì„ ë‹¹í™©í•˜ê²Œ í•´ìš”.'],
      ['í•œ ë¼ ë¨¹ì„ ë•Œ ê°ì •ì ì¸ ì˜í–¥ì„ ë§ì´ ë°›ì•„ìš”. ê¸°ë¶„ ì•ˆ ì¢‹ìœ¼ë©´ ë°¥ë„ ë§›ì—†ëŠ” íƒ€ì…ì´ì—ìš”.', 'ë‹¬ë‹¬í•œ ê±¸ë¡œ ê°ì •ì„ ë‹¬ë˜ë‹¤ ë³´ë©´ ì •ì‘ ê°ì • ì›ì¸ì„ í•´ê²°í•˜ì§€ ëª»í•˜ëŠ” ê²½ìš°ê°€ ìƒê²¨ìš”.']
    ],
    C: [
      ['ì™„ë²½ì£¼ì˜ê°€ ì‹ìŠµê´€ì—ê¹Œì§€ ë»—ì–´ìˆì–´ì„œ, ë£¨í‹´ì´ ë¬´ë„ˆì§€ë©´ ì „ì²´ì ìœ¼ë¡œ í”ë“¤ë¦¬ëŠ” ëŠë‚Œì´ ë“¤ì–´ìš”.', 'ë°°ê³ í”„ë‹¤ëŠ” ì‹ í˜¸ë„ ì´ì„±ì ìœ¼ë¡œ íŒë‹¨í•˜ë ¤ë‹¤ê°€ ì ì ˆí•œ íƒ€ì´ë°ì„ ë†“ì¹  ìˆ˜ ìˆì–´ìš”.'],
      ['íš¨ìœ¨ì ìœ¼ë¡œ ë¨¹ëŠ” ê²Œ ì¢‹ì§€ë§Œ ê·¸ê²Œ ì§€ì†ë˜ë©´ ì‹ì‚¬ ìì²´ì˜ ì¦ê±°ì›€ì„ ìƒì–´ë²„ë¦´ ìˆ˜ ìˆì–´ìš”.', 'ìŠ¤íŠ¸ë ˆìŠ¤ë¥¼ ë¹¨ë¦¬ ì²˜ë¦¬í•˜ë ¤ë‹¤ê°€ ê°ì •ì´ ì œëŒ€ë¡œ ì†Œí™”ë˜ì§€ ì•ŠëŠ” ê²½ìš°ê°€ ìˆì–´ìš”.'],
      ['í•œ ë¼ë¥¼ ì™„ë²½í•˜ê²Œ ë¨¹ìœ¼ë ¤ëŠ” ìš•êµ¬ ë•Œë¬¸ì— ì˜¤íˆë ¤ êµ¶ëŠ” ì„ íƒì„ í•˜ëŠ” íŒ¨í„´ì´ ìˆì„ ìˆ˜ ìˆì–´ìš”.', 'ê°ì •ì„ ë„ˆë¬´ ë¹ ë¥´ê²Œ ì •ë¦¬í•˜ë ¤ë‹¤ ë³´ë©´ ë‚˜ì¤‘ì— ë‹¤ì‹œ ì˜¬ë¼ì˜¤ëŠ” ê²½ìš°ê°€ ìˆì–´ìš”.']
    ],
    D: [
      ['ëŒ€ì¶© ë•Œìš°ëŠ” ê²Œ ìŠµê´€ì´ ë˜ë©´ ìê¸° ìì‹ ì„ ë°©ì¹˜í•˜ëŠ” ëŠë‚Œì´ ë“œëŠ” ì‹œê¸°ê°€ ì˜¬ ìˆ˜ ìˆì–´ìš”.', 'ê°ì • í‘œí˜„ì´ ì ì–´ì„œ ê°€ë” ì£¼ë³€ ì‚¬ëŒë“¤ì´ ì´ ì‚¬ëŒ ì†ì„ ì•Œ ìˆ˜ ì—†ë‹¤ê³  ëŠê»´ìš”.'],
      ['ë¬´ëŒì§„ ê²ƒì²˜ëŸ¼ ë³´ì¼ ìˆ˜ ìˆëŠ”ë°, ì‚¬ì‹¤ ì†ì—ì„œëŠ” ê½¤ ë§ì´ ìŒ“ì´ê³  ìˆëŠ” ìƒíƒœì¼ ìˆ˜ ìˆì–´ìš”.', 'ì•„ë¬´ê±°ë‚˜ ë¨¹ëŠ” ìŠµê´€ì´ ì¥ê¸°ì ìœ¼ë¡œ ì—ë„ˆì§€ë¥¼ ë¬´ë„ˆëœ¨ë¦´ ìˆ˜ ìˆì–´ìš”.'],
      ['í•œ ë¼ë¡œ ë²„í‹°ëŠ” ê²Œ ì§€ì†ë˜ë©´ ëª¸ê³¼ ë§ˆìŒ ëª¨ë‘ ì„œì„œíˆ ì§€ì³ê°€ìš”. ìê¸° ìì‹ ì„ ì¢€ ë” ì±™ê²¨ì•¼ í•  íƒ€ì´ë°ì´ì—ìš”.', 'ë§ ì—†ì´ í˜¼ì ì‚­íˆë‹¤ ë³´ë©´ ê°€ê¹Œìš´ ì‚¬ëŒë„ ë­˜ ë„ì™€ì¤˜ì•¼ í• ì§€ ëª¨ë¥´ëŠ” ìƒí™©ì´ ìƒê²¨ìš”.']
    ]
  };

  const wMeal = Math.min(mealIdx, 2);
  const wHungry = Math.min(Math.floor(c[2]/2) || 0, 1);
  const weakness = (weakMap[res.type]?.[wMeal]?.[wHungry]) || weakMap.A[0][0];

  // â”€â”€ ê²°ì •ì  í•œë§ˆë””: type + Q4(ì—°ì• ) + Q6(ì°) ì¡°í•© â”€â”€
  const reasonMap = {
    A: {
      '00': 'ë§ˆë¼íƒ•ì²˜ëŸ¼ ìê·¹ì ì´ê³  ì¤‘ë…ì ì¸ ì‚¬ëŒì¸ë°, ê·¸ ê°•ë„ë¥¼ ê°ë‹¹í•  ìˆ˜ ìˆëŠ” ì‚¬ëŒì´ ìˆì–´ìš”. ì°¾ìœ¼ë©´ ë¼ìš”.',
      '01': 'ëœ¨ê²ê²Œ ì‚´ì•˜ë˜ í”ì ì´ ì§€ê¸ˆì˜ ë‹¹ì‹ ì„ ë§Œë“¤ì—ˆì–´ìš”. ê·¸ ì°ë“¤ì´ ìŒ“ì—¬ ì´ì•¼ê¸°ê°€ ë˜ê³ , ë‹¹ì‹ ì´ ë¼ìš”.',
      '02': 'ì¹˜ì—´í•˜ê²Œ ì‚´ê³  ìˆëŠ” ê±° ë§ì•„ìš”. ê·¼ë° ê·¸ ì—´ê¸°ê°€ ë§ˆë¼íƒ•ì²˜ëŸ¼ ì‚¬ëŒë“¤ì„ ëŒì–´ë‹¹ê¸°ëŠ” ì´ìœ ê°€ ë˜ê³  ìˆì–´ìš”.',
      '03': 'í‘ì—­ì‚¬ë„ ì—°ì• ë„ ë‹¤ ì´ ì‚¬ëŒ ì´ì•¼ê¸°ì˜ˆìš”. ë¶€ë„ëŸ½ì§€ ì•Šì•„ë„ ë¼ìš”, ê·¸ê²Œ ë‹¹ì‹ ì„ ì‚´ì•„ìˆê²Œ ë§Œë“œë‹ˆê¹Œìš”.',
      '10': 'ì†ì ˆí•  ìˆ˜ ìˆëŠ” ì‚¬ëŒì´ ì§„ì§œ ìê¸°ë¥¼ ì§€í‚¬ ì¤„ ì•„ëŠ” ì‚¬ëŒì´ì—ìš”. ê·¸ ê²°ë‹¨ë ¥ì´ ë‹¹ì‹ ì˜ ì§„ì§œ í˜ì´ì—ìš”.',
      '11': 'ë­ë“  ì§ì ‘ ì •í•˜ê³  ì‹¤í–‰í•˜ëŠ” ì‚¬ëŒì´ì—ìš”. ê·¸ ì¶”ì§„ë ¥ì´ ë‹¹ì‹ ì„ ì—¬ê¸°ê¹Œì§€ ì˜¤ê²Œ í•œ ê±°ì˜ˆìš”.',
      '20': 'íšŒì‚¬ì—ì„œ ì§€ì³ë„ ì—¬ì „íˆ ì—´ì‹¬íˆ í•˜ê³  ìˆì£ ? ê·¸ ì—ë„ˆì§€ê°€ ë§ˆë¼íƒ•ì²˜ëŸ¼ ëœ¨ê±°ìš´ ê±°ì˜ˆìš”.',
      '21': 'ì´ë¶ˆí‚¥ í•  ê¸°ì–µë„, ë“ì–´ì˜¤ë¥´ëŠ” ê°ì •ë„, ë‹¤ ë‹¹ì‹ ì´ë¼ëŠ” ì‚¬ëŒì˜ ì¼ë¶€ì˜ˆìš”.',
      '30': 'ì‚¼ê°ê¹€ë°¥ì²˜ëŸ¼ ë¹ ë¥´ê²Œ ì‹œì‘í•˜ê³  ë¹ ë¥´ê²Œ ëë‚´ë„, ê·¸ ì•ˆì—ì„œ ë°°ìš°ëŠ” ê²Œ ìˆì—ˆì„ ê±°ì˜ˆìš”.',
      '31': 'ê°•ë ¬í•˜ê²Œ ì‚´ì•„ì˜¨ í”ì ë“¤ì´ ìˆì–´ìš”. ê·¸ê²Œ ì§€ê¸ˆ ì´ ì‚¬ëŒì„ ë§Œë“  ê±°ì˜ˆìš”. ë¶€ë„ëŸ½ì§€ ì•Šì•„ìš”.',
    },
    B: {
      '00': 'ë‹¬ë‹¬í•œ ì‚¬ëŒì´ë¼ê³  ë§Œë§Œí•˜ê²Œ ë³´ë©´ ì•ˆ ë¼ìš”. ì¼€ì´í¬ì²˜ëŸ¼ ê²¹ê²¹ì´ ìŒ“ì¸ ê¹Šì´ê°€ ìˆì–´ìš”.',
      '01': 'ì—°ì• ì—ì„œ ìƒì²˜ë°›ì•˜ì–´ë„ ì—¬ì „íˆ ì‚¬ëŒì—ê²Œ ì˜¨ê¸°ë¥¼ ì£¼ëŠ” ì‚¬ëŒì´ì—ìš”. ê·¸ê²Œ ì§„ì§œ ê°•í•œ ê±°ì˜ˆìš”.',
      '02': 'ì¼ë„ ì—´ì‹¬íˆ, ê°ì •ë„ í’ë¶€í•˜ê²Œ. ê·¸ ì–‘ë©´ì„ ë‹¤ ê°€ì§„ ê²Œ ë‹¹ì‹ ì˜ ì§„ì§œ ë§¤ë ¥ì´ì—ìš”.',
      '03': 'í‘ì—­ì‚¬ë¥¼ ì›ƒìœ¼ë©° ì–˜ê¸°í•  ìˆ˜ ìˆëŠ” ì‚¬ëŒì´ì—ìš”. ê·¸ íšŒë³µë ¥ì´ ë‹¹ì‹ ì˜ ê°€ì¥ í° ë¬´ê¸°ì˜ˆìš”.',
      '10': 'ì†ì ˆí•˜ë©´ì„œë„ ìƒëŒ€ë¥¼ íƒ“í•˜ì§€ ì•ŠëŠ” ì‚¬ëŒì´ì—ìš”. ê·¸ ì„±ìˆ™í•¨ì´ ì¼€ì´í¬ì²˜ëŸ¼ ë‹¬ê³  ê¹Šì–´ìš”.',
      '11': 'ê¸°ë…ì¼ ìŠì§€ ì•Šê³ , ì‘ì€ ê±° ì±™ê¸°ëŠ” ì‚¬ëŒì´ì—ìš”. ê·¸ê²Œ ë‹¹ì—°í•œ ê²Œ ì•„ë‹Œë° ë‹¹ì‹ ì€ ìì—°ìŠ¤ëŸ½ê²Œ í•´ìš”.',
      '20': 'í˜ë“  ìƒí™©ì—ì„œë„ ë‹¬ë‹¬í•œ ìˆœê°„ì„ ì°¾ì•„ë‚´ëŠ” ëŠ¥ë ¥ì´ ìˆì–´ìš”. ê·¸ê²Œ ìƒì¡´ ë³¸ëŠ¥ì´ì ë§¤ë ¥ì´ì—ìš”.',
      '21': 'í‘ì—­ì‚¬ë„ ì¼€ì´í¬ì²˜ëŸ¼ ë ˆì´ì–´ë¡œ ìŒ“ì•„ì„œ ì§€ê¸ˆì˜ ë‹¹ì‹ ì„ ë§Œë“¤ì—ˆì–´ìš”.',
      '30': 'ê°‘ìê¸° ì‹œì‘ëì–´ë„ ì§„ì‹¬ì´ì—ˆì–´ìš”. ê·¸ ì§„ì‹¬ì´ ë‹¹ì‹ ì„ ë” ê¹Šì€ ì‚¬ëŒìœ¼ë¡œ ë§Œë“¤ì—ˆì–´ìš”.',
      '31': 'ì´ë¶ˆí‚¥ í•  ê¸°ì–µì´ ìˆëŠ” ê±´ ê·¸ë§Œí¼ ê°ì •ì ìœ¼ë¡œ ì‚´ì•˜ë‹¤ëŠ” ê±°ì˜ˆìš”. ê·¸ê²Œ ë‹¹ì‹ ì˜ ì˜¨ê¸°ì˜ˆìš”.',
    },
    C: {
      '00': 'ì™€ì¸ì²˜ëŸ¼ ì²˜ìŒì—” ì–´ë µì§€ë§Œ, ì•Œì•„ê°ˆìˆ˜ë¡ "ì´ ì‚¬ëŒ ì§„ì§œë‹¤" ì‹¶ì€ ìˆœê°„ì´ ì˜¤ê²Œ ë¼ ìˆì–´ìš”.',
      '01': 'ì—°ì• ì—ì„œ ë­˜ ì›í•˜ëŠ”ì§€ ì´ì œ ì•Œê²Œ ëì„ ê±°ì˜ˆìš”. ê·¸ ëª…í™•í•¨ì´ ë‹¤ìŒ ì—°ì• ë¥¼ ë” ì˜ ë§Œë“¤ì–´ì¤˜ìš”.',
      '02': 'ì¹˜ì—´í•˜ê²Œ ì‚´ë©´ì„œë„ ìê¸° ê¸°ì¤€ì„ ìƒì§€ ì•ŠëŠ” ì‚¬ëŒì´ì—ìš”. ê·¸ ê¸°ì¤€ì´ ì™€ì¸ì²˜ëŸ¼ ìˆ™ì„±ë˜ê³  ìˆì–´ìš”.',
      '03': 'ì‹¤ìˆ˜ë„ í–ˆê³  í‘ì—­ì‚¬ë„ ìˆì§€ë§Œ, ê·¸ê²Œ ì™„ë²½ì£¼ì˜ìì²˜ëŸ¼ ë³´ì´ëŠ” ë‹¹ì‹ ì˜ ì¸ê°„ì ì¸ ë©´ì´ì—ìš”.',
      '10': 'ì„  ê¸‹ëŠ” ê²Œ ì°¨ê°‘ê²Œ ë³´ì¼ ìˆ˜ ìˆì§€ë§Œ, ìê¸° ìì‹ ì„ ì§€í‚¤ëŠ” ê±°ì˜ˆìš”. ê·¸ íŒë‹¨ë ¥ì´ ì¥ì ì´ì—ìš”.',
      '11': 'ëª¨ë“  ê²Œ ì´ìœ ê°€ ìˆëŠ” ì‚¬ëŒì´ì—ìš”. ë©”ë‰´ ê³ ë¥´ëŠ” ê²ƒë„, ì‚¬ëŒ ì‚¬ê·€ëŠ” ê²ƒë„ ë‹¤ ìƒê°ì´ ìˆì–´ìš”.',
      '20': 'íšŒì‚¬ì—ì„œ ì¹˜ì´ë©´ì„œë„ ì›ì¹™ì„ ì§€í‚¤ë ¤ëŠ” ì‚¬ëŒì´ì—ìš”. ê·¸ ì›ì¹™ì´ ë‚˜ì¤‘ì— ë‹¹ì‹ ì„ ì¦ëª…í•´ì¤„ ê±°ì˜ˆìš”.',
      '21': 'ì´ë¶ˆí‚¥ ê¸°ì–µë„ ì™€ì¸ì²˜ëŸ¼ ìˆ™ì„±ì‹œí‚¤ë©´ ë‚˜ì¤‘ì—” ë¬´ê¸°ê°€ ë¼ìš”. ì§„ì§œë¡œìš”.',
      '30': 'ë¹ ë¥´ê²Œ ëë‚¬ì–´ë„ ê·¸ ê²½í—˜ì´ ë‹¹ì‹ ì˜ ì‚¬ëŒ ë³´ëŠ” ëˆˆì„ ë‚ ì¹´ë¡­ê²Œ ë§Œë“¤ì—ˆì–´ìš”.',
      '31': 'ì™„ë²½í•˜ì§€ ì•Šì•˜ë˜ ìˆœê°„ë“¤ì´ ì™€ì¸ì˜ ì‚°ë„ì²˜ëŸ¼ ë‹¹ì‹ ì„ ë³µì¡í•˜ê³  ê¹Šì€ ì‚¬ëŒìœ¼ë¡œ ë§Œë“¤ì—ˆì–´ìš”.',
    },
    D: {
      '00': 'í•´ì¥êµ­ì²˜ëŸ¼ ìˆì–´ì•¼ ì™„ì„±ë˜ëŠ” ì¡´ì¬ì˜ˆìš”. ê·¸ ë“ ë“ í•¨ì´ ì£¼ë³€ ì‚¬ëŒë“¤ì´ ë‹¹ì‹ ì„ ì°¾ëŠ” ì´ìœ ì˜ˆìš”.',
      '01': 'ì—°ì• ì—ì„œ ìƒì²˜ë°›ì•˜ì–´ë„ ì—¬ì „íˆ ê³ì— ìˆì–´ì£¼ëŠ” ì‚¬ëŒì´ì—ìš”. ê·¸ ì§„êµ­ ê°™ì€ ì§„ì‹¬ì´ ë‹¹ì‹ ì´ì—ìš”.',
      '02': 'í˜ë“  ìƒí™©ì—ì„œë„ ìë¦¬ ì§€í‚¤ëŠ” ì‚¬ëŒì´ì—ìš”. ê·¸ ë¬µì§í•¨ì´ ë‹¹ì‹ ì˜ ì§„ì§œ ê°€ì¹˜ì˜ˆìš”.',
      '03': 'í‘ì—­ì‚¬ë„ í•´ì¥êµ­ì²˜ëŸ¼ ë‹¤ìŒë‚  ìƒˆë²½ì— ìƒê°ë‚˜ëŠ” ì´ì•¼ê¸°ê°€ ë¼ìš”. ê·¸ê²Œ ë‹¹ì‹  ë§¤ë ¥ì´ì—ìš”.',
      '10': 'ì†ì ˆí•  ë•Œë„ ì¡°ìš©íˆ í•˜ëŠ” ì‚¬ëŒì´ì—ìš”. ë§ ì—†ì´ ì‚¬ë¼ì§€ëŠ” ê²Œ ë” ë¬´ì„œìš´ ë²•ì´ì—ìš”.',
      '11': 'ê²°ì •í•˜ë©´ ë°”ê¾¸ì§€ ì•ŠëŠ” ì‚¬ëŒì´ì—ìš”. ê·¸ ë¬µì§í•œ ì‹ ë¢°ê°ì´ ì‚¬ëŒë“¤ì´ ë‹¹ì‹  ê³ì— ìˆëŠ” ì´ìœ ì˜ˆìš”.',
      '20': 'ì§€ì³ë„ í‹° ì•ˆ ë‚´ë©´ì„œ ë²„í‹°ê³  ìˆì£ ? ë‹¹ì‹ ì´ ìˆì–´ì„œ ì£¼ë³€ì´ ì•ˆì •ë˜ëŠ” ê±° ì•Œì•„ìš”.',
      '21': 'í‘ì—­ì‚¬ë¥¼ ì›ƒìœ¼ë©´ì„œ ì–˜ê¸°í•  ìˆ˜ ìˆëŠ” ì—¬ìœ ê°€ ë‹¹ì‹ ì˜ ê°€ì¥ í° ë¬´ê¸°ì˜ˆìš”.',
      '30': 'ë¹ ë¥´ê²Œ ëë‚¬ì–´ë„ ê·¸ ì‚¬ëŒ ìƒê°ì€ ì˜¤ë˜ í•˜ëŠ” íƒ€ì…ì´ì—ìš”. ê·¸ ê¹Šì´ê°€ ë‹¹ì‹ ì´ì—ìš”.',
      '31': 'ëŒ€ì¶© ì‚¬ëŠ” ê²ƒ ê°™ì•„ë„ ì‚¬ì‹¤ ì œì¼ ë‹¨ë‹¨í•˜ê²Œ ì‚´ê³  ìˆëŠ” ì‚¬ëŒì´ì—ìš”.',
    }
  };

  const loveKey = String(loveIdx);
  const storyKey = String(storyTypeIdx);
  const comboKey = loveKey + storyKey;
  const reason = reasonMap[res.type]?.[comboKey]
    || reasonMap[res.type]?.['00']
    || 'ì§€ê¸ˆ ì´ ì„ íƒë“¤ì´ ëª¨ì—¬ ë‹¹ì‹ ì´ë¼ëŠ” ì‚¬ëŒì„ ë§Œë“¤ê³  ìˆì–´ìš”.';

  // â”€â”€ íƒœê·¸: type + Q6 ì¡°í•© â”€â”€
  const tagPool = {
    A: ['#ë§ˆë¼íƒ•ì¸ê°„','#ìê·¹ì£¼ì˜','#ê°ì •ì§ì§„','#ì¤‘ë…ë§¤ë ¥','#ë°°ê³ í”„ë©´í”¼í•´','#ì—°ì• ê³ ìˆ˜','#ë§¤ìš´ë§›ì¸ìƒ','#ì°ë¶€ì','#ì—´ì •ê³¼ì‰','#ì§ì§„í˜•ì¸ê°„'],
    B: ['#ì¼€ì´í¬ì¸ê°„','#ë‹¬ë‹¬í•¨ì£¼ì˜','#ê¸°ë…ì¼ì¥ì¸','#ê°ì„±ì¶©ë§Œ','#ì´ë¶ˆí‚¥ì¥ì¸','#ì¡°ìš©í•œë‚­ë§Œì£¼ì˜','#ë””ì €íŠ¸ì¹˜ë£Œì‚¬','#ê°ì •ë¶€ì','#ì†Œí™•í–‰ë§ˆìŠ¤í„°','#ê³µê°ëŠ¥ë ¥Max'],
    C: ['#ì™€ì¸ì¸ê°„','#ìˆ™ì„±í˜•ì¸ê°„','#ì²œì²œíˆì•Œì•„ê°€ì','#1íšŒì°¨ëŠ”ëª¨ë¦„','#ë°˜ì „ë§¤ë ¥','#ë…¼ë¦¬ì™€ê°ì„±ì‚¬ì´','#ê¸°ì¤€ìˆëŠ”ì‚¬ëŒ','#ì™„ë²½ì£¼ì˜ìì˜ë°˜ì „','#ì™€ì¸ì²˜ëŸ¼ê¹Šì–´ì§','#íš¨ìœ¨ë§ˆìŠ¤í„°'],
    D: ['#í•´ì¥êµ­ì¸ê°„','#ì§„êµ­ì¸ìƒ','#ìˆì–´ì•¼ì™„ì„±','#ìƒˆë²½ì„¸ì‹œì—ìƒê°ë‚¨','#ì¡°ìš©í•œê°•ì','#ë§ì—†ëŠ”ë¯¿ìŒì§í•¨','#ë¬µì§í•œì¡´ì¬ê°','#ì•„ë¬´ê±°ë‚˜í˜•ì¸ê°„','#ì¿¨í•œì²™ì§„ì‹¬ì„','#ë“ ë“ í•œì‚¬ëŒ']
  };
  const baseTags = tagPool[res.type] || tagPool.A;
  // Q4, Q6 ê¸°ë°˜ ì¶”ê°€ íƒœê·¸
  const extraTags = {
    love: [['#ë§ˆë¼íƒ•ì—°ì• ','#ì¤‘ë…ì—°ì• '], ['#ë‹¬ë‹¬í•œì—°ì• ','#ê¸°ë…ì¼ì—°ì• '], ['#ì™€ì¸ì—°ì• ','#ìˆ™ì„±í˜•ì—°ì• '], ['#ì‚¼ê°ê¹€ë°¥ì—°ì• ','#ë¹ ë¥¸ì´ë³„']],
    story: [['#ì—°ì• ê³ ìˆ˜','#ì—°ì• ì°ë¶€ì'], ['#ì†ì ˆì¥ì¸','#ê¸°ì¤€ìˆëŠ”ì¸ê°„'], ['#íšŒì‚¬ì¸ê°„','#ì¹˜ì—´í•œì‚¶'], ['#í‘ì—­ì‚¬ë¶€ì','#ì´ë¶ˆí‚¥ë§ˆìŠ¤í„°']]
  };
  const extraL = extraTags.love[loveIdx] || [];
  const extraS = extraTags.story[storyTypeIdx] || [];
  const allTags = [...new Set([...baseTags.slice(0,3), ...extraL.slice(0,1), ...extraS.slice(0,1)])].slice(0,5);

  // â”€â”€ ìµœì¢… í•œì¤„ìš”ì•½ ê²°ì • (Q2 ìš°ì„ ) â”€â”€
  const finalHl = hlMap[res.type]?.[0]?.[Math.min(c[2]||0,3)] || hlMap.A[0][0];

  return renderQuizAI_local({ hl: finalHl, foodPsy, relPsy, hiddenCharm, weakness, reason, tags: allTags });
}

function renderQuizAI_local({ hl, foodPsy, relPsy, hiddenCharm, weakness, reason, tags }) {
  const sections = [
    { icon: 'ğŸ½ï¸', title: 'ìŒì‹ìœ¼ë¡œ ì½íˆëŠ” ë‚˜', content: foodPsy },
    { icon: 'ğŸ¤', title: 'ê´€ê³„ ë§ºëŠ” ë°©ì‹', content: relPsy },
    { icon: 'âœ¨', title: 'ë‚˜ë„ ëª°ëë˜ ë‚´ ë§¤ë ¥', content: hiddenCharm },
  ];
  return `<div class="q-ai-section"><div class="q-ai-section-title">âœ¦ í•œì¤„ ìš”ì•½</div><p style="font-weight:700;font-size:15px;color:var(--dark);line-height:1.6">${hl}</p></div>
<div class="q-ai-section"><div class="q-ai-section-title">âœ¦ ì‹¬ì¸µ ë¶„ì„</div>${sections.map(s => `<div style="margin-bottom:12px;padding:12px 14px;background:rgba(212,149,106,.06);border-radius:12px;border-left:3px solid var(--toast)"><p style="font-size:12px;font-weight:700;color:var(--toast);margin-bottom:6px">${s.icon} ${s.title}</p><p style="font-size:13px;color:var(--dark);line-height:1.85">${s.content}</p></div>`).join('')}</div>
${weakness ? `<div class="q-ai-section"><div class="q-ai-section-title">âš¡ ì•„í‚¬ë ˆìŠ¤ê±´</div><p style="font-size:13px;color:var(--muted);line-height:1.75;padding:12px 14px;background:rgba(44,24,16,.04);border-radius:12px;font-style:italic">${weakness}</p></div>` : ''}
<div class="q-ai-section"><div class="q-ai-section-title">âœ¦ ê²°ì •ì  í•œë§ˆë””</div><p style="font-size:14px;font-weight:600;color:var(--dark);border-left:3px solid var(--toast);padding:14px 16px;background:rgba(212,149,106,.07);border-radius:0 12px 12px 0;line-height:1.9">"${reason}"</p></div>
<div style="margin-top:4px">${tags.map(t => `<span class="q-ai-tag">${t}</span>`).join('')}</div>`;
}



// â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
//  PHONE
// â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
let consented=false;
function toggleConsent(){consented=!consented;document.getElementById('consent-cb').classList.toggle('checked',consented);}
function formatPhone(el){let v=el.value.replace(/\D/g,'').substring(0,11);if(v.length<=3)el.value=v;else if(v.length<=7)el.value=v.slice(0,3)+'-'+v.slice(3);else el.value=v.slice(0,3)+'-'+v.slice(3,7)+'-'+v.slice(7);}
function submitPhone(){
  const p=document.getElementById('phone-input').value.trim();
  if(p&&!consented){alert('ê°œì¸ì •ë³´ í™œìš© ë™ì˜ë¥¼ ì²´í¬í•´ì£¼ì„¸ìš”!');return;}
  submitToNetlify(p);
}

async function submitToNetlify(phone){
  // 7ê°œ ì§ˆë¬¸ ë‹µë³€ ì •ë¦¬
  const qAnswers={};
  answerLabels.forEach((item,qi)=>{
    const c=item.opts[item.chosen];
    qAnswers[`Q${qi+1}_ë‹µë³€`]=`${c.e} ${c.t}`;
  });

  const formData=new FormData();
  formData.append('form-name','ssulFood');
  formData.append('ì œì¶œì¼ì‹œ', new Date().toLocaleString('ko-KR'));
  formData.append('ì—°ë½ì²˜', phone||'ë¯¸ì œê³µ');
  formData.append('ìŒì‹ìœ í˜•', savedResult.food||'');
  formData.append('ì„±í–¥íƒœê·¸', savedResult.tag||'');
  formData.append('ì°_ì£¼ì¸ê³µìŒì‹', savedFoodName||'ì—†ìŒ');
  formData.append('ë…¹ìŒ_í…ìŠ¤íŠ¸', savedStory||'ì—†ìŒ');
  formData.append('ê°ì •', savedMood||'');
  Object.entries(qAnswers).forEach(([k,v])=>formData.append(k,v));

  try{
    await fetch('/', {method:'POST', body:formData});
  }catch(e){
    console.warn('Netlify form ì „ì†¡ ì‹¤íŒ¨ (ë¡œì»¬ í™˜ê²½ì—ì„  ì •ìƒ):', e);
  }
  goTo('page-done');
}

// â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
//  INIT
// â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
initQuiz();
</script>
</body>
</html>