<!DOCTYPE html>
<html lang="ko">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>ì°í‘¸ë“œ â€” ë‹¹ì‹ ì˜ ìŒì‹ê³¼ ì°ì€?</title>
<link href="https://fonts.googleapis.com/css2?family=Noto+Serif+KR:wght@400;700;900&family=Noto+Sans+KR:wght@300;400;500&display=swap" rel="stylesheet">
<style>
  :root {
    --cream: #FAF3E8; --toast: #D4956A; --caramel: #B8622A; --dark: #2C1810;
    --muted: #7A5C4A; --accent: #E8734A; --green: #5A7A52;
    --border: rgba(180,130,90,0.25);
    --story-blue: #4a5fa0; --story-bg: #f0f4ff; --story-border: rgba(100,130,220,.25);
    --rec-red: #E8453C; --rec-red-glow: rgba(232,69,60,0.2);
  }
  * { margin:0; padding:0; box-sizing:border-box; }
  body { background:var(--cream); font-family:'Noto Sans KR',sans-serif; color:var(--dark); min-height:100vh; overflow-x:hidden; }
  body::before { content:''; position:fixed; inset:0; background-image:radial-gradient(circle at 20% 20%,rgba(212,149,106,.08) 0%,transparent 50%),radial-gradient(circle at 80% 80%,rgba(91,122,82,.06) 0%,transparent 50%); pointer-events:none; z-index:0; }
  .page { display:none; position:relative; z-index:1; min-height:100vh; }
  .page.active { display:flex; flex-direction:column; }

  /* SPLASH */
  #page-splash { align-items:center; justify-content:center; background:linear-gradient(160deg,#FFF9F0 0%,#FAF0E0 40%,#F5E8CC 100%); text-align:center; padding:40px 20px; }
  .splash-title { font-family:'Noto Serif KR',serif; font-size:clamp(28px,8vw,52px); font-weight:900; color:var(--dark); line-height:1.25; letter-spacing:-1px; margin-bottom:10px; animation:fadeUp .8s ease both; }
  .splash-title em { color:var(--caramel); font-style:normal; }
  .splash-sub { font-size:14px; color:var(--muted); margin-bottom:44px; animation:fadeUp .8s .15s ease both; opacity:0; animation-fill-mode:both; }
  .splash-chars { display:flex; gap:12px; align-items:flex-end; justify-content:center; flex-wrap:wrap; margin-bottom:48px; animation:fadeUp .8s .25s ease both; opacity:0; animation-fill-mode:both; }
  .splash-char { display:flex; flex-direction:column; align-items:center; gap:6px; animation:bobble 2s ease-in-out infinite; }
  .splash-char:nth-child(2){animation-delay:.2s;} .splash-char:nth-child(3){animation-delay:.4s;} .splash-char:nth-child(4){animation-delay:.6s;}
  .splash-char svg { width:70px; height:78px; filter:drop-shadow(0 6px 12px rgba(44,24,16,.13)); }
  .splash-char-name { font-size:11px; font-weight:700; color:var(--muted); letter-spacing:.5px; }
  @keyframes bobble { 0%,100%{transform:translateY(0)} 50%{transform:translateY(-10px)} }
  .splash-btn { padding:16px 52px; border-radius:50px; border:none; background:linear-gradient(135deg,var(--caramel),var(--accent)); color:white; font-size:18px; font-weight:700; cursor:pointer; font-family:'Noto Serif KR',serif; box-shadow:0 8px 24px rgba(184,98,42,.35); transition:all .25s; animation:fadeUp .8s .4s ease both; opacity:0; animation-fill-mode:both; }
  .splash-btn:hover { transform:translateY(-3px); box-shadow:0 12px 32px rgba(184,98,42,.45); }

  /* LAYOUT */
  .page-wrap { max-width:640px; margin:0 auto; width:100%; padding:0 20px 80px; flex:1; }
  .page-header { text-align:center; padding:44px 0 28px; }
  .page-tag { display:inline-block; background:var(--toast); color:white; font-size:11px; letter-spacing:2px; padding:5px 14px; border-radius:20px; margin-bottom:14px; font-weight:500; }
  .page-header h2 { font-family:'Noto Serif KR',serif; font-size:clamp(22px,5vw,32px); font-weight:900; line-height:1.3; letter-spacing:-.5px; }
  .page-header h2 em { color:var(--caramel); font-style:normal; }
  .page-header p { margin-top:10px; color:var(--muted); font-size:13px; line-height:1.7; }

  /* QUIZ */
  .quiz-card { background:linear-gradient(135deg,#FFF9F0,#FFF3E0); border-radius:20px; padding:26px; border:1.5px solid rgba(212,149,106,.3); box-shadow:0 4px 24px rgba(44,24,16,.06); }
  .quiz-progress { display:flex; gap:6px; margin-bottom:10px; }
  .quiz-dot { height:4px; flex:1; border-radius:2px; background:var(--border); transition:background .3s; }
  .quiz-dot.active{background:var(--toast);} .quiz-dot.done{background:var(--caramel);}
  .quiz-step-label { font-size:11px; color:var(--muted); margin-bottom:18px; letter-spacing:.5px; font-weight:600; }
  .quiz-question { font-family:'Noto Serif KR',serif; font-size:18px; font-weight:700; line-height:1.5; margin-bottom:20px; color:var(--dark); }
  .quiz-options { display:grid; grid-template-columns:1fr 1fr; gap:10px; }
  .quiz-option { padding:14px 12px; border-radius:14px; border:2px solid var(--border); background:white; cursor:pointer; font-size:13px; color:var(--dark); text-align:center; line-height:1.4; transition:all .2s; font-family:'Noto Sans KR',sans-serif; }
  .quiz-option:hover { border-color:var(--toast); background:#FFF8F0; transform:translateY(-2px); }
  .quiz-option.selected { border-color:var(--caramel); background:linear-gradient(135deg,#FFF0E0,#FFE8CC); font-weight:500; }
  .quiz-option .opt-emoji { display:block; font-size:24px; margin-bottom:6px; }
  .btn-next { width:100%; padding:15px; border-radius:12px; border:none; background:var(--dark); color:white; font-size:15px; font-weight:700; cursor:pointer; font-family:'Noto Serif KR',serif; transition:all .2s; margin-top:18px; }
  .btn-next:hover { background:var(--caramel); transform:translateY(-2px); }

  /* â•â• RECORD PAGE â•â• */
  #page-record { background:var(--cream); }
  .record-wrap { max-width:640px; margin:0 auto; padding:0 20px 80px; flex:1; }

  /* Food input card */
  .food-input-card {
    background:linear-gradient(135deg,#FFF9F0,#FFF3E0);
    border-radius:20px; padding:22px;
    border:1.5px solid rgba(212,149,106,.3);
    box-shadow:0 4px 24px rgba(44,24,16,.06);
    margin-bottom:18px;
  }
  .food-input-card label { display:block; font-size:12px; font-weight:700; color:var(--muted); letter-spacing:.5px; margin-bottom:10px; }
  .food-input-row { display:flex; gap:10px; align-items:center; }
  .food-text-input {
    flex:1; padding:13px 16px;
    border-radius:12px; border:2px solid var(--border);
    background:#FDFAF6; font-size:15px; color:var(--dark);
    font-family:'Noto Sans KR',sans-serif; outline:none;
    transition:border-color .2s;
  }
  .food-text-input:focus { border-color:var(--toast); }
  .food-text-input::placeholder { color:rgba(122,92,74,.4); }
  .food-emoji-btn { font-size:26px; flex-shrink:0; cursor:default; }

  /* Theme chips */
  .theme-row { margin-top:14px; }
  .theme-chips-label { font-size:11px; font-weight:700; color:var(--muted); letter-spacing:.5px; margin-bottom:8px; }
  .theme-chips { display:flex; flex-wrap:wrap; gap:7px; }
  .theme-chip { padding:6px 14px; border-radius:20px; border:1.5px solid var(--border); background:transparent; font-size:12px; color:var(--muted); cursor:pointer; transition:all .2s; font-family:'Noto Sans KR',sans-serif; }
  .theme-chip:hover { border-color:var(--toast); color:var(--toast); }
  .theme-chip.active { background:var(--dark); border-color:var(--dark); color:white; }

  /* Recorder Zone */
  .recorder-zone {
    background:white;
    border-radius:24px; padding:28px 24px;
    border:2px solid var(--border);
    box-shadow:0 4px 24px rgba(44,24,16,.06);
    margin-bottom:18px;
    text-align:center;
    transition:border-color .3s, box-shadow .3s;
  }
  .recorder-zone.recording {
    border-color:var(--rec-red);
    box-shadow:0 0 0 4px var(--rec-red-glow), 0 8px 32px rgba(44,24,16,.08);
  }

  /* Waveform */
  .waveform-container {
    height:52px; display:flex;
    align-items:center; justify-content:center;
    gap:3px; margin-bottom:16px;
  }
  .wave-bar {
    width:3px; border-radius:2px;
    background:rgba(180,130,90,0.2);
    transition:background .3s;
  }
  .recording .wave-bar {
    background:var(--rec-red);
    animation:waveDance var(--dur,.6s) ease-in-out infinite alternate;
    animation-delay:var(--delay,0s);
  }
  @keyframes waveDance { from{height:4px} to{height:var(--max-h,36px)} }

  /* Timer */
  .rec-timer {
    font-family:'Noto Serif KR',serif;
    font-size:40px; font-weight:900;
    letter-spacing:3px; color:var(--dark);
    margin-bottom:6px; transition:color .3s;
  }
  .recording .rec-timer { color:var(--rec-red); }
  .rec-status-row {
    display:flex; align-items:center; justify-content:center;
    gap:7px; margin-bottom:22px; min-height:20px;
  }
  .rec-live-dot {
    width:7px; height:7px; border-radius:50%;
    background:var(--rec-red);
    display:none;
    animation:dotBlink 1s ease-in-out infinite;
  }
  .recording .rec-live-dot { display:block; }
  @keyframes dotBlink{0%,100%{opacity:1}50%{opacity:.2}}
  .rec-status-text { font-size:12px; color:var(--muted); }

  /* Record button */
  .rec-btn-outer {
    display:flex; flex-direction:column;
    align-items:center; gap:12px;
  }
  .rec-btn {
    width:80px; height:80px; border-radius:50%;
    border:none; cursor:pointer;
    display:flex; align-items:center; justify-content:center;
    font-size:34px;
    transition:all .25s cubic-bezier(.34,1.56,.64,1);
    background:linear-gradient(135deg,var(--caramel),var(--accent));
    box-shadow:0 6px 24px rgba(184,98,42,.35);
  }
  .rec-btn:hover { transform:scale(1.08); }
  .rec-btn:active { transform:scale(0.95); }
  .rec-btn.recording-active {
    background:linear-gradient(135deg,var(--rec-red),#FF7A72);
    box-shadow:0 0 0 8px var(--rec-red-glow), 0 6px 24px rgba(232,69,60,.3);
    animation:recPulse 1.5s ease-in-out infinite;
  }
  @keyframes recPulse{0%,100%{box-shadow:0 0 0 8px rgba(232,69,60,.2),0 6px 24px rgba(232,69,60,.3)}50%{box-shadow:0 0 0 14px rgba(232,69,60,.08),0 6px 24px rgba(232,69,60,.3)}}
  .rec-btn-label { font-size:12px; color:var(--muted); font-weight:500; }

  /* Processing overlay */
  .rec-processing {
    display:none;
    flex-direction:column;
    align-items:center;
    gap:10px;
    padding:20px 0 4px;
  }
  .rec-processing.show { display:flex; }
  .proc-spinner { width:32px; height:32px; border:3px solid var(--border); border-top-color:var(--toast); border-radius:50%; animation:spin .8s linear infinite; }
  @keyframes spin{to{transform:rotate(360deg)}}
  .proc-text { font-size:13px; color:var(--muted); }

  /* RESULT */
  #page-result { background:var(--cream); }
  .result-wrap { max-width:640px; margin:0 auto; padding:40px 20px 80px; }
  .result-loading-screen { display:flex; flex-direction:column; align-items:center; justify-content:center; min-height:70vh; gap:20px; text-align:center; }
  .result-loading-screen p { font-size:14px; color:var(--muted); line-height:1.8; }
  .big-spinner { width:52px; height:52px; border:4px solid var(--border); border-top-color:var(--toast); border-radius:50%; animation:spin .9s linear infinite; }

  /* Loading steps */
  .loading-steps { margin-top:16px; display:flex; flex-direction:column; gap:8px; text-align:left; }
  .loading-step-item {
    display:flex; align-items:center; gap:10px;
    padding:10px 14px; border-radius:12px;
    font-size:12px; color:var(--muted);
    background:white; border:1px solid var(--border);
    transition:all .3s;
  }
  .loading-step-item.active { color:var(--toast); border-color:rgba(212,149,106,.4); background:#FFF8F0; }
  .loading-step-item.done { color:var(--green); border-color:rgba(90,122,82,.3); }
  .loading-step-icon { font-size:16px; }

  /* Section header */
  .result-section-header { text-align:center; padding:28px 0 18px; }
  .result-badge { display:inline-flex; align-items:center; gap:6px; color:white; font-size:11px; letter-spacing:2px; padding:6px 16px; border-radius:20px; margin-bottom:10px; font-weight:700; }
  .result-badge.warm { background:linear-gradient(135deg,var(--caramel),var(--accent)); }
  .result-badge.cool { background:linear-gradient(135deg,#4a5fa0,#6678cc); }
  .result-section-title { font-family:'Noto Serif KR',serif; font-size:16px; font-weight:700; color:var(--dark); }

  /* Section divider */
  .section-divider { display:flex; align-items:center; gap:12px; margin:28px 0 20px; }
  .section-divider-line { flex:1; height:1px; background:linear-gradient(90deg,transparent,var(--border),transparent); }
  .section-divider-label { font-family:'Noto Serif KR',serif; font-size:11px; font-weight:700; letter-spacing:2px; color:var(--muted); white-space:nowrap; padding:6px 14px; background:white; border:1px solid var(--border); border-radius:20px; }

  /* PERSONALITY CARD */
  .personality-card { background:white; border-radius:24px; padding:28px; border:1.5px solid rgba(212,149,106,.3); box-shadow:0 8px 32px rgba(44,24,16,.08); margin-bottom:14px; text-align:center; animation:popIn .5s cubic-bezier(.34,1.56,.64,1) both; }
  .personality-emoji { font-size:52px; display:block; margin-bottom:12px; }
  .personality-food-type { font-family:'Noto Serif KR',serif; font-size:24px; font-weight:900; color:var(--caramel); margin-bottom:8px; }
  .personality-type-tag { display:inline-block; padding:5px 14px; background:rgba(212,149,106,.12); border:1px solid rgba(212,149,106,.3); border-radius:20px; font-size:12px; font-weight:600; color:var(--caramel); margin-bottom:14px; }
  .personality-desc { font-size:14px; color:var(--muted); line-height:1.85; text-align:left; padding:14px 16px; background:rgba(212,149,106,.05); border-radius:12px; border-left:3px solid var(--toast); }

  /* QUIZ AI BOX */
  .quiz-ai-box { background:linear-gradient(135deg,#FFF9F0,#FFF3E0); border-radius:16px; padding:20px; border:1.5px solid rgba(212,149,106,.3); margin-bottom:14px; animation:popIn .5s .1s cubic-bezier(.34,1.56,.64,1) both; }
  .quiz-ai-box-title { font-family:'Noto Serif KR',serif; font-size:14px; font-weight:700; color:var(--caramel); margin-bottom:14px; display:flex; align-items:center; gap:8px; }
  .quiz-ai-content { font-size:13px; color:var(--dark); line-height:1.9; }
  .q-ai-section { margin-bottom:14px; padding-bottom:14px; border-bottom:1px dashed rgba(212,149,106,.2); }
  .q-ai-section:last-child { border-bottom:none; margin-bottom:0; padding-bottom:0; }
  .q-ai-section-title { font-size:11px; font-weight:700; color:var(--toast); letter-spacing:1px; margin-bottom:8px; }
  .q-ai-tag { display:inline-block; margin:4px 3px 0; padding:3px 10px; background:rgba(212,149,106,.12); color:var(--caramel); border-radius:12px; font-size:11px; font-weight:600; }

  /* QUIZ RECAP */
  .quiz-recap-card { background:white; border-radius:20px; padding:20px; border:1px solid var(--border); box-shadow:0 4px 24px rgba(44,24,16,.05); margin-bottom:14px; animation:popIn .5s .2s cubic-bezier(.34,1.56,.64,1) both; }
  .recap-title { font-size:11px; color:var(--muted); letter-spacing:1px; font-weight:600; margin-bottom:12px; }
  .recap-q { margin-bottom:8px; border-radius:12px; overflow:hidden; border:1px solid var(--border); }
  .recap-q-text { font-size:12px; font-weight:700; color:var(--dark); padding:9px 12px; background:rgba(44,24,16,.04); border-bottom:1px solid var(--border); line-height:1.4; }
  .recap-opt-chosen { display:flex; align-items:center; gap:8px; padding:8px 12px; font-size:13px; font-weight:600; color:var(--dark); background:linear-gradient(90deg,#FFF0E0,#FFF8F4); }
  .recap-check { width:18px; height:18px; border-radius:50%; background:var(--caramel); display:flex; align-items:center; justify-content:center; font-size:10px; color:white; flex-shrink:0; }

  /* CHARACTER CARD */
  .character-card { background:white; border-radius:24px; padding:24px; border:1.5px solid var(--story-border); box-shadow:0 8px 32px rgba(44,24,16,.08); margin-bottom:14px; animation:popIn .5s .05s cubic-bezier(.34,1.56,.64,1) both; }
  .character-card-inner { display:flex; gap:18px; align-items:flex-start; }
  .char-img-wrap { width:130px; height:130px; border-radius:20px; background:linear-gradient(135deg,#f0f4ff,#e8ecff); border:2px solid var(--story-border); display:flex; align-items:center; justify-content:center; overflow:hidden; flex-shrink:0; transition:background .5s; }
  .char-img { width:100%; height:100%; object-fit:cover; }
  .char-loading-inner { display:flex; flex-direction:column; align-items:center; gap:8px; color:var(--muted); font-size:11px; text-align:center; padding:8px; }
  .small-spinner { width:24px; height:24px; border:3px solid var(--border); border-top-color:var(--toast); border-radius:50%; animation:spin .8s linear infinite; }
  .character-info { flex:1; min-width:0; }
  .character-food-name { font-family:'Noto Serif KR',serif; font-size:20px; font-weight:900; color:var(--story-blue); margin-bottom:6px; }
  .character-sub-tag { display:inline-block; padding:4px 12px; background:linear-gradient(135deg,#f0f4ff,#e8ecff); border:1px solid var(--story-border); border-radius:20px; font-size:11px; font-weight:600; color:var(--story-blue); margin-bottom:10px; }
  .character-base-desc { font-size:13px; color:var(--muted); line-height:1.7; }

  /* MOOD BADGE */
  .mood-badge { display:inline-flex; align-items:center; gap:5px; padding:4px 12px; border-radius:20px; font-size:11px; font-weight:700; margin-bottom:8px; border:1px solid; }

  /* CHARACTER TRAITS CARD */
  .character-traits-card { border-radius:20px; padding:22px; margin-bottom:14px; animation:popIn .5s .12s cubic-bezier(.34,1.56,.64,1) both; border:1.5px solid var(--story-border); background:linear-gradient(135deg,#f0f4ff,#eaedff); }
  .character-traits-title { font-family:'Noto Serif KR',serif; font-size:14px; font-weight:700; color:var(--story-blue); margin-bottom:14px; display:flex; align-items:center; gap:8px; }
  .trait-item { display:flex; gap:12px; align-items:flex-start; padding:12px 14px; background:white; border-radius:12px; margin-bottom:8px; border:1px solid rgba(100,130,220,.12); }
  .trait-item:last-child { margin-bottom:0; }
  .trait-icon { font-size:20px; flex-shrink:0; }
  .trait-text { font-size:13px; color:var(--dark); line-height:1.7; }
  .trait-text strong { color:var(--story-blue); font-weight:700; display:block; font-size:11px; margin-bottom:3px; letter-spacing:.5px; }

  /* STORY (TRANSCRIPT) AI BOX */
  .story-ai-box { background:linear-gradient(135deg,#f0f4ff,#e8f0fe); border-radius:16px; padding:20px; border:1.5px solid var(--story-border); margin-bottom:14px; animation:popIn .5s .2s cubic-bezier(.34,1.56,.64,1) both; }
  .story-ai-box-title { font-family:'Noto Serif KR',serif; font-size:14px; font-weight:700; color:#3a56b0; margin-bottom:14px; display:flex; align-items:center; gap:8px; }
  .story-ai-content { font-size:13px; color:#2a3a6a; line-height:1.9; }
  .ai-section { margin-bottom:14px; padding-bottom:14px; border-bottom:1px dashed rgba(100,130,220,.2); }
  .ai-section:last-child { border-bottom:none; margin-bottom:0; padding-bottom:0; }
  .ai-section-title { font-size:11px; font-weight:700; color:#7a90cc; letter-spacing:1px; margin-bottom:8px; }
  .ai-tag { display:inline-block; margin:4px 3px 0; padding:3px 10px; background:rgba(100,130,220,.15); color:#3a56b0; border-radius:12px; font-size:11px; font-weight:600; }

  /* TRANSCRIPT RECAP */
  .story-recap-card { background:white; border-radius:20px; padding:20px; border:1px solid var(--story-border); box-shadow:0 4px 24px rgba(44,24,16,.05); margin-bottom:14px; animation:popIn .5s .28s cubic-bezier(.34,1.56,.64,1) both; }
  .recap-story { border-radius:12px; overflow:hidden; border:1px solid var(--story-border); }
  .recap-story-label { font-size:12px; font-weight:700; color:var(--dark); padding:9px 12px; background:rgba(44,24,16,.04); border-bottom:1px solid var(--story-border); }
  .recap-story-content { padding:12px 14px; font-size:13px; color:var(--muted); line-height:1.8; }

  /* KEYWORDS */
  .keywords-row { display:flex; flex-wrap:wrap; gap:7px; margin-top:10px; }
  .kw-chip { padding:5px 13px; border-radius:20px; font-size:12px; font-weight:600; background:rgba(74,95,160,.1); color:var(--story-blue); border:1px solid rgba(74,95,160,.2); }

  /* LOADING DOTS */
  .loading-row { display:flex; align-items:center; gap:10px; color:var(--muted); font-size:12px; }
  .ai-dots { display:flex; gap:4px; }
  .ai-dots span { width:6px; height:6px; border-radius:50%; background:currentColor; animation:dotBounce 1.2s ease-in-out infinite; }
  .ai-dots span:nth-child(2){animation-delay:.2s;} .ai-dots span:nth-child(3){animation-delay:.4s;}
  @keyframes dotBounce{0%,80%,100%{transform:scale(.7);opacity:.5}40%{transform:scale(1);opacity:1}}

  .btn-to-phone { width:100%; padding:16px; border-radius:14px; border:none; background:linear-gradient(135deg,var(--caramel),var(--accent)); color:white; font-size:16px; font-weight:700; cursor:pointer; font-family:'Noto Serif KR',serif; box-shadow:0 6px 20px rgba(184,98,42,.3); transition:all .25s; margin-top:20px; animation:fadeUp .5s .5s ease both; opacity:0; animation-fill-mode:both; }
  .btn-to-phone:hover { transform:translateY(-2px); }

  /* PHONE */
  #page-phone { background:var(--cream); }
  .phone-wrap { max-width:480px; margin:0 auto; padding:60px 20px 80px; text-align:center; }
  .phone-emoji { font-size:56px; margin-bottom:20px; animation:popIn .6s cubic-bezier(.34,1.56,.64,1) both; }
  .phone-title { font-family:'Noto Serif KR',serif; font-size:26px; font-weight:900; color:var(--dark); margin-bottom:12px; }
  .phone-desc { font-size:14px; color:var(--muted); line-height:1.8; margin-bottom:32px; }
  .phone-input { width:100%; padding:16px 20px; border-radius:14px; border:2px solid var(--border); background:white; font-size:16px; color:var(--dark); font-family:'Noto Sans KR',sans-serif; outline:none; transition:border-color .2s; text-align:center; letter-spacing:1px; margin-bottom:12px; }
  .phone-input:focus { border-color:var(--toast); }
  .phone-skip { font-size:12px; color:var(--muted); text-decoration:underline; cursor:pointer; margin-bottom:20px; display:block; }
  .permission-row { display:flex; align-items:flex-start; gap:12px; padding:14px 16px; background:#F8F5F0; border-radius:12px; margin-bottom:24px; text-align:left; }
  .custom-cb { width:20px; height:20px; border:2px solid var(--border); border-radius:5px; flex-shrink:0; cursor:pointer; display:flex; align-items:center; justify-content:center; margin-top:1px; transition:all .2s; }
  .custom-cb.checked { background:var(--green); border-color:var(--green); }
  .custom-cb.checked::after { content:'âœ“'; color:white; font-size:12px; font-weight:700; }
  .permission-text { font-size:12px; color:var(--muted); line-height:1.6; }
  .permission-text strong { color:var(--dark); }
  .btn-finish { width:100%; padding:16px; border-radius:14px; border:none; background:linear-gradient(135deg,var(--caramel),var(--accent)); color:white; font-size:16px; font-weight:700; cursor:pointer; font-family:'Noto Serif KR',serif; box-shadow:0 6px 20px rgba(184,98,42,.3); transition:all .25s; }
  .btn-finish:hover { transform:translateY(-2px); }

  /* DONE */
  #page-done { background:var(--cream); }
  .done-wrap { max-width:480px; margin:0 auto; padding:80px 20px; text-align:center; }
  .done-emoji { font-size:64px; margin-bottom:24px; animation:popIn .6s cubic-bezier(.34,1.56,.64,1) both; }
  .done-title { font-family:'Noto Serif KR',serif; font-size:26px; font-weight:900; color:var(--dark); margin-bottom:12px; animation:fadeUp .6s .1s ease both; opacity:0; animation-fill-mode:both; }
  .done-desc { font-size:14px; color:var(--muted); line-height:1.9; margin-bottom:28px; animation:fadeUp .6s .2s ease both; opacity:0; animation-fill-mode:both; }
  .done-tag { display:inline-block; background:var(--dark); color:white; padding:10px 24px; border-radius:20px; font-size:13px; font-weight:500; animation:fadeUp .6s .3s ease both; opacity:0; animation-fill-mode:both; }

  /* DECO */
  .deco { position:fixed; font-size:28px; opacity:.06; pointer-events:none; z-index:0; animation:floatUp linear infinite; }
  @keyframes floatUp{0%{transform:translateY(100vh) rotate(0)}100%{transform:translateY(-100px) rotate(360deg)}}
  @keyframes fadeUp{from{opacity:0;transform:translateY(16px)}to{opacity:1;transform:translateY(0)}}
  @keyframes popIn{0%{transform:scale(.8);opacity:0}100%{transform:scale(1);opacity:1}}
  .fade-in{animation:fadeUp .35s ease both;}

  /* Audio tag minimal */
  .audio-recap-wrap { margin-bottom:10px; }
  .audio-recap-wrap audio { width:100%; border-radius:8px; }
</style>
</head>
<body>
<div class="deco" style="left:5%;animation-duration:18s;animation-delay:-3s">ğŸœ</div>
<div class="deco" style="left:85%;animation-duration:22s;animation-delay:-8s">ğŸ</div>
<div class="deco" style="left:55%;animation-duration:15s;animation-delay:-12s">ğŸ¥š</div>
<div class="deco" style="left:70%;animation-duration:19s;animation-delay:-15s">ğŸ§…</div>

<!-- â•â•â•â•â•â•â•â•â•â•â•â• SPLASH â•â•â•â•â•â•â•â•â•â•â•â• -->
<div class="page active" id="page-splash">
  <div class="splash-title">ì°í‘¸ë“œ!!<br><em>ë‹¹ì‹ ì˜ ìŒì‹ê³¼ ì°ì€??</em></div>
  <div class="splash-sub">ë‚˜ë¥¼ ë‹®ì€ ìŒì‹ ìºë¦­í„°ì™€ í•¨ê»˜ ì°ì„ í’€ì–´ë´ìš” ğŸ½ï¸</div>
  <div class="splash-chars">
    <div class="splash-char">
      <svg viewBox="0 0 72 80" xmlns="http://www.w3.org/2000/svg">
        <ellipse cx="36" cy="44" rx="26" ry="22" fill="#fff8f0"/>
        <rect x="10" y="38" width="52" height="16" rx="4" fill="#f9d0a0"/>
        <rect x="10" y="28" width="52" height="12" rx="4" fill="#fff"/>
        <rect x="10" y="20" width="52" height="10" rx="4" fill="#f9d0a0"/>
        <path d="M12 20 Q20 12 28 18 Q36 10 44 18 Q52 12 60 20" stroke="#fff" stroke-width="3" fill="none"/>
        <ellipse cx="24" cy="17" rx="5" ry="4" fill="#e8504a"/>
        <ellipse cx="36" cy="13" rx="5" ry="4" fill="#e8504a"/>
        <ellipse cx="48" cy="17" rx="5" ry="4" fill="#e8504a"/>
        <rect x="34" y="5" width="4" height="9" rx="2" fill="#f9c74f"/>
        <circle cx="28" cy="36" r="2" fill="#2c1810"/><circle cx="44" cy="36" r="2" fill="#2c1810"/>
        <path d="M30 41 Q36 46 42 41" stroke="#2c1810" stroke-width="1.5" fill="none" stroke-linecap="round"/>
        <line x1="10" y1="38" x2="2" y2="30" stroke="#2c1810" stroke-width="2" stroke-linecap="round"/>
        <line x1="62" y1="38" x2="70" y2="30" stroke="#2c1810" stroke-width="2" stroke-linecap="round"/>
        <line x1="28" y1="60" x2="24" y2="72" stroke="#2c1810" stroke-width="2" stroke-linecap="round"/>
        <line x1="44" y1="60" x2="48" y2="72" stroke="#2c1810" stroke-width="2" stroke-linecap="round"/>
      </svg>
      <span class="splash-char-name">ì¼€ì´í¬</span>
    </div>
    <div class="splash-char" style="animation-delay:.2s">
      <svg viewBox="0 0 72 80" xmlns="http://www.w3.org/2000/svg">
        <path d="M10 46 Q10 68 36 68 Q62 68 62 46 Z" fill="#2a1408"/>
        <path d="M12 46 Q12 64 36 64 Q60 64 60 46 Z" fill="#8db87a"/>
        <circle cx="36" cy="36" r="26" fill="#5c2e10"/>
        <circle cx="28" cy="34" r="2.5" fill="#1a0a04"/><circle cx="44" cy="34" r="2.5" fill="#1a0a04"/>
        <path d="M30 40 Q36 45 42 40" stroke="#1a0a04" stroke-width="1.8" fill="none" stroke-linecap="round"/>
        <line x1="10" y1="38" x2="2" y2="30" stroke="#2c1810" stroke-width="2" stroke-linecap="round"/>
        <line x1="62" y1="38" x2="70" y2="30" stroke="#2c1810" stroke-width="2" stroke-linecap="round"/>
        <line x1="28" y1="62" x2="24" y2="74" stroke="#2c1810" stroke-width="2" stroke-linecap="round"/>
        <line x1="44" y1="62" x2="48" y2="74" stroke="#2c1810" stroke-width="2" stroke-linecap="round"/>
      </svg>
      <span class="splash-char-name">ë‘ì«€ì¿ </span>
    </div>
    <div class="splash-char" style="animation-delay:.4s;margin-bottom:8px">
      <svg viewBox="0 0 72 80" xmlns="http://www.w3.org/2000/svg">
        <rect x="34" y="58" width="4" height="22" rx="2" fill="#8B6347"/>
        <ellipse cx="36" cy="56" rx="10" ry="10" fill="#e03c31"/>
        <ellipse cx="36" cy="40" rx="9" ry="9" fill="#7b4fa6"/>
        <ellipse cx="36" cy="26" rx="8" ry="8" fill="#f4a261"/>
        <circle cx="30" cy="40" r="2" fill="#2c1810"/><circle cx="42" cy="40" r="2" fill="#2c1810"/>
        <path d="M32 45 Q36 49 40 45" stroke="#2c1810" stroke-width="1.5" fill="none" stroke-linecap="round"/>
      </svg>
      <span class="splash-char-name">íƒ•í›„ë£¨</span>
    </div>
    <div class="splash-char" style="animation-delay:.6s">
      <svg viewBox="0 0 72 80" xmlns="http://www.w3.org/2000/svg">
        <path d="M10 52 Q10 70 36 70 Q62 70 62 52 Z" fill="#d4956a"/>
        <ellipse cx="36" cy="40" rx="26" ry="20" fill="#fdfaf6"/>
        <ellipse cx="36" cy="52" rx="26" ry="6" fill="#b8622a"/>
        <circle cx="28" cy="42" r="2" fill="#2c1810"/><circle cx="44" cy="42" r="2" fill="#2c1810"/>
        <path d="M30 48 Q36 53 42 48" stroke="#2c1810" stroke-width="1.5" fill="none" stroke-linecap="round"/>
        <line x1="10" y1="46" x2="2" y2="38" stroke="#2c1810" stroke-width="2" stroke-linecap="round"/>
        <line x1="62" y1="46" x2="70" y2="38" stroke="#2c1810" stroke-width="2" stroke-linecap="round"/>
        <line x1="28" y1="70" x2="24" y2="80" stroke="#2c1810" stroke-width="2" stroke-linecap="round"/>
        <line x1="44" y1="70" x2="48" y2="80" stroke="#2c1810" stroke-width="2" stroke-linecap="round"/>
      </svg>
      <span class="splash-char-name">ê³µê¹ƒë°¥</span>
    </div>
  </div>
  <button class="splash-btn" onclick="goTo('page-quiz')">ì‹œì‘í•˜ê¸° ğŸ½ï¸</button>
</div>

<!-- â•â•â•â•â•â•â•â•â•â•â•â• QUIZ â•â•â•â•â•â•â•â•â•â•â•â• -->
<div class="page" id="page-quiz">
  <div class="page-wrap">
    <div class="page-header">
      <div class="page-tag">ğŸ² STEP 1 / 2</div>
      <h2>ë‚˜ëŠ” ì–´ë–¤ <em>ìŒì‹</em>ì¼ê¹Œ?</h2>
      <p>7ê°€ì§€ ì§ˆë¬¸ì— ì†”ì§í•˜ê²Œ ë‹µí•´ì£¼ì„¸ìš”!</p>
    </div>
    <div class="quiz-card">
      <div class="quiz-progress" id="quiz-progress"></div>
      <div class="quiz-step-label" id="quiz-step-label"></div>
      <div id="quiz-body"></div>
    </div>
  </div>
</div>

<!-- â•â•â•â•â•â•â•â•â•â•â•â• RECORD (ì° ë…¹ìŒ) â•â•â•â•â•â•â•â•â•â•â•â• -->
<div class="page" id="page-record">
  <div class="record-wrap">
    <div class="page-header">
      <div class="page-tag">ğŸ™ï¸ STEP 2 / 2</div>
      <h2>ì°ì„ <em>ë§ë¡œ</em> í’€ì–´ë´ìš”</h2>
      <p>ìŒì„±ìœ¼ë¡œ ë…¹ìŒí•˜ë©´ AIê°€ ìºë¦­í„°ë¥¼ ê·¸ë ¤ë“œë ¤ìš” ğŸ¨</p>
    </div>

    <!-- Food input -->
    <div class="food-input-card">
      <label>ğŸ½ï¸ ì°ì˜ ì£¼ì¸ê³µ ìŒì‹ì€? <span style="color:var(--accent)">*</span></label>
      <div class="food-input-row">
        <input type="text" id="food-input" class="food-text-input"
          placeholder="ì˜ˆ) ë–¡ë³¶ì´, ì¹˜í‚¨, ë¼ë©´, ì‚¼ê²¹ì‚´..."
          oninput="this.style.borderColor=this.value.trim()?'var(--caramel)':'var(--border)'">
        <span class="food-emoji-btn">ğŸ½ï¸</span>
      </div>
      <p style="font-size:11px;color:var(--muted);margin-top:8px;padding-left:2px">ì´ ìŒì‹ìœ¼ë¡œ ê·€ì—¬ìš´ ìºë¦­í„°ë¥¼ AIê°€ ê·¸ë ¤ë“œë ¤ìš” ğŸ¨</p>
      <div class="theme-row">
        <div class="theme-chips-label">ì°ì˜ ì£¼ì œ</div>
        <div class="theme-chips">
          <button class="theme-chip" onclick="toggleChip(this)">ğŸ’˜ ì—°ì•  ì°</button>
          <button class="theme-chip" onclick="toggleChip(this)">âœ‚ï¸ ì¸ê°„ê´€ê³„ ì°</button>
          <button class="theme-chip" onclick="toggleChip(this)">ğŸ˜µ ì§ì¥/í•™êµ ì°</button>
          <button class="theme-chip" onclick="toggleChip(this)">ğŸ‘¨â€ğŸ‘©â€ğŸ‘§ ê°€ì¡± ì°</button>
          <button class="theme-chip" onclick="toggleChip(this)">ğŸ›ï¸ í‘ì—­ì‚¬ ì°</button>
          <button class="theme-chip" onclick="toggleChip(this)">â˜€ï¸ ì¼ìƒ ì°</button>
        </div>
      </div>
    </div>

    <!-- Recorder -->
    <div class="recorder-zone" id="recorder-zone">
      <div class="waveform-container" id="waveform"></div>
      <div class="rec-timer" id="rec-timer">00:00</div>
      <div class="rec-status-row">
        <div class="rec-live-dot"></div>
        <span class="rec-status-text" id="rec-status-text">ë²„íŠ¼ì„ ëˆŒëŸ¬ ë…¹ìŒ ì‹œì‘</span>
      </div>
      <div class="rec-btn-outer">
        <button class="rec-btn" id="rec-btn" onclick="toggleRecording()">ğŸ™ï¸</button>
        <span class="rec-btn-label" id="rec-btn-label">ë…¹ìŒ ì‹œì‘</span>
      </div>
      <div class="rec-processing" id="rec-processing">
        <div class="proc-spinner"></div>
        <div class="proc-text">AIê°€ ë¶„ì„ ì¤‘ì´ì—ìš”...</div>
      </div>
    </div>

    <p style="text-align:center;font-size:11px;color:var(--muted);margin-top:-8px;margin-bottom:20px;">
      âš ï¸ ë§ˆì´í¬ ì‚¬ìš©ì€ <strong>localhost ë˜ëŠ” https</strong> í™˜ê²½ì—ì„œë§Œ ê°€ëŠ¥í•´ìš”
    </p>

  </div>
</div>

<!-- â•â•â•â•â•â•â•â•â•â•â•â• RESULT â•â•â•â•â•â•â•â•â•â•â•â• -->
<div class="page" id="page-result">
  <div class="result-wrap">
    <div id="result-loading-screen" class="result-loading-screen">
      <div class="big-spinner"></div>
      <p id="loading-msg">ì°ì˜ ë¶„ìœ„ê¸°ë¥¼ ì½ëŠ” ì¤‘...<br><span style="font-size:12px;opacity:.6">ê°ì • ì˜¨ë„ ì¸¡ì • â†’ ìºë¦­í„° í‘œì • ê²°ì • ì¤‘ ğŸ­</span></p>
      <div class="loading-steps">
        <div class="loading-step-item" id="lstep-stt"><span class="loading-step-icon">ğŸ“</span>ìŒì„± â†’ í…ìŠ¤íŠ¸ ë³€í™˜ ì¤‘</div>
        <div class="loading-step-item" id="lstep-mood"><span class="loading-step-icon">ğŸ­</span>ë¶„ìœ„ê¸° íŒŒì•… ì¤‘</div>
        <div class="loading-step-item" id="lstep-img"><span class="loading-step-icon">ğŸ¨</span>ìºë¦­í„° ê·¸ë¦¬ëŠ” ì¤‘</div>
        <div class="loading-step-item" id="lstep-analysis"><span class="loading-step-icon">ğŸ§ </span>ì‹¬ì¸µ ë¶„ì„ ì¤‘</div>
      </div>
    </div>

    <div id="result-content" style="display:none">

      <!-- â•â• ìƒë‹¨ BLOCK: ê°ê´€ì‹ ì„±í–¥ ë¶„ì„ â•â• -->
      <div class="result-section-header">
        <div class="result-badge warm">ğŸ² ì„±í–¥ í…ŒìŠ¤íŠ¸ ê²°ê³¼</div>
        <div class="result-section-title">7ê°œ ì§ˆë¬¸ìœ¼ë¡œ ì•Œì•„ë³´ëŠ” ë‚˜ì˜ ìŒì‹ ì„±í–¥</div>
      </div>

      <div class="personality-card">
        <span class="personality-emoji" id="personality-emoji"></span>
        <div class="personality-food-type" id="personality-food-type"></div>
        <div class="personality-type-tag" id="personality-type-tag"></div>
        <div class="personality-desc" id="personality-desc"></div>
      </div>

      <div class="quiz-ai-box">
        <div class="quiz-ai-box-title">ğŸ” ì„±í–¥ ì‹¬ì¸µ ë¶„ì„</div>
        <div class="loading-row" id="quiz-ai-loading">
          <div class="ai-dots"><span></span><span></span><span></span></div>
          <span>ì„±í–¥ íŒ¨í„´ ë¶„ì„ ì¤‘...</span>
        </div>
        <div class="quiz-ai-content" id="quiz-ai-content" style="display:none"></div>
      </div>

      <div class="quiz-recap-card">
        <div class="recap-title">ğŸ“‹ ë‚´ê°€ ê³ ë¥¸ 7ê°€ì§€ ë‹µë³€</div>
        <div id="quiz-recap-body"></div>
      </div>

      <!-- êµ¬ë¶„ì„  -->
      <div class="section-divider">
        <div class="section-divider-line"></div>
        <div class="section-divider-label">âœ¦ ë‚˜ì˜ ìŒì‹ ìºë¦­í„° âœ¦</div>
        <div class="section-divider-line"></div>
      </div>

      <!-- â•â• í•˜ë‹¨ BLOCK: ì° ê¸°ë°˜ ìºë¦­í„° â•â• -->
      <div class="result-section-header">
        <div class="result-badge cool">ğŸ½ï¸ ì° ì† ìŒì‹ ìºë¦­í„°</div>
        <div class="result-section-title">ì°ì˜ ê°ì •ì„ ë‹´ì€ ë‚˜ë§Œì˜ ìºë¦­í„°</div>
      </div>

      <!-- ìºë¦­í„° ì´ë¯¸ì§€ + ê¸°ë³¸ ì •ë³´ -->
      <div class="character-card">
        <div class="character-card-inner">
          <div class="char-img-wrap" id="char-img-wrap">
            <div class="char-loading-inner" id="char-loading-inner">
              <div class="small-spinner"></div>
              <p>í‘œì •<br>ê·¸ë¦¬ëŠ” ì¤‘...</p>
            </div>
            <img class="char-img" id="char-img" src="" alt="" style="display:none">
          </div>
          <div class="character-info">
            <div class="character-food-name" id="char-food-name"></div>
            <div id="mood-badge-wrap"></div>
            <div class="character-sub-tag" id="char-sub-tag"></div>
            <div class="character-base-desc" id="char-base-desc"></div>
          </div>
        </div>
      </div>

      <!-- ìºë¦­í„° íŠ¹ì§• ì¹´ë“œ -->
      <div class="character-traits-card">
        <div class="character-traits-title">âœ¨ ì´ ìºë¦­í„°ëŠ” ì´ëŸ° íŠ¹ì§•ì„ ê°€ì§€ê³  ìˆì–´ìš”!</div>
        <div class="loading-row" id="char-traits-loading">
          <div class="ai-dots"><span></span><span></span><span></span></div>
          <span>ìºë¦­í„° íŠ¹ì§• ë¶„ì„ ì¤‘...</span>
        </div>
        <div id="char-traits-content" style="display:none"></div>
      </div>

      <!-- ì° ì‹¬ì¸µ ë¶„ì„ -->
      <div class="story-ai-box">
        <div class="story-ai-box-title">ğŸ¤– ì° ì‹¬ì¸µ ë¶„ì„</div>
        <div class="loading-row" id="story-ai-loading">
          <div class="ai-dots"><span></span><span></span><span></span></div>
          <span>ì°ì„ ë¶„ì„í•˜ëŠ” ì¤‘...</span>
        </div>
        <div class="story-ai-content" id="story-ai-content" style="display:none"></div>
      </div>

      <!-- ë…¹ìŒëœ ì° ë‚´ìš© -->
      <div class="story-recap-card" id="story-recap-card" style="display:none">
        <div class="recap-title">ğŸ™ï¸ AIê°€ ë°›ì•„ì“´ ë‚´ ì°</div>
        <!-- ì˜¤ë””ì˜¤ ì¬ìƒ -->
        <div class="audio-recap-wrap" id="audio-recap-wrap" style="display:none">
          <audio id="audio-playback" controls></audio>
        </div>
        <div class="recap-story">
          <div class="recap-story-label">ğŸ“ ë…¹ìŒëœ ë‚´ìš©</div>
          <div class="recap-story-content" id="story-recap-content"></div>
        </div>
        <!-- keywords -->
        <div id="keywords-wrap" style="display:none;margin-top:12px">
          <div style="font-size:11px;font-weight:700;color:var(--muted);letter-spacing:.5px;margin-bottom:7px;">í•µì‹¬ í‚¤ì›Œë“œ</div>
          <div class="keywords-row" id="keywords-row"></div>
        </div>
      </div>

      <button class="btn-to-phone" onclick="goTo('page-phone')">ë§ˆì§€ë§‰ì´ì—ìš”!!</button>
      <div style="text-align:center;margin-top:14px">
        <button onclick="restartAll()" style="padding:9px 22px;border-radius:20px;border:1.5px solid var(--toast);background:transparent;color:var(--toast);font-size:13px;cursor:pointer;font-family:'Noto Sans KR',sans-serif;">â†© ì²˜ìŒë¶€í„° ë‹¤ì‹œ</button>
      </div>
    </div>
  </div>
</div>

<!-- â•â•â•â•â•â•â•â•â•â•â•â• PHONE â•â•â•â•â•â•â•â•â•â•â•â• -->
<div class="page" id="page-phone">
  <div class="phone-wrap">
    <div class="phone-emoji">ğŸ“±</div>
    <div class="phone-title">ë§ˆì§€ë§‰ìœ¼ë¡œ<br>ì—°ë½ì²˜ë¥¼ ë‚¨ê²¨ì£¼ì„¸ìš”!</div>
    <div class="phone-desc">ë‹¹ì‹ ì˜ ì°ì´ ì›¹íˆ°ìœ¼ë¡œ ì œì‘ë  ê²½ìš°<br>ê°€ì¥ ë¨¼ì € ì—°ë½ë“œë¦´ê²Œìš” ğŸ¨<br><span style="font-size:12px;opacity:.7">(ì„ íƒ ì‚¬í•­ì´ì—ìš”)</span></div>
    <input type="tel" class="phone-input" id="phone-input" placeholder="010-0000-0000" inputmode="numeric" oninput="formatPhone(this)">
    <span class="phone-skip" onclick="goTo('page-done')">ê±´ë„ˆë›°ê¸°</span>
    <div class="permission-row">
      <div class="custom-cb" id="consent-cb" onclick="toggleConsent()"></div>
      <div class="permission-text"><strong>ì‚¬ì—° ë° ì—°ë½ì²˜ í™œìš©ì— ë™ì˜í•©ë‹ˆë‹¤.</strong><br>ì œì¶œëœ ë‚´ìš©ì€ ì›¹íˆ° ìŠ¤í† ë¦¬ ì œì‘ì— ì°¸ê³ ë  ìˆ˜ ìˆìœ¼ë©°, ì‹¤ëª…/ê°œì¸ì •ë³´ëŠ” ê³µê°œë˜ì§€ ì•ŠìŠµë‹ˆë‹¤.</div>
    </div>
    <button class="btn-finish" onclick="submitPhone()">ğŸ½ï¸ ì™„ë£Œí•˜ê¸°</button>
  </div>
</div>

<!-- â•â•â•â•â•â•â•â•â•â•â•â• DONE â•â•â•â•â•â•â•â•â•â•â•â• -->
<div class="page" id="page-done">
  <div class="done-wrap">
    <div class="done-emoji">ğŸ«¶</div>
    <div class="done-title">ê³ ë§ˆì›Œìš”, ì†Œì¤‘í•œ ì°!</div>
    <div class="done-desc">ë‹¹ì‹ ì˜ ì´ì•¼ê¸°ê°€ ë”°ëœ»í•œ ìŒì‹ ìºë¦­í„°ë¡œ<br>ë‹¤ì‹œ ì„¸ìƒì— ë‚˜ì˜¬ ë‚ ì„ ê¸°ë‹¤ë ¤ì£¼ì„¸ìš”.<br><br>ì°í‘¸ë“œê°€ ì‘ì›í• ê²Œìš” ğŸ½ï¸</div>
    <div class="done-tag">#ì°í‘¸ë“œ #ë‹¹ì‹ ì˜ìŒì‹ê³¼ì°ì€</div>
  </div>
</div>

<script>
// â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
//  NAV
// â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
function goTo(id){document.querySelectorAll('.page').forEach(p=>p.classList.remove('active'));document.getElementById(id).classList.add('active');window.scrollTo(0,0);}
function restartAll(){
  answers=[];answerLabels=[];currentQ=0;selectedIdx=null;
  initQuiz();
  document.getElementById('food-input').value='';
  document.getElementById('gemini-api-key').value='';
  // reset recorder
  isRecording=false; recordingSeconds=0;
  clearInterval(recordingInterval);
  if(mediaRecorder&&mediaRecorder.state!=='inactive'){try{mediaRecorder.stop();}catch(e){}}
  document.getElementById('rec-timer').textContent='00:00';
  document.getElementById('rec-status-text').textContent='ë²„íŠ¼ì„ ëˆŒëŸ¬ ë…¹ìŒ ì‹œì‘';
  document.getElementById('rec-btn').classList.remove('recording-active');
  document.getElementById('rec-btn').textContent='ğŸ™ï¸';
  document.getElementById('rec-btn-label').textContent='ë…¹ìŒ ì‹œì‘';
  document.getElementById('recorder-zone').classList.remove('recording');
  document.getElementById('rec-processing').classList.remove('show');
  buildWaveform();
  goTo('page-quiz');
}

// â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
//  QUIZ DATA
// â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
const questions=[
  {q:"ì§€ê¸ˆ ë‹¹ì¥ ë¨¹ê³  ì‹¶ì€ ê±´?",opts:[{e:"ğŸŒ¶ï¸",t:"ë§¤ì½¤í•œ ê±°",score:{A:2}},{e:"ğŸ°",t:"ë‹¬ë‹¬í•œ ê±°",score:{B:2}},{e:"ğŸ§‚",t:"ì§­ì§¤í•œ ê±°",score:{C:2}},{e:"ğŸ²",t:"ëœ¨ëˆí•œ êµ­ë¬¼",score:{D:2}}]},
  {q:"ë„ˆëŠ” ì–´ë–¤ \"ë¼\"ì•¼?",opts:[{e:"ğŸ•",t:"ì„¸ë¼ â€” ê·œì¹™ì ì´ê³  ë£¨í‹´ ìˆëŠ” ìƒí™œ",score:{C:2}},{e:"ğŸ•‘",t:"ë‘ë¼ â€” ë°”ì˜ì§€ë§Œ ì±™ê¸¸ ê±´ ì±™ê¹€",score:{B:2}},{e:"ğŸ•’",t:"í•œë¼ â€” ì •ì‹ ì—†ì´ í•˜ë£¨ ë³´ëƒ„",score:{A:2}},{e:"ğŸ’¨",t:"ë–¼ë¼ â€” ëŒ€ì¶© ë•Œìš°ëŠ” ìš”ì¦˜",score:{D:2}}]},
  {q:"ë°°ê³ í”„ë©´ ë‚˜ëŠ”?",opts:[{e:"ğŸ˜¤",t:"ì˜ˆë¯¼í•´ì§",score:{A:2}},{e:"ğŸ¤",t:"ì¡°ìš©í•´ì§",score:{B:2}},{e:"ğŸ—£ï¸",t:"ì•„ë¬´ ë§ì´ë‚˜ í•¨",score:{C:2}},{e:"ğŸ´",t:"ê·¸ëƒ¥ ì•„ë¬´ê±°ë‚˜ ë¨¹ìŒ",score:{D:2}}]},
  {q:"ì¹œêµ¬ë‘ ë©”ë‰´ ê³ ë¥¼ ë•Œ ë‚˜ëŠ”?",opts:[{e:"ğŸ‘†",t:"ë‚´ê°€ ì •í•¨",score:{A:2}},{e:"ğŸ™ƒ",t:"\"ì•„ë¬´ê±°ë‚˜\" í•´ë†“ê³  ê²°êµ­ ì˜ê²¬ ëƒ„",score:{B:2}},{e:"ğŸ«¶",t:"ìƒëŒ€ ì˜ê²¬ ì¡´ì¤‘",score:{C:2}},{e:"ğŸ’­",t:"ì†ìœ¼ë¡œ ë”´ ë©”ë‰´ ìƒê°í•¨",score:{D:2}}]},
  {q:"ì—°ì• ë¥¼ ìŒì‹ì— ë¹„ìœ í•˜ë©´?",opts:[{e:"ğŸ«•",t:"ë§ˆë¼íƒ• (ì¤‘ë…ì ì´ê³  ìê·¹ì )",score:{A:3}},{e:"ğŸ‚",t:"ì¼€ì´í¬ (ê¸°ë…ì¼ ë§ê³  ë‹¬ë‹¬)",score:{B:3}},{e:"ğŸ·",t:"ì™€ì¸ (ì‹œê°„ ì§€ë‚˜ì•¼ ê¹Šì–´ì§)",score:{C:3}},{e:"ğŸ”º",t:"ì‚¼ê°ê¹€ë°¥ (ê°‘ìê¸° ì‹œì‘, ê°‘ìê¸° ë)",score:{D:3}}]},
  {q:"ìŠ¤íŠ¸ë ˆìŠ¤ ë°›ì„ ë•Œ ë‹¹ì‹ ì€?",opts:[{e:"ğŸ”¥",t:"ë§¤ìš´ ê±°ë¡œ í’€ì–´ë²„ë¦°ë‹¤",score:{A:2}},{e:"ğŸ«",t:"ë‹¬ë‹¬í•œ ë””ì €íŠ¸ ì°¾ëŠ”ë‹¤",score:{B:2}},{e:"âš¡",t:"ê·¸ëƒ¥ ì•„ë¬´ê±°ë‚˜ ë¹¨ë¦¬ ë¨¹ëŠ”ë‹¤",score:{C:2}},{e:"ğŸš«",t:"ì•„ì˜ˆ ì•ˆ ë¨¹ëŠ”ë‹¤",score:{D:2}}]},
  {q:"ìš”ì¦˜ ë‚´ê°€ ë§ì´ í‘¸ëŠ” ì°ì€?",opts:[{e:"ğŸ’˜",t:"ë§¤ìš´ ì—°ì•  ì°",score:{A:3}},{e:"âœ‚ï¸",t:"ì¹œêµ¬ ì†ì ˆ ì°",score:{D:3}},{e:"ğŸ˜µ",t:"ìŠ¤íŠ¸ë ˆìŠ¤ì¸ íšŒì‚¬/í•™êµ ì°",score:{C:3}},{e:"ğŸ›ï¸",t:"ì´ë¶ˆí‚¥ í‘ì—­ì‚¬ ì°",score:{B:3}}]},
];
const scoreResults=[
  {type:"A",e:"ğŸŒ¶ï¸",food:"ë§ˆë¼íƒ•",desc:"ìê·¹ì ì´ê³  ê°•ë ¬í•œ ë§¤ë ¥ì˜ ì†Œìœ ì! í•œ ë²ˆ ë¹ ì§€ë©´ ëª» í—¤ì–´ë‚˜ì˜¤ëŠ” ì¤‘ë…ì ì¸ ì¡´ì¬ì˜ˆìš”. ë‹¤ìŒì— ë˜ ì°¾ê²Œ ë˜ëŠ” ì‚¬ëŒ.",tag:"#ì¤‘ë…ì£¼ì˜ #ìê·¹ë‚¨ì_ìê·¹ì—¬ì"},
  {type:"B",e:"ğŸ‚",food:"ë”¸ê¸° ì¼€ì´í¬",desc:"ë‹¬ë‹¬í•˜ê³  ì‚¬ë‘ìŠ¤ëŸ¬ìš´ ì—ë„ˆì§€ë¥¼ ê°€ì§„ ì‚¬ëŒ. íŠ¹ë³„í•œ ìˆœê°„ë§ˆë‹¤ ìƒê°ë‚˜ëŠ”, ì†Œì¤‘í•œ ë‚ ì˜ ì£¼ì¸ê³µ ê°™ì€ ì¡´ì¬ì˜ˆìš”.",tag:"#ë‹¬ë‹¬í•¨ì£¼ì˜ #ê¸°ë…ì¼ì¥ì¸"},
  {type:"C",e:"ğŸ·",food:"ì™€ì¸",desc:"ì²˜ìŒì—” ë‚¯ì„¤ì§€ë§Œ ì•Œì•„ê°ˆìˆ˜ë¡ ê¹Šì–´ì§€ëŠ” ì‚¬ëŒ. ì„£ë¶ˆë¦¬ íŒë‹¨í•˜ë©´ ì†í•´ì˜ˆìš”. ì‹œê°„ì´ ì§€ë‚ ìˆ˜ë¡ ì§„ê°€ê°€ ë“œëŸ¬ë‚©ë‹ˆë‹¤.",tag:"#ìˆ™ì„±í˜•ì¸ê°„ #ì²œì²œíˆì•Œì•„ê°€ì"},
  {type:"D",e:"ğŸ²",food:"í•´ì¥êµ­",desc:"í˜ë“  ë‚  ê°€ì¥ ë¨¼ì € ìƒê°ë‚˜ëŠ” ì‚¬ëŒ. ë§ ì—†ì–´ë„ ê³ì— ìˆìœ¼ë©´ ë“ ë“ í•˜ê³ , ê±°ì°½í•˜ì§€ ì•Šì•„ë„ ì§„ì‹¬ì´ ëŠê»´ì§€ëŠ” ì¡´ì¬ì˜ˆìš”.",tag:"#ì§„êµ­ì¸ìƒ #ìˆì–´ì•¼ì™„ì„±"},
];
let answers=[],answerLabels=[],currentQ=0,selectedIdx=null;

function initQuiz(){answers=[];answerLabels=[];currentQ=0;selectedIdx=null;renderProgress();renderQuestion();}
function renderProgress(){const p=document.getElementById('quiz-progress');p.innerHTML='';questions.forEach((_,i)=>{const d=document.createElement('div');d.className='quiz-dot'+(i===currentQ?' active':i<currentQ?' done':'');p.appendChild(d);});document.getElementById('quiz-step-label').textContent=`${currentQ+1} / ${questions.length}`;}
function renderQuestion(){const q=questions[currentQ];const isLast=currentQ===questions.length-1;document.getElementById('quiz-body').innerHTML=`<div class="quiz-question fade-in">${q.q}</div><div class="quiz-options fade-in">${q.opts.map((o,i)=>`<button class="quiz-option" onclick="selectOption(${i},this)"><span class="opt-emoji">${o.e}</span>${o.t}</button>`).join('')}</div><div id="next-wrap" style="display:none"><button class="btn-next" onclick="goNext()">${isLast?'ì° ë…¹ìŒí•˜ê¸° ğŸ™ï¸':'ë‹¤ìŒ ì§ˆë¬¸ â†’'}</button></div>`;}
function selectOption(idx,btn){document.querySelectorAll('.quiz-option').forEach(b=>b.classList.remove('selected'));btn.classList.add('selected');selectedIdx=idx;document.getElementById('next-wrap').style.display='block';}
function goNext(){if(selectedIdx===null)return;const q=questions[currentQ];answers.push(q.opts[selectedIdx].score);answerLabels.push({q:q.q,opts:q.opts,chosen:selectedIdx});selectedIdx=null;currentQ++;if(currentQ>=questions.length)goTo('page-record');else{renderProgress();renderQuestion();}}

// â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
//  STORY UTILS
// â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
function toggleChip(btn){btn.classList.toggle('active');}

// â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
//  WAVEFORM
// â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
function buildWaveform(){
  const c=document.getElementById('waveform');
  c.innerHTML='';
  for(let i=0;i<28;i++){
    const b=document.createElement('div');
    b.className='wave-bar';
    const h=6+Math.random()*30;
    b.style.setProperty('--max-h',h+'px');
    b.style.setProperty('--dur',(0.4+Math.random()*0.5).toFixed(2)+'s');
    b.style.setProperty('--delay',(i*0.035).toFixed(2)+'s');
    b.style.height='4px';
    c.appendChild(b);
  }
}
buildWaveform();

// â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
//  AUDIO RECORDER
// â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
let mediaRecorder=null, audioChunks=[], recordingInterval=null, recordingSeconds=0, isRecording=false;
let currentBlob=null, currentAudioUrl=null;

function getSupportedMimeType(){
  const types=['audio/webm;codecs=opus','audio/webm','audio/ogg;codecs=opus','audio/mp4'];
  return types.find(t=>MediaRecorder.isTypeSupported(t))||'';
}

async function toggleRecording(){
  if(!isRecording) await startRecording();
  else stopRecording();
}

async function startRecording(){
  try{
    const stream=await navigator.mediaDevices.getUserMedia({audio:true,video:false});
    audioChunks=[];
    const mime=getSupportedMimeType();
    mediaRecorder=new MediaRecorder(stream,mime?{mimeType:mime}:{});
    mediaRecorder.ondataavailable=e=>{if(e.data.size>0)audioChunks.push(e.data);};
    mediaRecorder.onstop=handleRecordingStop;
    mediaRecorder.start(100);
    isRecording=true; recordingSeconds=0;

    const zone=document.getElementById('recorder-zone');
    const btn=document.getElementById('rec-btn');
    zone.classList.add('recording');
    btn.classList.add('recording-active');
    btn.textContent='â¹ï¸';
    document.getElementById('rec-btn-label').textContent='íƒ­í•˜ë©´ ë…¹ìŒ ì¢…ë£Œ';
    document.getElementById('rec-status-text').textContent='ë…¹ìŒ ì¤‘...';

    recordingInterval=setInterval(()=>{
      recordingSeconds++;
      const m=String(Math.floor(recordingSeconds/60)).padStart(2,'0');
      const s=String(recordingSeconds%60).padStart(2,'0');
      document.getElementById('rec-timer').textContent=`${m}:${s}`;
    },1000);
  }catch(err){
    alert('ë§ˆì´í¬ ê¶Œí•œì´ í•„ìš”í•´ìš”!\në¸Œë¼ìš°ì € ì„¤ì •ì—ì„œ ë§ˆì´í¬ë¥¼ í—ˆìš©í•˜ê±°ë‚˜,\nlocalhost ë˜ëŠ” HTTPS í™˜ê²½ì—ì„œ ì ‘ì†í•´ì£¼ì„¸ìš”.');
    console.error(err);
  }
}

function stopRecording(){
  if(!mediaRecorder||!isRecording)return;
  isRecording=false;
  clearInterval(recordingInterval);
  mediaRecorder.stop();
  mediaRecorder.stream.getTracks().forEach(t=>t.stop());

  const zone=document.getElementById('recorder-zone');
  const btn=document.getElementById('rec-btn');
  zone.classList.remove('recording');
  btn.classList.remove('recording-active');
  btn.textContent='â³';
  btn.disabled=true;
  document.getElementById('rec-btn-label').textContent='ë¶„ì„ ì¤‘...';
  document.getElementById('rec-status-text').textContent='AIê°€ ì°ì„ ë¶„ì„í•˜ê³  ìˆì–´ìš”';
  document.getElementById('rec-processing').classList.add('show');
}

async function handleRecordingStop(){
  const foodName=document.getElementById('food-input').value.trim();
  if(!foodName){
    alert('ì°ì˜ ì£¼ì¸ê³µ ìŒì‹ì„ ì…ë ¥í•´ì£¼ì„¸ìš”! ğŸ½ï¸');
    resetRecorder(); return;
  }

  const mime=getSupportedMimeType()||'audio/webm';
  currentBlob=new Blob(audioChunks,{type:mime});
  currentAudioUrl=URL.createObjectURL(currentBlob);

  // ê²°ê³¼ í™”ë©´ìœ¼ë¡œ ì´ë™ í›„ ë¶„ì„ ì‹œì‘
  goTo('page-result');
  await buildResult(foodName);
}

function resetRecorder(){
  const btn=document.getElementById('rec-btn');
  btn.textContent='ğŸ™ï¸'; btn.disabled=false;
  document.getElementById('rec-btn-label').textContent='ë…¹ìŒ ì‹œì‘';
  document.getElementById('rec-status-text').textContent='ë²„íŠ¼ì„ ëˆŒëŸ¬ ë…¹ìŒ ì‹œì‘';
  document.getElementById('rec-timer').textContent='00:00';
  document.getElementById('rec-processing').classList.remove('show');
  buildWaveform();
}

// â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
//  API_BASE & Gemini helpers
// â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
const API_BASE='/api';

const FOOD_HINTS={
  'ë–¡ë³¶ì´':'glossy red gochujang-coated cylindrical rice cakes, bright red sauce',
  'ë¼ë©´':'wavy yellow instant noodles, red soup base, floating green onion',
  'ì¹˜í‚¨':'golden-brown crispy fried chicken, crunchy breading',
  'ì‚¼ê²¹ì‚´':'thick grilled pork belly slices with fat layers, charred grill marks',
  'í”¼ì':'round pizza with thick melted cheese, red tomato sauce',
  'í–„ë²„ê±°':'tall stacked burger with sesame bun, lettuce, tomato, beef patty',
  'ì´ˆë°¥':'nigiri sushi with salmon or tuna on white rice',
  'ë§ˆë¼íƒ•':'deep red spicy broth with chili peppers, heavy red oil sheen',
  'ì¼€ì´í¬':'layered cake with pink strawberry cream frosting, whole strawberries',
  'ì•„ì´ìŠ¤í¬ë¦¼':'soft-serve ice cream swirl in a cone, pastel colors',
  'ë„ë„›':'ring-shaped donut with pink glaze and rainbow sprinkles',
  'ê¹€ë°¥':'cylindrical gimbap sliced showing colorful cross-section',
  'ë§Œë‘':'plump pleated dumpling with pinched folds',
  'ì§œì¥ë©´':'black bean paste noodles with dark brown glossy sauce, julienned cucumber',
};
function getFoodHint(n){if(FOOD_HINTS[n])return FOOD_HINTS[n];for(const[k,v]of Object.entries(FOOD_HINTS)){if(n.includes(k)||k.includes(n))return v;}return`recognizable Korean dish called "${n}" with its most distinctive colors and textures`;}

const MOOD_MAP={
  happy:   {label:'í–‰ë³µí•´ìš”',emoji:'ğŸ˜Š',bg:'linear-gradient(135deg,#fffbe0,#fff8cc)',border:'rgba(255,200,50,.35)',badgeColor:'#e6a800',badgeBg:'rgba(255,220,50,.15)'},
  excited: {label:'ì„¤ë ˆìš”',emoji:'ğŸ¥°',bg:'linear-gradient(135deg,#fff0f8,#ffe8f4)',border:'rgba(220,100,180,.3)',badgeColor:'#c0508a',badgeBg:'rgba(220,100,180,.1)'},
  sad:     {label:'ìŠ¬í¼ìš”',emoji:'ğŸ˜¢',bg:'linear-gradient(135deg,#e8f0ff,#dce8ff)',border:'rgba(80,120,220,.25)',badgeColor:'#3a5cc0',badgeBg:'rgba(80,120,220,.1)'},
  angry:   {label:'ì–µìš¸í•´ìš”',emoji:'ğŸ˜¤',bg:'linear-gradient(135deg,#fff0f0,#ffe8e8)',border:'rgba(220,80,80,.25)',badgeColor:'#c04040',badgeBg:'rgba(220,80,80,.1)'},
  lonely:  {label:'ê·¸ë¦¬ì›Œìš”',emoji:'ğŸ¥º',bg:'linear-gradient(135deg,#f4f0ff,#ece4ff)',border:'rgba(130,90,220,.25)',badgeColor:'#7040c0',badgeBg:'rgba(130,90,220,.1)'},
  nostalgic:{label:'ì¶”ì–µì´ì—ìš”',emoji:'ğŸŒ™',bg:'linear-gradient(135deg,#fdf5e0,#f9edd0)',border:'rgba(180,140,60,.25)',badgeColor:'#906030',badgeBg:'rgba(180,140,60,.1)'},
  nervous: {label:'ê¸´ì¥ë¼ìš”',emoji:'ğŸ˜…',bg:'linear-gradient(135deg,#f0fff4,#e4fce8)',border:'rgba(60,160,90,.25)',badgeColor:'#307040',badgeBg:'rgba(60,160,90,.1)'},
  neutral: {label:'ë‹´ë‹´í•´ìš”',emoji:'ğŸ˜Œ',bg:'linear-gradient(135deg,#f8f8f8,#f2f2f2)',border:'rgba(150,150,150,.2)',badgeColor:'#606060',badgeBg:'rgba(150,150,150,.08)'},
};
const MOOD_FACE={
  happy:'big joyful smile with rosy blush cheeks, sparkle star highlights in eyes (âœ¨), eyebrows raised happily',
  excited:'wide open star-shaped eyes (â˜…â˜…), huge open grin showing tiny teeth, eyebrows raised high, small hearts floating around',
  sad:'teardrop rolling down one cheek, eyes curved downward with droopy pupils, small trembling mouth, eyebrows slanted sad',
  angry:'sharp furrowed brow lines drawn on forehead, angular narrow eyes showing frustration, tight firm mouth, tiny steam puffs from top',
  lonely:'soft half-closed eyes looking slightly down, gentle wistful small smile, single floating heart nearby, eyebrows slightly down',
  nostalgic:'warm closed-eye peaceful smile, tear of joy on one cheek, eyebrows gently curved upward, soft glow expression',
  nervous:'large sweat drop on forehead, wide uncertain wobbly eyes, zigzag nervous mouth, one eyebrow raised',
  neutral:'calm simple dot eyes, small relaxed smile, smooth neutral eyebrows, peaceful gentle face',
};

function detectMoodLocal(story){
  if(!story)return'neutral';
  const s=story;
  if(/ì„¤ë ˆ|ë‘ê·¼|ì¢‹ì•„|í–‰ë³µ|ì›ƒìŒ|ê¸°ë»|ì¦ê±°|ìµœê³ |ëŒ€ë°•|ì‹ ë‚¬|ì™„ë²½/.test(s))return'excited';
  if(/ê·¸ë¦½|ë³´ê³ ì‹¶|ì¶”ì–µ|ê·¸ë•Œ|ì˜›ë‚ |ë‹¤ì‹œ|ëŒì•„ê°€|ìŠí˜€ì§€ì§€|ê¸°ì–µ/.test(s))return'nostalgic';
  if(/ì™¸ë¡œ|í˜¼ì|ì“¸ì“¸|ê³ ë…|ì•„ë¬´ë„|ìš¸ì—ˆ|ëˆˆë¬¼/.test(s))return'lonely';
  if(/í™”ë‚˜|ì–µìš¸|ì§œì¦|ì—´ë°›|ë¶„í•´|ë¶ˆê³µí‰|ì™œë‚˜ë§Œ|ì§„ì§œ/.test(s))return'angry';
  if(/ê¸´ì¥|ë–¨ë ¤|ë¬´ì„œ|ê±±ì •|ë¶ˆì•ˆ|ì–´ë–¡í•´|ë§í–ˆ|ì‹¤ìˆ˜/.test(s))return'nervous';
  if(/ìŠ¬í”„|ìš¸ê³ |í˜ë“¤ì—ˆ|ì§€ì³|í¬ê¸°|ì‹¤íŒ¨|ì•„íŒ |ì•„í”„/.test(s))return'sad';
  if(/ê°ì‚¬|ë”°ëœ»|ë“ ë“ |ê³ ë§ˆì›Œ|ì‚¬ë‘|ì†Œì¤‘|í–‰ìš´|ìœ„ë¡œ/.test(s))return'happy';
  return'neutral';
}

// â”€â”€â”€ ê³µí†µ Gemini í…ìŠ¤íŠ¸ í˜¸ì¶œ (ì„œë²„ or ì§ì ‘) â”€â”€â”€
async function callGemini(prompt,maxTokens=600){
  try{
    const r=await fetch(`${API_BASE}/gemini`,{method:'POST',headers:{'Content-Type':'application/json'},body:JSON.stringify({prompt,maxTokens,temperature:0.92})});
    if(!r.ok)throw new Error(`${r.status}`);
    const d=await r.json();return d.text||null;
  }catch(e){console.warn('[text]',e);return null;}
}

// â”€â”€â”€ ìŒì„± â†’ ì„œë²„ ë¼ìš°íŠ¸(/api/gemini-audio)ë¡œ ì „ë‹¬ â”€â”€â”€
async function transcribeAudio(blob,mimeType){
  try{
    const base64=await blobToBase64(blob);
    const cleanMime=mimeType.split(';')[0]||'audio/webm';
    const r=await fetch(`${API_BASE}/gemini-audio`,{
      method:'POST',
      headers:{'Content-Type':'application/json'},
      body:JSON.stringify({
        audioData:base64,
        mimeType:cleanMime,
        prompt:`ì•„ë˜ ì˜¤ë””ì˜¤ë¥¼ í•œêµ­ì–´ë¡œ ì •í™•íˆ ë°›ì•„ì“°ê¸°í•˜ê³ , ë‹¤ìŒ JSON í˜•ì‹ìœ¼ë¡œë§Œ ì‘ë‹µí•˜ì„¸ìš”:
{"transcript":"ì „ì²´ ë‚´ìš©","keywords":["í‚¤ì›Œë“œ1","í‚¤ì›Œë“œ2","í‚¤ì›Œë“œ3"],"mood":"happy|excited|sad|angry|lonely|nostalgic|nervous|neutral ì¤‘ í•˜ë‚˜"}
JSON ì™¸ ë‹¤ë¥¸ í…ìŠ¤íŠ¸ ì—†ì´.`
      })
    });
    if(!r.ok)throw new Error(`${r.status}`);
    const d=await r.json();
    return d.result||null;
  }catch(e){console.warn('[STT]',e);return null;}
}

function blobToBase64(blob){
  return new Promise((res,rej)=>{
    const reader=new FileReader();
    reader.onload=()=>res(reader.result.split(',')[1]);
    reader.onerror=rej;
    reader.readAsDataURL(blob);
  });
}

// ì´ë¯¸ì§€ ìƒì„±
async function generateCharImage(foodName,mood){
  const face=MOOD_FACE[mood]||MOOD_FACE.neutral;
  const prompt=`Create a cute kawaii chibi food character illustration.
CHARACTER: The entire body IS a "${foodName}". Visual: ${getFoodHint(foodName)}. Make it INSTANTLY RECOGNIZABLE.
FACIAL EXPRESSION (most important part): ${face}. This emotion must be CLEARLY visible and expressive.
BODY: Thin stick arms with tiny round hands extending from sides. Thin stick legs with small round feet below. Small rosy blush circles on cheeks.
STYLE: Clean flat kawaii illustration like LINE Friends / Kakao Friends. Bold outlines. Pure white (#FFFFFF) background. No text, no shadows, centered. Character feels ALIVE with clear personality.`;
  try{
    const r=await fetch(`${API_BASE}/gemini-image`,{method:'POST',headers:{'Content-Type':'application/json'},body:JSON.stringify({prompt})});
    if(!r.ok)throw new Error(`${r.status}`);
    const d=await r.json();
    if(d.imageData)return`data:${d.mimeType};base64,${d.imageData}`;
  }catch(e){console.warn('[image]',e);}
  throw new Error('ì´ë¯¸ì§€ ìƒì„± ì‹¤íŒ¨');
}

function getField(text,key){const m=text.match(new RegExp(key+':\\s*(.+?)(?=\\n[ê°€-í£A-Za-z0-9]+:|$)','s'));return m?m[1].trim().replace(/\n/g,' '):'';}

// â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
//  LOADING STEPS
// â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
function setLoadingStep(id){
  ['lstep-stt','lstep-mood','lstep-img','lstep-analysis'].forEach(sid=>{
    const el=document.getElementById(sid);
    el.classList.remove('active','done');
    if(sid===id)el.classList.add('active');
    // mark previous as done
  });
  const order=['lstep-stt','lstep-mood','lstep-img','lstep-analysis'];
  const idx=order.indexOf(id);
  order.slice(0,idx).forEach(sid=>document.getElementById(sid).classList.add('done'));
}
function doneLoadingStep(id){document.getElementById(id)?.classList.replace('active','done');}

// â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
//  MAIN BUILD RESULT
// â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
async function buildResult(foodName){
  // Reset result UI
  document.getElementById('result-loading-screen').style.display='flex';
  document.getElementById('result-content').style.display='none';
  ['lstep-stt','lstep-mood','lstep-img','lstep-analysis'].forEach(id=>{
    const el=document.getElementById(id);
    el.classList.remove('active','done');
  });

  const totals={A:0,B:0,C:0,D:0};
  answers.forEach(sc=>Object.entries(sc).forEach(([k,v])=>totals[k]+=v));
  const topType=Object.entries(totals).sort((a,b)=>b[1]-a[1])[0][0];
  const res=scoreResults.find(r=>r.type===topType);

  // 1) STT â€” ìŒì„± â†’ í…ìŠ¤íŠ¸
  setLoadingStep('lstep-stt');
  const loadingMsg=document.getElementById('loading-msg');
  loadingMsg.innerHTML='ìŒì„±ì„ í…ìŠ¤íŠ¸ë¡œ ë³€í™˜ ì¤‘...<br><span style="font-size:12px;opacity:.6">Geminiê°€ ë°›ì•„ì“°ê³  ìˆì–´ìš” ğŸ“</span>';

  const mime=getSupportedMimeType()||'audio/webm';
  const sttResult=currentBlob?await transcribeAudio(currentBlob,mime):null;

  const story=sttResult?.transcript||'';
  const keywords=sttResult?.keywords||[];
  const sttMood=sttResult?.mood;

  doneLoadingStep('lstep-stt');

  // 2) ë¶„ìœ„ê¸° ë¶„ì„
  setLoadingStep('lstep-mood');
  loadingMsg.innerHTML='ì°ì˜ ê°ì •ì„ ì½ëŠ” ì¤‘...<br><span style="font-size:12px;opacity:.6">ë¶„ìœ„ê¸° íŒŒì•… â†’ ìºë¦­í„° í‘œì • ê²°ì • ì¤‘ ğŸ­</span>';

  let mood;
  if(sttMood&&MOOD_MAP[sttMood])mood=sttMood;
  else{
    const moodFromApi=await callGemini(`ì•„ë˜ ì°ì˜ í•µì‹¬ ê°ì •ì„ ë”± í•˜ë‚˜ë§Œ ê³¨ë¼ì£¼ì„¸ìš”.\nì„ íƒì§€: happy / excited / sad / angry / lonely / nostalgic / nervous / neutral\n[ì°] "${story.slice(0,200)}"\në°˜ë“œì‹œ ìœ„ ì„ íƒì§€ ì¤‘ ì˜ì–´ í•˜ë‚˜ë§Œ ë‹µí•˜ì„¸ìš”. ì„¤ëª… ì—†ì´.`,10);
    const parsedMood=moodFromApi?.trim().toLowerCase().split(/\W/)[0];
    mood=MOOD_MAP[parsedMood]?parsedMood:detectMoodLocal(story);
  }
  const moodData=MOOD_MAP[mood];
  doneLoadingStep('lstep-mood');

  // 3) ê²°ê³¼ í™”ë©´ í‘œì‹œ
  document.getElementById('result-loading-screen').style.display='none';
  document.getElementById('result-content').style.display='block';

  // ì„±í–¥ ì¹´ë“œ
  document.getElementById('personality-emoji').textContent=res.e;
  document.getElementById('personality-food-type').textContent=`${res.food} íƒ€ì…`;
  document.getElementById('personality-type-tag').textContent=res.tag;
  document.getElementById('personality-desc').textContent=res.desc;

  // ë‹µë³€ ë¦¬ìº¡
  let recapHtml='';
  answerLabels.forEach((item,qi)=>{const c=item.opts[item.chosen];recapHtml+=`<div class="recap-q"><div class="recap-q-text">Q${qi+1}. ${item.q}</div><div class="recap-opt-chosen"><span class="recap-check">âœ“</span><span style="font-size:16px">${c.e}</span><span>${c.t}</span></div></div>`;});
  document.getElementById('quiz-recap-body').innerHTML=recapHtml;

  // ìºë¦­í„° ê¸°ë³¸ ì •ë³´
  document.getElementById('char-food-name').textContent=`${foodName} ìºë¦­í„°`;
  document.getElementById('mood-badge-wrap').innerHTML=`<div class="mood-badge" style="background:${moodData.badgeBg};border-color:${moodData.border};color:${moodData.badgeColor}">${moodData.emoji} ${moodData.label}</div>`;
  document.getElementById('char-sub-tag').textContent=`#${foodName}ìºë¦­í„° #ì°í‘¸ë“œ`;
  document.getElementById('char-base-desc').textContent=`ì°ì˜ ë¶„ìœ„ê¸°(${moodData.label})ë¥¼ ë‹´ì•„ AIê°€ ê·¸ë¦° ë‚˜ë§Œì˜ ${foodName} ìºë¦­í„°ì˜ˆìš”.`;
  document.getElementById('char-img-wrap').style.background=moodData.bg;

  // ì° í…ìŠ¤íŠ¸ / í‚¤ì›Œë“œ í‘œì‹œ
  if(story){
    document.getElementById('story-recap-content').textContent=story;
    document.getElementById('story-recap-card').style.display='block';
    // ì˜¤ë””ì˜¤ ì¬ìƒ
    if(currentAudioUrl){
      const ap=document.getElementById('audio-playback');
      ap.src=currentAudioUrl;
      document.getElementById('audio-recap-wrap').style.display='block';
    }
    // í‚¤ì›Œë“œ
    if(keywords.length){
      document.getElementById('keywords-row').innerHTML=keywords.map(k=>`<span class="kw-chip"># ${k}</span>`).join('');
      document.getElementById('keywords-wrap').style.display='block';
    }
  }

  // 4) ì´ë¯¸ì§€ ìƒì„±
  setLoadingStep('lstep-img');
  generateCharImage(foodName,mood).then(url=>{
    doneLoadingStep('lstep-img');
    document.getElementById('char-img').src=url;
    document.getElementById('char-img').style.display='block';
    document.getElementById('char-loading-inner').style.display='none';
  }).catch(()=>{
    doneLoadingStep('lstep-img');
    document.getElementById('char-loading-inner').innerHTML=`<span style="font-size:40px">${moodData.emoji}</span><p style="font-size:12px;margin-top:6px;color:var(--muted)">${foodName}<br>${moodData.label}</p>`;
  });

  // 5) ì„±í–¥ AI ë¶„ì„
  setLoadingStep('lstep-analysis');
  doQuizAnalysis(answerLabels,res).then(text=>{
    doneLoadingStep('lstep-analysis');
    document.getElementById('quiz-ai-loading').style.display='none';
    const el=document.getElementById('quiz-ai-content');
    el.innerHTML=text?renderQuizAI(text,res):localQuizAI(res);
    el.style.display='block';
  });

  // 6) ìºë¦­í„° íŠ¹ì§•
  doCharTraits(foodName,res,story,mood).then(text=>{
    document.getElementById('char-traits-loading').style.display='none';
    const el=document.getElementById('char-traits-content');
    const fallback=`ìºë¦­í„°ì´ë¦„: ${foodName}ì´\ní•œì¤„ì†Œê°œ: ${foodName}ì˜ ë§¤ë ¥ì„ ê°€ë“ ë‹´ì€ ê·€ì—¬ìš´ ì¡´ì¬ì˜ˆìš” ğŸŒŸ\níŠ¹ì§•1ì œëª©: ì²«ì¸ìƒ\níŠ¹ì§•1ë‚´ìš©: ì²˜ìŒ ë§Œë‚˜ë©´ ë¶„ìœ„ê¸°ë¥¼ ë°”ê¿”ë²„ë¦¬ëŠ” ì¡´ì¬ê°ì´ì—ìš”. ${moodData.emoji} ${moodData.label} ìƒíƒœë¡œ ì˜¤ëŠ˜ë„ ì—´ì‹¬íˆ ì‚´ì•„ê°€ëŠ” ì¤‘ì´ì—ìš” ğŸŒŸ\níŠ¹ì§•2ì œëª©: ì˜¤ëŠ˜ì˜ê¸°ë¶„\níŠ¹ì§•2ë‚´ìš©: ì§€ê¸ˆ ì´ ìºë¦­í„°ëŠ” ${moodData.label} ìƒíƒœì˜ˆìš”. ${foodName}ì²˜ëŸ¼ ì†”ì§í•˜ê²Œ ê°ì •ì„ ë“œëŸ¬ë‚´ëŠ” íƒ€ì…ì´ì—ìš” ğŸ’«\níŠ¹ì§•3ì œëª©: íŠ¹ê¸°\níŠ¹ì§•3ë‚´ìš©: ì–´ë–¤ ìƒí™©ì—ì„œë„ ${foodName}ë§Œì˜ ë§›ì„ ìƒì§€ ì•Šì•„ìš” âœ¨\ní•„ì‚´ê¸°: ìƒëŒ€ë°©ì„ ë¬´ì¥í•´ì œì‹œí‚¤ëŠ” ${foodName} íŠ¹ìœ ì˜ í–¥ê¸° ê³µê²©`;
    el.innerHTML=renderTraits(text||fallback,foodName,mood);
    el.style.display='block';
  });

  // 7) ì° ì‹¬ì¸µ ë¶„ì„ (íŠ¸ëœìŠ¤í¬ë¦½íŠ¸ ê¸°ë°˜)
  doStoryAnalysis(res,story,foodName,mood).then(text=>{
    document.getElementById('story-ai-loading').style.display='none';
    const el=document.getElementById('story-ai-content');
    if(text){
      el.innerHTML=renderStoryAI(text,foodName,mood);
    }else if(story){
      el.innerHTML=renderStoryAI(`ì°í•œì¤„: ${foodName}ê³¼ í•¨ê»˜í•œ ì´ ìˆœê°„, ì˜¤ë˜ ê¸°ì–µë  ê²ƒ ê°™ì•„ìš” ${moodData.emoji}\nìŒì‹ì‹¬ë¦¬: ${foodName}ì´ë¼ëŠ” ì„ íƒ ìì²´ê°€ ì´ë¯¸ ë§ì€ ê±¸ ë§í•´ì£¼ê³  ìˆì–´ìš”. ì§€ê¸ˆ ì´ ê°ì •(${moodData.label})ì„ ë‹´ê¸°ì— ê°€ì¥ ì˜ ì–´ìš¸ë¦¬ëŠ” ìŒì‹ì´ì—ˆì„ ê±°ì˜ˆìš”. ${foodName}ì´ ê°€ì§„ ë§›ê³¼ ì˜¨ë„ê°€ ì´ ì°ì˜ ê°ì •ê³¼ ë‹®ì•„ìˆì–´ìš”. ìŒì‹ í•˜ë‚˜ì—ë„ ì´ë ‡ê²Œ ë§ì€ ê°ì •ì´ ë‹´ê¸¸ ìˆ˜ ìˆë‹¤ëŠ” ê²Œ ë†€ë¼ì›Œìš”.\nì´ì‚¬ëŒì—ê²Œ: ì´ ì°ì„ ì“°ë©´ì„œ ì–´ë–¤ ê¸°ë¶„ì´ì—ˆëŠ”ì§€ ì•Œ ê²ƒ ê°™ì•„ìš”. ê·¸ ê°ì •, ë‹¤ ë§ì•„ìš”.\nì›¹íˆ°ì¥ë©´: ${foodName} ìºë¦­í„°ê°€ ${moodData.emoji} í‘œì •ìœ¼ë¡œ ì¡°ìš©íˆ ì•‰ì•„ìˆëŠ” ì¥ë©´ â€” ë§ ì—†ì´ë„ ëª¨ë“  ê²Œ ì „í•´ì§€ëŠ” ê·¸ í•œ ì»·ì´ì—ìš”.\níƒœê·¸: #${foodName}ì° #ì°í‘¸ë“œ #ë‚˜ì˜ì´ì•¼ê¸° #ìŒì‹ì‹¬ë¦¬`,foodName,mood);
    }else{
      el.innerHTML=`<p style="color:#4a5fa0;line-height:1.8">ë…¹ìŒì´ ì—†ê±°ë‚˜ ì¸ì‹ë˜ì§€ ì•Šì•˜ì–´ìš” ğŸ˜Š<br>ë‹¤ì‹œ í•œ ë²ˆ ì‹œë„í•´ë³´ì‹œê±°ë‚˜, API í‚¤ë¥¼ í™•ì¸í•´ì£¼ì„¸ìš”.</p>`;
    }
    el.style.display='block';
  });

  // ë ˆì½”ë” ë¦¬ì…‹
  resetRecorder();
}

// â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
//  AI FUNCTIONS (ì›ë³¸ ê·¸ëŒ€ë¡œ)
// â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
async function doQuizAnalysis(answerLabels,res){
  const list=answerLabels.map((it,qi)=>{const c=it.opts[it.chosen];return`Q${qi+1}. ${it.q} â†’ ${c.e} ${c.t}`;}).join('\n');
  const prompt=`ë‹¹ì‹ ì€ í•œêµ­ì˜ ì¸ê¸° ì‹¬ë¦¬ ë¶„ì„ê°€ì˜ˆìš”.
ì½ë‹¤ ë³´ë©´ "ì–´, ì´ê±° ë‚˜ ì–˜ê¸°ì–ì•„?" í•˜ê³  ë¬´ë¦ íƒ ì¹˜ê²Œ ë§Œë“œëŠ” ë¶„ì„ì´ì–´ì•¼ í•´ìš”.
ì¹œê·¼í•œ ì¡´ëŒ“ë§, êµ¬ì²´ì  ìƒí™œ ìƒí™© ë¬˜ì‚¬ í•„ìˆ˜.

[ì„±í–¥ ìœ í˜•] ${res.food} íƒ€ì… (${res.tag})
[7ê°€ì§€ ì„ íƒ]
${list}

â”â” ì¶œë ¥ í˜•ì‹ (ë¼ë²¨ ê·¸ëŒ€ë¡œ ì“°ì„¸ìš”) â”â”
í•œì¤„ìš”ì•½: [ì´ ì‚¬ëŒì„ ë”± í•œ ì¤„ë¡œ. ìŒì‹ ë¹„ìœ  + ë°˜ì „ í¬ì¸íŠ¸. ì´ëª¨ì§€ 2ê°œ]
íŠ¹ì§•1: [ì‹ìŠµê´€ì—ì„œ ë“œëŸ¬ë‚˜ëŠ” ì„±ê²©. "ë°°ê³ í”Œ ë•Œ ~í•œë‹¤" ê°™ì€ êµ¬ì²´ì  ìƒí™©. 2ë¬¸ì¥]
íŠ¹ì§•2: [ê´€ê³„ì—ì„œ ë“œëŸ¬ë‚˜ëŠ” íŒ¨í„´. "ì¹œêµ¬ë‘ ë°¥ ë¨¹ì„ ë•Œ ~" ì‹ êµ¬ì²´ì  ìƒí™©. 2ë¬¸ì¥]
íŠ¹ì§•3: [ì´ ì‚¬ëŒì´ ìŠ¤ìŠ¤ë¡œ ëª¨ë¥´ëŠ” ë§¤ë ¥. ë”°ëœ»í•˜ê³  êµ¬ì²´ì ìœ¼ë¡œ. 2ë¬¸ì¥]
ì•½ì : [ì´ íƒ€ì…ì˜ ì•„í‚¬ë ˆìŠ¤ê±´. ì†”ì§í•˜ê²Œ 1ë¬¸ì¥. ë„ˆë¬´ ì§ì ‘ì ì´ì§€ ì•Šê²Œ]
ê²°ì •ì í•œë§ˆë””: [ì´ ì‚¬ëŒì—ê²Œ í•´ì£¼ê³  ì‹¶ì€ ë§. ë”°ëœ»í•˜ì§€ë§Œ ì§„ì§œì¸ ë§. 1ë¬¸ì¥]
íƒœê·¸: #íƒœê·¸1 #íƒœê·¸2 #íƒœê·¸3 #íƒœê·¸4 #íƒœê·¸5

"íŠ¹ë³„í•œ", "ë§¤ë ¥ì ì¸" ê°™ì€ ë»”í•œ ë‹¨ì–´ ê¸ˆì§€. íƒœê·¸ëŠ” ë°ˆ/ì‹ ì¡°ì–´ ìŠ¤íƒ€ì¼.`;
  return await callGemini(prompt,700);
}

async function doCharTraits(foodName,res,story,mood){
  const moodData=MOOD_MAP[mood]||MOOD_MAP.neutral;
  const prompt=`ê·€ì—¬ìš´ ìŒì‹ ìºë¦­í„° í¬ë¦¬ì—ì´í„°ë¡œì„œ "${foodName}" ìºë¦­í„°ë¥¼ ì†Œê°œí•´ì£¼ì„¸ìš”.
ì´ ìºë¦­í„°ëŠ” "${foodName}"ì´ ì‚¬ëŒì´ ëœ ì¡´ì¬ì˜ˆìš”.
í˜„ì¬ ê¸°ë¶„: ${moodData.label} ${moodData.emoji}
ì´ ì‚¬ëŒ ì„±í–¥: ${res.food} íƒ€ì…${story?`\nì° íŒíŠ¸: "${story.slice(0,120)}"` :''}

â”â” ì¶œë ¥ í˜•ì‹ (ë¼ë²¨ ê·¸ëŒ€ë¡œ) â”â”
ìºë¦­í„°ì´ë¦„: [${foodName} + ê·€ì—¬ìš´ ë‹‰ë„¤ì„. ì˜ˆ: "ë¼ë©´ì´", "ì¹˜í‚¨êµ°" ë“±]
í•œì¤„ì†Œê°œ: ["${foodName}ì˜ ë§›ì²˜ëŸ¼ ~í•œ ì¡´ì¬ì˜ˆìš”" í˜•ì‹. ì´ëª¨ì§€ 1ê°œ. ë°˜ë“œì‹œ ìŒì‹ íŠ¹ì„± ì—°ê²°]

íŠ¹ì§•1ì œëª©: [3~5ê¸€ì]
íŠ¹ì§•1ë‚´ìš©: [${foodName}ì˜ ì‹¤ì œ íŠ¹ì„±(ë§›/ì§ˆê°/ì˜¨ë„)ê³¼ ì´ ìºë¦­í„° ì„±ê²© ì—°ê²°. í”¼ì‹ ì›ƒê¸°ëŠ” í†¤. ì´ëª¨ì§€ í¬í•¨. 2ë¬¸ì¥]

íŠ¹ì§•2ì œëª©: [ì œëª©]
íŠ¹ì§•2ë‚´ìš©: [í˜„ì¬ ê¸°ë¶„(${moodData.label})ì´ ë°˜ì˜ëœ ì˜¤ëŠ˜ì˜ ìƒíƒœ. êµ¬ì²´ì  ìƒí™© ë¬˜ì‚¬. 2ë¬¸ì¥]

íŠ¹ì§•3ì œëª©: [ì œëª©]
íŠ¹ì§•3ë‚´ìš©: [ì´ ìºë¦­í„°ì˜ ìˆ¨ê²¨ì§„ ëŠ¥ë ¥. ë”°ëœ»í•˜ê³  ê·€ì—½ê²Œ. 2ë¬¸ì¥]

í•„ì‚´ê¸°: [ì´ ìºë¦­í„°ë§Œì˜ íŠ¹ë³„í•œ ëŠ¥ë ¥. "~ì„ ë¬´ë„ˆëœ¨ë¦¬ëŠ” OO ê³µê²©" ê°™ì€ ì¬ë¯¸ìˆëŠ” í˜•ì‹]

ì¹œê·¼í•œ ì¡´ëŒ“ë§.`;
  return await callGemini(prompt,600);
}

async function doStoryAnalysis(res,story,foodName,mood){
  if(!story)return null;
  const moodData=MOOD_MAP[mood]||MOOD_MAP.neutral;
  const prompt=`ë‹¹ì‹ ì€ ë”°ëœ»í•œ ê°ì„±ì˜ ì‘ê°€ì´ì ì‹¬ë¦¬ ë¶„ì„ê°€ì˜ˆìš”.
ë§ˆì¹˜ ì˜¤ëœ ì¹œêµ¬ê°€ "ì•¼ ê·¸ê±° ì•Œì§€? ê·¸ê²Œ ì‚¬ì‹¤ì€~" í•˜ë©° ê³µê°í•´ì£¼ëŠ” í†¤.
ì¹œê·¼í•œ ì¡´ëŒ“ë§, ë»”í•œ ìœ„ë¡œ ê¸ˆì§€.

[ì‘ì„±ì ì„±í–¥] ${res.food} íƒ€ì…
[ì°ì˜ ì£¼ì¸ê³µ ìŒì‹] ${foodName}
[ì°ì˜ ê°ì •] ${moodData.label} ${moodData.emoji}
[ì° ë‚´ìš©] "${story}"

â”â” ì¶œë ¥ í˜•ì‹ (ë¼ë²¨ ê·¸ëŒ€ë¡œ) â”â”
ì°í•œì¤„: [ì´ ì°ì˜ í•µì‹¬ì„ í•œ ì¤„ë¡œ. ì½ìœ¼ë©´ ì°¡í•œ ë¬¸ì¥. ì´ëª¨ì§€ 1ê°œ]
ìŒì‹ì‹¬ë¦¬: [ì™œ í•˜í•„ "${foodName}"ì´ ì´ ì°ì˜ ì£¼ì¸ê³µì´ ëëŠ”ì§€. ìŒì‹ì˜ ë§›/ì˜¨ë„/ë¨¹ëŠ” ìƒí™©ê³¼ ì°ì˜ ê°ì • ì—°ê²°. 3~4ë¬¸ì¥. êµ¬ì²´ì ìœ¼ë¡œ]
ì´ì‚¬ëŒì—ê²Œ: [ì´ ì°ì„ ì“´ ì‚¬ëŒì—ê²Œë§Œ í•´ì£¼ëŠ” ë§. ë»”í•œ ìœ„ë¡œ ë§ê³  ì§„ì§œ ê·¸ ìˆœê°„ ê·¸ ê°ì •ì— ë§ëŠ” ë§. 2ë¬¸ì¥]
ì›¹íˆ°ì¥ë©´: ["${foodName} ìºë¦­í„°ê°€ ~í•˜ëŠ” ì¥ë©´" í˜•ì‹. ì‹œê°ì ìœ¼ë¡œ ìƒìƒí•˜ê²Œ. ê°ì •ì´ ì˜ ë‹´ê¸´ í•œ ì»· ë¬˜ì‚¬. 2ë¬¸ì¥]
íƒœê·¸: #íƒœê·¸1 #íƒœê·¸2 #íƒœê·¸3 #íƒœê·¸4

"í˜ë‚´ì„¸ìš”", "ì˜ ë  ê±°ì˜ˆìš”" ê°™ì€ ë»”í•œ ìœ„ë¡œ ê¸ˆì§€. ì° ë‚´ìš©ì„ ì§„ì§œ ì½ê³  ë¶„ì„í•œ ê²ƒì²˜ëŸ¼ êµ¬ì²´ì ìœ¼ë¡œ.`;
  return await callGemini(prompt,700);
}

// â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
//  RENDER FUNCTIONS (ì›ë³¸ ê·¸ëŒ€ë¡œ)
// â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
function renderQuizAI(text,res){
  const hl=getField(text,'í•œì¤„ìš”ì•½')||`${res.food} íƒ€ì…ì˜ ë…ë³´ì ì¸ ë‹¹ì‹  âœ¨`;
  const t1=getField(text,'íŠ¹ì§•1'),t2=getField(text,'íŠ¹ì§•2'),t3=getField(text,'íŠ¹ì§•3');
  const traits=[t1,t2,t3].filter(Boolean);
  if(!traits.length)traits.push('ì½ì„ìˆ˜ë¡ ê³µê° ê°€ëŠ” ì„±í–¥ì´ì—ìš”.','ì£¼ë³€ì´ ë¨¼ì € ì•Œì•„ë³´ëŠ” ìˆ¨ì€ ë§¤ë ¥ì´ ìˆì–´ìš”.','ìê¸° ìì‹ ì„ ì˜ ì•„ëŠ” ì‚¬ëŒì´ì—ìš”.');
  const weakness=getField(text,'ì•½ì ');
  const reason=getField(text,'ê²°ì •ì í•œë§ˆë””')||`${res.food}ì²˜ëŸ¼ ì•Œê³  ë³´ë©´ ë” ê¹Šì–´ì§€ëŠ” ì‚¬ëŒì´ì—ìš”.`;
  const tags=(getField(text,'íƒœê·¸').match(/#[^\s#]+/g)||[]).slice(0,5);
  if(!tags.length)tags.push('#ë‚˜ë‹¤ìš´ì°','#ì°í‘¸ë“œ','#ì°ë¶„ì„','#ìŒì‹ì„±í–¥');
  return`<div class="q-ai-section"><div class="q-ai-section-title">âœ¦ í•œì¤„ ìš”ì•½</div><p style="font-weight:700;font-size:15px;color:var(--dark);line-height:1.6">${hl}</p></div>
<div class="q-ai-section"><div class="q-ai-section-title">âœ¦ ì´ëŸ° ì‚¬ëŒì´ì—ìš”</div>${traits.map((t,i)=>`<div style="margin-bottom:10px;padding:10px 12px;background:rgba(212,149,106,.06);border-radius:10px;border-left:3px solid var(--toast)"><p style="font-size:11px;font-weight:700;color:var(--toast);margin-bottom:4px">íŠ¹ì§• ${i+1}</p><p style="font-size:13px;color:var(--dark);line-height:1.7">${t}</p></div>`).join('')}</div>
${weakness?`<div class="q-ai-section"><div class="q-ai-section-title">âš¡ ì•„í‚¬ë ˆìŠ¤ê±´</div><p style="font-size:13px;color:var(--muted);line-height:1.7;padding:10px 12px;background:rgba(44,24,16,.04);border-radius:10px;font-style:italic">${weakness}</p></div>`:''}
<div class="q-ai-section"><div class="q-ai-section-title">âœ¦ ê²°ì •ì  í•œë§ˆë””</div><p style="font-size:14px;font-weight:600;color:var(--dark);border-left:3px solid var(--toast);padding:12px 14px;background:rgba(212,149,106,.07);border-radius:0 10px 10px 0;line-height:1.8">"${reason}"</p></div>
<div style="margin-top:4px">${tags.map(t=>`<span class="q-ai-tag">${t}</span>`).join('')}</div>`;
}

function renderTraits(text,foodName,mood){
  const moodData=MOOD_MAP[mood]||MOOD_MAP.neutral;
  const charName=getField(text,'ìºë¦­í„°ì´ë¦„')||`${foodName}ì´`;
  const charIntro=getField(text,'í•œì¤„ì†Œê°œ')||`${foodName}ì˜ ë§¤ë ¥ì„ ë‹´ì€ ê·€ì—¬ìš´ ì¡´ì¬ì˜ˆìš”.`;
  const special=getField(text,'í•„ì‚´ê¸°');
  let html=`<div style="padding:12px 14px;background:white;border-radius:12px;margin-bottom:10px;border:2px solid rgba(100,130,220,.15)">
  <div style="display:flex;align-items:center;gap:10px;margin-bottom:8px">
    <span style="font-size:26px">${moodData.emoji}</span>
    <div>
      <div style="font-family:'Noto Serif KR',serif;font-size:16px;font-weight:900;color:var(--story-blue)">${charName}</div>
      <div style="font-size:11px;color:var(--muted);margin-top:2px">ì§€ê¸ˆ ê¸°ë¶„: <strong style="color:var(--story-blue)">${moodData.label}</strong></div>
    </div>
  </div>
  <p style="font-size:13px;color:var(--dark);line-height:1.7;padding-top:8px;border-top:1px dashed rgba(100,130,220,.2)">${charIntro}</p>
</div>`;
  const icons=['ğŸŒŸ','ğŸ’«','âœ¨'];
  for(let i=1;i<=3;i++){
    const title=getField(text,`íŠ¹ì§•${i}ì œëª©`)||`íŠ¹ì§• ${i}`;
    const content=getField(text,`íŠ¹ì§•${i}ë‚´ìš©`)||`${foodName} ìºë¦­í„°ë§Œì˜ ë…íŠ¹í•œ ë§¤ë ¥ì´ ìˆì–´ìš”.`;
    html+=`<div class="trait-item"><span class="trait-icon">${icons[i-1]}</span><div class="trait-text"><strong>${title}</strong>${content}</div></div>`;
  }
  if(special)html+=`<div style="margin-top:10px;padding:12px 14px;background:linear-gradient(135deg,rgba(100,130,220,.1),rgba(100,130,220,.05));border-radius:12px;border:1px dashed rgba(100,130,220,.3)"><div style="font-size:11px;font-weight:700;color:var(--story-blue);letter-spacing:1px;margin-bottom:6px">âš”ï¸ í•„ì‚´ê¸°</div><p style="font-size:13px;color:var(--dark);line-height:1.7">${special}</p></div>`;
  return html;
}

function renderStoryAI(text,foodName,mood){
  const moodData=MOOD_MAP[mood]||MOOD_MAP.neutral;
  const summary=getField(text,'ì°í•œì¤„');
  const foodPsy=getField(text,'ìŒì‹ì‹¬ë¦¬')||`${foodName}ì´ë¼ëŠ” ì„ íƒì—ì„œ ë‹¹ì‹ ì˜ ì§„ì‹¬ì´ ëŠê»´ì ¸ìš”.`;
  const toYou=getField(text,'ì´ì‚¬ëŒì—ê²Œ')||'ë‹¹ì‹ ì˜ ì´ì•¼ê¸°, ì§„ì‹¬ìœ¼ë¡œ ì˜ ë“¤ì—ˆì–´ìš”.';
  const scene=getField(text,'ì›¹íˆ°ì¥ë©´');
  const tags=(getField(text,'íƒœê·¸').match(/#[^\s#]+/g)||[]).slice(0,4);
  if(!tags.length)tags.push('#ì°í‘¸ë“œ','#ìŒì‹ì°','#ë‚˜ì˜ì´ì•¼ê¸°');
  let html=`<div style="display:inline-flex;align-items:center;gap:6px;padding:5px 14px;background:${moodData.badgeBg};border:1px solid ${moodData.border};border-radius:20px;font-size:12px;font-weight:700;color:${moodData.badgeColor};margin-bottom:16px">
  ${moodData.emoji} ì´ ì°ì˜ ê°ì •: ${moodData.label}
</div>`;
  if(summary)html+=`<div class="ai-section"><div class="ai-section-title">âœ¦ ì´ ì°ì„ í•œ ì¤„ë¡œ</div><p style="font-weight:700;font-size:15px;color:#1a2a6a;line-height:1.6;padding:10px 14px;background:rgba(100,130,220,.07);border-radius:10px">${summary}</p></div>`;
  html+=`<div class="ai-section"><div class="ai-section-title">âœ¦ ${foodName}ì„ ì„ íƒí•œ ì‹¬ë¦¬</div><p style="color:#2a3a6a;line-height:1.9;font-size:13px">${foodPsy}</p></div>`;
  html+=`<div class="ai-section"><div class="ai-section-title">âœ¦ ì´ ì°ì„ ì“´ ë‹¹ì‹ ì—ê²Œ</div><p style="font-size:14px;color:#2a3a7a;border-left:3px solid #7090d8;padding:12px 14px;background:rgba(100,130,220,.07);border-radius:0 10px 10px 0;line-height:1.8">"${toYou}"</p></div>`;
  if(scene)html+=`<div class="ai-section"><div class="ai-section-title">ğŸ¬ ì›¹íˆ°ìœ¼ë¡œ ë§Œë“ ë‹¤ë©´</div><div style="padding:12px 14px;background:linear-gradient(135deg,#f8f0ff,#f0f4ff);border-radius:10px;border:1px dashed rgba(130,100,220,.25)"><p style="font-size:13px;color:#3a2a6a;line-height:1.8;font-style:italic">${scene}</p></div></div>`;
  html+=`<div style="margin-top:4px">${tags.map(t=>`<span class="ai-tag">${t}</span>`).join('')}</div>`;
  return html;
}

function localQuizAI(res){
  const db={
    A:{hl:`ğŸŒ¶ï¸ğŸ”¥ í•œ ë²ˆ ë§›ë³´ë©´ ìê¾¸ ìƒê°ë‚˜ëŠ” ë§ˆë¼íƒ•í˜• ì¸ê°„`,traits:[`ë°°ê³ í”Œ ë•Œ ì˜ˆë¯¼í•´ì§€ëŠ” ê±´ ê°ì •ì„ ìˆ¨ê¸°ì§€ ì•ŠëŠ” ì†”ì§í•¨ì´ì—ìš”. ì¹œêµ¬ë“¤ì€ "ìŸ¤ ë°°ê³ í”„ë©´ í”¼í•´ì•¼ í•´"ë¼ê³  í•˜ì§€ë§Œ, ê·¸ê²Œ ì˜¤íˆë ¤ ì‹ ë¢°ê°€ ê°€ëŠ” ì´ìœ ì˜ˆìš”.`,`ë©”ë‰´ ì •í•  ë•Œ ë‚´ê°€ ì •í•˜ëŠ” íƒ€ì… â€” ë‹¨í†¡ì— "ì•„ë¬´ê±°ë‚˜"ê°€ ì˜¬ë¼ì˜¤ë©´ ì œì¼ ë¨¼ì € "ê·¸ëŸ¼ ì—¬ê¸° ì–´ë•Œìš”?" í•˜ëŠ” ì‚¬ëŒì´ì—ìš”.`,`ìê·¹ì ì¸ ê±¸ ì¢‹ì•„í•˜ëŠ” ë•ë¶„ì— ì‚¶ì˜ ì˜¨ë„ê°€ í•­ìƒ ë†’ì•„ìš”. ì§€ë£¨í•  í‹ˆì´ ì—†ì–´ì„œ ì£¼ë³€ ì‚¬ëŒë“¤ì´ í•­ìƒ í™œê¸°ì°¨ì ¸ìš”.`],weakness:`ì²˜ìŒ ë³´ëŠ” ì‚¬ëŒì—ê²Œ ë„ˆë¬´ ê°•í•œ ì¸ìƒì„ ì¤„ ìˆ˜ ìˆì–´ìš”.`,reason:`ë§ˆë¼íƒ•ì²˜ëŸ¼ ì²˜ìŒì—” "ì´ê²Œ ë§ë‚˜?" ì‹¶ë‹¤ê°€ë„, ê²°êµ­ ë‹¤ìŒì— ë˜ ì°¾ê²Œ ë˜ëŠ” ì‚¬ëŒì´ì—ìš”.`,tags:['#ìê·¹ì£¼ì˜','#ê°ì •ì§ì§„','#ì¤‘ë…ë§¤ë ¥','#ë§ˆë¼íƒ•ì¸ê°„','#ë°°ê³ í”„ë©´í”¼í•´']},
    B:{hl:`ğŸ‚ğŸŒ™ ì¡°ìš©íˆ ë‹¹ì‹  ìƒì¼ ê¸°ì–µí•˜ëŠ” ì¼€ì´í¬í˜• ì¸ê°„`,traits:[`ìŠ¤íŠ¸ë ˆìŠ¤ ë°›ìœ¼ë©´ ë‹¬ë‹¬í•œ ê±¸ ì°¾ëŠ” â€” ê°ì •ì„ í­ë°œì‹œí‚¤ëŠ” ëŒ€ì‹  í¸ì˜ì  ë””ì €íŠ¸ ì½”ë„ˆì—ì„œ í˜¼ì ì¡°ìš©íˆ í•´ê²°í•˜ëŠ” ìê¸° ëŒë´„ì˜ ê³ ìˆ˜ì˜ˆìš”.`,`ì´ë¶ˆ ì† í‘ì—­ì‚¬ê°€ ë§ë‹¤ë©´, ê°ìˆ˜ì„±ì´ ê·¸ë§Œí¼ í’ë¶€í•˜ë‹¤ëŠ” ëœ»ì´ì—ìš”. ë‚¨ë“¤ì´ ê·¸ëƒ¥ ì§€ë‚˜ì¹œ ìƒëŒ€ë°©ì˜ í•œë§ˆë””ë¥¼ ë©°ì¹ ì§¸ ê³±ì”¹ëŠ” ì‚¬ëŒì´ì—ìš”.`,`ê²‰ìœ¼ë¡  í‰ì˜¨í•´ ë³´ì´ì§€ë§Œ ì†ìœ¼ë¡  ëŠì„ì—†ì´ ìƒê° ì¤‘ â€” ê·¸ ìƒê°ë“¤ì´ ê°€ë” ëª…ëŒ€ì‚¬ë¡œ í„°ì ¸ë‚˜ì™€ìš”.`],weakness:`ê¸°ë¶„ ë‚˜ë¹ ë„ í‹° ì•ˆ ë‚´ë‹¤ê°€ ë‚˜ì¤‘ì— í•œêº¼ë²ˆì— í„°ì§€ëŠ” ê²½ìš°ê°€ ìˆì–´ìš”.`,reason:`ë”¸ê¸°ì¼€ì´í¬ì²˜ëŸ¼ ê¸°ë¶„ ì¢‹ì„ ë•Œë„, ìœ„ë¡œê°€ í•„ìš”í•  ë•Œë„, ê²°êµ­ ìƒê°ë‚˜ëŠ” ì‚¬ëŒì´ì—ìš”.`,tags:['#ê°ì„±ì¶©ë§Œ','#ê¸°ë…ì¼ì¥ì¸','#ì¡°ìš©í•œë‚­ë§Œì£¼ì˜','#ì¼€ì´í¬ì¸ê°„','#ì´ë¶ˆí‚¥ì¥ì¸']},
    C:{hl:`ğŸ·â³ 1íšŒì°¨ì—” ì ˆëŒ€ ëª¨ë¥´ëŠ” ì™€ì¸í˜• ì¸ê°„`,traits:[`ì„¸ë¼ ë‹¤ ì±™ê¸°ëŠ” ê·œì¹™íŒŒ â€” ê²‰ìœ¼ë¡  ì² ì €í•´ ë³´ì´ì§€ë§Œ ì‚¬ì‹¤ ìê¸° ìì‹ í•œí…Œ ê°€ì¥ ì—„ê²©í•´ìš”. ë‚¨í•œí…ŒëŠ” "ê´œì°®ì•„ìš”~" í•˜ë©´ì„œ í˜¼ìì„  ê¸°ì¤€ì´ ì„¸ ë°°ì˜ˆìš”.`,`ìŠ¤íŠ¸ë ˆìŠ¤ ë°›ìœ¼ë©´ ë¹¨ë¦¬ ë¨¹ê³  í•´ê²°í•˜ëŠ” íƒ€ì… â€” ë°¥ì„ íš¨ìœ¨ì˜ ê´€ì ìœ¼ë¡œ ë³´ëŠ” ì‚¬ëŒì´ì—ìš”. "ë°¥ì´ ë­” ì·¨ë¯¸ì•¼, ì—°ë£Œì§€" í•˜ë‹¤ê°€ë„ ë§›ìˆëŠ” ê±° ì•ì—ì„œ ë¬´ë„ˆì§€ëŠ” ë°˜ì „ ìˆì–´ìš”.`,`ì²˜ìŒ ë§Œë‚˜ë©´ ì¡°ê¸ˆ ì–´ë µê²Œ ëŠê»´ì§€ì§€ë§Œ, ê°€ê¹Œì›Œì§€ë©´ ì™„ì „ ë‹¤ë¥¸ ì‚¬ëŒ ë‚˜ì™€ìš”.`],weakness:`ì²˜ìŒ ì¸ìƒì´ ë„ˆë¬´ ì™„ë²½í•´ ë³´ì—¬ì„œ ì‚¬ëŒë“¤ì´ ë¨¼ì € ë§ ê±¸ê¸° ì–´ë ¤ì›Œí•´ìš”.`,reason:`ì™€ì¸ì²˜ëŸ¼ ì‹œê°„ì´ ì§€ë‚ ìˆ˜ë¡ ê¹Šì–´ì§€ëŠ” ë§› â€” ë¹¨ë¦¬ íŒë‹¨í•˜ë©´ ì´ ì‚¬ëŒ ëª¨ë¥´ëŠ” ê±°ì˜ˆìš”.`,tags:['#ìˆ™ì„±í˜•ì¸ê°„','#ì²œì²œíˆì•Œì•„ê°€ì','#1íšŒì°¨ëŠ”ëª¨ë¦„','#ì™€ì¸ì¸ê°„','#ë°˜ì „ë§¤ë ¥']},
    D:{hl:`ğŸ²ğŸŒ™ ìƒˆë²½ 3ì‹œì— ìƒê°ë‚˜ëŠ” í•´ì¥êµ­í˜• ì¸ê°„`,traits:[`ë°°ê³ íŒŒë„ ê·¸ëƒ¥ ì•„ë¬´ê±°ë‚˜ ë¨¹ëŠ” â€” ì‚¬ì†Œí•œ ê²ƒì— ì—ë„ˆì§€ ìŸì§€ ì•ŠëŠ” ì‚¬ëŒì´ì—ìš”. ë©”ë‰´ ê³ ë¥´ëŠ” ë° 30ë¶„ ì“°ëŠ” ì‚¬ëŒë“¤ ì˜†ì—ì„œ "ì•„ë¬´ê±°ë‚˜ ì£¼ì„¸ìš”" í•˜ê³  ë°”ë¡œ ê²°ì •í•´ìš”.`,`ì¡°ìš©íˆ ì˜¤ë˜ ì°¸ë‹¤ê°€ í•œ ë²ˆì— ì •ë¦¬í•˜ëŠ” íƒ€ì…ì´ì—ìš”. ë‹¨í†¡ì—ì„œ ë§ ì—†ì´ ë‚˜ê°€ê±°ë‚˜, ì—°ë½ì´ ì„œì„œíˆ ì¤„ì–´ë“œëŠ” ê±¸ë¡œ ë§ˆìŒì„ í‘œí˜„í•´ìš”.`,`ê±°ì°½í•œ í‘œí˜„ì€ ì—†ì–´ë„ ê³ì— ìˆìœ¼ë©´ ì™ ì§€ ì•ˆì‹¬ì´ ë˜ëŠ” ì‚¬ëŒì´ì—ìš”.`],weakness:`ê°ì • í‘œí˜„ì´ ì ë‹¤ ë³´ë‹ˆ ê°€ë” ì†ì„ ì•Œ ìˆ˜ ì—†ë‹¤ëŠ” ë§ì„ ë“¤ì–´ìš”.`,reason:`í•´ì¥êµ­ì²˜ëŸ¼ ìˆì„ ë•ŒëŠ” ë‹¹ì—°í•˜ê³ , ì—†ìœ¼ë©´ ì§„ì§œ ë¹ˆìë¦¬ê°€ ëŠê»´ì§€ëŠ” ì‚¬ëŒì´ì—ìš”.`,tags:['#ì§„êµ­ì¸ìƒ','#ìˆì–´ì•¼ì™„ì„±','#ìƒˆë²½ì„¸ì‹œì—ìƒê°ë‚˜ëŠ”ì‚¬ëŒ','#í•´ì¥êµ­ì¸ê°„','#ì¡°ìš©í•œê°•ì']}
  }[res.type];
  return renderQuizAI(`í•œì¤„ìš”ì•½: ${db.hl}\níŠ¹ì§•1: ${db.traits[0]}\níŠ¹ì§•2: ${db.traits[1]}\níŠ¹ì§•3: ${db.traits[2]}\nì•½ì : ${db.weakness}\nê²°ì •ì í•œë§ˆë””: ${db.reason}\níƒœê·¸: ${db.tags.join(' ')}`,res);
}

// â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
//  PHONE
// â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
let consented=false;
function toggleConsent(){consented=!consented;document.getElementById('consent-cb').classList.toggle('checked',consented);}
function formatPhone(el){let v=el.value.replace(/\D/g,'').substring(0,11);if(v.length<=3)el.value=v;else if(v.length<=7)el.value=v.slice(0,3)+'-'+v.slice(3);else el.value=v.slice(0,3)+'-'+v.slice(3,7)+'-'+v.slice(7);}
function submitPhone(){const p=document.getElementById('phone-input').value.trim();if(p&&!consented){alert('ê°œì¸ì •ë³´ í™œìš© ë™ì˜ë¥¼ ì²´í¬í•´ì£¼ì„¸ìš”!');return;}goTo('page-done');}

// â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
//  INIT
// â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
initQuiz();
</script>
</body>
</html>
