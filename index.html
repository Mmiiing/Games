<!DOCTYPE html>
<html lang="ko">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>ì°í‘¸ë“œ â€” ë‹¹ì‹ ì˜ ìŒì‹ê³¼ ì°ì€?</title>
<link href="https://fonts.googleapis.com/css2?family=Noto+Serif+KR:wght@400;700;900&family=Noto+Sans+KR:wght@300;400;500&display=swap" rel="stylesheet">
<style>
  :root {
    --cream: #FAF3E8; --toast: #D4956A; --caramel: #B8622A; --dark: #2C1810;
    --muted: #7A5C4A; --accent: #E8734A; --green: #5A7A52;
    --border: rgba(180,130,90,0.25);
    --story-blue: #4a5fa0; --story-bg: #f0f4ff; --story-border: rgba(100,130,220,.25);
  }
  * { margin:0; padding:0; box-sizing:border-box; }
  body { background:var(--cream); font-family:'Noto Sans KR',sans-serif; color:var(--dark); min-height:100vh; overflow-x:hidden; }
  body::before { content:''; position:fixed; inset:0; background-image:radial-gradient(circle at 20% 20%,rgba(212,149,106,.08) 0%,transparent 50%),radial-gradient(circle at 80% 80%,rgba(91,122,82,.06) 0%,transparent 50%); pointer-events:none; z-index:0; }
  .page { display:none; position:relative; z-index:1; min-height:100vh; }
  .page.active { display:flex; flex-direction:column; }

  /* SPLASH */
  #page-splash { align-items:center; justify-content:center; background:linear-gradient(160deg,#FFF9F0 0%,#FAF0E0 40%,#F5E8CC 100%); text-align:center; padding:40px 20px; }
  .splash-title { font-family:'Noto Serif KR',serif; font-size:clamp(28px,8vw,52px); font-weight:900; color:var(--dark); line-height:1.25; letter-spacing:-1px; margin-bottom:10px; animation:fadeUp .8s ease both; }
  .splash-title em { color:var(--caramel); font-style:normal; }
  .splash-sub { font-size:14px; color:var(--muted); margin-bottom:44px; animation:fadeUp .8s .15s ease both; opacity:0; animation-fill-mode:both; }
  .splash-chars { display:flex; gap:12px; align-items:flex-end; justify-content:center; flex-wrap:wrap; margin-bottom:48px; animation:fadeUp .8s .25s ease both; opacity:0; animation-fill-mode:both; }
  .splash-char { display:flex; flex-direction:column; align-items:center; gap:6px; animation:bobble 2s ease-in-out infinite; }
  .splash-char:nth-child(2){animation-delay:.2s;} .splash-char:nth-child(3){animation-delay:.4s;} .splash-char:nth-child(4){animation-delay:.6s;}
  .splash-char svg { width:70px; height:78px; filter:drop-shadow(0 6px 12px rgba(44,24,16,.13)); }
  .splash-char-name { font-size:11px; font-weight:700; color:var(--muted); letter-spacing:.5px; }
  @keyframes bobble { 0%,100%{transform:translateY(0)} 50%{transform:translateY(-10px)} }
  .splash-btn { padding:16px 52px; border-radius:50px; border:none; background:linear-gradient(135deg,var(--caramel),var(--accent)); color:white; font-size:18px; font-weight:700; cursor:pointer; font-family:'Noto Serif KR',serif; box-shadow:0 8px 24px rgba(184,98,42,.35); transition:all .25s; animation:fadeUp .8s .4s ease both; opacity:0; animation-fill-mode:both; }
  .splash-btn:hover { transform:translateY(-3px); box-shadow:0 12px 32px rgba(184,98,42,.45); }

  /* LAYOUT */
  .page-wrap { max-width:640px; margin:0 auto; width:100%; padding:0 20px 80px; flex:1; }
  .page-header { text-align:center; padding:44px 0 28px; }
  .page-tag { display:inline-block; background:var(--toast); color:white; font-size:11px; letter-spacing:2px; padding:5px 14px; border-radius:20px; margin-bottom:14px; font-weight:500; }
  .page-header h2 { font-family:'Noto Serif KR',serif; font-size:clamp(22px,5vw,32px); font-weight:900; line-height:1.3; letter-spacing:-.5px; }
  .page-header h2 em { color:var(--caramel); font-style:normal; }
  .page-header p { margin-top:10px; color:var(--muted); font-size:13px; line-height:1.7; }

  /* QUIZ */
  .quiz-card { background:linear-gradient(135deg,#FFF9F0,#FFF3E0); border-radius:20px; padding:26px; border:1.5px solid rgba(212,149,106,.3); box-shadow:0 4px 24px rgba(44,24,16,.06); }
  .quiz-progress { display:flex; gap:6px; margin-bottom:10px; }
  .quiz-dot { height:4px; flex:1; border-radius:2px; background:var(--border); transition:background .3s; }
  .quiz-dot.active{background:var(--toast);} .quiz-dot.done{background:var(--caramel);}
  .quiz-step-label { font-size:11px; color:var(--muted); margin-bottom:18px; letter-spacing:.5px; font-weight:600; }
  .quiz-question { font-family:'Noto Serif KR',serif; font-size:18px; font-weight:700; line-height:1.5; margin-bottom:20px; color:var(--dark); }
  .quiz-options { display:grid; grid-template-columns:1fr 1fr; gap:10px; }
  .quiz-option { padding:14px 12px; border-radius:14px; border:2px solid var(--border); background:white; cursor:pointer; font-size:13px; color:var(--dark); text-align:center; line-height:1.4; transition:all .2s; font-family:'Noto Sans KR',sans-serif; }
  .quiz-option:hover { border-color:var(--toast); background:#FFF8F0; transform:translateY(-2px); }
  .quiz-option.selected { border-color:var(--caramel); background:linear-gradient(135deg,#FFF0E0,#FFE8CC); font-weight:500; }
  .quiz-option .opt-emoji { display:block; font-size:24px; margin-bottom:6px; }
  .btn-next { width:100%; padding:15px; border-radius:12px; border:none; background:var(--dark); color:white; font-size:15px; font-weight:700; cursor:pointer; font-family:'Noto Serif KR',serif; transition:all .2s; margin-top:18px; }
  .btn-next:hover { background:var(--caramel); transform:translateY(-2px); }

  /* STORY PAGE */
  .story-card { background:white; border-radius:20px; padding:28px; border:1px solid var(--border); box-shadow:0 4px 24px rgba(44,24,16,.06); margin-bottom:20px; }
  .story-intro { font-size:13px; color:var(--muted); margin-bottom:22px; line-height:1.7; padding:14px 16px; background:rgba(212,149,106,.07); border-radius:12px; border-left:3px solid var(--toast); }
  .theme-label { font-size:12px; font-weight:600; color:var(--muted); letter-spacing:.5px; margin-bottom:10px; }
  .theme-chips { display:flex; flex-wrap:wrap; gap:8px; margin-bottom:20px; }
  .theme-chip { padding:7px 15px; border-radius:20px; border:1.5px solid var(--border); background:transparent; font-size:13px; color:var(--muted); cursor:pointer; transition:all .2s; font-family:'Noto Sans KR',sans-serif; }
  .theme-chip:hover { border-color:var(--toast); color:var(--toast); }
  .theme-chip.active { background:var(--dark); border-color:var(--dark); color:white; }
  .story-field { position:relative; margin-bottom:18px; }
  .story-field label { display:block; font-size:12px; font-weight:600; color:var(--muted); margin-bottom:8px; letter-spacing:.5px; }
  .story-field textarea { width:100%; padding:14px 16px; border-radius:12px; border:1.5px solid var(--border); background:#FDFAF6; font-size:14px; color:var(--dark); font-family:'Noto Sans KR',sans-serif; resize:none; outline:none; transition:border-color .2s; line-height:1.7; min-height:140px; }
  .story-field textarea:focus { border-color:var(--toast); background:white; }
  .char-count { position:absolute; bottom:10px; right:14px; font-size:11px; color:var(--border); }
  .temp-label { font-size:12px; font-weight:600; color:var(--muted); letter-spacing:.5px; margin-bottom:10px; }
  .temp-track { display:flex; align-items:center; gap:8px; margin-bottom:22px; }
  .temp-end { font-size:11px; color:var(--muted); white-space:nowrap; flex-shrink:0; }
  .temp-btns { display:flex; gap:6px; flex:1; justify-content:center; }
  .temp-btn { width:38px; height:38px; border-radius:50%; border:1.5px solid var(--border); background:white; font-size:13px; font-weight:600; color:var(--muted); cursor:pointer; transition:all .2s; }
  .temp-btn:hover { border-color:var(--toast); color:var(--toast); }
  .temp-btn.active { background:var(--dark); border-color:var(--dark); color:white; }
  .btn-submit { width:100%; padding:16px; border-radius:14px; border:none; background:linear-gradient(135deg,var(--caramel),var(--accent)); color:white; font-size:16px; font-weight:700; cursor:pointer; font-family:'Noto Serif KR',serif; letter-spacing:.5px; transition:all .25s; box-shadow:0 6px 20px rgba(184,98,42,.3); }
  .btn-submit:hover { transform:translateY(-2px); }

  /* RESULT */
  #page-result { background:var(--cream); }
  .result-wrap { max-width:640px; margin:0 auto; padding:40px 20px 80px; }
  .result-loading-screen { display:flex; flex-direction:column; align-items:center; justify-content:center; min-height:70vh; gap:20px; text-align:center; }
  .result-loading-screen p { font-size:14px; color:var(--muted); line-height:1.8; }
  .big-spinner { width:52px; height:52px; border:4px solid var(--border); border-top-color:var(--toast); border-radius:50%; animation:spin .9s linear infinite; }
  @keyframes spin{to{transform:rotate(360deg)}}

  /* Section header */
  .result-section-header { text-align:center; padding:28px 0 18px; }
  .result-badge { display:inline-flex; align-items:center; gap:6px; color:white; font-size:11px; letter-spacing:2px; padding:6px 16px; border-radius:20px; margin-bottom:10px; font-weight:700; }
  .result-badge.warm { background:linear-gradient(135deg,var(--caramel),var(--accent)); }
  .result-badge.cool { background:linear-gradient(135deg,#4a5fa0,#6678cc); }
  .result-section-title { font-family:'Noto Serif KR',serif; font-size:16px; font-weight:700; color:var(--dark); }

  /* Section divider */
  .section-divider { display:flex; align-items:center; gap:12px; margin:28px 0 20px; }
  .section-divider-line { flex:1; height:1px; background:linear-gradient(90deg,transparent,var(--border),transparent); }
  .section-divider-label { font-family:'Noto Serif KR',serif; font-size:11px; font-weight:700; letter-spacing:2px; color:var(--muted); white-space:nowrap; padding:6px 14px; background:white; border:1px solid var(--border); border-radius:20px; }

  /* PERSONALITY CARD */
  .personality-card { background:white; border-radius:24px; padding:28px; border:1.5px solid rgba(212,149,106,.3); box-shadow:0 8px 32px rgba(44,24,16,.08); margin-bottom:14px; text-align:center; animation:popIn .5s cubic-bezier(.34,1.56,.64,1) both; }
  .personality-emoji { font-size:52px; display:block; margin-bottom:12px; }
  .personality-food-type { font-family:'Noto Serif KR',serif; font-size:24px; font-weight:900; color:var(--caramel); margin-bottom:8px; }
  .personality-type-tag { display:inline-block; padding:5px 14px; background:rgba(212,149,106,.12); border:1px solid rgba(212,149,106,.3); border-radius:20px; font-size:12px; font-weight:600; color:var(--caramel); margin-bottom:14px; }
  .personality-desc { font-size:14px; color:var(--muted); line-height:1.85; text-align:left; padding:14px 16px; background:rgba(212,149,106,.05); border-radius:12px; border-left:3px solid var(--toast); }

  /* QUIZ AI BOX */
  .quiz-ai-box { background:linear-gradient(135deg,#FFF9F0,#FFF3E0); border-radius:16px; padding:20px; border:1.5px solid rgba(212,149,106,.3); margin-bottom:14px; animation:popIn .5s .1s cubic-bezier(.34,1.56,.64,1) both; }
  .quiz-ai-box-title { font-family:'Noto Serif KR',serif; font-size:14px; font-weight:700; color:var(--caramel); margin-bottom:14px; display:flex; align-items:center; gap:8px; }
  .quiz-ai-content { font-size:13px; color:var(--dark); line-height:1.9; }
  .q-ai-section { margin-bottom:14px; padding-bottom:14px; border-bottom:1px dashed rgba(212,149,106,.2); }
  .q-ai-section:last-child { border-bottom:none; margin-bottom:0; padding-bottom:0; }
  .q-ai-section-title { font-size:11px; font-weight:700; color:var(--toast); letter-spacing:1px; margin-bottom:8px; }
  .q-ai-tag { display:inline-block; margin:4px 3px 0; padding:3px 10px; background:rgba(212,149,106,.12); color:var(--caramel); border-radius:12px; font-size:11px; font-weight:600; }

  /* QUIZ RECAP */
  .quiz-recap-card { background:white; border-radius:20px; padding:20px; border:1px solid var(--border); box-shadow:0 4px 24px rgba(44,24,16,.05); margin-bottom:14px; animation:popIn .5s .2s cubic-bezier(.34,1.56,.64,1) both; }
  .recap-title { font-size:11px; color:var(--muted); letter-spacing:1px; font-weight:600; margin-bottom:12px; }
  .recap-q { margin-bottom:8px; border-radius:12px; overflow:hidden; border:1px solid var(--border); }
  .recap-q-text { font-size:12px; font-weight:700; color:var(--dark); padding:9px 12px; background:rgba(44,24,16,.04); border-bottom:1px solid var(--border); line-height:1.4; }
  .recap-opt-chosen { display:flex; align-items:center; gap:8px; padding:8px 12px; font-size:13px; font-weight:600; color:var(--dark); background:linear-gradient(90deg,#FFF0E0,#FFF8F4); }
  .recap-check { width:18px; height:18px; border-radius:50%; background:var(--caramel); display:flex; align-items:center; justify-content:center; font-size:10px; color:white; flex-shrink:0; }

  /* CHARACTER CARD */
  .character-card { background:white; border-radius:24px; padding:24px; border:1.5px solid var(--story-border); box-shadow:0 8px 32px rgba(44,24,16,.08); margin-bottom:14px; animation:popIn .5s .05s cubic-bezier(.34,1.56,.64,1) both; }
  .character-card-inner { display:flex; gap:18px; align-items:flex-start; }
  .char-img-wrap { width:120px; height:120px; border-radius:18px; background:linear-gradient(135deg,#f0f4ff,#e8ecff); border:2px solid var(--story-border); display:flex; align-items:center; justify-content:center; overflow:hidden; flex-shrink:0; }
  .char-img { width:100%; height:100%; object-fit:cover; }
  .char-loading-inner { display:flex; flex-direction:column; align-items:center; gap:8px; color:var(--muted); font-size:11px; text-align:center; padding:8px; }
  .small-spinner { width:24px; height:24px; border:3px solid var(--border); border-top-color:var(--toast); border-radius:50%; animation:spin .8s linear infinite; }
  .character-info { flex:1; min-width:0; }
  .character-food-name { font-family:'Noto Serif KR',serif; font-size:20px; font-weight:900; color:var(--story-blue); margin-bottom:6px; }
  .character-sub-tag { display:inline-block; padding:4px 12px; background:linear-gradient(135deg,#f0f4ff,#e8ecff); border:1px solid var(--story-border); border-radius:20px; font-size:11px; font-weight:600; color:var(--story-blue); margin-bottom:10px; }
  .character-base-desc { font-size:13px; color:var(--muted); line-height:1.7; }

  /* CHARACTER TRAITS CARD â€” ìƒˆë¡œ ì¶”ê°€ */
  .character-traits-card { background:linear-gradient(135deg,#f0f4ff,#eaedff); border-radius:20px; padding:22px; border:1.5px solid var(--story-border); margin-bottom:14px; animation:popIn .5s .12s cubic-bezier(.34,1.56,.64,1) both; }
  .character-traits-title { font-family:'Noto Serif KR',serif; font-size:14px; font-weight:700; color:var(--story-blue); margin-bottom:14px; display:flex; align-items:center; gap:8px; }
  .trait-item { display:flex; gap:12px; align-items:flex-start; padding:12px 14px; background:white; border-radius:12px; margin-bottom:8px; border:1px solid rgba(100,130,220,.12); }
  .trait-item:last-child { margin-bottom:0; }
  .trait-icon { font-size:20px; flex-shrink:0; }
  .trait-text { font-size:13px; color:var(--dark); line-height:1.7; }
  .trait-text strong { color:var(--story-blue); font-weight:700; display:block; font-size:11px; margin-bottom:3px; letter-spacing:.5px; text-transform:uppercase; }

  /* STORY AI BOX */
  .story-ai-box { background:linear-gradient(135deg,#f0f4ff,#e8f0fe); border-radius:16px; padding:20px; border:1.5px solid var(--story-border); margin-bottom:14px; animation:popIn .5s .2s cubic-bezier(.34,1.56,.64,1) both; }
  .story-ai-box-title { font-family:'Noto Serif KR',serif; font-size:14px; font-weight:700; color:#3a56b0; margin-bottom:14px; display:flex; align-items:center; gap:8px; }
  .story-ai-content { font-size:13px; color:#2a3a6a; line-height:1.9; }
  .ai-section { margin-bottom:14px; padding-bottom:14px; border-bottom:1px dashed rgba(100,130,220,.2); }
  .ai-section:last-child { border-bottom:none; margin-bottom:0; padding-bottom:0; }
  .ai-section-title { font-size:11px; font-weight:700; color:#7a90cc; letter-spacing:1px; margin-bottom:8px; }
  .ai-tag { display:inline-block; margin:4px 3px 0; padding:3px 10px; background:rgba(100,130,220,.15); color:#3a56b0; border-radius:12px; font-size:11px; font-weight:600; }

  /* STORY RECAP */
  .story-recap-card { background:white; border-radius:20px; padding:20px; border:1px solid var(--story-border); box-shadow:0 4px 24px rgba(44,24,16,.05); margin-bottom:14px; animation:popIn .5s .28s cubic-bezier(.34,1.56,.64,1) both; }
  .recap-story { border-radius:12px; overflow:hidden; border:1px solid var(--story-border); }
  .recap-story-label { font-size:12px; font-weight:700; color:var(--dark); padding:9px 12px; background:rgba(44,24,16,.04); border-bottom:1px solid var(--story-border); }
  .recap-story-content { padding:12px 14px; font-size:13px; color:var(--muted); line-height:1.8; }

  /* LOADING DOTS */
  .loading-row { display:flex; align-items:center; gap:10px; color:var(--muted); font-size:12px; }
  .ai-dots { display:flex; gap:4px; }
  .ai-dots span { width:6px; height:6px; border-radius:50%; background:currentColor; animation:dotBounce 1.2s ease-in-out infinite; }
  .ai-dots span:nth-child(2){animation-delay:.2s;} .ai-dots span:nth-child(3){animation-delay:.4s;}
  @keyframes dotBounce{0%,80%,100%{transform:scale(.7);opacity:.5}40%{transform:scale(1);opacity:1}}

  .btn-to-phone { width:100%; padding:16px; border-radius:14px; border:none; background:linear-gradient(135deg,var(--caramel),var(--accent)); color:white; font-size:16px; font-weight:700; cursor:pointer; font-family:'Noto Serif KR',serif; box-shadow:0 6px 20px rgba(184,98,42,.3); transition:all .25s; margin-top:20px; animation:fadeUp .5s .5s ease both; opacity:0; animation-fill-mode:both; }
  .btn-to-phone:hover { transform:translateY(-2px); }

  /* PHONE */
  #page-phone { background:var(--cream); }
  .phone-wrap { max-width:480px; margin:0 auto; padding:60px 20px 80px; text-align:center; }
  .phone-emoji { font-size:56px; margin-bottom:20px; animation:popIn .6s cubic-bezier(.34,1.56,.64,1) both; }
  .phone-title { font-family:'Noto Serif KR',serif; font-size:26px; font-weight:900; color:var(--dark); margin-bottom:12px; }
  .phone-desc { font-size:14px; color:var(--muted); line-height:1.8; margin-bottom:32px; }
  .phone-input { width:100%; padding:16px 20px; border-radius:14px; border:2px solid var(--border); background:white; font-size:16px; color:var(--dark); font-family:'Noto Sans KR',sans-serif; outline:none; transition:border-color .2s; text-align:center; letter-spacing:1px; margin-bottom:12px; }
  .phone-input:focus { border-color:var(--toast); }
  .phone-skip { font-size:12px; color:var(--muted); text-decoration:underline; cursor:pointer; margin-bottom:20px; display:block; }
  .permission-row { display:flex; align-items:flex-start; gap:12px; padding:14px 16px; background:#F8F5F0; border-radius:12px; margin-bottom:24px; text-align:left; }
  .custom-cb { width:20px; height:20px; border:2px solid var(--border); border-radius:5px; flex-shrink:0; cursor:pointer; display:flex; align-items:center; justify-content:center; margin-top:1px; transition:all .2s; }
  .custom-cb.checked { background:var(--green); border-color:var(--green); }
  .custom-cb.checked::after { content:'âœ“'; color:white; font-size:12px; font-weight:700; }
  .permission-text { font-size:12px; color:var(--muted); line-height:1.6; }
  .permission-text strong { color:var(--dark); }
  .btn-finish { width:100%; padding:16px; border-radius:14px; border:none; background:linear-gradient(135deg,var(--caramel),var(--accent)); color:white; font-size:16px; font-weight:700; cursor:pointer; font-family:'Noto Serif KR',serif; box-shadow:0 6px 20px rgba(184,98,42,.3); transition:all .25s; }
  .btn-finish:hover { transform:translateY(-2px); }

  /* DONE */
  #page-done { background:var(--cream); }
  .done-wrap { max-width:480px; margin:0 auto; padding:80px 20px; text-align:center; }
  .done-emoji { font-size:64px; margin-bottom:24px; animation:popIn .6s cubic-bezier(.34,1.56,.64,1) both; }
  .done-title { font-family:'Noto Serif KR',serif; font-size:26px; font-weight:900; color:var(--dark); margin-bottom:12px; animation:fadeUp .6s .1s ease both; opacity:0; animation-fill-mode:both; }
  .done-desc { font-size:14px; color:var(--muted); line-height:1.9; margin-bottom:28px; animation:fadeUp .6s .2s ease both; opacity:0; animation-fill-mode:both; }
  .done-tag { display:inline-block; background:var(--dark); color:white; padding:10px 24px; border-radius:20px; font-size:13px; font-weight:500; animation:fadeUp .6s .3s ease both; opacity:0; animation-fill-mode:both; }

  /* DECO */
  .deco { position:fixed; font-size:28px; opacity:.06; pointer-events:none; z-index:0; animation:floatUp linear infinite; }
  @keyframes floatUp{0%{transform:translateY(100vh) rotate(0)}100%{transform:translateY(-100px) rotate(360deg)}}
  @keyframes fadeUp{from{opacity:0;transform:translateY(16px)}to{opacity:1;transform:translateY(0)}}
  @keyframes popIn{0%{transform:scale(.8);opacity:0}100%{transform:scale(1);opacity:1}}
  .fade-in{animation:fadeUp .35s ease both;}
</style>
</head>
<body>
<div class="deco" style="left:5%;animation-duration:18s;animation-delay:-3s">ğŸœ</div>
<div class="deco" style="left:85%;animation-duration:22s;animation-delay:-8s">ğŸ</div>
<div class="deco" style="left:55%;animation-duration:15s;animation-delay:-12s">ğŸ¥š</div>
<div class="deco" style="left:70%;animation-duration:19s;animation-delay:-15s">ğŸ§…</div>

<!-- SPLASH -->
<div class="page active" id="page-splash">
  <div class="splash-title">ì°í‘¸ë“œ!!<br><em>ë‹¹ì‹ ì˜ ìŒì‹ê³¼ ì°ì€??</em></div>
  <div class="splash-sub">ë‚˜ë¥¼ ë‹®ì€ ìŒì‹ ìºë¦­í„°ì™€ í•¨ê»˜ ì°ì„ í’€ì–´ë´ìš” ğŸ½ï¸</div>
  <div class="splash-chars">
    <div class="splash-char">
      <svg viewBox="0 0 72 80" xmlns="http://www.w3.org/2000/svg">
        <ellipse cx="36" cy="44" rx="26" ry="22" fill="#fff8f0"/>
        <rect x="10" y="38" width="52" height="16" rx="4" fill="#f9d0a0"/>
        <rect x="10" y="28" width="52" height="12" rx="4" fill="#fff"/>
        <rect x="10" y="20" width="52" height="10" rx="4" fill="#f9d0a0"/>
        <path d="M12 20 Q20 12 28 18 Q36 10 44 18 Q52 12 60 20" stroke="#fff" stroke-width="3" fill="none"/>
        <ellipse cx="24" cy="17" rx="5" ry="4" fill="#e8504a"/>
        <ellipse cx="36" cy="13" rx="5" ry="4" fill="#e8504a"/>
        <ellipse cx="48" cy="17" rx="5" ry="4" fill="#e8504a"/>
        <rect x="34" y="5" width="4" height="9" rx="2" fill="#f9c74f"/>
        <circle cx="28" cy="36" r="2" fill="#2c1810"/><circle cx="44" cy="36" r="2" fill="#2c1810"/>
        <path d="M30 41 Q36 46 42 41" stroke="#2c1810" stroke-width="1.5" fill="none" stroke-linecap="round"/>
        <line x1="10" y1="38" x2="2" y2="30" stroke="#2c1810" stroke-width="2" stroke-linecap="round"/>
        <line x1="62" y1="38" x2="70" y2="30" stroke="#2c1810" stroke-width="2" stroke-linecap="round"/>
        <line x1="28" y1="60" x2="24" y2="72" stroke="#2c1810" stroke-width="2" stroke-linecap="round"/>
        <line x1="44" y1="60" x2="48" y2="72" stroke="#2c1810" stroke-width="2" stroke-linecap="round"/>
      </svg>
      <span class="splash-char-name">ì¼€ì´í¬</span>
    </div>
    <div class="splash-char" style="animation-delay:.2s">
      <svg viewBox="0 0 72 80" xmlns="http://www.w3.org/2000/svg">
        <path d="M10 46 Q10 68 36 68 Q62 68 62 46 Z" fill="#2a1408"/>
        <path d="M12 46 Q12 64 36 64 Q60 64 60 46 Z" fill="#8db87a"/>
        <circle cx="36" cy="36" r="26" fill="#5c2e10"/>
        <circle cx="28" cy="34" r="2.5" fill="#1a0a04"/><circle cx="44" cy="34" r="2.5" fill="#1a0a04"/>
        <path d="M30 40 Q36 45 42 40" stroke="#1a0a04" stroke-width="1.8" fill="none" stroke-linecap="round"/>
        <line x1="10" y1="38" x2="2" y2="30" stroke="#2c1810" stroke-width="2" stroke-linecap="round"/>
        <line x1="62" y1="38" x2="70" y2="30" stroke="#2c1810" stroke-width="2" stroke-linecap="round"/>
        <line x1="28" y1="62" x2="24" y2="74" stroke="#2c1810" stroke-width="2" stroke-linecap="round"/>
        <line x1="44" y1="62" x2="48" y2="74" stroke="#2c1810" stroke-width="2" stroke-linecap="round"/>
      </svg>
      <span class="splash-char-name">ë‘ì«€ì¿ </span>
    </div>
    <div class="splash-char" style="animation-delay:.4s;margin-bottom:8px">
      <svg viewBox="0 0 72 80" xmlns="http://www.w3.org/2000/svg">
        <rect x="34" y="58" width="4" height="22" rx="2" fill="#8B6347"/>
        <ellipse cx="36" cy="56" rx="10" ry="10" fill="#e03c31"/>
        <ellipse cx="36" cy="40" rx="9" ry="9" fill="#7b4fa6"/>
        <ellipse cx="36" cy="26" rx="8" ry="8" fill="#f4a261"/>
        <circle cx="30" cy="40" r="2" fill="#2c1810"/><circle cx="42" cy="40" r="2" fill="#2c1810"/>
        <path d="M32 45 Q36 49 40 45" stroke="#2c1810" stroke-width="1.5" fill="none" stroke-linecap="round"/>
      </svg>
      <span class="splash-char-name">íƒ•í›„ë£¨</span>
    </div>
    <div class="splash-char" style="animation-delay:.6s">
      <svg viewBox="0 0 72 80" xmlns="http://www.w3.org/2000/svg">
        <path d="M10 52 Q10 70 36 70 Q62 70 62 52 Z" fill="#d4956a"/>
        <ellipse cx="36" cy="40" rx="26" ry="20" fill="#fdfaf6"/>
        <ellipse cx="36" cy="52" rx="26" ry="6" fill="#b8622a"/>
        <circle cx="28" cy="42" r="2" fill="#2c1810"/><circle cx="44" cy="42" r="2" fill="#2c1810"/>
        <path d="M30 48 Q36 53 42 48" stroke="#2c1810" stroke-width="1.5" fill="none" stroke-linecap="round"/>
        <line x1="10" y1="46" x2="2" y2="38" stroke="#2c1810" stroke-width="2" stroke-linecap="round"/>
        <line x1="62" y1="46" x2="70" y2="38" stroke="#2c1810" stroke-width="2" stroke-linecap="round"/>
        <line x1="28" y1="70" x2="24" y2="80" stroke="#2c1810" stroke-width="2" stroke-linecap="round"/>
        <line x1="44" y1="70" x2="48" y2="80" stroke="#2c1810" stroke-width="2" stroke-linecap="round"/>
      </svg>
      <span class="splash-char-name">ê³µê¹ƒë°¥</span>
    </div>
  </div>
  <button class="splash-btn" onclick="goTo('page-quiz')">ì‹œì‘í•˜ê¸° ğŸ½ï¸</button>
</div>

<!-- QUIZ -->
<div class="page" id="page-quiz">
  <div class="page-wrap">
    <div class="page-header">
      <div class="page-tag">ğŸ² STEP 1 / 2</div>
      <h2>ë‚˜ëŠ” ì–´ë–¤ <em>ìŒì‹</em>ì¼ê¹Œ?</h2>
      <p>7ê°€ì§€ ì§ˆë¬¸ì— ì†”ì§í•˜ê²Œ ë‹µí•´ì£¼ì„¸ìš”!</p>
    </div>
    <div class="quiz-card">
      <div class="quiz-progress" id="quiz-progress"></div>
      <div class="quiz-step-label" id="quiz-step-label"></div>
      <div id="quiz-body"></div>
    </div>
  </div>
</div>

<!-- STORY -->
<div class="page" id="page-story">
  <div class="page-wrap">
    <div class="page-header">
      <div class="page-tag">âœï¸ STEP 2 / 2</div>
      <h2>ë‹¹ì‹ ì˜ <em>ì°</em>ì„ í’€ì–´ë´ìš”</h2>
      <p>ì° ì† ìŒì‹ìœ¼ë¡œ ë‚˜ë§Œì˜ ìºë¦­í„°ê°€ íƒ„ìƒí•´ìš”!</p>
    </div>
    <div class="story-card">
      <div class="story-intro">ğŸ“¢ ì°ì— ë“±ì¥í•˜ëŠ” ìŒì‹ì„ ì•Œë ¤ì£¼ë©´, ê·¸ ìŒì‹ì´ ë‚˜ì˜ ìŒì‹ ìºë¦­í„°ê°€ ë¼ìš”!</div>
      <div class="story-field">
        <label>ğŸ½ï¸ ë‚´ ì°ì˜ ì£¼ì¸ê³µ ìŒì‹ì€? <span style="color:var(--accent)">*</span></label>
        <div style="position:relative">
          <input type="text" id="food-input" placeholder="ì˜ˆ) ë–¡ë³¶ì´, ì¹˜í‚¨, ë¼ë©´, ì‚¼ê²¹ì‚´..."
            style="width:100%;padding:14px 16px;border-radius:12px;border:2px solid var(--border);background:#FDFAF6;font-size:15px;color:var(--dark);font-family:'Noto Sans KR',sans-serif;outline:none;transition:border-color .2s;"
            oninput="this.style.borderColor=this.value.trim()?'var(--caramel)':'var(--border)'"
            onfocus="this.style.borderColor='var(--toast)'"
            onblur="this.style.borderColor=this.value.trim()?'var(--caramel)':'var(--border)'">
          <span style="position:absolute;right:14px;top:50%;transform:translateY(-50%);font-size:22px">ğŸ½ï¸</span>
        </div>
        <p style="font-size:11px;color:var(--muted);margin-top:6px;padding-left:2px">ì´ ìŒì‹ìœ¼ë¡œ ê·€ì—¬ìš´ ìºë¦­í„°ë¥¼ AIê°€ ê·¸ë ¤ë“œë ¤ìš” ğŸ¨</p>
      </div>
      <div class="theme-label">ì°ì˜ ì£¼ì œë¥¼ ê³¨ë¼ì£¼ì„¸ìš”</div>
      <div class="theme-chips">
        <button class="theme-chip" onclick="toggleChip(this)">ğŸ’˜ ì—°ì•  ì°</button>
        <button class="theme-chip" onclick="toggleChip(this)">âœ‚ï¸ ì¸ê°„ê´€ê³„ ì°</button>
        <button class="theme-chip" onclick="toggleChip(this)">ğŸ˜µ ì§ì¥/í•™êµ ì°</button>
        <button class="theme-chip" onclick="toggleChip(this)">ğŸ‘¨â€ğŸ‘©â€ğŸ‘§ ê°€ì¡± ì°</button>
        <button class="theme-chip" onclick="toggleChip(this)">ğŸ›ï¸ í‘ì—­ì‚¬ ì°</button>
        <button class="theme-chip" onclick="toggleChip(this)">â˜€ï¸ ì¼ìƒ ì°</button>
      </div>
      <div class="story-field">
        <label>ì°ì„ ì ì–´ì£¼ì„¸ìš”</label>
        <textarea id="story-text" placeholder="ì˜ˆ) ì·¨ì—… ì¤€ë¹„ 3ë…„ì§¸ì¸ë°, ë§¤ì¼ ë°¤ ì–´ë¨¸ë‹ˆê°€ ë“ì—¬ì£¼ì‹œëŠ” ë¼ë©´ì´ ì œ ìœ ì¼í•œ ìœ„ë¡œì˜ˆìš”..." oninput="updateCount(this,'story-count',300)"></textarea>
        <span class="char-count"><span id="story-count">0</span>/300</span>
      </div>
      <div class="temp-label">ì´ ì°ì˜ ê°ì • ì˜¨ë„ëŠ”? ğŸŒ¡ï¸</div>
      <div class="temp-track">
        <span class="temp-end">ğŸ˜¢ ì°¨ê°‘ê²Œ</span>
        <div class="temp-btns" id="temp-btns"></div>
        <span class="temp-end">ëœ¨ê²ê²Œ ğŸ˜Š</span>
      </div>
      <button class="btn-submit" onclick="goToResult()">ğŸ½ï¸ ë‚´ ìŒì‹ ìºë¦­í„° ë³´ê¸°</button>
    </div>
  </div>
</div>

<!-- RESULT -->
<div class="page" id="page-result">
  <div class="result-wrap">
    <div id="result-loading-screen" class="result-loading-screen">
      <div class="big-spinner"></div>
      <p>ì„±í–¥ ë¶„ì„ + ìºë¦­í„° ìƒì„± ì¤‘...<br><span style="font-size:12px;opacity:.6">ê°ê´€ì‹ 7ê°œ + ì° ë¶„ì„ ì¤‘</span></p>
    </div>

    <div id="result-content" style="display:none">

      <!-- â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
           ìƒë‹¨ BLOCK: ê°ê´€ì‹ 7ê°œ ì„±í–¥ ë¶„ì„
      â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â• -->
      <div class="result-section-header">
        <div class="result-badge warm">ğŸ² ì„±í–¥ í…ŒìŠ¤íŠ¸ ê²°ê³¼</div>
        <div class="result-section-title">7ê°œ ì§ˆë¬¸ìœ¼ë¡œ ì•Œì•„ë³´ëŠ” ë‚˜ì˜ ìŒì‹ ì„±í–¥</div>
      </div>

      <!-- ì„±í–¥ íƒ€ì… ë©”ì¸ ì¹´ë“œ -->
      <div class="personality-card">
        <span class="personality-emoji" id="personality-emoji"></span>
        <div class="personality-food-type" id="personality-food-type"></div>
        <div class="personality-type-tag" id="personality-type-tag"></div>
        <div class="personality-desc" id="personality-desc"></div>
      </div>

      <!-- ì„±í–¥ AI ë¶„ì„ -->
      <div class="quiz-ai-box">
        <div class="quiz-ai-box-title">ğŸ” ì„±í–¥ ìƒì„¸ ë¶„ì„</div>
        <div class="loading-row" id="quiz-ai-loading">
          <div class="ai-dots"><span></span><span></span><span></span></div>
          <span>ì„±í–¥ íŒ¨í„´ ë¶„ì„ ì¤‘...</span>
        </div>
        <div class="quiz-ai-content" id="quiz-ai-content" style="display:none"></div>
      </div>

      <!-- ê°ê´€ì‹ ë‹µë³€ ë¦¬ìº¡ -->
      <div class="quiz-recap-card">
        <div class="recap-title">ğŸ“‹ ë‚´ê°€ ê³ ë¥¸ 7ê°€ì§€ ë‹µë³€</div>
        <div id="quiz-recap-body"></div>
      </div>

      <!-- â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
           êµ¬ë¶„ì„ 
      â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â• -->
      <div class="section-divider">
        <div class="section-divider-line"></div>
        <div class="section-divider-label">âœ¦ ë‚˜ì˜ ìŒì‹ ìºë¦­í„° âœ¦</div>
        <div class="section-divider-line"></div>
      </div>

      <!-- â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
           í•˜ë‹¨ BLOCK: ì° ê¸°ë°˜ ìºë¦­í„° ê²°ê³¼
      â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â• -->
      <div class="result-section-header">
        <div class="result-badge cool">ğŸ½ï¸ ì° ì† ìŒì‹ ìºë¦­í„°</div>
        <div class="result-section-title">ì° ì† ìŒì‹ì´ ë‚˜ë§Œì˜ ìºë¦­í„°ê°€ ëì–´ìš”</div>
      </div>

      <!-- ìºë¦­í„° ì´ë¯¸ì§€ + ê¸°ë³¸ ì •ë³´ -->
      <div class="character-card">
        <div class="character-card-inner">
          <div class="char-img-wrap" id="char-img-wrap">
            <div class="char-loading-inner" id="char-loading-inner">
              <div class="small-spinner"></div>
              <p>ìºë¦­í„°<br>ìƒì„± ì¤‘...</p>
            </div>
            <img class="char-img" id="char-img" src="" alt="" style="display:none">
          </div>
          <div class="character-info">
            <div class="character-food-name" id="char-food-name"></div>
            <div class="character-sub-tag" id="char-sub-tag"></div>
            <div class="character-base-desc" id="char-base-desc"></div>
          </div>
        </div>
      </div>

      <!-- ğŸ†• ìºë¦­í„° íŠ¹ì§• ì¹´ë“œ -->
      <div class="character-traits-card">
        <div class="character-traits-title">âœ¨ ì´ ìºë¦­í„°ëŠ” ì´ëŸ° íŠ¹ì§•ì„ ê°€ì§€ê³  ìˆì–´ìš”!</div>
        <div class="loading-row" id="char-traits-loading">
          <div class="ai-dots"><span></span><span></span><span></span></div>
          <span>ìºë¦­í„° íŠ¹ì§• ë¶„ì„ ì¤‘...</span>
        </div>
        <div id="char-traits-content" style="display:none"></div>
      </div>

      <!-- ì° ì‹¬ì¸µ ë¶„ì„ -->
      <div class="story-ai-box">
        <div class="story-ai-box-title">ğŸ¤– ì° ì‹¬ì¸µ ë¶„ì„</div>
        <div class="loading-row" id="story-ai-loading">
          <div class="ai-dots"><span></span><span></span><span></span></div>
          <span>ì°ì„ ë¶„ì„í•˜ëŠ” ì¤‘...</span>
        </div>
        <div class="story-ai-content" id="story-ai-content" style="display:none"></div>
      </div>

      <!-- ì° ë‚´ìš© ë¦¬ìº¡ -->
      <div class="story-recap-card" id="story-recap-card" style="display:none">
        <div class="recap-title">âœï¸ ë‚´ê°€ ì“´ ì°</div>
        <div class="recap-story">
          <div class="recap-story-content" id="story-recap-content"></div>
        </div>
      </div>

      <button class="btn-to-phone" onclick="goTo('page-phone')">ğŸ“± ì—°ë½ì²˜ ë‚¨ê¸°ê¸°</button>
      <div style="text-align:center;margin-top:14px">
        <button onclick="restartAll()" style="padding:9px 22px;border-radius:20px;border:1.5px solid var(--toast);background:transparent;color:var(--toast);font-size:13px;cursor:pointer;font-family:'Noto Sans KR',sans-serif;">â†© ì²˜ìŒë¶€í„° ë‹¤ì‹œ</button>
      </div>
    </div>
  </div>
</div>

<!-- PHONE -->
<div class="page" id="page-phone">
  <div class="phone-wrap">
    <div class="phone-emoji">ğŸ“±</div>
    <div class="phone-title">ë§ˆì§€ë§‰ìœ¼ë¡œ<br>ì—°ë½ì²˜ë¥¼ ë‚¨ê²¨ì£¼ì„¸ìš”!</div>
    <div class="phone-desc">ë‹¹ì‹ ì˜ ì°ì´ ì›¹íˆ°ìœ¼ë¡œ ì œì‘ë  ê²½ìš°<br>ê°€ì¥ ë¨¼ì € ì—°ë½ë“œë¦´ê²Œìš” ğŸ¨<br><span style="font-size:12px;opacity:.7">(ì„ íƒ ì‚¬í•­ì´ì—ìš”)</span></div>
    <input type="tel" class="phone-input" id="phone-input" placeholder="010-0000-0000" inputmode="numeric" oninput="formatPhone(this)">
    <span class="phone-skip" onclick="goTo('page-done')">ê±´ë„ˆë›°ê¸°</span>
    <div class="permission-row">
      <div class="custom-cb" id="consent-cb" onclick="toggleConsent()"></div>
      <div class="permission-text"><strong>ì‚¬ì—° ë° ì—°ë½ì²˜ í™œìš©ì— ë™ì˜í•©ë‹ˆë‹¤.</strong><br>ì œì¶œëœ ë‚´ìš©ì€ ì›¹íˆ° ìŠ¤í† ë¦¬ ì œì‘ì— ì°¸ê³ ë  ìˆ˜ ìˆìœ¼ë©°, ì‹¤ëª…/ê°œì¸ì •ë³´ëŠ” ê³µê°œë˜ì§€ ì•ŠìŠµë‹ˆë‹¤.</div>
    </div>
    <button class="btn-finish" onclick="submitPhone()">ğŸ½ï¸ ì™„ë£Œí•˜ê¸°</button>
  </div>
</div>

<!-- DONE -->
<div class="page" id="page-done">
  <div class="done-wrap">
    <div class="done-emoji">ğŸ«¶</div>
    <div class="done-title">ê³ ë§ˆì›Œìš”, ì†Œì¤‘í•œ ì°!</div>
    <div class="done-desc">ë‹¹ì‹ ì˜ ì´ì•¼ê¸°ê°€ ë”°ëœ»í•œ ìŒì‹ ìºë¦­í„°ë¡œ<br>ë‹¤ì‹œ ì„¸ìƒì— ë‚˜ì˜¬ ë‚ ì„ ê¸°ë‹¤ë ¤ì£¼ì„¸ìš”.<br><br>ì°í‘¸ë“œê°€ ì‘ì›í• ê²Œìš” ğŸ½ï¸</div>
    <div class="done-tag">#ì°í‘¸ë“œ #ë‹¹ì‹ ì˜ìŒì‹ê³¼ì°ì€</div>
  </div>
</div>

<script>
// â”€â”€ NAV â”€â”€
function goTo(id){document.querySelectorAll('.page').forEach(p=>p.classList.remove('active'));document.getElementById(id).classList.add('active');window.scrollTo(0,0);}
function restartAll(){answers=[];answerLabels=[];currentQ=0;selectedIdx=null;initQuiz();initTempBtns();document.getElementById('food-input').value='';document.getElementById('story-text').value='';document.getElementById('story-count').textContent='0';goTo('page-quiz');}

// â”€â”€ QUIZ DATA â”€â”€
const questions=[
  {q:"ì§€ê¸ˆ ë‹¹ì¥ ë¨¹ê³  ì‹¶ì€ ê±´?",opts:[{e:"ğŸŒ¶ï¸",t:"ë§¤ì½¤í•œ ê±°",score:{A:2}},{e:"ğŸ°",t:"ë‹¬ë‹¬í•œ ê±°",score:{B:2}},{e:"ğŸ§‚",t:"ì§­ì§¤í•œ ê±°",score:{C:2}},{e:"ğŸ²",t:"ëœ¨ëˆí•œ êµ­ë¬¼",score:{D:2}}]},
  {q:"ë„ˆëŠ” ì–´ë–¤ \"ë¼\"ì•¼?",opts:[{e:"ğŸ•",t:"ì„¸ë¼ â€” ê·œì¹™ì ì´ê³  ë£¨í‹´ ìˆëŠ” ìƒí™œ",score:{C:2}},{e:"ğŸ•‘",t:"ë‘ë¼ â€” ë°”ì˜ì§€ë§Œ ì±™ê¸¸ ê±´ ì±™ê¹€",score:{B:2}},{e:"ğŸ•’",t:"í•œë¼ â€” ì •ì‹ ì—†ì´ í•˜ë£¨ ë³´ëƒ„",score:{A:2}},{e:"ğŸ’¨",t:"ë–¼ë¼ â€” ëŒ€ì¶© ë•Œìš°ëŠ” ìš”ì¦˜",score:{D:2}}]},
  {q:"ë°°ê³ í”„ë©´ ë‚˜ëŠ”?",opts:[{e:"ğŸ˜¤",t:"ì˜ˆë¯¼í•´ì§",score:{A:2}},{e:"ğŸ¤",t:"ì¡°ìš©í•´ì§",score:{B:2}},{e:"ğŸ—£ï¸",t:"ì•„ë¬´ ë§ì´ë‚˜ í•¨",score:{C:2}},{e:"ğŸ´",t:"ê·¸ëƒ¥ ì•„ë¬´ê±°ë‚˜ ë¨¹ìŒ",score:{D:2}}]},
  {q:"ì¹œêµ¬ë‘ ë©”ë‰´ ê³ ë¥¼ ë•Œ ë‚˜ëŠ”?",opts:[{e:"ğŸ‘†",t:"ë‚´ê°€ ì •í•¨",score:{A:2}},{e:"ğŸ™ƒ",t:"\"ì•„ë¬´ê±°ë‚˜\" í•´ë†“ê³  ê²°êµ­ ì˜ê²¬ ëƒ„",score:{B:2}},{e:"ğŸ«¶",t:"ìƒëŒ€ ì˜ê²¬ ì¡´ì¤‘",score:{C:2}},{e:"ğŸ’­",t:"ì†ìœ¼ë¡œ ë”´ ë©”ë‰´ ìƒê°í•¨",score:{D:2}}]},
  {q:"ì—°ì• ë¥¼ ìŒì‹ì— ë¹„ìœ í•˜ë©´?",opts:[{e:"ğŸ«•",t:"ë§ˆë¼íƒ• (ì¤‘ë…ì ì´ê³  ìê·¹ì )",score:{A:3}},{e:"ğŸ‚",t:"ì¼€ì´í¬ (ê¸°ë…ì¼ ë§ê³  ë‹¬ë‹¬)",score:{B:3}},{e:"ğŸ·",t:"ì™€ì¸ (ì‹œê°„ ì§€ë‚˜ì•¼ ê¹Šì–´ì§)",score:{C:3}},{e:"ğŸ”º",t:"ì‚¼ê°ê¹€ë°¥ (ê°‘ìê¸° ì‹œì‘, ê°‘ìê¸° ë)",score:{D:3}}]},
  {q:"ìŠ¤íŠ¸ë ˆìŠ¤ ë°›ì„ ë•Œ ë‹¹ì‹ ì€?",opts:[{e:"ğŸ”¥",t:"ë§¤ìš´ ê±°ë¡œ í’€ì–´ë²„ë¦°ë‹¤",score:{A:2}},{e:"ğŸ«",t:"ë‹¬ë‹¬í•œ ë””ì €íŠ¸ ì°¾ëŠ”ë‹¤",score:{B:2}},{e:"âš¡",t:"ê·¸ëƒ¥ ì•„ë¬´ê±°ë‚˜ ë¹¨ë¦¬ ë¨¹ëŠ”ë‹¤",score:{C:2}},{e:"ğŸš«",t:"ì•„ì˜ˆ ì•ˆ ë¨¹ëŠ”ë‹¤",score:{D:2}}]},
  {q:"ìš”ì¦˜ ë‚´ê°€ ë§ì´ í‘¸ëŠ” ì°ì€?",opts:[{e:"ğŸ’˜",t:"ë§¤ìš´ ì—°ì•  ì°",score:{A:3}},{e:"âœ‚ï¸",t:"ì¹œêµ¬ ì†ì ˆ ì°",score:{D:3}},{e:"ğŸ˜µ",t:"ìŠ¤íŠ¸ë ˆìŠ¤ì¸ íšŒì‚¬/í•™êµ ì°",score:{C:3}},{e:"ğŸ›ï¸",t:"ì´ë¶ˆí‚¥ í‘ì—­ì‚¬ ì°",score:{B:3}}]},
];
const scoreResults=[
  {type:"A",e:"ğŸŒ¶ï¸",food:"ë§ˆë¼íƒ•",desc:"ìê·¹ì ì´ê³  ê°•ë ¬í•œ ë§¤ë ¥ì˜ ì†Œìœ ì! í•œ ë²ˆ ë¹ ì§€ë©´ ëª» í—¤ì–´ë‚˜ì˜¤ëŠ” ì¤‘ë…ì ì¸ ì¡´ì¬ì˜ˆìš”. ë‹¤ìŒì— ë˜ ì°¾ê²Œ ë˜ëŠ” ì‚¬ëŒ.",tag:"#ì¤‘ë…ì£¼ì˜ #ìê·¹ë‚¨ì_ìê·¹ì—¬ì"},
  {type:"B",e:"ğŸ‚",food:"ë”¸ê¸° ì¼€ì´í¬",desc:"ë‹¬ë‹¬í•˜ê³  ì‚¬ë‘ìŠ¤ëŸ¬ìš´ ì—ë„ˆì§€ë¥¼ ê°€ì§„ ì‚¬ëŒ. íŠ¹ë³„í•œ ìˆœê°„ë§ˆë‹¤ ìƒê°ë‚˜ëŠ”, ì†Œì¤‘í•œ ë‚ ì˜ ì£¼ì¸ê³µ ê°™ì€ ì¡´ì¬ì˜ˆìš”.",tag:"#ë‹¬ë‹¬í•¨ì£¼ì˜ #ê¸°ë…ì¼ì¥ì¸"},
  {type:"C",e:"ğŸ·",food:"ì™€ì¸",desc:"ì²˜ìŒì—” ë‚¯ì„¤ì§€ë§Œ ì•Œì•„ê°ˆìˆ˜ë¡ ê¹Šì–´ì§€ëŠ” ì‚¬ëŒ. ì„£ë¶ˆë¦¬ íŒë‹¨í•˜ë©´ ì†í•´ì˜ˆìš”. ì‹œê°„ì´ ì§€ë‚ ìˆ˜ë¡ ì§„ê°€ê°€ ë“œëŸ¬ë‚©ë‹ˆë‹¤.",tag:"#ìˆ™ì„±í˜•ì¸ê°„ #ì²œì²œíˆì•Œì•„ê°€ì"},
  {type:"D",e:"ğŸ²",food:"í•´ì¥êµ­",desc:"í˜ë“  ë‚  ê°€ì¥ ë¨¼ì € ìƒê°ë‚˜ëŠ” ì‚¬ëŒ. ë§ ì—†ì–´ë„ ê³ì— ìˆìœ¼ë©´ ë“ ë“ í•˜ê³ , ê±°ì°½í•˜ì§€ ì•Šì•„ë„ ì§„ì‹¬ì´ ëŠê»´ì§€ëŠ” ì¡´ì¬ì˜ˆìš”.",tag:"#ì§„êµ­ì¸ìƒ #ìˆì–´ì•¼ì™„ì„±"},
];
let answers=[],answerLabels=[],currentQ=0,selectedIdx=null;

function initQuiz(){answers=[];answerLabels=[];currentQ=0;selectedIdx=null;renderProgress();renderQuestion();}
function renderProgress(){const p=document.getElementById('quiz-progress');p.innerHTML='';questions.forEach((_,i)=>{const d=document.createElement('div');d.className='quiz-dot'+(i===currentQ?' active':i<currentQ?' done':'');p.appendChild(d);});document.getElementById('quiz-step-label').textContent=`${currentQ+1} / ${questions.length}`;}
function renderQuestion(){const q=questions[currentQ];const isLast=currentQ===questions.length-1;document.getElementById('quiz-body').innerHTML=`<div class="quiz-question fade-in">${q.q}</div><div class="quiz-options fade-in">${q.opts.map((o,i)=>`<button class="quiz-option" onclick="selectOption(${i},this)"><span class="opt-emoji">${o.e}</span>${o.t}</button>`).join('')}</div><div id="next-wrap" style="display:none"><button class="btn-next" onclick="goNext()">${isLast?'ì° ì…ë ¥í•˜ê¸° âœï¸':'ë‹¤ìŒ ì§ˆë¬¸ â†’'}</button></div>`;}
function selectOption(idx,btn){document.querySelectorAll('.quiz-option').forEach(b=>b.classList.remove('selected'));btn.classList.add('selected');selectedIdx=idx;document.getElementById('next-wrap').style.display='block';}
function goNext(){if(selectedIdx===null)return;const q=questions[currentQ];answers.push(q.opts[selectedIdx].score);answerLabels.push({q:q.q,opts:q.opts,chosen:selectedIdx});selectedIdx=null;currentQ++;if(currentQ>=questions.length)goTo('page-story');else{renderProgress();renderQuestion();}}

// â”€â”€ STORY UTILS â”€â”€
function toggleChip(btn){btn.classList.toggle('active');}
function updateCount(el,id,max){const len=Math.min(el.value.length,max);document.getElementById(id).textContent=len;if(el.value.length>max)el.value=el.value.substring(0,max);}
function initTempBtns(){const c=document.getElementById('temp-btns');c.innerHTML='';for(let i=1;i<=5;i++){const b=document.createElement('button');b.className='temp-btn';b.textContent=i;b.onclick=()=>{document.querySelectorAll('.temp-btn').forEach(x=>x.classList.remove('active'));b.classList.add('active');};c.appendChild(b);}}

// â”€â”€ NETLIFY FUNCTIONS API (API í‚¤ëŠ” ì„œë²„ì—ì„œë§Œ ì‚¬ìš©) â”€â”€
// ë¡œì»¬: http://localhost:8888/api/gemini
// ë°°í¬: https://your-site.netlify.app/api/gemini
const API_BASE = '/api';

const FOOD_HINTS={'ë–¡ë³¶ì´':'glossy red gochujang-coated cylindrical rice cakes, bright red sauce','ë¼ë©´':'wavy yellow instant noodles, red soup base, floating green onion','ì¹˜í‚¨':'golden-brown crispy fried chicken, crunchy breading','ì‚¼ê²¹ì‚´':'thick grilled pork belly slices with fat layers, charred grill marks','í”¼ì':'round pizza with thick melted cheese, red tomato sauce','í–„ë²„ê±°':'tall stacked burger with sesame bun, lettuce, tomato, beef patty','ì´ˆë°¥':'nigiri sushi with salmon or tuna on white rice','ë§ˆë¼íƒ•':'deep red spicy broth with chili peppers, heavy red oil sheen','ì¼€ì´í¬':'layered cake with pink strawberry cream frosting, whole strawberries','ì•„ì´ìŠ¤í¬ë¦¼':'soft-serve ice cream swirl in a cone, pastel colors','ë„ë„›':'ring-shaped donut with pink glaze and rainbow sprinkles','ê¹€ë°¥':'cylindrical gimbap sliced showing colorful cross-section','ë§Œë‘':'plump pleated dumpling with pinched folds','ì§œì¥ë©´':'black bean paste noodles with dark brown glossy sauce, julienned cucumber'};

function getFoodHint(n){if(FOOD_HINTS[n])return FOOD_HINTS[n];for(const[k,v]of Object.entries(FOOD_HINTS)){if(n.includes(k)||k.includes(n))return v;}return`recognizable Korean dish called "${n}" showing its most distinctive colors, textures, shape`;}

// ì´ë¯¸ì§€ ìƒì„± â†’ /api/gemini-image í˜¸ì¶œ
async function generateCharImage(foodName){
  const prompt=`Create a cute kawaii chibi food character illustration on pure white background. The character body IS a ${foodName}. Visual: ${getFoodHint(foodName)}. Make it INSTANTLY RECOGNIZABLE. Add: two tiny black dot eyes, small curved smile, thin stick arms and legs. Style: clean flat illustration like Kakao Friends. Pure white background, no text, no shadows, centered.`;
  try{
    const r=await fetch(`${API_BASE}/gemini-image`,{
      method:'POST',
      headers:{'Content-Type':'application/json'},
      body:JSON.stringify({prompt})
    });
    if(!r.ok) throw new Error(`status ${r.status}`);
    const d=await r.json();
    if(d.imageData) return `data:${d.mimeType};base64,${d.imageData}`;
  }catch(e){console.warn('[image]',e);}
  throw new Error('ì´ë¯¸ì§€ ìƒì„± ì‹¤íŒ¨');
}

// í…ìŠ¤íŠ¸ ë¶„ì„ â†’ /api/gemini í˜¸ì¶œ
async function callGemini(prompt,maxTokens=500){
  try{
    const r=await fetch(`${API_BASE}/gemini`,{
      method:'POST',
      headers:{'Content-Type':'application/json'},
      body:JSON.stringify({prompt,maxTokens,temperature:0.9})
    });
    if(!r.ok) throw new Error(`status ${r.status}`);
    const d=await r.json();
    return d.text||null;
  }catch(e){
    console.warn('[text]',e);
    return null;
  }
}

function getField(text,key){const m=text.match(new RegExp(key+':\\s*(.+?)(?=\\n[ê°€-í£A-Za-z0-9]+:|$)','s'));return m?m[1].trim().replace(/\n/g,' '):'';}

// â”€â”€ QUIZ ANALYSIS â”€â”€
async function doQuizAnalysis(answerLabels,res){
  const chosenList=answerLabels.map((item,qi)=>{const c=item.opts[item.chosen];return`Q${qi+1}. ${item.q} â†’ ${c.e} ${c.t}`;}).join('\n');
  const prompt=`í•œêµ­ MBTI ë¶„ì„ê°€ë¡œì„œ ì¬ì¹˜ìˆëŠ” ì„±í–¥ ë¶„ì„ì„ ì¨ì£¼ì„¸ìš”. ì¹œê·¼í•œ ì¡´ëŒ“ë§ë¡œ í†µì¼.

[ì„±í–¥ ìœ í˜•] ${res.food} íƒ€ì… (${res.tag})
[ë‹µë³€]
${chosenList}

ì¶œë ¥ í˜•ì‹ (ë¼ë²¨ ê·¸ëŒ€ë¡œ):
í•œì¤„ìš”ì•½: [ìŒì‹ íƒ€ì…ìœ¼ë¡œ ì••ì¶•í•œ í•œ ì¤„, ì´ëª¨ì§€ 1~2ê°œ]
íŠ¹ì§•1: [í–‰ë™ íŒ¨í„´. "~í•˜ëŠ” íƒ€ì…ì´ì—ìš”" í˜•íƒœ]
íŠ¹ì§•2: [ê´€ê³„ì—ì„œ ë“œëŸ¬ë‚˜ëŠ” íŠ¹ì„±. ìƒí™© ë¬˜ì‚¬ í¬í•¨]
íŠ¹ì§•3: [ìŠ¤ìŠ¤ë¡œ ëª¨ë¥´ëŠ” ë§¤ë ¥ í¬ì¸íŠ¸]
ê²°ì •ì í•œë§ˆë””: [ë”°ëœ»í•œ í•œë§ˆë””]
íƒœê·¸: #íƒœê·¸1 #íƒœê·¸2 #íƒœê·¸3 #íƒœê·¸4

ê° í•­ëª© 1~2ë¬¸ì¥. íƒœê·¸ëŠ” ì‹ ì¡°ì–´/ë°ˆ ìŠ¤íƒ€ì¼.`;
  return await callGemini(prompt,500);
}

// â”€â”€ CHARACTER TRAITS â”€â”€
async function doCharTraits(foodName,res,story){
  const prompt=`ê·€ì—¬ìš´ ìŒì‹ ìºë¦­í„° ë””ìì´ë„ˆë¡œì„œ "${foodName}" ìºë¦­í„°ì˜ íŠ¹ì§• 3ê°€ì§€ë¥¼ ì•Œë ¤ì£¼ì„¸ìš”.
ì´ ì‚¬ëŒ ì„±í–¥: "${res.food} íƒ€ì…" (${res.tag})${story?`\nì° ë‚´ìš©: "${story.slice(0,100)}"` :''}

ì¶œë ¥ í˜•ì‹ (ë¼ë²¨ ê·¸ëŒ€ë¡œ):
íŠ¹ì§•1ì œëª©: [3~5ê¸€ì ì§§ì€ ì œëª©]
íŠ¹ì§•1ë‚´ìš©: [${foodName}ì˜ ì‹¤ì œ ë§›/ì§ˆê°/íŠ¹ì„±ê³¼ ì´ ì‚¬ëŒ ì„±í–¥ ì—°ê²°. ê·€ì—½ê³  ë”°ëœ»í•˜ê²Œ. ì´ëª¨ì§€ 1ê°œ í¬í•¨. 1~2ë¬¸ì¥]

íŠ¹ì§•2ì œëª©: [ì œëª©]
íŠ¹ì§•2ë‚´ìš©: [ë‹¤ë¥¸ ê°ë„ì˜ íŠ¹ì§•]

íŠ¹ì§•3ì œëª©: [ì œëª©]
íŠ¹ì§•3ë‚´ìš©: [ì„¸ ë²ˆì§¸ íŠ¹ì§•]

ì¹œê·¼í•œ ì¡´ëŒ“ë§ ì‚¬ìš©.`;
  return await callGemini(prompt,400);
}

// â”€â”€ STORY ANALYSIS â”€â”€
async function doStoryAnalysis(res,story,foodName){
  if(!story)return null;
  const prompt=`ìŒì‹ ì¹¼ëŸ¼ë‹ˆìŠ¤íŠ¸ë¡œì„œ ì°ì„ ë¶„ì„í•´ì£¼ì„¸ìš”. ì¹œê·¼í•œ ì¡´ëŒ“ë§.

[ì„±í–¥] ${res.food} íƒ€ì…
[ìŒì‹] ${foodName}
[ì°] "${story}"

ì¶œë ¥ í˜•ì‹:
ìŒì‹ë¶„ì„: [ì™œ "${foodName}"ì„ ì°ì˜ ì£¼ì¸ê³µìœ¼ë¡œ ì„ íƒí–ˆëŠ”ì§€ ì‹¬ë¦¬. ìŒì‹ íŠ¹ì„±ê³¼ ì° ì—°ê²°]
ì°í•œì¤„: [ì´ ì°ì„ ë”°ëœ»í•˜ê²Œ í•œ ì¤„ ìš”ì•½. ì´ëª¨ì§€ 1ê°œ]
ê²°ì •ì í•œë§ˆë””: [ì´ ì‚¬ëŒì—ê²Œ í•´ì£¼ê³  ì‹¶ì€ ìœ„ë¡œ/ê³µê°ì˜ ë§]
íƒœê·¸: #íƒœê·¸1 #íƒœê·¸2 #íƒœê·¸3

ê° í•­ëª© 1~2ë¬¸ì¥.`;
  return await callGemini(prompt,350);
}

// â”€â”€ RENDER â”€â”€
function renderQuizAI(text,res){
  const hl=getField(text,'í•œì¤„ìš”ì•½')||`${res.food} íƒ€ì…ì˜ ë…ë³´ì ì¸ ë‹¹ì‹  âœ¨`;
  const traits=[getField(text,'íŠ¹ì§•1'),getField(text,'íŠ¹ì§•2'),getField(text,'íŠ¹ì§•3')].filter(Boolean);
  if(!traits.length)traits.push('ì½ì„ìˆ˜ë¡ ê³µê° ê°€ëŠ” ì„±í–¥ì´ì—ìš”.','ì£¼ë³€ì´ ë¨¼ì € ì•Œì•„ë³´ëŠ” ìˆ¨ì€ ë§¤ë ¥ì´ ìˆì–´ìš”.','ìê¸° ìì‹ ì„ ì˜ ì•„ëŠ” ì‚¬ëŒì´ì—ìš”.');
  const reason=getField(text,'ê²°ì •ì í•œë§ˆë””')||`${res.food}ì²˜ëŸ¼ ì•Œê³  ë³´ë©´ ë” ê¹Šì–´ì§€ëŠ” ì‚¬ëŒì´ì—ìš”.`;
  const tagStr=getField(text,'íƒœê·¸');
  const tags=(tagStr.match(/#[^\s#]+/g)||[]).slice(0,4);
  if(!tags.length)tags.push('#ë‚˜ë‹¤ìš´ì°','#ì°í‘¸ë“œ','#ì°ë¶„ì„','#ìŒì‹ì„±í–¥');
  return `<div class="q-ai-section"><div class="q-ai-section-title">âœ¦ í•œì¤„ ìš”ì•½</div><p style="font-weight:700;font-size:15px;color:var(--dark);line-height:1.6">${hl}</p></div>
<div class="q-ai-section"><div class="q-ai-section-title">âœ¦ ì´ëŸ° ì‚¬ëŒì´ì—ìš”</div>${traits.map(t=>`<p style="margin-bottom:8px;padding-left:12px;border-left:2px solid rgba(212,149,106,.3)">â€¢ ${t}</p>`).join('')}</div>
<div class="q-ai-section"><div class="q-ai-section-title">âœ¦ ê²°ì •ì  í•œë§ˆë””</div><p style="font-size:14px;font-weight:600;color:var(--dark);border-left:3px solid var(--toast);padding:10px 12px;background:rgba(212,149,106,.07);border-radius:0 8px 8px 0;line-height:1.7">"${reason}"</p></div>
<div style="margin-top:4px">${tags.map(t=>`<span class="q-ai-tag">${t}</span>`).join('')}</div>`;
}

function renderTraits(text,foodName){
  const icons=['ğŸŒŸ','ğŸ’«','âœ¨'];
  let html='';
  for(let i=1;i<=3;i++){
    const title=getField(text,`íŠ¹ì§•${i}ì œëª©`)||`íŠ¹ì§• ${i}`;
    const content=getField(text,`íŠ¹ì§•${i}ë‚´ìš©`)||`${foodName} ìºë¦­í„°ë§Œì˜ ë…íŠ¹í•œ ë§¤ë ¥ì´ ìˆì–´ìš”.`;
    html+=`<div class="trait-item"><span class="trait-icon">${icons[i-1]}</span><div class="trait-text"><strong>${title}</strong>${content}</div></div>`;
  }
  return html;
}

function localTraits(foodName){
  return `íŠ¹ì§•1ì œëª©: ì²«ì¸ìƒ\níŠ¹ì§•1ë‚´ìš©: ì²˜ìŒ ë§Œë‚˜ë©´ "${foodName}ì´ì—ìš”!" ì†Œê°œì— ë‹¤ë“¤ ì›ƒëŠ” ê·¸ ë°˜ì‘ â€” ì´ ìºë¦­í„°ëŠ” ì–¸ì œë‚˜ ë¶„ìœ„ê¸°ë¥¼ ë°í˜€ìš” ğŸŒŸ\níŠ¹ì§•2ì œëª©: ìˆ¨ì€ë§¤ë ¥\níŠ¹ì§•2ë‚´ìš©: ê²‰ìœ¼ë¡  í‰ë²”í•œ ${foodName}ì²˜ëŸ¼ ë³´ì´ì§€ë§Œ ì•Œê³  ë³´ë©´ ê¹Šì´ê°€ ìˆì–´ìš”. ë‘ ë²ˆ ë§Œë‚˜ë©´ ë¬´ì¡°ê±´ íŒ¬ì´ ë¼ìš” ğŸ’«\níŠ¹ì§•3ì œëª©: íŠ¹ê¸°\níŠ¹ì§•3ë‚´ìš©: ì–´ë–¤ ìƒí™©ì—ì„œë„ ë³¸ì¸ì˜ ë§›ì„ ìƒì§€ ì•ŠëŠ” ${foodName}ì²˜ëŸ¼, ì´ ìºë¦­í„°ëŠ” ì–´ë””ì„œë‚˜ ìê¸°ë‹¤ì›Œìš” âœ¨`;
}

function renderStoryAI(text,foodName){
  const foodAna=getField(text,'ìŒì‹ë¶„ì„')||`${foodName}ì´ë¼ëŠ” ì„ íƒì—ì„œ ë‹¹ì‹ ì˜ ì§„ì‹¬ì´ ëŠê»´ì ¸ìš”.`;
  const summary=getField(text,'ì°í•œì¤„')||'';
  const reason=getField(text,'ê²°ì •ì í•œë§ˆë””')||'ë‹¹ì‹ ì˜ ì´ì•¼ê¸°, ì •ë§ ì˜ ë“¤ì—ˆì–´ìš”.';
  const tagStr=getField(text,'íƒœê·¸');
  const tags=(tagStr.match(/#[^\s#]+/g)||[]).slice(0,3);
  if(!tags.length)tags.push('#ì°í‘¸ë“œ','#ìŒì‹ì°','#ë‚˜ì˜ì´ì•¼ê¸°');
  let html=`<div class="ai-section"><div class="ai-section-title">âœ¦ ìŒì‹ ì„ íƒ ì‹¬ë¦¬</div><p style="color:#2a3a6a;line-height:1.8;font-style:italic">${foodAna}</p></div>`;
  if(summary)html+=`<div class="ai-section"><div class="ai-section-title">âœ¦ ì´ ì°ì„ í•œ ì¤„ë¡œ</div><p style="font-weight:700;font-size:14px;color:#1a2a6a;line-height:1.6">${summary}</p></div>`;
  html+=`<div class="ai-section"><div class="ai-section-title">âœ¦ ê²°ì •ì  í•œë§ˆë””</div><p style="font-size:14px;font-weight:600;color:#2a3a7a;border-left:3px solid #7090d8;padding:10px 12px;background:rgba(100,130,220,.07);border-radius:0 8px 8px 0;line-height:1.7">"${reason}"</p></div>`;
  html+=`<div style="margin-top:4px">${tags.map(t=>`<span class="ai-tag">${t}</span>`).join('')}</div>`;
  return html;
}

// â”€â”€ LOCAL FALLBACKS â”€â”€
function localQuizAI(res){
  const db={
    A:{hl:`ğŸŒ¶ï¸ í•œ ë²ˆ ë§›ë³´ë©´ ìê¾¸ ìƒê°ë‚˜ëŠ” ë§ˆë¼íƒ•í˜• ì¸ê°„`,traits:[`ë°°ê³ í”Œ ë•Œ ì˜ˆë¯¼í•´ì§€ëŠ” ê±´ ê°ì •ì„ ìˆ¨ê¸°ì§€ ì•ŠëŠ” ì†”ì§í•¨ì´ì—ìš”. ì˜¤íˆë ¤ ê·¸ê²Œ ì‹ ë¢°ê°ì„ ì¤˜ìš”.`,`ë©”ë‰´ ì •í•  ë•Œ ë‚´ê°€ ì •í•˜ëŠ” íƒ€ì… â€” ê²°ì • ì¥ì•  ì¹œêµ¬ë“¤í•œí…Œ ì—†ì–´ì„  ì•ˆ ë  ì¡´ì¬ì˜ˆìš”.`,`ìê·¹ì ì¸ ê±¸ ì¢‹ì•„í•˜ëŠ” ë•ë¶„ì— ì‚¶ì˜ ì˜¨ë„ê°€ í•­ìƒ ë†’ì•„ìš”. ì§€ë£¨í•  í‹ˆì´ ì—†ëŠ” ì‚¬ëŒì´ì—ìš”.`],reason:`ë§ˆë¼íƒ•ì²˜ëŸ¼ ì²˜ìŒì—” "ì´ê²Œ ë§ë‚˜?" ì‹¶ë‹¤ê°€ë„, ê²°êµ­ ë‹¤ìŒì— ë˜ ì°¾ê²Œ ë˜ëŠ” ì‚¬ëŒì´ì—ìš”.`,tags:['#ìê·¹ì£¼ì˜','#ê°ì •ì§ì§„','#ì¤‘ë…ë§¤ë ¥','#ë§ˆë¼íƒ•ì¸ê°„']},
    B:{hl:`ğŸ‚ ì¡°ìš©íˆ ë‹¹ì‹  ìƒì¼ ê¸°ì–µí•˜ëŠ” ì¼€ì´í¬í˜• ì¸ê°„`,traits:[`ìŠ¤íŠ¸ë ˆìŠ¤ ë°›ìœ¼ë©´ ë‹¬ë‹¬í•œ ê±¸ ì°¾ëŠ” â€” ê°ì •ì„ í­ë°œì‹œí‚¤ëŠ” ëŒ€ì‹  ìŠ¤ìŠ¤ë¡œ ë‹¬ë˜ëŠ” ìê¸° ëŒë´„ì˜ ê³ ìˆ˜ì˜ˆìš”.`,`ì´ë¶ˆ ì† í‘ì—­ì‚¬ê°€ ë§ë‹¤ë©´, ê°ìˆ˜ì„±ì´ ê·¸ë§Œí¼ í’ë¶€í•˜ë‹¤ëŠ” ëœ»ì´ì—ìš”. ë‚¨ë“¤ì´ ì§€ë‚˜ì¹œ ìˆœê°„ë„ ì˜¤ë˜ ê¸°ì–µí•´ìš”.`,`ê²‰ìœ¼ë¡  í‰ì˜¨í•´ ë³´ì´ì§€ë§Œ ì†ìœ¼ë¡  ëŠì„ì—†ì´ ìƒê° ì¤‘ â€” ì¡°ìš©í•œ ê°ë™ì„ ì£¼ëŠ” íƒ€ì…ì´ì—ìš”.`],reason:`ë”¸ê¸°ì¼€ì´í¬ì²˜ëŸ¼ ê¸°ë¶„ ì¢‹ì„ ë•Œë„, ìœ„ë¡œê°€ í•„ìš”í•  ë•Œë„, ê²°êµ­ ìƒê°ë‚˜ëŠ” ì‚¬ëŒì´ì—ìš”.`,tags:['#ê°ì„±ì¶©ë§Œ','#ê¸°ë…ì¼ì¥ì¸','#ì¡°ìš©í•œë‚­ë§Œì£¼ì˜','#ì¼€ì´í¬ì¸ê°„']},
    C:{hl:`ğŸ· 1íšŒì°¨ì—” ì ˆëŒ€ ëª¨ë¥´ëŠ” ì™€ì¸í˜• ì¸ê°„`,traits:[`ì„¸ë¼ ë‹¤ ì±™ê¸°ëŠ” ê·œì¹™íŒŒ â€” ê²‰ìœ¼ë¡  ì² ì €í•´ ë³´ì´ì§€ë§Œ ì‚¬ì‹¤ ìê¸° ìì‹ í•œí…Œ ê°€ì¥ ì—„ê²©í•´ìš”.`,`ìŠ¤íŠ¸ë ˆìŠ¤ ë°›ìœ¼ë©´ ë¹¨ë¦¬ ë¨¹ê³  í•´ê²°í•˜ëŠ” íƒ€ì… â€” ê°ì •ì„ ì˜¤ë˜ ëŒì§€ ì•Šê³  ë¦¬ì…‹í•˜ëŠ” ëŠ¥ë ¥ì´ ìˆì–´ìš”.`,`ì²˜ìŒ ë§Œë‚˜ë©´ ì¡°ê¸ˆ ì–´ë µê²Œ ëŠê»´ì§€ì§€ë§Œ, ê°€ê¹Œì›Œì§€ë©´ ì™„ì „ ë‹¤ë¥¸ ì‚¬ëŒ ë‚˜ì™€ìš”. ê·¸ê²Œ ë°˜ì „ ë§¤ë ¥ì´ì—ìš”.`],reason:`ì™€ì¸ì²˜ëŸ¼ ì‹œê°„ì´ ì§€ë‚ ìˆ˜ë¡ ê¹Šì–´ì§€ëŠ” ë§› â€” ë¹¨ë¦¬ íŒë‹¨í•˜ë©´ ì´ ì‚¬ëŒ ëª¨ë¥´ëŠ” ê±°ì˜ˆìš”.`,tags:['#ìˆ™ì„±í˜•ì¸ê°„','#ì²œì²œíˆì•Œì•„ê°€ì','#1íšŒì°¨ëŠ”ëª¨ë¦„','#ì™€ì¸ì¸ê°„']},
    D:{hl:`ğŸ² ìƒˆë²½ 3ì‹œì— ìƒê°ë‚˜ëŠ” í•´ì¥êµ­í˜• ì¸ê°„`,traits:[`ë°°ê³ íŒŒë„ ê·¸ëƒ¥ ì•„ë¬´ê±°ë‚˜ ë¨¹ëŠ” â€” ì‚¬ì†Œí•œ ê²ƒì— ì—ë„ˆì§€ ìŸì§€ ì•Šê³  íš¨ìœ¨ì ìœ¼ë¡œ ì•„ë¼ëŠ” ì‚¬ëŒì´ì—ìš”.`,`ì¡°ìš©íˆ ì˜¤ë˜ ì°¸ë‹¤ê°€ í•œ ë²ˆì— ì •ë¦¬í•˜ëŠ” íƒ€ì…ì´ì—ìš”. ë§ ì—†ì´ ë– ë‚˜ëŠ” ì‚¬ëŒì´ ê°€ì¥ ë¬´ì„œìš´ íƒ€ì….`,`ê±°ì°½í•œ í‘œí˜„ì€ ì—†ì–´ë„ ê³ì— ìˆìœ¼ë©´ ì™ ì§€ ì•ˆì‹¬ì´ ë˜ëŠ” ì‚¬ëŒ â€” ê·¸ê²Œ ì œì¼ ì–´ë ¤ìš´ ê±°ì˜ˆìš”.`],reason:`í•´ì¥êµ­ì²˜ëŸ¼ ìˆì„ ë•ŒëŠ” ë‹¹ì—°í•˜ê³ , ì—†ìœ¼ë©´ ì§„ì§œ ë¹ˆìë¦¬ê°€ ëŠê»´ì§€ëŠ” ì‚¬ëŒì´ì—ìš”.`,tags:['#ì§„êµ­ì¸ìƒ','#ìˆì–´ì•¼ì™„ì„±','#ìƒˆë²½ì„¸ì‹œì—ìƒê°ë‚˜ëŠ”ì‚¬ëŒ','#í•´ì¥êµ­ì¸ê°„']}
  }[res.type];
  return renderQuizAI(`í•œì¤„ìš”ì•½: ${db.hl}\níŠ¹ì§•1: ${db.traits[0]}\níŠ¹ì§•2: ${db.traits[1]}\níŠ¹ì§•3: ${db.traits[2]}\nê²°ì •ì í•œë§ˆë””: ${db.reason}\níƒœê·¸: ${db.tags.join(' ')}`,res);
}

// â”€â”€ MAIN RESULT BUILD â”€â”€
function goToResult(){
  const foodName=document.getElementById('food-input').value.trim();
  if(!foodName){alert('ì°ì˜ ì£¼ì¸ê³µ ìŒì‹ì„ ì…ë ¥í•´ì£¼ì„¸ìš”! ğŸ½ï¸');document.getElementById('food-input').focus();return;}
  const story=document.getElementById('story-text').value.trim();
  goTo('page-result');
  buildResult(story,foodName);
}

function buildResult(story,foodName){
  const totals={A:0,B:0,C:0,D:0};
  answers.forEach(sc=>Object.entries(sc).forEach(([k,v])=>totals[k]+=v));
  const topType=Object.entries(totals).sort((a,b)=>b[1]-a[1])[0][0];
  const res=scoreResults.find(r=>r.type===topType);

  setTimeout(()=>{
    document.getElementById('result-loading-screen').style.display='none';
    document.getElementById('result-content').style.display='block';

    // â”€â”€ 1) ê°ê´€ì‹ ì„±í–¥ ê²°ê³¼ â”€â”€
    document.getElementById('personality-emoji').textContent=res.e;
    document.getElementById('personality-food-type').textContent=`${res.food} íƒ€ì…`;
    document.getElementById('personality-type-tag').textContent=res.tag;
    document.getElementById('personality-desc').textContent=res.desc;

    // ê°ê´€ì‹ ë‹µë³€ ë¦¬ìº¡
    let recapHtml='';
    answerLabels.forEach((item,qi)=>{const c=item.opts[item.chosen];recapHtml+=`<div class="recap-q"><div class="recap-q-text">Q${qi+1}. ${item.q}</div><div class="recap-opt-chosen"><span class="recap-check">âœ“</span><span style="font-size:16px">${c.e}</span><span>${c.t}</span></div></div>`;});
    document.getElementById('quiz-recap-body').innerHTML=recapHtml;

    // â”€â”€ 2) ì° ìºë¦­í„° ê¸°ë³¸ ì •ë³´ â”€â”€
    document.getElementById('char-food-name').textContent=`${foodName} ìºë¦­í„°`;
    document.getElementById('char-sub-tag').textContent=`#${foodName}ìºë¦­í„° #ì°í‘¸ë“œ`;
    document.getElementById('char-base-desc').textContent=`${foodName}ì˜ ë§¤ë ¥ì„ ë‹´ì€ ë‚˜ë§Œì˜ ê·€ì—¬ìš´ ìºë¦­í„°ì˜ˆìš”. AIê°€ ê·¸ë¦° íŠ¹ë³„í•œ ìŒì‹ ìºë¦­í„°!`;

    // ì° ë‚´ìš© ë¦¬ìº¡
    if(story){document.getElementById('story-recap-content').textContent=story;document.getElementById('story-recap-card').style.display='block';}

    // â”€â”€ 3) ì´ë¯¸ì§€ ìƒì„± (ë¹„ë™ê¸°) â”€â”€
    generateCharImage(foodName).then(url=>{
      document.getElementById('char-img').src=url;
      document.getElementById('char-img').style.display='block';
      document.getElementById('char-loading-inner').style.display='none';
    }).catch(()=>{
      document.getElementById('char-loading-inner').innerHTML=`<span style="font-size:48px">ğŸ½ï¸</span><p style="font-size:12px;margin-top:6px;color:var(--muted)">${foodName}</p>`;
    });

    // â”€â”€ 4) ê°ê´€ì‹ AI ë¶„ì„ (ë¹„ë™ê¸°) â”€â”€
    doQuizAnalysis(answerLabels,res).then(text=>{
      document.getElementById('quiz-ai-loading').style.display='none';
      const el=document.getElementById('quiz-ai-content');
      el.innerHTML=text?renderQuizAI(text,res):localQuizAI(res);
      el.style.display='block';
    });

    // â”€â”€ 5) ìºë¦­í„° íŠ¹ì§• AI ë¶„ì„ (ë¹„ë™ê¸°) â”€â”€
    doCharTraits(foodName,res,story).then(text=>{
      document.getElementById('char-traits-loading').style.display='none';
      const el=document.getElementById('char-traits-content');
      el.innerHTML=renderTraits(text||localTraits(foodName),foodName);
      el.style.display='block';
    });

    // â”€â”€ 6) ì° AI ë¶„ì„ (ë¹„ë™ê¸°) â”€â”€
    doStoryAnalysis(res,story,foodName).then(text=>{
      document.getElementById('story-ai-loading').style.display='none';
      const el=document.getElementById('story-ai-content');
      if(text){el.innerHTML=renderStoryAI(text,foodName);}
      else if(story){el.innerHTML=`<p style="color:#4a5fa0;line-height:1.8">${foodName}ì´ë¼ëŠ” ì„ íƒì—ì„œ ë‹¹ì‹ ì˜ ì´ì•¼ê¸°ê°€ ê³ ìŠ¤ë€íˆ ëŠê»´ì ¸ìš”. ìŒì‹ í•˜ë‚˜ì—ë„ ì´ë ‡ê²Œ ë§ì€ ê°ì •ì´ ë‹´ê¸¸ ìˆ˜ ìˆë‹¤ëŠ” ê²Œ ë†€ëì§€ ì•Šë‚˜ìš”?</p>`;}
      else{el.innerHTML=`<p style="color:#4a5fa0;line-height:1.8">ì°ì„ ì…ë ¥í•˜ì§€ ì•Šìœ¼ì…¨ë„¤ìš”! ë‹¤ìŒì—” ì°ë„ í•¨ê»˜ ì ì–´ì£¼ì‹œë©´ ë” ê¹Šì€ ë¶„ì„ì„ í•´ë“œë¦´ê²Œìš” ğŸ˜Š</p>`;}
      el.style.display='block';
    });

  },1800);
}

// â”€â”€ PHONE â”€â”€
let consented=false;
function toggleConsent(){consented=!consented;document.getElementById('consent-cb').classList.toggle('checked',consented);}
function formatPhone(el){let v=el.value.replace(/\D/g,'').substring(0,11);if(v.length<=3)el.value=v;else if(v.length<=7)el.value=v.slice(0,3)+'-'+v.slice(3);else el.value=v.slice(0,3)+'-'+v.slice(3,7)+'-'+v.slice(7);}
function submitPhone(){const p=document.getElementById('phone-input').value.trim();if(p&&!consented){alert('ê°œì¸ì •ë³´ í™œìš© ë™ì˜ë¥¼ ì²´í¬í•´ì£¼ì„¸ìš”!');return;}goTo('page-done');}

initQuiz();
initTempBtns();
</script>
</body>
</html>