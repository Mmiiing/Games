<!DOCTYPE html>
<html lang="ko">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>ì°í‘¸ë“œ â€” ë‹¹ì‹ ì˜ ìŒì‹ê³¼ ì°ì€?</title>
<link href="https://fonts.googleapis.com/css2?family=Noto+Serif+KR:wght@400;700;900&family=Noto+Sans+KR:wght@300;400;500&display=swap" rel="stylesheet">
<style>
  :root {
    --cream: #FAF3E8;
    --toast: #D4956A;
    --caramel: #B8622A;
    --dark: #2C1810;
    --muted: #7A5C4A;
    --accent: #E8734A;
    --green: #5A7A52;
    --border: rgba(180,130,90,0.25);
  }
  * { margin:0; padding:0; box-sizing:border-box; }
  body {
    background: var(--cream);
    font-family: 'Noto Sans KR', sans-serif;
    color: var(--dark);
    min-height: 100vh;
    overflow-x: hidden;
  }
  body::before {
    content:''; position:fixed; inset:0;
    background-image:
      radial-gradient(circle at 20% 20%, rgba(212,149,106,0.08) 0%, transparent 50%),
      radial-gradient(circle at 80% 80%, rgba(91,122,82,0.06) 0%, transparent 50%);
    pointer-events:none; z-index:0;
  }

  .page { display:none; position:relative; z-index:1; min-height:100vh; }
  .page.active { display:flex; flex-direction:column; }

  #page-splash {
    align-items:center; justify-content:center;
    background:linear-gradient(160deg,#FFF9F0 0%,#FAF0E0 40%,#F5E8CC 100%);
    text-align:center; padding:40px 20px;
  }
  .splash-title { font-family:'Noto Serif KR',serif; font-size:clamp(28px,8vw,52px); font-weight:900; color:var(--dark); line-height:1.25; letter-spacing:-1px; margin-bottom:10px; animation:fadeUp .8s ease both; }
  .splash-title em { color:var(--caramel); font-style:normal; }
  .splash-sub { font-size:14px; color:var(--muted); margin-bottom:44px; animation:fadeUp .8s .15s ease both; opacity:0; animation-fill-mode:both; }
  .splash-chars { display:flex; gap:12px; align-items:flex-end; justify-content:center; flex-wrap:wrap; margin-bottom:48px; animation:fadeUp .8s .25s ease both; opacity:0; animation-fill-mode:both; }
  .splash-char { display:flex; flex-direction:column; align-items:center; gap:6px; animation:bobble 2s ease-in-out infinite; }
  .splash-char:nth-child(2){animation-delay:.2s;} .splash-char:nth-child(3){animation-delay:.4s;} .splash-char:nth-child(4){animation-delay:.6s;}
  .splash-char svg { width:70px; height:78px; filter:drop-shadow(0 6px 12px rgba(44,24,16,.13)); }
  .splash-char-name { font-size:11px; font-weight:700; color:var(--muted); letter-spacing:.5px; }
  @keyframes bobble { 0%,100%{transform:translateY(0)} 50%{transform:translateY(-10px)} }
  .splash-btn { padding:16px 52px; border-radius:50px; border:none; background:linear-gradient(135deg,var(--caramel),var(--accent)); color:white; font-size:18px; font-weight:700; cursor:pointer; font-family:'Noto Serif KR',serif; box-shadow:0 8px 24px rgba(184,98,42,.35); transition:all .25s; animation:fadeUp .8s .4s ease both; opacity:0; animation-fill-mode:both; }
  .splash-btn:hover { transform:translateY(-3px); box-shadow:0 12px 32px rgba(184,98,42,.45); }

  .page-wrap { max-width:640px; margin:0 auto; width:100%; padding:0 20px 80px; flex:1; }
  .page-header { text-align:center; padding:44px 0 28px; }
  .page-tag { display:inline-block; background:var(--toast); color:white; font-size:11px; letter-spacing:2px; padding:5px 14px; border-radius:20px; margin-bottom:14px; font-weight:500; }
  .page-header h2 { font-family:'Noto Serif KR',serif; font-size:clamp(22px,5vw,32px); font-weight:900; line-height:1.3; letter-spacing:-.5px; }
  .page-header h2 em { color:var(--caramel); font-style:normal; }
  .page-header p { margin-top:10px; color:var(--muted); font-size:13px; line-height:1.7; }

  .quiz-card { background:linear-gradient(135deg,#FFF9F0,#FFF3E0); border-radius:20px; padding:26px; border:1.5px solid rgba(212,149,106,.3); box-shadow:0 4px 24px rgba(44,24,16,.06); }
  .quiz-progress { display:flex; gap:6px; margin-bottom:10px; }
  .quiz-dot { height:4px; flex:1; border-radius:2px; background:var(--border); transition:background .3s; }
  .quiz-dot.active{background:var(--toast);} .quiz-dot.done{background:var(--caramel);}
  .quiz-step-label { font-size:11px; color:var(--muted); margin-bottom:18px; letter-spacing:.5px; font-weight:600; }
  .quiz-question { font-family:'Noto Serif KR',serif; font-size:18px; font-weight:700; line-height:1.5; margin-bottom:20px; color:var(--dark); }
  .quiz-options { display:grid; grid-template-columns:1fr 1fr; gap:10px; }
  .quiz-option { padding:14px 12px; border-radius:14px; border:2px solid var(--border); background:white; cursor:pointer; font-size:13px; color:var(--dark); text-align:center; line-height:1.4; transition:all .2s; font-family:'Noto Sans KR',sans-serif; }
  .quiz-option:hover { border-color:var(--toast); background:#FFF8F0; transform:translateY(-2px); }
  .quiz-option.selected { border-color:var(--caramel); background:linear-gradient(135deg,#FFF0E0,#FFE8CC); font-weight:500; }
  .quiz-option .opt-emoji { display:block; font-size:24px; margin-bottom:6px; }
  .btn-next { width:100%; padding:15px; border-radius:12px; border:none; background:var(--dark); color:white; font-size:15px; font-weight:700; cursor:pointer; font-family:'Noto Serif KR',serif; transition:all .2s; margin-top:18px; }
  .btn-next:hover { background:var(--caramel); transform:translateY(-2px); }

  .story-card { background:white; border-radius:20px; padding:28px; border:1px solid var(--border); box-shadow:0 4px 24px rgba(44,24,16,.06); margin-bottom:20px; }
  .story-intro { font-size:13px; color:var(--muted); margin-bottom:22px; line-height:1.7; padding:14px 16px; background:rgba(212,149,106,.07); border-radius:12px; border-left:3px solid var(--toast); }
  .theme-label { font-size:12px; font-weight:600; color:var(--muted); letter-spacing:.5px; margin-bottom:10px; }
  .theme-chips { display:flex; flex-wrap:wrap; gap:8px; margin-bottom:20px; }
  .theme-chip { padding:7px 15px; border-radius:20px; border:1.5px solid var(--border); background:transparent; font-size:13px; color:var(--muted); cursor:pointer; transition:all .2s; font-family:'Noto Sans KR',sans-serif; }
  .theme-chip:hover { border-color:var(--toast); color:var(--toast); }
  .theme-chip.active { background:var(--dark); border-color:var(--dark); color:white; }
  .story-field { position:relative; margin-bottom:18px; }
  .story-field label { display:block; font-size:12px; font-weight:600; color:var(--muted); margin-bottom:8px; letter-spacing:.5px; }
  .story-field textarea { width:100%; padding:14px 16px; border-radius:12px; border:1.5px solid var(--border); background:#FDFAF6; font-size:14px; color:var(--dark); font-family:'Noto Sans KR',sans-serif; resize:none; outline:none; transition:border-color .2s; line-height:1.7; min-height:140px; }
  .story-field textarea:focus { border-color:var(--toast); background:white; }
  .char-count { position:absolute; bottom:10px; right:14px; font-size:11px; color:var(--border); }
  .temp-label { font-size:12px; font-weight:600; color:var(--muted); letter-spacing:.5px; margin-bottom:10px; }
  .temp-track { display:flex; align-items:center; gap:8px; margin-bottom:22px; }
  .temp-end { font-size:11px; color:var(--muted); white-space:nowrap; flex-shrink:0; }
  .temp-btns { display:flex; gap:6px; flex:1; justify-content:center; }
  .temp-btn { width:38px; height:38px; border-radius:50%; border:1.5px solid var(--border); background:white; font-size:13px; font-weight:600; color:var(--muted); cursor:pointer; transition:all .2s; }
  .temp-btn:hover { border-color:var(--toast); color:var(--toast); }
  .temp-btn.active { background:var(--dark); border-color:var(--dark); color:white; }
  .btn-submit { width:100%; padding:16px; border-radius:14px; border:none; background:linear-gradient(135deg,var(--caramel),var(--accent)); color:white; font-size:16px; font-weight:700; cursor:pointer; font-family:'Noto Serif KR',serif; letter-spacing:.5px; transition:all .25s; box-shadow:0 6px 20px rgba(184,98,42,.3); }
  .btn-submit:hover { transform:translateY(-2px); box-shadow:0 10px 28px rgba(184,98,42,.4); }

  #page-result { background:var(--cream); }
  .result-wrap { max-width:640px; margin:0 auto; padding:40px 20px 80px; }
  .result-loading-screen { display:flex; flex-direction:column; align-items:center; justify-content:center; min-height:70vh; gap:20px; text-align:center; }
  .result-loading-screen p { font-size:14px; color:var(--muted); line-height:1.8; }
  .big-spinner { width:52px; height:52px; border:4px solid var(--border); border-top-color:var(--toast); border-radius:50%; animation:spin .9s linear infinite; }
  @keyframes spin{to{transform:rotate(360deg)}}

  .result-card { background:white; border-radius:24px; padding:32px 28px; border:1.5px solid rgba(212,149,106,.3); box-shadow:0 8px 32px rgba(44,24,16,.08); margin-bottom:20px; text-align:center; animation:popIn .5s cubic-bezier(.34,1.56,.64,1) both; }
  .char-img-wrap { width:200px; height:200px; margin:0 auto 20px; border-radius:50%; background:linear-gradient(135deg,#FFF8F0,#FFF0E0); border:3px solid rgba(212,149,106,.3); display:flex; align-items:center; justify-content:center; overflow:hidden; }
  .char-img { width:100%; height:100%; object-fit:cover; animation:popIn .5s cubic-bezier(.34,1.56,.64,1); }
  .char-loading-inner { display:flex; flex-direction:column; align-items:center; gap:10px; color:var(--muted); font-size:12px; }
  .small-spinner { width:28px; height:28px; border:3px solid var(--border); border-top-color:var(--toast); border-radius:50%; animation:spin .8s linear infinite; }
  .result-food { font-family:'Noto Serif KR',serif; font-size:24px; font-weight:900; color:var(--caramel); margin-bottom:10px; }
  .result-desc { font-size:14px; color:var(--muted); line-height:1.8; margin-bottom:14px; }
  .result-tag { display:inline-block; padding:6px 16px; background:var(--toast); color:white; border-radius:20px; font-size:12px; font-weight:500; }

  .ai-box { background:linear-gradient(135deg,#f0f4ff,#e8f0fe); border-radius:16px; padding:20px; border:1.5px solid rgba(100,130,220,.25); margin-bottom:20px; text-align:left; animation:popIn .5s .2s cubic-bezier(.34,1.56,.64,1) both; }
  .ai-box-title { font-family:'Noto Serif KR',serif; font-size:14px; font-weight:700; color:#3a56b0; margin-bottom:14px; display:flex; align-items:center; gap:8px; }
  .ai-content { font-size:13px; color:#2a3a6a; line-height:1.9; }
  .ai-loading { display:flex; align-items:center; gap:10px; color:#6678aa; font-size:12px; }
  .ai-dots { display:flex; gap:4px; }
  .ai-dots span { width:6px; height:6px; border-radius:50%; background:#6678aa; animation:dotBounce 1.2s ease-in-out infinite; }
  .ai-dots span:nth-child(2){animation-delay:.2s;} .ai-dots span:nth-child(3){animation-delay:.4s;}
  @keyframes dotBounce{0%,80%,100%{transform:scale(.7);opacity:.5}40%{transform:scale(1);opacity:1}}
  .ai-tag { display:inline-block; margin:4px 3px 0; padding:3px 10px; background:rgba(100,130,220,.15); color:#3a56b0; border-radius:12px; font-size:11px; font-weight:600; }
  .ai-section { margin-bottom:14px; padding-bottom:14px; border-bottom:1px dashed rgba(100,130,220,.2); }
  .ai-section:last-child { border-bottom:none; margin-bottom:0; padding-bottom:0; }
  .ai-section-title { font-size:11px; font-weight:700; color:#7a90cc; letter-spacing:1px; margin-bottom:8px; }

  .recap-card { background:white; border-radius:20px; padding:24px; border:1px solid var(--border); box-shadow:0 4px 24px rgba(44,24,16,.05); margin-bottom:20px; text-align:left; animation:popIn .5s .35s cubic-bezier(.34,1.56,.64,1) both; }
  .recap-title { font-size:11px; color:var(--muted); letter-spacing:1px; font-weight:600; margin-bottom:14px; }
  .recap-q { margin-bottom:10px; border-radius:12px; overflow:hidden; border:1px solid var(--border); }
  .recap-q-text { font-size:12px; font-weight:700; color:var(--dark); padding:9px 12px; background:rgba(44,24,16,.04); border-bottom:1px solid var(--border); line-height:1.4; }
  .recap-opt-chosen { display:flex; align-items:center; gap:8px; padding:8px 12px; font-size:13px; font-weight:600; color:var(--dark); background:linear-gradient(90deg,#FFF0E0,#FFF8F4); }
  .recap-check { width:18px; height:18px; border-radius:50%; background:var(--caramel); display:flex; align-items:center; justify-content:center; font-size:10px; color:white; flex-shrink:0; }
  .recap-story { margin-bottom:10px; border-radius:12px; overflow:hidden; border:1px solid var(--border); }
  .recap-story-label { font-size:12px; font-weight:700; color:var(--dark); padding:9px 12px; background:rgba(44,24,16,.04); border-bottom:1px solid var(--border); }
  .recap-story-content { padding:12px 14px; font-size:13px; color:var(--muted); line-height:1.8; }

  .btn-to-phone { width:100%; padding:16px; border-radius:14px; border:none; background:linear-gradient(135deg,var(--caramel),var(--accent)); color:white; font-size:16px; font-weight:700; cursor:pointer; font-family:'Noto Serif KR',serif; box-shadow:0 6px 20px rgba(184,98,42,.3); transition:all .25s; margin-top:20px; animation:fadeUp .5s .5s ease both; opacity:0; animation-fill-mode:both; }
  .btn-to-phone:hover { transform:translateY(-2px); }

  #page-phone { background:var(--cream); }
  .phone-wrap { max-width:480px; margin:0 auto; padding:60px 20px 80px; text-align:center; }
  .phone-emoji { font-size:56px; margin-bottom:20px; animation:popIn .6s cubic-bezier(.34,1.56,.64,1) both; }
  .phone-title { font-family:'Noto Serif KR',serif; font-size:26px; font-weight:900; color:var(--dark); margin-bottom:12px; }
  .phone-desc { font-size:14px; color:var(--muted); line-height:1.8; margin-bottom:32px; }
  .phone-input { width:100%; padding:16px 20px; border-radius:14px; border:2px solid var(--border); background:white; font-size:16px; color:var(--dark); font-family:'Noto Sans KR',sans-serif; outline:none; transition:border-color .2s; text-align:center; letter-spacing:1px; margin-bottom:12px; }
  .phone-input:focus { border-color:var(--toast); }
  .phone-skip { font-size:12px; color:var(--muted); text-decoration:underline; cursor:pointer; margin-bottom:20px; display:block; }
  .permission-row { display:flex; align-items:flex-start; gap:12px; padding:14px 16px; background:#F8F5F0; border-radius:12px; margin-bottom:24px; text-align:left; }
  .custom-cb { width:20px; height:20px; border:2px solid var(--border); border-radius:5px; flex-shrink:0; cursor:pointer; display:flex; align-items:center; justify-content:center; margin-top:1px; transition:all .2s; }
  .custom-cb.checked { background:var(--green); border-color:var(--green); }
  .custom-cb.checked::after { content:'âœ“'; color:white; font-size:12px; font-weight:700; }
  .permission-text { font-size:12px; color:var(--muted); line-height:1.6; }
  .permission-text strong { color:var(--dark); }
  .btn-finish { width:100%; padding:16px; border-radius:14px; border:none; background:linear-gradient(135deg,var(--caramel),var(--accent)); color:white; font-size:16px; font-weight:700; cursor:pointer; font-family:'Noto Serif KR',serif; box-shadow:0 6px 20px rgba(184,98,42,.3); transition:all .25s; }
  .btn-finish:hover { transform:translateY(-2px); }

  #page-done { background:var(--cream); }
  .done-wrap { max-width:480px; margin:0 auto; padding:80px 20px; text-align:center; }
  .done-emoji { font-size:64px; margin-bottom:24px; animation:popIn .6s cubic-bezier(.34,1.56,.64,1) both; }
  .done-title { font-family:'Noto Serif KR',serif; font-size:26px; font-weight:900; color:var(--dark); margin-bottom:12px; animation:fadeUp .6s .1s ease both; opacity:0; animation-fill-mode:both; }
  .done-desc { font-size:14px; color:var(--muted); line-height:1.9; margin-bottom:28px; animation:fadeUp .6s .2s ease both; opacity:0; animation-fill-mode:both; }
  .done-tag { display:inline-block; background:var(--dark); color:white; padding:10px 24px; border-radius:20px; font-size:13px; font-weight:500; animation:fadeUp .6s .3s ease both; opacity:0; animation-fill-mode:both; }

  .deco { position:fixed; font-size:28px; opacity:.06; pointer-events:none; z-index:0; animation:floatUp linear infinite; }
  @keyframes floatUp{0%{transform:translateY(100vh) rotate(0)}100%{transform:translateY(-100px) rotate(360deg)}}
  @keyframes fadeUp{from{opacity:0;transform:translateY(16px)}to{opacity:1;transform:translateY(0)}}
  @keyframes popIn{0%{transform:scale(.8);opacity:0}100%{transform:scale(1);opacity:1}}
  .fade-in{animation:fadeUp .35s ease both;}
</style>
</head>
<body>

<div class="deco" style="left:5%;animation-duration:18s;animation-delay:-3s">ğŸœ</div>
<div class="deco" style="left:85%;animation-duration:22s;animation-delay:-8s">ğŸ</div>
<div class="deco" style="left:55%;animation-duration:15s;animation-delay:-12s">ğŸ¥š</div>
<div class="deco" style="left:70%;animation-duration:19s;animation-delay:-15s">ğŸ§…</div>

<!-- SPLASH -->
<div class="page active" id="page-splash">
  <div class="splash-title">ì°í‘¸ë“œ!!<br><em>ë‹¹ì‹ ì˜ ìŒì‹ê³¼ ì°ì€??</em></div>
  <div class="splash-sub">ë‚˜ë¥¼ ë‹®ì€ ìŒì‹ ìºë¦­í„°ì™€ í•¨ê»˜ ì°ì„ í’€ì–´ë´ìš” ğŸ½ï¸</div>
  <div class="splash-chars">
    <div class="splash-char">
      <svg viewBox="0 0 72 80" xmlns="http://www.w3.org/2000/svg">
        <ellipse cx="36" cy="44" rx="26" ry="22" fill="#fff8f0"/>
        <rect x="10" y="38" width="52" height="16" rx="4" fill="#f9d0a0"/>
        <rect x="10" y="28" width="52" height="12" rx="4" fill="#fff"/>
        <rect x="10" y="20" width="52" height="10" rx="4" fill="#f9d0a0"/>
        <path d="M12 20 Q20 12 28 18 Q36 10 44 18 Q52 12 60 20" stroke="#fff" stroke-width="3" fill="none"/>
        <ellipse cx="24" cy="17" rx="5" ry="4" fill="#e8504a"/>
        <ellipse cx="36" cy="13" rx="5" ry="4" fill="#e8504a"/>
        <ellipse cx="48" cy="17" rx="5" ry="4" fill="#e8504a"/>
        <rect x="34" y="5" width="4" height="9" rx="2" fill="#f9c74f"/>
        <ellipse cx="36" cy="4" rx="2" ry="3" fill="#f4a261" opacity=".8"/>
        <circle cx="28" cy="36" r="2" fill="#2c1810"/><circle cx="44" cy="36" r="2" fill="#2c1810"/>
        <path d="M30 41 Q36 46 42 41" stroke="#2c1810" stroke-width="1.5" fill="none" stroke-linecap="round"/>
        <line x1="10" y1="38" x2="2" y2="30" stroke="#2c1810" stroke-width="2" stroke-linecap="round"/>
        <line x1="62" y1="38" x2="70" y2="30" stroke="#2c1810" stroke-width="2" stroke-linecap="round"/>
        <line x1="28" y1="60" x2="24" y2="72" stroke="#2c1810" stroke-width="2" stroke-linecap="round"/>
        <line x1="44" y1="60" x2="48" y2="72" stroke="#2c1810" stroke-width="2" stroke-linecap="round"/>
      </svg>
      <span class="splash-char-name">ì¼€ì´í¬</span>
    </div>
    <div class="splash-char" style="animation-delay:.2s">
      <svg viewBox="0 0 72 80" xmlns="http://www.w3.org/2000/svg">
        <ellipse cx="36" cy="72" rx="18" ry="4" fill="#b8905a" opacity=".2"/>
        <path d="M10 46 Q10 68 36 68 Q62 68 62 46 Z" fill="#2a1408"/>
        <path d="M12 46 Q12 64 36 64 Q60 64 60 46 Z" fill="#8db87a"/>
        <circle cx="36" cy="36" r="26" fill="#5c2e10"/>
        <circle cx="28" cy="34" r="2.5" fill="#1a0a04"/><circle cx="44" cy="34" r="2.5" fill="#1a0a04"/>
        <path d="M30 40 Q36 45 42 40" stroke="#1a0a04" stroke-width="1.8" fill="none" stroke-linecap="round"/>
        <line x1="10" y1="38" x2="2" y2="30" stroke="#2c1810" stroke-width="2" stroke-linecap="round"/>
        <line x1="62" y1="38" x2="70" y2="30" stroke="#2c1810" stroke-width="2" stroke-linecap="round"/>
        <line x1="28" y1="62" x2="24" y2="74" stroke="#2c1810" stroke-width="2" stroke-linecap="round"/>
        <line x1="44" y1="62" x2="48" y2="74" stroke="#2c1810" stroke-width="2" stroke-linecap="round"/>
      </svg>
      <span class="splash-char-name">ë‘ì«€ì¿ </span>
    </div>
    <div class="splash-char" style="animation-delay:.4s;margin-bottom:8px">
      <svg viewBox="0 0 72 80" xmlns="http://www.w3.org/2000/svg">
        <rect x="34" y="58" width="4" height="22" rx="2" fill="#8B6347"/>
        <ellipse cx="36" cy="56" rx="10" ry="10" fill="#e03c31"/>
        <ellipse cx="36" cy="40" rx="9" ry="9" fill="#7b4fa6"/>
        <ellipse cx="36" cy="26" rx="8" ry="8" fill="#f4a261"/>
        <circle cx="30" cy="40" r="2" fill="#2c1810"/><circle cx="42" cy="40" r="2" fill="#2c1810"/>
        <path d="M32 45 Q36 49 40 45" stroke="#2c1810" stroke-width="1.5" fill="none" stroke-linecap="round"/>
      </svg>
      <span class="splash-char-name">íƒ•í›„ë£¨</span>
    </div>
    <div class="splash-char" style="animation-delay:.6s">
      <svg viewBox="0 0 72 80" xmlns="http://www.w3.org/2000/svg">
        <path d="M10 52 Q10 70 36 70 Q62 70 62 52 Z" fill="#d4956a"/>
        <ellipse cx="36" cy="40" rx="26" ry="20" fill="#fdfaf6"/>
        <ellipse cx="36" cy="52" rx="26" ry="6" fill="#b8622a"/>
        <circle cx="28" cy="42" r="2" fill="#2c1810"/><circle cx="44" cy="42" r="2" fill="#2c1810"/>
        <path d="M30 48 Q36 53 42 48" stroke="#2c1810" stroke-width="1.5" fill="none" stroke-linecap="round"/>
        <line x1="10" y1="46" x2="2" y2="38" stroke="#2c1810" stroke-width="2" stroke-linecap="round"/>
        <line x1="62" y1="46" x2="70" y2="38" stroke="#2c1810" stroke-width="2" stroke-linecap="round"/>
        <line x1="28" y1="70" x2="24" y2="80" stroke="#2c1810" stroke-width="2" stroke-linecap="round"/>
        <line x1="44" y1="70" x2="48" y2="80" stroke="#2c1810" stroke-width="2" stroke-linecap="round"/>
      </svg>
      <span class="splash-char-name">ê³µê¹ƒë°¥</span>
    </div>
  </div>
  <button class="splash-btn" onclick="goTo('page-quiz')">ì‹œì‘í•˜ê¸° ğŸ½ï¸</button>
</div>

<!-- QUIZ -->
<div class="page" id="page-quiz">
  <div class="page-wrap">
    <div class="page-header">
      <div class="page-tag">ğŸ² STEP 1 / 2</div>
      <h2>ë‚˜ëŠ” ì–´ë–¤ <em>ìŒì‹</em>ì¼ê¹Œ?</h2>
      <p>7ê°€ì§€ ì§ˆë¬¸ì— ì†”ì§í•˜ê²Œ ë‹µí•´ì£¼ì„¸ìš”!</p>
    </div>
    <div class="quiz-card">
      <div class="quiz-progress" id="quiz-progress"></div>
      <div class="quiz-step-label" id="quiz-step-label"></div>
      <div id="quiz-body"></div>
    </div>
  </div>
</div>

<!-- STORY -->
<div class="page" id="page-story">
  <div class="page-wrap">
    <div class="page-header">
      <div class="page-tag">âœï¸ STEP 2 / 2</div>
      <h2>ë‹¹ì‹ ì˜ <em>ì°</em>ì„ í’€ì–´ë´ìš”</h2>
      <p>ì° ì† ìŒì‹ìœ¼ë¡œ ë‚˜ë§Œì˜ ìºë¦­í„°ê°€ íƒ„ìƒí•´ìš”!</p>
    </div>
    <div class="story-card">
      <div class="story-intro">
        ğŸ“¢ ì°ì— ë“±ì¥í•˜ëŠ” ìŒì‹ì„ ì•Œë ¤ì£¼ë©´, ê·¸ ìŒì‹ì´ ë‚˜ì˜ ìŒì‹ ìºë¦­í„°ê°€ ë¼ìš”!
      </div>
      <div class="story-field">
        <label>ğŸ½ï¸ ë‚´ ì°ì˜ ì£¼ì¸ê³µ ìŒì‹ì€? <span style="color:var(--accent)">*</span></label>
        <div style="position:relative">
          <input type="text" id="food-input"
            placeholder="ì˜ˆ) ë–¡ë³¶ì´, ì¹˜í‚¨, ë¼ë©´, ì‚¼ê²¹ì‚´..."
            style="width:100%;padding:14px 16px;border-radius:12px;border:2px solid var(--border);background:#FDFAF6;font-size:15px;color:var(--dark);font-family:'Noto Sans KR',sans-serif;outline:none;transition:border-color .2s;"
            oninput="this.style.borderColor=this.value.trim()?'var(--caramel)':'var(--border)'"
            onfocus="this.style.borderColor='var(--toast)'"
            onblur="this.style.borderColor=this.value.trim()?'var(--caramel)':'var(--border)'"
          >
          <span id="food-emoji-preview" style="position:absolute;right:14px;top:50%;transform:translateY(-50%);font-size:22px;transition:all .3s">ğŸ½ï¸</span>
        </div>
        <p style="font-size:11px;color:var(--muted);margin-top:6px;padding-left:2px">ì´ ìŒì‹ìœ¼ë¡œ ê·€ì—¬ìš´ ìºë¦­í„°ë¥¼ AIê°€ ê·¸ë ¤ë“œë ¤ìš” ğŸ¨</p>
      </div>
      <div class="theme-label">ì°ì˜ ì£¼ì œë¥¼ ê³¨ë¼ì£¼ì„¸ìš”</div>
      <div class="theme-chips">
        <button class="theme-chip" onclick="toggleChip(this)">ğŸ’˜ ì—°ì•  ì°</button>
        <button class="theme-chip" onclick="toggleChip(this)">âœ‚ï¸ ì¸ê°„ê´€ê³„ ì°</button>
        <button class="theme-chip" onclick="toggleChip(this)">ğŸ˜µ ì§ì¥/í•™êµ ì°</button>
        <button class="theme-chip" onclick="toggleChip(this)">ğŸ‘¨â€ğŸ‘©â€ğŸ‘§ ê°€ì¡± ì°</button>
        <button class="theme-chip" onclick="toggleChip(this)">ğŸ›ï¸ í‘ì—­ì‚¬ ì°</button>
        <button class="theme-chip" onclick="toggleChip(this)">â˜€ï¸ ì¼ìƒ ì°</button>
      </div>
      <div class="story-field">
        <label>ì°ì„ ì ì–´ì£¼ì„¸ìš”</label>
        <textarea id="story-text" placeholder="ì˜ˆ) ì·¨ì—… ì¤€ë¹„ 3ë…„ì§¸ì¸ë°, ë§¤ì¼ ë°¤ ì–´ë¨¸ë‹ˆê°€ ë“ì—¬ì£¼ì‹œëŠ” ë¼ë©´ì´ ì œ ìœ ì¼í•œ ìœ„ë¡œì˜ˆìš”. ê·¸ ëƒ„ë¹„ ëšœê»‘ ì—¬ëŠ” ì†Œë¦¬ê°€ ì„¸ìƒì—ì„œ ì œì¼ ë”°ëœ»í•œ ì†Œë¦¬ ê°™ì•„ì„œ..." oninput="updateCount(this,'story-count',300)"></textarea>
        <span class="char-count"><span id="story-count">0</span>/300</span>
      </div>
      <div class="temp-label">ì´ ì°ì˜ ê°ì • ì˜¨ë„ëŠ”? ğŸŒ¡ï¸</div>
      <div class="temp-track">
        <span class="temp-end">ğŸ˜¢ ì°¨ê°‘ê²Œ</span>
        <div class="temp-btns" id="temp-btns"></div>
        <span class="temp-end">ëœ¨ê²ê²Œ ğŸ˜Š</span>
      </div>
      <button class="btn-submit" onclick="goToResult()">ğŸ½ï¸ ë‚´ ìŒì‹ ìºë¦­í„° ë³´ê¸°</button>
    </div>
  </div>
</div>

<!-- RESULT -->
<div class="page" id="page-result">
  <div class="result-wrap">
    <div id="result-loading-screen" class="result-loading-screen">
      <div class="big-spinner"></div>
      <p>ë‹¹ì‹ ì˜ ìŒì‹ ìºë¦­í„°ë¥¼<br>ì—´ì‹¬íˆ ê·¸ë¦¬ê³  ìˆì–´ìš”... ğŸ¨<br><span style="font-size:12px;opacity:.6">ì° ì† ìŒì‹ + ì„±í–¥ ë¶„ì„ ì¤‘</span></p>
    </div>
    <div id="result-content" style="display:none">
      <div style="text-align:center;padding:32px 0 20px">
        <div class="page-tag">ğŸ‰ ê²°ê³¼ ê³µê°œ!</div>
      </div>
      <div class="result-card">
        <div class="char-img-wrap" id="char-img-wrap">
          <div class="char-loading-inner" id="char-loading-inner">
            <div class="small-spinner"></div>
            <p>ìºë¦­í„° ìƒì„± ì¤‘...</p>
          </div>
          <img class="char-img" id="char-img" src="" alt="" style="display:none">
        </div>
        <div class="result-food" id="result-food"></div>
        <div class="result-desc" id="result-desc"></div>
        <div class="result-tag" id="result-tag"></div>
      </div>
      <div class="ai-box">
        <div class="ai-box-title">ğŸ¤– AI ì„±í–¥ ë¶„ì„</div>
        <div class="ai-loading" id="ai-loading">
          <div class="ai-dots"><span></span><span></span><span></span></div>
          <span>ì° + ì„±í–¥ì„ ë¶„ì„í•˜ëŠ” ì¤‘...</span>
        </div>
        <div class="ai-content" id="ai-content" style="display:none"></div>
      </div>
      <div class="recap-card" id="recap-card"></div>
      <button class="btn-to-phone" onclick="goTo('page-phone')">ğŸ“± ì—°ë½ì²˜ ë‚¨ê¸°ê¸°</button>
      <div style="text-align:center;margin-top:14px">
        <button onclick="restartAll()" style="padding:9px 22px;border-radius:20px;border:1.5px solid var(--toast);background:transparent;color:var(--toast);font-size:13px;cursor:pointer;font-family:'Noto Sans KR',sans-serif;transition:all .2s;">â†© ì²˜ìŒë¶€í„° ë‹¤ì‹œ</button>
      </div>
    </div>
  </div>
</div>

<!-- PHONE -->
<div class="page" id="page-phone">
  <div class="phone-wrap">
    <div class="phone-emoji">ğŸ“±</div>
    <div class="phone-title">ë§ˆì§€ë§‰ìœ¼ë¡œ<br>ì—°ë½ì²˜ë¥¼ ë‚¨ê²¨ì£¼ì„¸ìš”!</div>
    <div class="phone-desc">ë‹¹ì‹ ì˜ ì°ì´ ì›¹íˆ°ìœ¼ë¡œ ì œì‘ë  ê²½ìš°<br>ê°€ì¥ ë¨¼ì € ì—°ë½ë“œë¦´ê²Œìš” ğŸ¨<br><span style="font-size:12px;opacity:.7">(ì„ íƒ ì‚¬í•­ì´ì—ìš”)</span></div>
    <input type="tel" class="phone-input" id="phone-input" placeholder="010-0000-0000" inputmode="numeric" oninput="formatPhone(this)">
    <span class="phone-skip" onclick="goTo('page-done')">ê±´ë„ˆë›°ê¸°</span>
    <div class="permission-row">
      <div class="custom-cb" id="consent-cb" onclick="toggleConsent()"></div>
      <div class="permission-text">
        <strong>ì‚¬ì—° ë° ì—°ë½ì²˜ í™œìš©ì— ë™ì˜í•©ë‹ˆë‹¤.</strong><br>
        ì œì¶œëœ ë‚´ìš©ì€ ì›¹íˆ° ìŠ¤í† ë¦¬ ì œì‘ì— ì°¸ê³ ë  ìˆ˜ ìˆìœ¼ë©°, ì‹¤ëª…/ê°œì¸ì •ë³´ëŠ” ê³µê°œë˜ì§€ ì•ŠìŠµë‹ˆë‹¤.
      </div>
    </div>
    <button class="btn-finish" onclick="submitPhone()">ğŸ½ï¸ ì™„ë£Œí•˜ê¸°</button>
  </div>
</div>

<!-- DONE -->
<div class="page" id="page-done">
  <div class="done-wrap">
    <div class="done-emoji">ğŸ«¶</div>
    <div class="done-title">ê³ ë§ˆì›Œìš”, ì†Œì¤‘í•œ ì°!</div>
    <div class="done-desc">ë‹¹ì‹ ì˜ ì´ì•¼ê¸°ê°€ ë”°ëœ»í•œ ìŒì‹ ìºë¦­í„°ë¡œ<br>ë‹¤ì‹œ ì„¸ìƒì— ë‚˜ì˜¬ ë‚ ì„ ê¸°ë‹¤ë ¤ì£¼ì„¸ìš”.<br><br>ì°í‘¸ë“œê°€ ì‘ì›í• ê²Œìš” ğŸ½ï¸</div>
    <div class="done-tag">#ì°í‘¸ë“œ #ë‹¹ì‹ ì˜ìŒì‹ê³¼ì°ì€</div>
  </div>
</div>

<script>
// â”€â”€ PAGE NAV â”€â”€
function goTo(id) {
  document.querySelectorAll('.page').forEach(p => p.classList.remove('active'));
  document.getElementById(id).classList.add('active');
  window.scrollTo(0,0);
}
function restartAll() {
  answers=[]; answerLabels=[]; currentQ=0; selectedIdx=null;
  initQuiz(); initTempBtns();
  document.getElementById('food-input').value='';
  document.getElementById('story-text').value='';
  document.getElementById('story-count').textContent='0';
  goTo('page-quiz');
}

// â”€â”€ QUIZ â”€â”€
const questions = [
  { q:"ì§€ê¸ˆ ë‹¹ì¥ ë¨¹ê³  ì‹¶ì€ ê±´?", opts:[{e:"ğŸŒ¶ï¸",t:"ë§¤ì½¤í•œ ê±°",score:{A:2}},{e:"ğŸ°",t:"ë‹¬ë‹¬í•œ ê±°",score:{B:2}},{e:"ğŸ§‚",t:"ì§­ì§¤í•œ ê±°",score:{C:2}},{e:"ğŸ²",t:"ëœ¨ëˆí•œ êµ­ë¬¼",score:{D:2}}] },
  { q:"ë„ˆëŠ” ì–´ë–¤ \"ë¼\"ì•¼?", opts:[{e:"ğŸ•",t:"ì„¸ë¼ â€” ê·œì¹™ì ì´ê³  ë£¨í‹´ ìˆëŠ” ìƒí™œ",score:{C:2}},{e:"ğŸ•‘",t:"ë‘ë¼ â€” ë°”ì˜ì§€ë§Œ ì±™ê¸¸ ê±´ ì±™ê¹€",score:{B:2}},{e:"ğŸ•’",t:"í•œë¼ â€” ì •ì‹ ì—†ì´ í•˜ë£¨ ë³´ëƒ„",score:{A:2}},{e:"ğŸ’¨",t:"ë–¼ë¼ â€” ëŒ€ì¶© ë•Œìš°ëŠ” ìš”ì¦˜",score:{D:2}}] },
  { q:"ë°°ê³ í”„ë©´ ë‚˜ëŠ”?", opts:[{e:"ğŸ˜¤",t:"ì˜ˆë¯¼í•´ì§",score:{A:2}},{e:"ğŸ¤",t:"ì¡°ìš©í•´ì§",score:{B:2}},{e:"ğŸ—£ï¸",t:"ì•„ë¬´ ë§ì´ë‚˜ í•¨",score:{C:2}},{e:"ğŸ´",t:"ê·¸ëƒ¥ ì•„ë¬´ê±°ë‚˜ ë¨¹ìŒ",score:{D:2}}] },
  { q:"ì¹œêµ¬ë‘ ë©”ë‰´ ê³ ë¥¼ ë•Œ ë‚˜ëŠ”?", opts:[{e:"ğŸ‘†",t:"ë‚´ê°€ ì •í•¨",score:{A:2}},{e:"ğŸ™ƒ",t:"\"ì•„ë¬´ê±°ë‚˜\" í•´ë†“ê³  ê²°êµ­ ì˜ê²¬ ëƒ„",score:{B:2}},{e:"ğŸ«¶",t:"ìƒëŒ€ ì˜ê²¬ ì¡´ì¤‘",score:{C:2}},{e:"ğŸ’­",t:"ì†ìœ¼ë¡œ ë”´ ë©”ë‰´ ìƒê°í•¨",score:{D:2}}] },
  { q:"ì—°ì• ë¥¼ ìŒì‹ì— ë¹„ìœ í•˜ë©´?", opts:[{e:"ğŸ«•",t:"ë§ˆë¼íƒ• (ì¤‘ë…ì ì´ê³  ìê·¹ì )",score:{A:3}},{e:"ğŸ‚",t:"ì¼€ì´í¬ (ê¸°ë…ì¼ ë§ê³  ë‹¬ë‹¬)",score:{B:3}},{e:"ğŸ·",t:"ì™€ì¸ (ì‹œê°„ ì§€ë‚˜ì•¼ ê¹Šì–´ì§)",score:{C:3}},{e:"ğŸ”º",t:"í¸ì˜ì  ì‚¼ê°ê¹€ë°¥ (ê°‘ìê¸° ì‹œì‘, ê°‘ìê¸° ë)",score:{D:3}}] },
  { q:"ìŠ¤íŠ¸ë ˆìŠ¤ ë°›ì„ ë•Œ ë‹¹ì‹ ì€?", opts:[{e:"ğŸ”¥",t:"ë§¤ìš´ ê±°ë¡œ í’€ì–´ë²„ë¦°ë‹¤",score:{A:2}},{e:"ğŸ«",t:"ë‹¬ë‹¬í•œ ë””ì €íŠ¸ ì°¾ëŠ”ë‹¤",score:{B:2}},{e:"âš¡",t:"ê·¸ëƒ¥ ì•„ë¬´ê±°ë‚˜ ë¹¨ë¦¬ ë¨¹ëŠ”ë‹¤",score:{C:2}},{e:"ğŸš«",t:"ì•„ì˜ˆ ì•ˆ ë¨¹ëŠ”ë‹¤",score:{D:2}}] },
  { q:"ìš”ì¦˜ ë‚´ê°€ ë§ì´ í‘¸ëŠ” ë‚˜ì˜ ì°ì€?", opts:[{e:"ğŸ’˜",t:"ë§¤ìš´ ì—°ì•  ì° (ì—°ì• )",score:{A:3}},{e:"âœ‚ï¸",t:"ì¹œêµ¬ ì†ì ˆ ì° (ì¸ê°„ê´€ê³„)",score:{D:3}},{e:"ğŸ˜µ",t:"ìŠ¤íŠ¸ë ˆìŠ¤ì¸ íšŒì‚¬/í•™êµ ì° (ì§„ë¡œ ê³ ë¯¼)",score:{C:3}},{e:"ğŸ›ï¸",t:"í˜¼ì ì´ë¶ˆí‚¥í•˜ëŠ” í‘ì—­ì‚¬ ì°",score:{B:3}}] },
];
const scoreResults = [
  {type:"A",e:"ğŸŒ¶ï¸",food:"ë§ˆë¼íƒ•",desc:"ìê·¹ì ì´ê³  ê°•ë ¬í•œ ë§¤ë ¥ì˜ ì†Œìœ ì! í•œ ë²ˆ ë¹ ì§€ë©´ ëª» í—¤ì–´ë‚˜ì˜¤ëŠ” ì¤‘ë…ì ì¸ ì¡´ì¬ì˜ˆìš”. ë‹¤ìŒì— ë˜ ì°¾ê²Œ ë˜ëŠ” ì‚¬ëŒ.",tag:"#ì¤‘ë…ì£¼ì˜ #ìê·¹ë‚¨ì_ìê·¹ì—¬ì"},
  {type:"B",e:"ğŸ‚",food:"ë”¸ê¸° ì¼€ì´í¬",desc:"ë‹¬ë‹¬í•˜ê³  ì‚¬ë‘ìŠ¤ëŸ¬ìš´ ì—ë„ˆì§€ë¥¼ ê°€ì§„ ì‚¬ëŒ. íŠ¹ë³„í•œ ìˆœê°„ë§ˆë‹¤ ìƒê°ë‚˜ëŠ”, ì†Œì¤‘í•œ ë‚ ì˜ ì£¼ì¸ê³µ ê°™ì€ ì¡´ì¬ì˜ˆìš”.",tag:"#ë‹¬ë‹¬í•¨ì£¼ì˜ #ê¸°ë…ì¼ì¥ì¸"},
  {type:"C",e:"ğŸ·",food:"ì™€ì¸",desc:"ì²˜ìŒì—” ë‚¯ì„¤ì§€ë§Œ ì•Œì•„ê°ˆìˆ˜ë¡ ê¹Šì–´ì§€ëŠ” ì‚¬ëŒ. ì„£ë¶ˆë¦¬ íŒë‹¨í•˜ë©´ ì†í•´ì˜ˆìš”. ì‹œê°„ì´ ì§€ë‚ ìˆ˜ë¡ ì§„ê°€ê°€ ë“œëŸ¬ë‚©ë‹ˆë‹¤.",tag:"#ìˆ™ì„±í˜•ì¸ê°„ #ì²œì²œíˆì•Œì•„ê°€ì"},
  {type:"D",e:"ğŸ²",food:"í•´ì¥êµ­",desc:"í˜ë“  ë‚  ê°€ì¥ ë¨¼ì € ìƒê°ë‚˜ëŠ” ì‚¬ëŒ. ë§ ì—†ì–´ë„ ê³ì— ìˆìœ¼ë©´ ë“ ë“ í•˜ê³ , ê±°ì°½í•˜ì§€ ì•Šì•„ë„ ì§„ì‹¬ì´ ëŠê»´ì§€ëŠ” ì¡´ì¬ì˜ˆìš”.",tag:"#ì§„êµ­ì¸ìƒ #ìˆì–´ì•¼ì™„ì„±"},
];

let answers=[], answerLabels=[], currentQ=0, selectedIdx=null;

function initQuiz() {
  answers=[]; answerLabels=[]; currentQ=0; selectedIdx=null;
  renderProgress(); renderQuestion();
}
function renderProgress() {
  const p=document.getElementById('quiz-progress'); p.innerHTML='';
  questions.forEach((_,i)=>{ const d=document.createElement('div'); d.className='quiz-dot'+(i===currentQ?' active':i<currentQ?' done':''); p.appendChild(d); });
  document.getElementById('quiz-step-label').textContent=`${currentQ+1} / ${questions.length}`;
}
function renderQuestion() {
  const q=questions[currentQ]; const isLast=currentQ===questions.length-1;
  document.getElementById('quiz-body').innerHTML=`
    <div class="quiz-question fade-in">${q.q}</div>
    <div class="quiz-options fade-in">${q.opts.map((o,i)=>`<button class="quiz-option" onclick="selectOption(${i},this)"><span class="opt-emoji">${o.e}</span>${o.t}</button>`).join('')}</div>
    <div id="next-wrap" style="display:none"><button class="btn-next" onclick="goNext()">${isLast?'ì° ì…ë ¥í•˜ê¸° âœï¸':'ë‹¤ìŒ ì§ˆë¬¸ â†’'}</button></div>`;
}
function selectOption(idx,btn) {
  document.querySelectorAll('.quiz-option').forEach(b=>b.classList.remove('selected'));
  btn.classList.add('selected'); selectedIdx=idx;
  document.getElementById('next-wrap').style.display='block';
}
function goNext() {
  if(selectedIdx===null)return;
  const q=questions[currentQ];
  answers.push(q.opts[selectedIdx].score);
  answerLabels.push({q:q.q,opts:q.opts,chosen:selectedIdx});
  selectedIdx=null; currentQ++;
  if(currentQ>=questions.length) goTo('page-story');
  else { renderProgress(); renderQuestion(); }
}

// â”€â”€ STORY â”€â”€
function toggleChip(btn){ btn.classList.toggle('active'); }
function updateCount(el,id,max){ const len=Math.min(el.value.length,max); document.getElementById(id).textContent=len; if(el.value.length>max)el.value=el.value.substring(0,max); }
function initTempBtns() {
  const c=document.getElementById('temp-btns'); c.innerHTML='';
  for(let i=1;i<=5;i++){ const b=document.createElement('button'); b.className='temp-btn'; b.textContent=i; b.onclick=()=>{ document.querySelectorAll('.temp-btn').forEach(x=>x.classList.remove('active')); b.classList.add('active'); }; c.appendChild(b); }
}

// â”€â”€ IMAGE PROMPT (í•µì‹¬ ê°œì„ ) â”€â”€
const GEMINI_API_KEY='AIzaSyALM4DZgw-FAL9cPmeq5EtY8ViydZJ8iMA';

// ìŒì‹ë³„ ì‹œê°ì  íŠ¹ì§• ì‚¬ì „ â€” ëª¨ë¸ì´ ìŒì‹ì„ ì •í™•íˆ ê·¸ë¦¬ë„ë¡ ìœ ë„
const FOOD_VISUAL_HINTS = {
  'ë–¡ë³¶ì´': 'glossy red gochujang-coated cylindrical rice cakes (tteok), bright red sauce coating, fish cake pieces visible',
  'ë¼ë©´': 'wavy yellow instant noodles with swirling broth steam, red soup base, floating green onion',
  'ì¹˜í‚¨': 'golden-brown crispy fried chicken pieces with crunchy breading texture, glistening surface',
  'ì‚¼ê²¹ì‚´': 'thick slices of grilled pork belly with distinct fat and meat layers, charred grill marks',
  'í”¼ì': 'round pizza with thick melted cheese pull, red tomato sauce, toppings visible from above',
  'í–„ë²„ê±°': 'tall stacked burger with sesame bun top, visible lettuce, tomato, beef patty layers',
  'ì´ˆë°¥': 'nigiri sushi â€” oval white rice mound topped with salmon or tuna, pink fish draping over',
  'ë§ˆë¼íƒ•': 'deep red spicy broth with floating chili peppers, various ingredients, heavy red oil sheen',
  'ìˆœëŒ€': 'dark grey cylindrical blood sausage stuffed with glass noodles and vegetables, sliced cross-section',
  'ê°ìíƒ•': 'pork spine bones in deep red spicy broth with whole potatoes, perilla leaves floating',
  'íŒŒìŠ¤íƒ€': 'twirled spaghetti with red tomato sauce or creamy white sauce, parmesan shavings',
  'ì¼€ì´í¬': 'layered cake with pink strawberry cream frosting, whole strawberries on top, cross-section layers',
  'ì•„ì´ìŠ¤í¬ë¦¼': 'soft-serve ice cream swirl in a cone, pastel colors, melting slightly at edges',
  'ë„ë„›': 'ring-shaped donut with pink glaze and rainbow sprinkles on top',
  'ë¹µ': 'round golden-brown bread loaf with cracked crust, fluffy interior texture visible',
  'ê¹€ë°¥': 'cylindrical gimbap roll sliced to show colorful cross-section: yellow egg, orange carrot, green spinach, white rice',
  'ë§Œë‘': 'plump pleated dumpling with pinched folds on top, semi-translucent steamed skin',
  'êµ­ë°¥': 'large bowl of pork and rice soup with green onions and clear broth, steam rising',
  'íƒ•ìˆ˜ìœ¡': 'crispy pork pieces in glossy sweet-and-sour red sauce with pineapple chunks',
  'ì§œì¥ë©´': 'black bean paste noodles â€” dark brown glossy sauce coating thick noodles, julienned cucumber on top',
};

function getFoodVisualHint(foodName) {
  // ì§ì ‘ ë§¤ì¹­
  if(FOOD_VISUAL_HINTS[foodName]) return FOOD_VISUAL_HINTS[foodName];
  // ë¶€ë¶„ ë§¤ì¹­
  for(const [key, val] of Object.entries(FOOD_VISUAL_HINTS)) {
    if(foodName.includes(key) || key.includes(foodName)) return val;
  }
  // ë§¤ì¹­ ì—†ìœ¼ë©´ ìŒì‹ ì´ë¦„ ê·¸ëŒ€ë¡œ ì˜ì–´ë¡œ ì§ì ‘ ë¬˜ì‚¬í•˜ë„ë¡ ìœ„ì„
  return `recognizable Korean dish called "${foodName}" â€” show its most distinctive visual features: characteristic colors, textures, and shape`;
}

function makeFoodImagePrompt(foodName) {
  const visualHint = getFoodVisualHint(foodName);
  return `Create a cute kawaii chibi food character illustration on a pure white background.

FOOD BODY (most important â€” the character's entire HEAD and TORSO must be the food itself):
The character's body IS a ${foodName}. Visual reference: ${visualHint}.
Make the food INSTANTLY RECOGNIZABLE â€” use accurate colors, textures, and distinctive features of the food.
The food shape should be realistic and detailed enough that anyone could identify what food it is at a glance.

FOOD VISUAL REQUIREMENTS:
- Show the food's authentic colors (e.g. if it's red spicy food, use vivid red; if it's golden fried food, use golden-brown)
- Show key identifying textures (glossy sauce, crispy coating, layered structure, etc.)
- The food should be the DOMINANT visual element â€” large, centered, clearly rendered

CHARACTER DETAILS (added ON TOP of the food body):
- Two tiny black dot eyes with white highlights
- A small curved black smile line for mouth
- Two thin black stick arms extending from the sides of the food body (with tiny rounded hands)
- Two thin black stick legs below the food body (with tiny rounded feet)
- Optional: small rosy cheek circles for cuteness

STYLE:
- Clean, flat illustration style (like LINE Friends or Kakao Friends characters)
- Bold outlines on the food body
- Pure white (#FFFFFF) background â€” nothing else
- No text, no labels, no shadows
- Centered composition, full character visible

The result should feel like an adorable sticker where the food is unmistakably "${foodName}".`;
}

async function generateCharImage(foodName) {
  const prompt = makeFoodImagePrompt(foodName);
  for(const {ver,model} of [
    {ver:'v1alpha',model:'gemini-2.0-flash-exp-image-generation'},
    {ver:'v1beta',model:'gemini-2.0-flash-exp'}
  ]) {
    try {
      const r=await fetch(`https://generativelanguage.googleapis.com/${ver}/models/${model}:generateContent?key=${GEMINI_API_KEY}`,{
        method:'POST',headers:{'Content-Type':'application/json'},
        body:JSON.stringify({contents:[{parts:[{text:prompt}]}],generationConfig:{responseModalities:['IMAGE','TEXT']}})
      });
      if(!r.ok){console.warn(`[${model}]`,r.status);continue;}
      const d=await r.json();
      const ip=(d.candidates?.[0]?.content?.parts||[]).find(p=>p.inlineData);
      if(ip) return `data:${ip.inlineData.mimeType};base64,${ip.inlineData.data}`;
    } catch(e){console.warn(e);}
  }
  throw new Error('ì´ë¯¸ì§€ ìƒì„± ì‹¤íŒ¨');
}

// â”€â”€ ANALYSIS PROMPT (í•µì‹¬ ê°œì„ ) â”€â”€
async function generateGeminiAnalysis(answerLabels, res, story, foodName) {
  const chosenList = answerLabels.map((item,qi)=>{
    const c = item.opts[item.chosen];
    return `Q${qi+1}. ${item.q} â†’ ${c.e} ${c.t}`;
  }).join('\n');

  const storySection = story
    ? `[ì° ë‚´ìš©]\n"${story}"`
    : `[ì° ì—†ìŒ â€” ìŒì‹ ì„ íƒê³¼ ì„±í–¥ ë°ì´í„°ë§Œìœ¼ë¡œ ë¶„ì„]`;

  const prompt = `ë‹¹ì‹ ì€ í•œêµ­ì˜ ì¸ê¸° MBTI ë¶„ì„ê°€ì´ì ìŒì‹ ì¹¼ëŸ¼ë‹ˆìŠ¤íŠ¸ì˜ˆìš”. 
ì¬ì¹˜ ìˆê³  ê³µê° ê°€ëŠ” ë¬¸ì¥ìœ¼ë¡œ, ì½ë‹¤ ë³´ë©´ "ì´ê±° ë‚˜ ì–˜ê¸°ì–ì•„?!" í•˜ê³  ë¬´ë¦ íƒ ì¹˜ê²Œ ë§Œë“œëŠ” ì„±í–¥ ë¶„ì„ì„ ì¨ì£¼ì„¸ìš”.
ë°˜ë§+ì¡´ëŒ“ë§ í˜¼ìš© ê¸ˆì§€. ì¹œê·¼í•œ ì¡´ëŒ“ë§ë¡œ í†µì¼í•´ì£¼ì„¸ìš”.

â”â”â” ì…ë ¥ ë°ì´í„° â”â”â”
[ì„±í–¥ ìœ í˜•] ${res.food} íƒ€ì… (${res.tag})
[í…ŒìŠ¤íŠ¸ ë‹µë³€]
${chosenList}
[ì° ì† ìŒì‹] ${foodName}
${storySection}

â”â”â” ì¶œë ¥ í˜•ì‹ (ë¼ë²¨ ê·¸ëŒ€ë¡œ ìœ ì§€, ê° í•­ëª© í•œ ì¤„ì”©) â”â”â”

í•œì¤„ìš”ì•½: [ì´ ì‚¬ëŒì„ ìŒì‹+MBTI ìŠ¤íƒ€ì¼ë¡œ ì••ì¶•í•œ í•œ ì¤„. ì¬ì¹˜ìˆëŠ” ë¹„ìœ ë‚˜ ë°˜ì „ í¬í•¨. ì´ëª¨ì§€ 1~2ê°œ]

íŠ¹ì§•1: [ì´ ì‚¬ëŒë§Œì˜ ë…íŠ¹í•œ í–‰ë™ íŒ¨í„´ì´ë‚˜ ìŠµê´€. "~í•˜ëŠ” íƒ€ì…ì´ì—ìš”" í˜•íƒœë¡œ]
íŠ¹ì§•2: [ê´€ê³„ì—ì„œ ë“œëŸ¬ë‚˜ëŠ” ì´ ì‚¬ëŒì˜ íŠ¹ì„±. êµ¬ì²´ì  ìƒí™© ë¬˜ì‚¬ í¬í•¨]
íŠ¹ì§•3: [ì´ ì‚¬ëŒì´ ìŠ¤ìŠ¤ë¡œëŠ” ì˜ ëª¨ë¥´ëŠ” ë§¤ë ¥ í¬ì¸íŠ¸. ë”°ëœ»í•˜ê²Œ]

ìŒì‹ë¶„ì„: [ì™œ í•˜í•„ "${foodName}"ì„ ì°ì˜ ì£¼ì¸ê³µìœ¼ë¡œ ì„ íƒí–ˆëŠ”ì§€, ê·¸ ì‹¬ë¦¬ë¥¼ ë¶„ì„. ìŒì‹ íŠ¹ì„±ê³¼ ì´ ì‚¬ëŒ ì„±í–¥ ì—°ê²°. ì°ì´ ìˆìœ¼ë©´ ì° ë‚´ìš©ë„ ë°˜ì˜]

ê²°ì •ì í•œë§ˆë””: [ì´ ì‚¬ëŒì—ê²Œ í•´ì£¼ê³  ì‹¶ì€ ë”°ëœ»í•˜ê³  ì¸ìƒì ì¸ í•œë§ˆë””. ì‰¼í‘œ í˜¸í¡ ì‚´ë ¤ì„œ]

íƒœê·¸: #íƒœê·¸1 #íƒœê·¸2 #íƒœê·¸3 #íƒœê·¸4

â”â”â” ì‘ì„± ê°€ì´ë“œ â”â”â”
- ì§„ë¶€í•œ í‘œí˜„ ê¸ˆì§€: "íŠ¹ë³„í•œ", "ë§¤ë ¥ì ì¸", "ì†Œì¤‘í•œ" ê°™ì€ ë»”í•œ ë‹¨ì–´ëŠ” ì“°ì§€ ë§ˆì„¸ìš”
- êµ¬ì²´ì„±: ì¶”ìƒì  í‘œí˜„ ëŒ€ì‹  ì‹¤ìƒí™œ ìƒí™©ìœ¼ë¡œ ë¬˜ì‚¬í•´ì£¼ì„¸ìš”  
- ìŒì‹ ì—°ê²°: ë°˜ë“œì‹œ "${foodName}"ì˜ ë§›/ì§ˆê°/ë¨¹ëŠ” ë°©ì‹ê³¼ ì´ ì‚¬ëŒì˜ ì„±í–¥ì„ ì—°ê²°í•´ì£¼ì„¸ìš”
- ê¸¸ì´: ê° í•­ëª© 1~2ë¬¸ì¥ (ê²°ì •ì í•œë§ˆë””ëŠ” 1ë¬¸ì¥)
- íƒœê·¸: ì´ ì‚¬ëŒì—ê²Œ ë”± ë§ëŠ” ì‹ ì¡°ì–´/ë°ˆ ìŠ¤íƒ€ì¼ë¡œ`;

  const textModels = [
    {ver:'v1beta', model:'gemini-2.0-flash-lite'},
    {ver:'v1beta', model:'gemini-2.0-flash'},
    {ver:'v1beta', model:'gemini-1.5-flash'},
    {ver:'v1beta', model:'gemini-1.5-flash-latest'},
    {ver:'v1beta', model:'gemini-pro'},
  ];
  for(const {ver, model} of textModels) {
    try {
      const r = await fetch(`https://generativelanguage.googleapis.com/${ver}/models/${model}:generateContent?key=${GEMINI_API_KEY}`, {
        method:'POST', headers:{'Content-Type':'application/json'},
        body: JSON.stringify({contents:[{parts:[{text:prompt}]}], generationConfig:{temperature:0.92, maxOutputTokens:700}})
      });
      if(!r.ok){console.warn(`[text:${model}]`,r.status); continue;}
      const d = await r.json();
      const text = d.candidates?.[0]?.content?.parts?.[0]?.text||'';
      if(text) return text;
    } catch(e){console.warn(`[text:${model}]`,e);}
  }
  return null;
}

function parseGeminiText(text, res, foodName) {
  const get = key => {
    const m = text.match(new RegExp(key + ':\\s*(.+?)(?=\\n[ê°€-í£A-Za-z]+:|$)', 's'));
    return m ? m[1].trim().replace(/\n/g,' ') : '';
  };
  const hl = get('í•œì¤„ìš”ì•½') || get('í•œì¤„ì„±í–¥') || `${foodName} ìºë¦­í„°ë¥¼ ë‹®ì€ ë…ë³´ì ì¸ ë‹¹ì‹  âœ¨`;
  const traits = [get('íŠ¹ì§•1'),get('íŠ¹ì§•2'),get('íŠ¹ì§•3')].filter(Boolean);
  if(!traits.length) traits.push('ì½ì„ìˆ˜ë¡ ê³µê° ê°€ëŠ” ì„±í–¥ì˜ ì†Œìœ ìì˜ˆìš”.','ì£¼ë³€ ì‚¬ëŒë“¤ì´ ë¨¼ì € ì•Œì•„ë³´ëŠ” ìˆ¨ì€ ë§¤ë ¥ì´ ìˆì–´ìš”.','ìê¸° ìì‹ ì„ ì˜ ì•„ëŠ” ì‚¬ëŒì´ì—ìš”.');
  const storyLine = get('ìŒì‹ë¶„ì„') || get('ì°ë¶„ì„');
  const reason = get('ê²°ì •ì í•œë§ˆë””') || get('ì´ìœ ') || `${foodName}ì²˜ëŸ¼, ì•Œê³  ë³´ë©´ ë” ë§›ìˆëŠ” ì‚¬ëŒì´ì—ìš”.`;
  const tagStr = get('íƒœê·¸');
  const tags = (tagStr.match(/#[^\s#]+/g)||[]).slice(0,4);
  if(!tags.length) tags.push('#ë‚˜ë‹¤ìš´ì°','#ìŒì‹ìºë¦­í„°','#ì°í‘¸ë“œ','#ì°ë¶„ì„');
  return {hl, traits, storyLine, reason, tags};
}

function localAnalysis(answerLabels, res, story, foodName) {
  const chosenTexts=answerLabels.map(item=>item.opts[item.chosen].t);
  const is=key=>chosenTexts.some(t=>t.includes(key));
  const db={
    A:{
      hl:`ğŸŒ¶ï¸ í•œ ë²ˆ ë§›ë³´ë©´ ìê¾¸ ìƒê°ë‚˜ëŠ” ê·¸ ì‚¬ëŒ â€” ë§ˆë¼íƒ•í˜• ì¸ê°„`,
      traits:[
        `ë°°ê³ í”Œ ë•Œ ì˜ˆë¯¼í•´ì§„ë‹¤ê³  í•˜ì…¨ì£ ? ì†”ì§íˆ ê·¸ê²Œ ë§¤ë ¥ì´ì—ìš”. ê°ì • ìˆ¨ê¸°ëŠ” ë²•ì„ ëª¨ë¥´ëŠ” ì‚¬ëŒì´ë¼ ì˜¤íˆë ¤ ì‹ ë¢°ê°€ ê°€ìš”.`,
        `ë©”ë‰´ ì •í•  ë•Œ ë‚´ê°€ ì •í•˜ëŠ” íƒ€ì… â€” ê²°ì • ì¥ì•  ì¹œêµ¬ë“¤í•œí…Œ ì—†ì–´ì„  ì•ˆ ë  ì¡´ì¬ì˜ˆìš”. ëŒ€ì‹  ë³¸ì¸ ì·¨í–¥ì€ í™•ì‹¤íˆ ìˆì–´ìš”.`,
        `ìê·¹ì ì¸ ê±¸ ì¢‹ì•„í•˜ëŠ” ì„±í–¥ ë•ë¶„ì— ì‚¶ì˜ ì˜¨ë„ê°€ í•­ìƒ ë†’ì•„ìš”. ì§€ë£¨í•  í‹ˆì´ ì—†ëŠ” ì‚¬ëŒì´ì—ìš”.`
      ],
      storyLine:`${foodName}ì„ ì„ íƒí•œ ê±´ ìš°ì—°ì´ ì•„ë‹ˆì—ìš”. ê°•í•˜ê³  ê¸°ì–µì— ë‚¨ëŠ” ì¸ìƒì„ ì£¼ê³  ì‹¶ì€ ë§ˆìŒì´ ë¬´ì˜ì‹ ì¤‘ì— ë°˜ì˜ëœ ê±°ì˜ˆìš”.`,
      reason:`ë§ˆë¼íƒ•ì²˜ëŸ¼ ì²˜ìŒì—” "ì´ê²Œ ë§ë‚˜?" ì‹¶ë‹¤ê°€ë„, ê²°êµ­ ë‹¤ìŒì— ë˜ ì°¾ê²Œ ë˜ëŠ” ì‚¬ëŒì´ì—ìš”.`,
      tags:['#ìê·¹ì£¼ì˜','#ê°ì •ì§ì§„','#ì¤‘ë…ë§¤ë ¥','#ë§ˆë¼íƒ•ì¸ê°„']
    },
    B:{
      hl:`ğŸ‚ ì¡°ìš©íˆ ë‹¹ì‹  ìƒì¼ ê¸°ì–µí•˜ê³  ìˆëŠ” ì‚¬ëŒ â€” ì¼€ì´í¬í˜• ì¸ê°„`,
      traits:[
        `ìŠ¤íŠ¸ë ˆìŠ¤ ë°›ìœ¼ë©´ ë‹¬ë‹¬í•œ ê±¸ ì°¾ëŠ”ë‹¤ê³  í•˜ì…¨ì£ ? ê°ì •ì„ í­ë°œì‹œí‚¤ëŠ” ëŒ€ì‹  ë‹¨ ê²ƒìœ¼ë¡œ ìŠ¤ìŠ¤ë¡œ ë‹¬ë˜ëŠ” â€” ìê¸° ëŒë´„ì˜ ê³ ìˆ˜ì˜ˆìš”.`,
        `ì´ë¶ˆ ì† í‘ì—­ì‚¬ ì°ì´ ë§ë‹¤ë©´, ê°ìˆ˜ì„±ì´ ê·¸ë§Œí¼ í’ë¶€í•˜ë‹¤ëŠ” ëœ»ì´ì—ìš”. ë‚¨ë“¤ì´ ê·¸ëƒ¥ ì§€ë‚˜ì¹œ ìˆœê°„ë„ ì˜¤ë˜ ê¸°ì–µí•´ìš”.`,
        `ê²‰ìœ¼ë¡  í‰ì˜¨í•´ ë³´ì´ì§€ë§Œ ì†ìœ¼ë¡  ëŠì„ì—†ì´ ìƒê° ì¤‘ â€” ì¡°ìš©í•œ ê°ë™ì„ ì£¼ëŠ” íƒ€ì…ì´ì—ìš”.`
      ],
      storyLine:`${foodName}ì´ë¼ëŠ” ì„ íƒ, íŠ¹ë³„í•œ ë‚ ì— ì–´ìš¸ë¦¬ëŠ” ìŒì‹ì´ì£ . í‰ë²”í•œ í•˜ë£¨ì—ë„ ì˜ë¯¸ë¥¼ ì°¾ëŠ” ë‹¹ì‹ ì˜ ê°ìˆ˜ì„±ì´ ë‹´ê²¨ìˆì–´ìš”.`,
      reason:`ë”¸ê¸°ì¼€ì´í¬ì²˜ëŸ¼ â€” ê¸°ë¶„ ì¢‹ì„ ë•Œë„, ìœ„ë¡œê°€ í•„ìš”í•  ë•Œë„, ê²°êµ­ ìƒê°ë‚˜ëŠ” ì‚¬ëŒì´ì—ìš”.`,
      tags:['#ê°ì„±ì¶©ë§Œ','#ê¸°ë…ì¼ì¥ì¸','#ì¡°ìš©í•œë‚­ë§Œì£¼ì˜','#ì¼€ì´í¬ì¸ê°„']
    },
    C:{
      hl:`ğŸ· 1íšŒì°¨ì—” ì ˆëŒ€ ëª¨ë¥´ëŠ” ì‚¬ëŒ â€” ì™€ì¸í˜• ì¸ê°„`,
      traits:[
        `ì„¸ë¼ ë‹¤ ì±™ê¸°ëŠ” ê·œì¹™íŒŒ â€” ê²‰ìœ¼ë¡  ì² ì €í•´ ë³´ì´ì§€ë§Œ ì‚¬ì‹¤ ìê¸° ìì‹ í•œí…Œ ê°€ì¥ ì—„ê²©í•´ìš”. ë‚¨í•œí…ŒëŠ” ì˜ì™¸ë¡œ ê´€ëŒ€í•´ìš”.`,
        `ìŠ¤íŠ¸ë ˆìŠ¤ ë°›ìœ¼ë©´ ë¹¨ë¦¬ ë¨¹ê³  í•´ê²°í•˜ëŠ” íƒ€ì… â€” ê°ì •ì„ ì˜¤ë˜ ëŒì§€ ì•Šê³  ë¦¬ì…‹í•˜ëŠ” ëŠ¥ë ¥ì´ ìˆì–´ìš”.`,
        `ì²˜ìŒ ë§Œë‚˜ë©´ ì¡°ê¸ˆ ì–´ë µê²Œ ëŠê»´ì§ˆ ìˆ˜ ìˆëŠ”ë°, ê°€ê¹Œì›Œì§€ë©´ ì™„ì „ ë‹¤ë¥¸ ì‚¬ëŒ ë‚˜ì™€ìš”. ê·¸ê²Œ ì´ ì‚¬ëŒì˜ ë°˜ì „ ë§¤ë ¥ì´ì—ìš”.`
      ],
      storyLine:`${foodName} ì„ íƒì—ì„œ ë³´ì—¬ìš” â€” ìœ í–‰ ë”°ë¥´ê¸°ë³´ë‹¤ ë‚´ ê¸°ì¤€ì´ ìˆëŠ” ì‚¬ëŒ. ë‚¨ë“¤ ë‹¤ ì‹œí‚¬ ë•Œ í˜¼ì ë‹¤ë¥¸ ë©”ë‰´ ìƒê°í•˜ëŠ” ìŠ¤íƒ€ì¼.`,
      reason:`ì™€ì¸ì²˜ëŸ¼, ì‹œê°„ì´ ì§€ë‚ ìˆ˜ë¡ ê¹Šì–´ì§€ëŠ” ë§› â€” ë¹¨ë¦¬ íŒë‹¨í•˜ë©´ ì´ ì‚¬ëŒ ëª¨ë¥´ëŠ” ê±°ì˜ˆìš”.`,
      tags:['#ìˆ™ì„±í˜•ì¸ê°„','#ì²œì²œíˆì•Œì•„ê°€ì','#1íšŒì°¨ëŠ”ëª¨ë¦„','#ì™€ì¸ì¸ê°„']
    },
    D:{
      hl:`ğŸ² ìƒˆë²½ 3ì‹œì— ìƒê°ë‚˜ëŠ” ê·¸ ì‚¬ëŒ â€” í•´ì¥êµ­í˜• ì¸ê°„`,
      traits:[
        `ë°°ê³ íŒŒë„ ê·¸ëƒ¥ ì•„ë¬´ê±°ë‚˜ ë¨¹ëŠ”ë‹¤ê³  í•˜ì…¨ì£ ? ì‚¬ì†Œí•œ ê²ƒì— ì—ë„ˆì§€ ìŸëŠ” ê±¸ íš¨ìœ¨ì ìœ¼ë¡œ ì•„ë¼ëŠ” ì‚¬ëŒì´ì—ìš”.`,
        `ì†ì ˆ ì°ì´ ìˆë‹¤ë©´ â€” ì¡°ìš©íˆ ì˜¤ë˜ ì°¸ë‹¤ê°€ í•œ ë²ˆì— ì •ë¦¬í•˜ëŠ” íƒ€ì…ì´ì—ìš”. ë§ ì—†ì´ ë– ë‚˜ëŠ” ì‚¬ëŒì´ ê°€ì¥ ë¬´ì„œìš´ íƒ€ì….`,
        `ê±°ì°½í•œ í‘œí˜„ì€ ì—†ì–´ë„ ê³ì— ìˆìœ¼ë©´ ì™ ì§€ ëª¨ë¥´ê²Œ ì•ˆì‹¬ì´ ë˜ëŠ” ì‚¬ëŒ â€” ê·¸ê²Œ ì œì¼ ì–´ë ¤ìš´ ê±°ì˜ˆìš”.`
      ],
      storyLine:`${foodName}ì´ë¼ëŠ” ì„ íƒ, í™”ë ¤í•˜ì§„ ì•Šì§€ë§Œ ì§„ì§œ í•„ìš”í•  ë•Œ ìƒê°ë‚˜ëŠ” ìŒì‹ì´ì–ì•„ìš”. ê·¸ê²Œ ë°”ë¡œ ì´ ì‚¬ëŒì´ì—ìš”.`,
      reason:`í•´ì¥êµ­ì²˜ëŸ¼ â€” ìˆì„ ë•ŒëŠ” ë‹¹ì—°í•˜ê³ , ì—†ìœ¼ë©´ ì§„ì§œ ë¹ˆìë¦¬ê°€ ëŠê»´ì§€ëŠ” ì‚¬ëŒì´ì—ìš”.`,
      tags:['#ì§„êµ­ì¸ìƒ','#ìˆì–´ì•¼ì™„ì„±','#ìƒˆë²½ì„¸ì‹œì—ìƒê°ë‚˜ëŠ”ì‚¬ëŒ','#í•´ì¥êµ­ì¸ê°„']
    }
  }[res.type];
  return {hl:db.hl, traits:db.traits, storyLine:db.storyLine, reason:db.reason, tags:db.tags};
}

function renderAIContent(parsed) {
  const {hl, traits, storyLine, reason, tags} = parsed;
  let html = '';

  // í•œì¤„ìš”ì•½
  html += `<div class="ai-section">
    <div class="ai-section-title">âœ¦ í•œì¤„ ìš”ì•½</div>
    <p style="font-weight:700;font-size:15px;color:#1a2a6a;line-height:1.6">${hl}</p>
  </div>`;

  // ì„±í–¥ íŠ¹ì§•
  html += `<div class="ai-section">
    <div class="ai-section-title">âœ¦ ì´ëŸ° ì‚¬ëŒì´ì—ìš”</div>
    ${traits.map(t=>`<p style="margin-bottom:8px;padding-left:12px;border-left:2px solid rgba(100,130,220,.3)">â€¢ ${t}</p>`).join('')}
  </div>`;

  // ìŒì‹ ë¶„ì„
  if(storyLine) {
    html += `<div class="ai-section">
      <div class="ai-section-title">âœ¦ ìŒì‹ ì„ íƒ ì‹¬ë¦¬</div>
      <p style="color:#3a4a8a;line-height:1.8;font-style:italic">${storyLine}</p>
    </div>`;
  }

  // ê²°ì •ì  í•œë§ˆë””
  html += `<div class="ai-section">
    <div class="ai-section-title">âœ¦ ê²°ì •ì  í•œë§ˆë””</div>
    <p style="font-size:14px;font-weight:600;color:#2a3a7a;border-left:3px solid #7090d8;padding:10px 12px;background:rgba(100,130,220,.07);border-radius:0 8px 8px 0;line-height:1.7">"${reason}"</p>
  </div>`;

  // íƒœê·¸
  html += `<div style="margin-top:4px">${tags.map(t=>`<span class="ai-tag">${t}</span>`).join('')}</div>`;

  return html;
}

function goToResult() {
  const foodName = document.getElementById('food-input').value.trim();
  if(!foodName){ alert('ì°ì˜ ì£¼ì¸ê³µ ìŒì‹ì„ ì…ë ¥í•´ì£¼ì„¸ìš”! ğŸ½ï¸'); document.getElementById('food-input').focus(); return; }
  const story=document.getElementById('story-text').value.trim();
  goTo('page-result');
  buildResult(story, foodName);
}

function buildResult(story, foodName) {
  const totals={A:0,B:0,C:0,D:0};
  answers.forEach(sc=>Object.entries(sc).forEach(([k,v])=>totals[k]+=v));
  const topType=Object.entries(totals).sort((a,b)=>b[1]-a[1])[0][0];
  const res=scoreResults.find(r=>r.type===topType);

  setTimeout(()=>{
    document.getElementById('result-loading-screen').style.display='none';
    document.getElementById('result-content').style.display='block';
    document.getElementById('result-food').textContent=`ë‹¹ì‹ ì˜ ì° ìŒì‹ : " ${foodName} "`;
    document.getElementById('result-desc').textContent=res.desc;
    document.getElementById('result-tag').textContent=res.tag;

    // ì´ë¯¸ì§€ ìƒì„±
    generateCharImage(foodName).then(url=>{
      document.getElementById('char-img').src=url;
      document.getElementById('char-img').style.display='block';
      document.getElementById('char-loading-inner').style.display='none';
    }).catch(()=>{
      document.getElementById('char-loading-inner').innerHTML=`<span style="font-size:48px">ğŸ½ï¸</span><p style="font-size:12px;margin-top:6px;color:var(--muted)">${foodName}</p>`;
    });

    // Gemini í…ìŠ¤íŠ¸ ë¶„ì„
    generateGeminiAnalysis(answerLabels, res, story, foodName).then(text=>{
      const loadingEl=document.getElementById('ai-loading');
      const contentEl=document.getElementById('ai-content');
      loadingEl.style.display='none';
      let parsed;
      if(text) {
        parsed = parseGeminiText(text, res, foodName);
      } else {
        parsed = localAnalysis(answerLabels, res, story, foodName);
      }
      contentEl.innerHTML=renderAIContent(parsed);
      contentEl.style.display='block';
    });

    buildRecap(story, foodName);
  }, 1800);
}

function buildRecap(story, foodName) {
  let html='<div class="recap-title">ğŸ“‹ ë‚˜ì˜ ì„ íƒ ëª¨ì•„ë³´ê¸°</div>';
  if(foodName) html+=`<div class="recap-q"><div class="recap-q-text">ğŸ½ï¸ ë‚´ ì°ì˜ ì£¼ì¸ê³µ ìŒì‹</div><div class="recap-opt-chosen"><span class="recap-check">âœ“</span><span>${foodName}</span></div></div>`;
  answerLabels.forEach((item,qi)=>{
    const c=item.opts[item.chosen];
    html+=`<div class="recap-q"><div class="recap-q-text">Q${qi+1}. ${item.q}</div><div class="recap-opt-chosen"><span class="recap-check">âœ“</span><span style="font-size:16px">${c.e}</span><span>${c.t}</span></div></div>`;
  });
  if(story){ html+=`<div class="recap-story"><div class="recap-story-label">âœï¸ ë‚´ê°€ ì“´ ì°</div><div class="recap-story-content">${story}</div></div>`; }
  document.getElementById('recap-card').innerHTML=html;
}

// â”€â”€ PHONE â”€â”€
let consented=false;
function toggleConsent(){ consented=!consented; document.getElementById('consent-cb').classList.toggle('checked',consented); }
function formatPhone(el){ let v=el.value.replace(/\D/g,'').substring(0,11); if(v.length<=3)el.value=v; else if(v.length<=7)el.value=v.slice(0,3)+'-'+v.slice(3); else el.value=v.slice(0,3)+'-'+v.slice(3,7)+'-'+v.slice(7); }
function submitPhone(){ const p=document.getElementById('phone-input').value.trim(); if(p&&!consented){alert('ê°œì¸ì •ë³´ í™œìš© ë™ì˜ë¥¼ ì²´í¬í•´ì£¼ì„¸ìš”!');return;} goTo('page-done'); }

initQuiz();
initTempBtns();
</script>
</body>
</html>