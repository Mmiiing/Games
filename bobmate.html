<!DOCTYPE html>
<html lang="ko">
<head>
<meta charset="UTF-8"/>
<meta name="viewport" content="width=device-width, initial-scale=1.0"/>
<title>ë°¥ë©”ì´íŠ¸ â€” ë‚˜ì™€ ì–´ìš¸ë¦¬ëŠ” ë°¥ ë©”ì´íŠ¸ëŠ”?</title>
<link href="https://fonts.googleapis.com/css2?family=Noto+Serif+KR:wght@400;700;900&family=Noto+Sans+KR:wght@300;400;500;700&display=swap" rel="stylesheet"/>
<style>
/* â•â• TOKENS â•â• */
:root{
  --cream:#FDF6EC;--warm:#FFFAF4;
  --o:#E8602C;--o2:#F28B5F;--o3:#C44A1A;
  --br:#4A2810;--br2:#7A4A28;
  --y:#F5C518;
  --td:#2D1A0E;--tm:#7A4A28;--tl:#B8895A;
  --sh:rgba(74,40,16,.11);

  /* â”€â”€ spacing scale (mobile-first) â”€â”€ */
  --px:16px;          /* horizontal page padding */
  --gap:12px;         /* standard gap */
  --r:14px;           /* border-radius base */

  /* â”€â”€ type scale â”€â”€ */
  --fs-xs:11px;
  --fs-sm:13px;
  --fs-base:15px;
  --fs-md:17px;
  --fs-lg:22px;
  --fs-xl:28px;
}

/* â”€â”€ tablet / desktop overrides â”€â”€ */
@media(min-width:480px){
  :root{
    --px:24px;
    --gap:14px;
    --fs-sm:14px;
    --fs-base:15px;
    --fs-md:18px;
    --fs-lg:24px;
    --fs-xl:32px;
  }
}
@media(min-width:768px){
  :root{
    --px:32px;
    --gap:16px;
    --fs-lg:28px;
    --fs-xl:38px;
  }
}

/* â”€â”€ RESET â”€â”€ */
*{margin:0;padding:0;box-sizing:border-box;-webkit-tap-highlight-color:transparent;}
html{height:100%;}
body{
  min-height:100%;
  font-family:'Noto Sans KR',sans-serif;
  font-size:var(--fs-base);
  background:var(--cream);color:var(--td);
  -webkit-font-smoothing:antialiased;
  overflow:hidden;
}

@media(min-width:768px){
  html,body{height:100%;overflow:hidden;}
  body{
    background:#1C0E05;
    display:flex;align-items:center;justify-content:center;
  }
}

/* â”€â”€ BG (ëª¨ë°”ì¼: stage ë°°ê²½, ë°ìŠ¤í¬í†±: body ë°°ê²½) â”€â”€ */
body::before{
  content:'';position:fixed;inset:0;pointer-events:none;z-index:0;
  background:
    radial-gradient(ellipse 60% 50% at 15% 0%,rgba(232,96,44,.07) 0%,transparent 70%),
    radial-gradient(ellipse 50% 40% at 85% 90%,rgba(245,197,24,.09) 0%,transparent 70%),
    radial-gradient(ellipse 40% 30% at 70% 20%,rgba(61,122,82,.05) 0%,transparent 70%);
}
@media(min-width:768px){
  body::before{
    background:
      radial-gradient(ellipse 70% 60% at 15% 10%,rgba(232,96,44,.18) 0%,transparent 60%),
      radial-gradient(ellipse 60% 50% at 85% 85%,rgba(245,197,24,.12) 0%,transparent 60%),
      radial-gradient(ellipse 50% 40% at 50% 50%,rgba(196,74,26,.06) 0%,transparent 70%);
  }
}

/* â”€â”€ Floats â”€â”€ */
#floats{position:absolute;inset:0;pointer-events:none;z-index:0;overflow:hidden;}
#floats span{position:absolute;font-size:1.4rem;opacity:.06;animation:fup linear infinite;}
@keyframes fup{
  0%{transform:translateY(105vh) rotate(-10deg);opacity:0;}
  8%{opacity:.06;}92%{opacity:.06;}
  100%{transform:translateY(-10vh) rotate(20deg);opacity:0;}
}

/* â•â• STAGE â•â• */
#stage{
  position:fixed;inset:0;z-index:10;
  display:flex;flex-direction:column;
  overflow:hidden;
  background:var(--cream);
  padding-top:env(safe-area-inset-top);
  padding-bottom:env(safe-area-inset-bottom);
}

@media(min-width:768px){
  #stage{
    position:relative;
    inset:auto;
    width:430px;
    height:min(860px, 92vh);
    border-radius:44px;
    box-shadow:
      0 0 0 1px rgba(255,255,255,.07),
      0 40px 100px rgba(0,0,0,.65),
      0 10px 30px rgba(0,0,0,.35);
    overflow:hidden;
    margin:auto;
  }
  #stage::before{
    content:'';
    position:absolute;top:14px;left:50%;transform:translateX(-50%);
    width:72px;height:4px;
    background:rgba(74,40,16,.18);
    border-radius:100px;
    z-index:100;pointer-events:none;
  }
}

/* â”€â”€ Top progress bar â”€â”€ */
#topBar{
  flex-shrink:0;height:4px;
  background:rgba(176,120,72,.15);
}
#topFill{
  height:100%;
  background:linear-gradient(to right,var(--o2),var(--o));
  border-radius:0 4px 4px 0;
  transition:width .5s cubic-bezier(.4,0,.2,1);
  width:0%;
}

/* â”€â”€ Step nav header â”€â”€ */
#stepLabel{
  flex-shrink:0;
  display:flex;align-items:center;justify-content:space-between;
  padding:12px var(--px) 0;
  min-height:44px; /* touch target */
}
#stepLabel .back-btn{
  display:flex;align-items:center;gap:5px;
  background:none;border:none;
  font-size:var(--fs-sm);font-weight:700;
  color:var(--tl);cursor:pointer;
  padding:8px 0;min-width:60px;
  transition:color .2s;
}
#stepLabel .back-btn:active{color:var(--o);}
@media(hover:hover){#stepLabel .back-btn:hover{color:var(--o);}}
#stepLabel .back-btn.hidden{visibility:hidden;pointer-events:none;}
#stepText{font-size:var(--fs-xs);font-weight:700;letter-spacing:1.5px;color:var(--tl);}

/* â”€â”€ Slides wrapper â”€â”€ */
#slides{
  flex:1;
  position:relative;
  overflow:hidden; /* ë¹„í™œì„± ìŠ¬ë¼ì´ë“œì˜ translateX ë…¸ì¶œ ì°¨ë‹¨ */
}

.slide{
  position:absolute;inset:0;
  display:flex;flex-direction:column;align-items:center;justify-content:flex-start;
  padding:16px var(--px) 0;
  overflow-y:auto;overflow-x:hidden;
  -webkit-overflow-scrolling:touch;
  opacity:0;
  pointer-events:none;
  transform:translateX(60px);
  transition:opacity .38s cubic-bezier(.4,0,.2,1), transform .38s cubic-bezier(.4,0,.2,1);
  scrollbar-width:none;
}
.slide::-webkit-scrollbar{display:none;}
/* active/exit í´ë˜ìŠ¤ëŠ” ë” ì´ìƒ ì‚¬ìš© ì•ˆ í•¨ - inline styleë¡œ ì œì–´ */

.slide-inner{
  width:100%;max-width:560px;
  padding-bottom:100px;
  overflow-x:hidden;
}

/* â”€â”€ Section header â”€â”€ */
.sec-badge{
  display:inline-flex;align-items:center;
  background:rgba(232,96,44,.1);
  color:var(--o);font-size:var(--fs-xs);font-weight:700;letter-spacing:1.5px;
  padding:4px 12px;border-radius:100px;
  margin-bottom:12px;
}
.sec-icon-big{font-size:2rem;display:block;margin-bottom:8px;}
.sec-title{
  font-family:'Noto Serif KR',serif;
  font-size:var(--fs-lg);
  font-weight:900;color:var(--br);
  line-height:1.3;margin-bottom:6px;
}
.sec-title em{color:var(--o);font-style:normal;}
.sec-hint{
  font-size:var(--fs-sm);color:var(--tl);
  line-height:1.65;margin-bottom:22px;
}

/* â”€â”€ Field block â”€â”€ */
.field{margin-bottom:22px;}
.field:last-child{margin-bottom:0;}
.field-label{
  font-size:var(--fs-xs);font-weight:700;letter-spacing:.5px;
  color:var(--tm);margin-bottom:9px;
  display:flex;align-items:center;gap:5px;
  text-transform:uppercase;
}

/* â”€â”€ Chips â”€â”€ */
.chip-grid{display:flex;flex-wrap:wrap;gap:8px;overflow:hidden;}
.chip{
  display:inline-flex;align-items:center;gap:5px;
  padding:9px 15px;
  background:var(--warm);
  border:2px solid rgba(176,120,72,.25);
  border-radius:100px;
  font-size:var(--fs-sm);font-weight:600;color:var(--br2);
  cursor:pointer;transition:border-color .15s,background .15s,color .15s,box-shadow .15s;
  user-select:none;
  min-height:42px;
  white-space:nowrap;
}
@media(hover:hover){.chip:hover{border-color:var(--o2);background:#FFF3EB;}}
.chip:active{transform:scale(.97);}
.chip.sel{border-color:var(--o);background:var(--o);color:#fff;box-shadow:0 3px 12px rgba(232,96,44,.32);}

/* â”€â”€ Card options â”€â”€ */
.card-options{
  display:grid;
  grid-template-columns:1fr 1fr;
  gap:var(--gap);
}
/* single column only on very small screens */
@media(max-width:360px){.card-options{grid-template-columns:1fr;}}
.card-opt{
  padding:14px 13px;
  background:var(--warm);
  border:2px solid rgba(176,120,72,.22);
  border-radius:var(--r);cursor:pointer;transition:all .15s;text-align:left;
  min-height:90px;
}
@media(hover:hover){.card-opt:hover{border-color:var(--o2);background:#FFF5EE;}}
.card-opt:active{transform:scale(.98);}
.card-opt.sel{border-color:var(--o);background:#FFF0E8;box-shadow:0 3px 14px rgba(232,96,44,.18);}
.co-emoji{font-size:1.5rem;display:block;margin-bottom:6px;}
.co-label{font-size:var(--fs-sm);font-weight:700;color:var(--br);margin-bottom:2px;line-height:1.3;}
.co-desc{font-size:12px;color:var(--tl);line-height:1.4;}

/* â”€â”€ MBTI â”€â”€ */
.mbti-pair{display:grid;grid-template-columns:1fr 1fr;gap:8px;margin-bottom:8px;}
.mbti-btn{
  padding:13px 8px;text-align:center;
  background:var(--warm);
  border:2px solid rgba(176,120,72,.22);
  border-radius:12px;
  font-size:var(--fs-sm);font-weight:700;color:var(--br2);
  cursor:pointer;transition:all .15s;user-select:none;
  min-height:46px;line-height:1.3;
}
@media(hover:hover){.mbti-btn:hover{border-color:var(--o2);background:#FFF3EB;}}
.mbti-btn:active{transform:scale(.97);}
.mbti-btn.sel{border-color:var(--o);background:var(--o);color:#fff;box-shadow:0 3px 10px rgba(232,96,44,.28);}
.mbti-result{
  margin-top:10px;
  background:linear-gradient(135deg,#FFF3EB,#FFF8F2);
  border:1.5px solid rgba(232,96,44,.2);
  border-radius:12px;padding:12px 14px;
  text-align:center;min-height:44px;
  display:flex;align-items:center;justify-content:center;gap:8px;
}

/* â”€â”€ Slider â”€â”€ */
.range-labels{display:flex;justify-content:space-between;font-size:12px;color:var(--tl);margin-bottom:10px;}
.range-row{display:flex;align-items:center;gap:10px;}
input[type=range]{
  -webkit-appearance:none;width:100%;height:6px;
  background:linear-gradient(to right,var(--o) 0%,var(--o) var(--pct,50%),rgba(176,120,72,.2) var(--pct,50%),rgba(176,120,72,.2) 100%);
  border-radius:100px;outline:none;cursor:pointer;
  /* bigger thumb for mobile */
}
input[type=range]::-webkit-slider-thumb{
  -webkit-appearance:none;width:28px;height:28px;
  background:var(--o);border-radius:50%;
  box-shadow:0 2px 10px rgba(232,96,44,.45);
  border:3px solid #fff;cursor:pointer;
}
.range-val{
  flex-shrink:0;min-width:68px;padding:7px 10px;text-align:center;
  background:var(--o);color:#fff;
  font-size:12px;font-weight:700;border-radius:8px;white-space:nowrap;
}

/* â”€â”€ Toggle rows â”€â”€ */
.toggle-rows{display:grid;gap:8px;}
.toggle-row{
  display:flex;align-items:center;justify-content:space-between;
  padding:12px 14px;background:var(--warm);
  border:1.5px solid rgba(176,120,72,.2);border-radius:var(--r);gap:10px;
  min-height:52px; /* fat touch row */
}
.toggle-lbl{font-size:var(--fs-sm);font-weight:600;color:var(--br2);flex:1;}
.toggle-sw{
  display:flex;background:rgba(176,120,72,.12);
  border-radius:100px;overflow:hidden;
  border:1.5px solid rgba(176,120,72,.18);flex-shrink:0;
}
.toggle-sw button{
  padding:7px 13px;border:none;background:transparent;
  font-size:12px;font-weight:700;color:var(--tl);
  cursor:pointer;transition:all .15s;border-radius:100px;
  min-width:60px;min-height:36px;
}
.toggle-sw button.on{background:var(--o);color:#fff;box-shadow:0 2px 8px rgba(232,96,44,.3);}

/* â”€â”€ Star rating â”€â”€ */
.star-block{margin-bottom:14px;}
.star-block:last-child{margin-bottom:0;}
.star-block-label{font-size:var(--fs-sm);font-weight:600;color:var(--tm);margin-bottom:7px;}
.star-row{display:flex;gap:6px;}
.star-item{
  display:flex;flex-direction:column;align-items:center;justify-content:center;gap:4px;
  padding:9px 4px;background:var(--warm);
  border:2px solid rgba(176,120,72,.2);border-radius:12px;
  flex:1;cursor:pointer;transition:all .15s;
  min-height:58px;
}
@media(hover:hover){.star-item:hover{border-color:var(--o2);}}
.star-item:active{transform:scale(.95);}
.star-item.sel{border-color:var(--o);background:#FFF0E8;}
.s-emoji{font-size:.9rem;line-height:1;}
.s-label{font-size:10px;font-weight:600;color:var(--br2);text-align:center;line-height:1.25;}

/* â”€â”€ Textarea â”€â”€ */
.free-input{
  width:100%;padding:14px;
  font-family:'Noto Sans KR',sans-serif;font-size:var(--fs-base);
  color:var(--td);background:var(--warm);
  border:2px solid rgba(176,120,72,.25);border-radius:var(--r);
  resize:none;outline:none;line-height:1.7;transition:border-color .2s;
}
.free-input:focus{border-color:var(--o);}
.free-input::placeholder{color:var(--tl);}
.char-count{text-align:right;font-size:12px;color:var(--tl);margin-top:5px;}

/* â”€â”€ Bottom nav â”€â”€ */
#bottomNav{
  flex-shrink:0;
  padding:10px var(--px) 16px;
  background:linear-gradient(to top,var(--cream) 60%,transparent);
  position:relative;z-index:20;
}
.next-btn{
  display:flex;align-items:center;justify-content:center;gap:10px;
  width:100%;max-width:560px;margin:0 auto;
  padding:17px;
  background:linear-gradient(135deg,var(--o),var(--o3));
  color:#fff;font-family:'Noto Sans KR',sans-serif;
  font-size:var(--fs-base);font-weight:700;
  border:none;border-radius:16px;cursor:pointer;
  box-shadow:0 6px 24px rgba(232,96,44,.38);
  transition:box-shadow .2s,transform .15s;
  min-height:54px; /* comfortable tap target */
}
@media(hover:hover){.next-btn:hover{transform:translateY(-2px);box-shadow:0 12px 32px rgba(232,96,44,.46);}}
.next-btn:active{transform:scale(.98);}
.next-btn:disabled{opacity:.4;cursor:not-allowed;transform:none;box-shadow:none;}

/* â•â• HERO SLIDE â•â• */
#heroSlide{
  display:flex;flex-direction:column;
  align-items:center;justify-content:center;
  text-align:center;
  padding:32px var(--px);
  position:absolute;inset:0;
  transition:opacity .45s,transform .45s;
  overflow-y:auto;overflow-x:hidden;
  -webkit-overflow-scrolling:touch;
}
.hero-pill{
  display:inline-flex;align-items:center;gap:6px;
  background:var(--o);color:#fff;
  font-size:var(--fs-xs);font-weight:700;letter-spacing:2px;
  padding:5px 16px;border-radius:100px;
  box-shadow:0 4px 16px rgba(232,96,44,.38);
  margin-bottom:18px;
}
.hero-emoji{
  font-size:3.6rem;display:block;margin-bottom:14px;
  animation:heroBounce 2s ease-in-out infinite;
}
@keyframes heroBounce{0%,100%{transform:translateY(0);}50%{transform:translateY(-9px);}}
.hero h1{
  font-family:'Noto Serif KR',serif;
  font-size:var(--fs-xl);
  font-weight:900;color:var(--br);
  line-height:1.45;
  letter-spacing:-.01em;
  word-break:keep-all;
  margin-bottom:14px;
}
.hero h1 em{color:var(--o);font-style:normal;position:relative;}
.hero h1 em::after{
  content:'';position:absolute;bottom:2px;left:0;right:0;
  height:4px;background:var(--y);border-radius:3px;opacity:.6;
}
.hero p{
  font-size:var(--fs-sm);color:var(--tl);
  line-height:1.9;letter-spacing:.01em;word-break:keep-all;
  max-width:300px;margin:0 auto 30px;
}
.hero-start{
  display:inline-flex;align-items:center;gap:10px;
  background:linear-gradient(135deg,var(--o),var(--o3));
  color:#fff;font-size:var(--fs-base);font-weight:700;
  padding:15px 36px;border-radius:100px;border:none;cursor:pointer;
  box-shadow:0 8px 26px rgba(232,96,44,.42);transition:all .2s;
  min-height:52px;
}
@media(hover:hover){.hero-start:hover{transform:translateY(-3px);box-shadow:0 14px 34px rgba(232,96,44,.48);}}
.hero-start:active{transform:scale(.97);}
.hero-dots{display:flex;gap:5px;justify-content:center;margin-top:24px;}
.hero-dot{width:7px;height:7px;border-radius:50%;background:rgba(176,120,72,.22);}

/* â•â• LOADING â•â• */
#loadSlide{
  position:absolute;inset:0;
  display:none;flex-direction:column;
  align-items:center;justify-content:center;
  text-align:center;padding:40px var(--px);
  z-index:30;background:var(--cream);
}
.load-emoji{font-size:4.5rem;display:block;animation:loadB .7s ease-in-out infinite alternate;}
@keyframes loadB{from{transform:translateY(0) rotate(-5deg);}to{transform:translateY(-14px) rotate(5deg);}}
.load-title{font-family:'Noto Serif KR',serif;font-size:var(--fs-md);font-weight:900;color:var(--br);margin:18px 0 7px;}
.load-sub{font-size:var(--fs-sm);color:var(--tl);margin-bottom:26px;}
.load-steps{display:flex;flex-direction:column;gap:9px;max-width:260px;margin:0 auto;}
.load-step{
  padding:9px 16px;background:var(--warm);border-radius:100px;
  font-size:var(--fs-sm);color:var(--tl);border:1px solid rgba(176,120,72,.2);
  animation:sf 2.4s ease-in-out infinite;
}
.load-step:nth-child(2){animation-delay:.8s;}
.load-step:nth-child(3){animation-delay:1.6s;}
@keyframes sf{0%,100%{opacity:.3;}50%{opacity:1;color:var(--o);border-color:var(--o2);}}

/* â•â• RESULT â•â• */
#resultSlide{
  position:absolute;inset:0;
  display:none;overflow-y:auto;overflow-x:hidden;
  -webkit-overflow-scrolling:touch;
  z-index:25;
  scrollbar-width:none;
  background: #FFF0E8;
}
#resultSlide::-webkit-scrollbar{display:none;}

.result-hero-area{
  text-align:center;
  padding:28px var(--px) 20px;
}
.result-pill{
  display:inline-block;
  background:linear-gradient(135deg,var(--o),var(--y));
  color:#fff;font-size:var(--fs-xs);font-weight:700;letter-spacing:2px;
  padding:5px 16px;border-radius:100px;margin-bottom:14px;
}
.result-h{
  font-family:'Noto Serif KR',serif;
  font-size:var(--fs-lg);font-weight:900;
  color:var(--br);line-height:1.25;margin-bottom:5px;
}
.result-sub{font-size:var(--fs-sm);color:var(--tl);}

.rc-wrap{
  max-width:560px;margin:0 auto;
  padding:0 var(--px) 40px;
}
.rc{
  background:var(--warm);border-radius:18px;padding:22px;
  margin-bottom:12px;
  box-shadow:0 2px 6px var(--sh),0 8px 24px var(--sh);
  border:1px solid rgba(176,120,72,.16);
  animation:cardIn .45s cubic-bezier(.34,1.56,.64,1) both;
}
.rc:nth-child(2){animation-delay:.06s;}
.rc:nth-child(3){animation-delay:.12s;}
.rc:nth-child(4){animation-delay:.18s;}
.rc:nth-child(5){animation-delay:.24s;}
@keyframes cardIn{from{opacity:0;transform:translateY(16px) scale(.97);}to{opacity:1;transform:none;}}

.rc-label{font-size:var(--fs-xs);font-weight:700;letter-spacing:1.5px;color:var(--o);text-transform:uppercase;margin-bottom:12px;}
.score-circle{
  width:96px;height:96px;border-radius:50%;
  background:conic-gradient(var(--o) 0%,var(--o) calc(var(--s,80)*1%),rgba(176,120,72,.15) calc(var(--s,80)*1%) 100%);
  display:flex;align-items:center;justify-content:center;
  margin:0 auto 6px;box-shadow:0 0 0 5px rgba(232,96,44,.07);position:relative;
}
.score-circle::before{content:'';position:absolute;inset:8px;background:var(--warm);border-radius:50%;}
.score-num{position:relative;z-index:1;font-family:'Noto Serif KR',serif;font-size:1.45rem;font-weight:900;color:var(--br);}
.score-lbl{text-align:center;font-size:12px;color:var(--tl);}

.bar-item{margin-bottom:11px;}
.bar-item:last-child{margin-bottom:0;}
.bar-head{display:flex;justify-content:space-between;font-size:var(--fs-sm);color:var(--tm);font-weight:600;margin-bottom:5px;}
.bar-track{height:7px;background:rgba(176,120,72,.15);border-radius:100px;overflow:hidden;}
.bar-fill{height:100%;border-radius:100px;background:linear-gradient(to right,var(--o2),var(--o));width:0%;transition:width 1.2s cubic-bezier(.4,0,.2,1);}

.tag-row{display:flex;flex-wrap:wrap;gap:7px;margin-top:8px;}
.tag{display:inline-flex;align-items:center;gap:4px;padding:6px 12px;background:#FFF0E8;border:1px solid rgba(232,96,44,.22);border-radius:100px;font-size:var(--fs-sm);color:var(--o3);font-weight:600;}

.ana-p{font-size:var(--fs-sm);color:var(--td);line-height:1.85;}
.tip-box{background:linear-gradient(135deg,#FFFBF0,#FFF6E8);border:1px solid rgba(245,197,24,.5);border-radius:12px;padding:13px 15px;font-size:var(--fs-sm);color:var(--br2);line-height:1.7;margin-top:9px;}
.divider{height:1px;background:linear-gradient(to right,transparent,rgba(176,120,72,.22),transparent);margin:16px 0;}

.restart-btn{
  display:flex;align-items:center;justify-content:center;gap:8px;
  width:100%;
  padding:15px;background:transparent;
  border:2px solid rgba(176,120,72,.28);border-radius:14px;
  color:var(--tm);font-family:'Noto Sans KR',sans-serif;
  font-size:var(--fs-sm);font-weight:700;cursor:pointer;transition:all .18s;
  min-height:50px;
}
@media(hover:hover){.restart-btn:hover{border-color:var(--o);color:var(--o);background:#FFF3EB;}}
.restart-btn:active{background:#FFF3EB;}

/* â”€â”€ Error â”€â”€ */
#errBox{
  display:none;position:fixed;
  bottom:calc(80px + env(safe-area-inset-bottom));
  left:50%;transform:translateX(-50%);
  z-index:40;width:calc(100% - 32px);max-width:520px;
}
.err-inner{
  background:#FFF0EE;border:1px solid rgba(232,96,44,.38);border-radius:12px;
  padding:12px 15px;font-size:var(--fs-sm);color:var(--o3);
}
</style>
</head>
<body>

<div id="stage">

  <div id="floats"></div>

  <!-- Top bar -->
  <div id="topBar"><div id="topFill"></div></div>

  <!-- Step label -->
  <div id="stepLabel" style="display:none;">
    <button class="back-btn" id="backBtn" onclick="prevStep()">â† ì´ì „</button>
    <span id="stepText"></span>
    <div style="width:60px"></div>
  </div>

  <!-- Slides -->
  <div id="slides">

    <!-- HERO -->
    <div id="heroSlide">
      <span class="hero-emoji">ğŸš</span>
      <div class="hero-pill">AI ë°¥ë©”ì´íŠ¸ ë¶„ì„</div>
      <h1>ë‚˜ì™€ ì–´ìš¸ë¦¬ëŠ”<br><em>ë°¥ ë©”ì´íŠ¸</em>ëŠ”?</h1>
      <p style="padding: 10px">ì‹ì„±Â·ì„±ê²©Â·ì‹ì‚¬ ìŠµê´€ì„ ë¶„ì„í•´<br>ì°°ë–¡ê¶í•© ë°¥ë©”ì´íŠ¸ ìœ í˜•ì„ ì°¾ì•„ë“œë ¤ìš”</p>
      <button class="hero-start" onclick="startSteps()">ì§€ê¸ˆ ë°”ë¡œ ë¶„ì„í•˜ê¸° â†’</button>
      <div class="hero-dots" id="heroDots"></div>
    </div>

    <!-- STEP SLIDES (injected by JS) -->
    <div id="stepSlides"></div>

    <!-- Loading -->
    <div id="loadSlide">
      <span class="load-emoji">ğŸ²</span>
      <div class="load-title">ë”± ë§ëŠ” ë°¥ë©”ì´íŠ¸ë¥¼ ì°¾ëŠ” ì¤‘...</div>
      <div class="load-sub">AIê°€ ë‹¹ì‹ ì˜ ì‹ì‚¬ ìŠ¤íƒ€ì¼ì„ ë¶„ì„í•˜ê³  ìˆì–´ìš”</div>
      <div class="load-steps">
        <div class="load-step">ğŸ” ì‹ì‚¬ íŒ¨í„´ ë¶„ì„ ì¤‘</div>
        <div class="load-step">ğŸ§¬ MBTI ê¶í•© ê³„ì‚° ì¤‘</div>
        <div class="load-step">âœ¨ ìµœê³ ì˜ ë°¥ë©”ì´íŠ¸ íƒìƒ‰ ì¤‘</div>
      </div>
    </div>

    <!-- Result -->
    <div id="resultSlide">
      <div class="result-hero-area">
        <div class="result-pill">âœ¨ ë¶„ì„ ì™„ë£Œ</div>
        <div class="result-h" id="rTitle"></div>
        <div class="result-sub" id="rSub"></div>
      </div>
      <div class="rc-wrap">
        <div class="rc" id="rC1"></div>
        <div class="rc" id="rC2"></div>
        <div class="rc" id="rC3"></div>
        <div class="rc" id="rC4"></div>
        <div class="rc" id="rC5"></div>
        <button class="restart-btn" onclick="restart()">ğŸ”„ ë‹¤ì‹œ ë¶„ì„í•˜ê¸°</button>
      </div>
    </div>

  </div><!-- /slides -->

  <!-- Bottom nav -->
  <div id="bottomNav" style="display:none;">
    <button class="next-btn" id="nextBtn" onclick="nextStep()">ë‹¤ìŒ â†’</button>
  </div>

</div><!-- /stage -->

<div id="errBox"><div class="err-inner" id="errMsg"></div></div>

<script>
/* â•â• CONFIG â•â• */
const API_KEY = 'AIzaSyD0vjpK3qurPxRfoIIY5MT1VJcx9K9s-VU';

/* â”€â”€ Floating food â”€â”€ */
['ğŸš','ğŸœ','ğŸ–','ğŸ¥˜','ğŸ±','ğŸ¥—','ğŸ£','ğŸ”','ğŸ¥©','ğŸ²','ğŸŒ®','ğŸ§†','ğŸ›','ğŸ¥','ğŸ¤'].forEach(f=>{
  const s=document.createElement('span');
  s.textContent=f;
  s.style.cssText=`left:${Math.random()*100}%;animation-duration:${16+Math.random()*18}s;animation-delay:${Math.random()*16}s;`;
  document.getElementById('floats').appendChild(s);
});

/* â•â• STEP DEFINITIONS â•â• */
const STEPS = [
  {
    id:'s_gender_age',
    badge:'STEP 01 Â· 5',
    icon:'ğŸ™‹',
    title:'ë¨¼ì € <em>ë‚˜ì— ëŒ€í•´</em><br>ì•Œë ¤ì£¼ì„¸ìš”',
    hint:'í•´ë‹¹í•˜ëŠ” í•­ëª©ì„ ì„ íƒí•´ì£¼ì„¸ìš”',
    fields:[
      {type:'single-chip', id:'gender', label:'ì„±ë³„', opts:[
        {v:'ë‚¨ì„±',l:'ğŸ‘¨ ë‚¨ì„±'},{v:'ì—¬ì„±',l:'ğŸ‘© ì—¬ì„±'},{v:'ê¸°íƒ€',l:'ğŸ§‘ ê¸°íƒ€'}
      ]},
      {type:'single-chip', id:'age', label:'ì—°ë ¹ëŒ€', opts:[
        {v:'10ëŒ€',l:'10ëŒ€'},{v:'20ëŒ€ ì´ˆë°˜',l:'20ëŒ€ ì´ˆë°˜'},{v:'20ëŒ€ í›„ë°˜',l:'20ëŒ€ í›„ë°˜'},
        {v:'30ëŒ€',l:'30ëŒ€'},{v:'40ëŒ€+',l:'40ëŒ€+'}
      ]},
      {type:'mbti', id:'myMbti', label:'ë‚˜ì˜ MBTI', hint:'ê° ìŒì—ì„œ í•˜ë‚˜ì”© ì„ íƒ (ì„ íƒ ì‚¬í•­)', resultId:'myMbtiRes',
        pairs:[['EI','E â€” ì™¸í–¥í˜•','I â€” ë‚´í–¥í˜•'],['SN','S â€” ê°ê°í˜•','N â€” ì§ê´€í˜•'],['TF','T â€” ì‚¬ê³ í˜•','F â€” ê°ì •í˜•'],['JP','J â€” íŒë‹¨í˜•','P â€” ì¸ì‹í˜•']]}
    ]
  },
  {
    id:'s_food',
    badge:'STEP 02 Â· 5',
    icon:'ğŸ½ï¸',
    title:'ë‚˜ì˜ <em>ì‹ì‚¬ ìŠ¤íƒ€ì¼</em>ì€?',
    hint:'í‰ì†Œ ì‹ì‚¬ ëª¨ìŠµê³¼ ê°€ì¥ ê°€ê¹Œìš´ ê²ƒì„ ì„ íƒí•´ì£¼ì„¸ìš”',
    fields:[
      {type:'slider', id:'mealSpeed', label:'ì‹ì‚¬ ì†ë„', min:1, max:5, val:3,
        leftLabel:'ğŸ¢ ì²œì²œíˆ', rightLabel:'âš¡ ë¹ ë¥´ê²Œ',
        labels:['ì •ë§ ì²œì²œíˆ ë¨¹ì–´ìš”','ì—¬ìœ ë¡­ê²Œ ë¨¹ì–´ìš”','ë³´í†µì´ì—ìš”','ë¹ ë¥¸ í¸ì´ì—ìš”','ì—„ì²­ ë¹ ë¥´ê²Œ']},
      {type:'multi-chip', id:'foodPref', label:'ì„ í˜¸ ìŒì‹ (ì—¬ëŸ¬ ê°œ ê°€ëŠ¥)', opts:[
        {v:'í•œì‹',l:'ğŸ¥˜ í•œì‹'},{v:'ë¶„ì‹/ë©´ë¥˜',l:'ğŸœ ë¶„ì‹/ë©´ë¥˜'},{v:'ê³ ê¸°/êµ¬ì´',l:'ğŸ¥© ê³ ê¸°/êµ¬ì´'},
        {v:'ì¼ì‹',l:'ğŸ£ ì¼ì‹'},{v:'ì–‘ì‹',l:'ğŸ ì–‘ì‹'},{v:'ì¤‘ì‹',l:'ğŸ¥Ÿ ì¤‘ì‹'},
        {v:'ê±´ê°•ì‹',l:'ğŸ¥— ê±´ê°•ì‹'},{v:'íŒ¨ìŠ¤íŠ¸í‘¸ë“œ',l:'ğŸ” íŒ¨ìŠ¤íŠ¸í‘¸ë“œ'},{v:'ë””ì €íŠ¸',l:'ğŸ§ ë””ì €íŠ¸'}
      ]},
    ]
  },
  {
    id:'s_vibe',
    badge:'STEP 03 Â· 5',
    icon:'âœ¨',
    title:'ì‹ì‚¬í•  ë•Œ<br><em>ì–´ë–¤ ë¶„ìœ„ê¸°</em>ë¥¼ ì¢‹ì•„í•´ìš”?',
    hint:'ê°€ì¥ ì˜ ë§ëŠ” ìŠ¤íƒ€ì¼ì„ ê³¨ë¼ì£¼ì„¸ìš”',
    fields:[
      {type:'card-opts', id:'talkAmt', label:'ì‹ì‚¬ ì¤‘ ëŒ€í™”ëŸ‰', opts:[
        {v:'ìˆ˜ë‹¤ê°€ ë©”ì¸',e:'ğŸ—£ï¸',l:'ìˆ˜ë‹¤ê°€ ë©”ì¸',d:'ë°¥ë³´ë‹¤ ì´ì•¼ê¸°ê°€ ë” ì¢‹ì•„ìš”'},
        {v:'ì ë‹¹íˆ ëŒ€í™”',e:'ğŸ˜Š',l:'ì ë‹¹íˆ ëŒ€í™”',d:'ë§› ì–˜ê¸°í•˜ë©´ì„œ í¸í•˜ê²Œ'},
        {v:'ë°¥ì— ì§‘ì¤‘',e:'ğŸ¯',l:'ë°¥ì— ì§‘ì¤‘',d:'ë¨¹ì„ ë• ë¨¹ì–´ì•¼ í•´ìš”!'},
        {v:'ìƒëŒ€ì— ë§ì¶¤',e:'ğŸ²',l:'ìƒëŒ€ì— ë§ì¶¤',d:'ìƒëŒ€ë°©ì—ê²Œ ë§ì¶°ìš”'},
      ]},
      {type:'card-opts', id:'placeType', label:'ì‹ì‚¬ ì¥ì†Œ ì„ í˜¸', opts:[
        {v:'ìœ ëª… ë§›ì§‘ íƒë°©',e:'â­',l:'ìœ ëª… ë§›ì§‘ íƒë°©',d:'ì¤„ ì„œë„ ê´œì°®ì•„ìš”'},
        {v:'ë™ë„¤ ë‹¨ê³¨ì§‘',e:'ğŸ ',l:'ë™ë„¤ ë‹¨ê³¨ì§‘',d:'í¸í•˜ê³  ìµìˆ™í•œ ê³³ì´ ìµœê³ '},
        {v:'ìƒˆë¡œìš´ ê³³ ë„ì „',e:'ğŸ—ºï¸',l:'ìƒˆë¡œìš´ ê³³ ë„ì „',d:'ëª¨í—˜ì„ ì¦ê²¨ìš”'},
        {v:'ë¶„ìœ„ê¸° ì¤‘ì‹œ',e:'âœ¨',l:'ë¶„ìœ„ê¸° ì¤‘ì‹œ',d:'ì¸í…Œë¦¬ì–´ë„ ì¤‘ìš”í•´ìš”'},
      ]},
    ]
  },
  {
    id:'s_habits',
    badge:'STEP 04 Â· 5',
    icon:'âš™ï¸',
    title:'ë‚˜ì˜ <em>ì‹ì‚¬ ìŠµê´€</em>ì„<br>ì²´í¬í•´ì£¼ì„¸ìš”',
    hint:'í•´ë‹¹í•˜ëŠ” ìª½ ë²„íŠ¼ì„ ëˆŒëŸ¬ì£¼ì„¸ìš”',
    fields:[
      {type:'toggles', id:'habits', items:[
        {key:'menu',  label:'ğŸ± ë©”ë‰´ ê²°ì •',     a:'ë‚´ê°€ ì •í•´ìš”', b:'ë”°ë¼ê°€ìš”'},
        {key:'pay',   label:'ğŸ’¸ ë°¥ê°’ ê³„ì‚°',     a:'ë”ì¹˜í˜ì´',   b:'ë²ˆê°ˆì•„ìš”'},
        {key:'leftover',label:'ğŸ¥¡ ë‚¨ì€ ìŒì‹',   a:'ë‚¨ê²¨ìš”',     b:'ë‹¤ ë¨¹ì–´ìš”'},
        {key:'photo', label:'ğŸ“¸ ìŒì‹ ì‚¬ì§„',     a:'ê¼­ ì°ì–´ìš”',  b:'ì•ˆ ì°ì–´ìš”'},
        {key:'spicy', label:'ğŸŒ¶ï¸ ë§¤ìš´ ìŒì‹',    a:'ì˜ ë¨¹ì–´ìš”',  b:'ëª» ë¨¹ì–´ìš”'},
        {key:'adventure',label:'ğŸŒ ìƒˆ ìŒì‹ ë„ì „',a:'ì¢‹ì•„í•´ìš”',   b:'ì‹«ì–´í•´ìš”'},
        {key:'timing',label:'â° ì‹ì‚¬ ì‹œê°„',     a:'ì‹œê°„ ë§ì¶°ìš”', b:'ë°°ê³ í”Œ ë•Œìš”'},
      ]}
    ]
  },
  {
    id:'s_ideal',
    badge:'STEP 05 Â· 5',
    icon:'ğŸ’‘',
    title:'ì›í•˜ëŠ” <em>ë°¥ë©”ì´íŠ¸</em>ëŠ”<br>ì–´ë–¤ ì‚¬ëŒì¸ê°€ìš”?',
    hint:'ì¤‘ìš”ë„ë¥¼ ë³„ì ìœ¼ë¡œ, ì›í•˜ëŠ” MBTIë„ ì„ íƒí•´ì£¼ì„¸ìš” (ì„ íƒ ì‚¬í•­)',
    fields:[
      {type:'stars', id:'stars', items:[
        {id:'speed',label:'ì‹ì‚¬ ì†ë„ê°€ ë¹„ìŠ·í•œ ê²ƒ'},
        {id:'food', label:'ìŒì‹ ì·¨í–¥ì´ ë§ëŠ” ê²ƒ'},
        {id:'talk', label:'ëŒ€í™”ê°€ ì˜ í†µí•˜ëŠ” ê²ƒ'},
        {id:'flex', label:'ë©”ë‰´ ì„ íƒì´ ìœ ì—°í•œ ê²ƒ'},
        {id:'clean',label:'ê¹”ë”í•˜ê²Œ ë¨¹ëŠ” ê²ƒ'},
      ]},
      {type:'mbti', id:'mateMbti', label:'ì›í•˜ëŠ” ë°¥ë©”ì´íŠ¸ MBTI', hint:'ì„ íƒ ì•ˆ í•´ë„ ë©ë‹ˆë‹¤', resultId:'mateMbtiRes',
        pairs:[['mEI','E â€” ì™¸í–¥í˜•','I â€” ë‚´í–¥í˜•'],['mSN','S â€” ê°ê°í˜•','N â€” ì§ê´€í˜•'],['mTF','T â€” ì‚¬ê³ í˜•','F â€” ê°ì •í˜•'],['mJP','J â€” íŒë‹¨í˜•','P â€” ì¸ì‹í˜•']]},
      {type:'textarea', id:'freeText', label:'ë°¥ë©”ì´íŠ¸ì—ê²Œ ë°”ë¼ëŠ” ì  (ììœ  ì„œìˆ )',
        placeholder:'ì˜ˆ: ë§›ì§‘ ì •ë³´ê°€ í’ë¶€í–ˆìœ¼ë©´ ì¢‹ê² ì–´ìš” / ë©”ë‰´ ê³ ë¥´ëŠ” ë° ì‹œê°„ì´ ì˜¤ë˜ ê±¸ë ¤ë„ ê¸°ë‹¤ë ¤ì¤˜ìš”...'}
    ]
  }
];

/* â”€â”€ State â”€â”€ */
const st = {
  gender:null, age:null,
  myMbti:{EI:null,SN:null,TF:null,JP:null},
  mateMbti:{mEI:null,mSN:null,mTF:null,mJP:null},
  foodPref:[],
  talkAmt:null, placeType:null,
  mealSpeed:3,
  habits:{menu:'ë‚´ê°€ ì •í•´ìš”',pay:'ë”ì¹˜í˜ì´',leftover:'ë‚¨ê²¨ìš”',photo:'ê¼­ ì°ì–´ìš”',spicy:'ì˜ ë¨¹ì–´ìš”',adventure:'ì¢‹ì•„í•´ìš”',timing:'ì‹œê°„ ë§ì¶°ìš”'},
  stars:{speed:3,food:3,talk:3,flex:3,clean:3},
  freeText:''
};

const SL=['ê´€ì‹¬ì—†ì–´ìš”','ì¡°ê¸ˆ ì¤‘ìš”','ì¤‘ìš”í•´ìš”','ë§¤ìš° ì¤‘ìš”','ìµœìš°ì„ !'];
const SE=['â­','â­â­','â­â­â­','â­â­â­â­','â­â­â­â­â­'];
const TOTAL = STEPS.length;

/* â•â• BUILD SLIDES â•â• */
function buildSlides(){
  const cont=document.getElementById('stepSlides');
  // hero dots
  const dots=document.getElementById('heroDots');
  for(let i=0;i<TOTAL;i++){const d=document.createElement('div');d.className='hero-dot';dots.appendChild(d);}

  STEPS.forEach((step,si)=>{
    const slide=document.createElement('div');
    slide.className='slide';slide.id='slide_'+si;
    let html=`<div class="slide-inner">
      <div class="sec-badge">${step.badge}</div>
      <span class="sec-icon-big">${step.icon}</span>
      <div class="sec-title">${step.title}</div>
      <div class="sec-hint">${step.hint}</div>`;

    step.fields.forEach(f=>{
      html+=buildField(f,si);
    });
    html+=`</div>`;
    slide.innerHTML=html;
    cont.appendChild(slide);
  });
}

function buildField(f, si){
  let h=`<div class="field" id="field_${f.id}">`;
  if(f.label) h+=`<div class="field-label">${f.label}</div>`;
  if(f.hint && f.type==='mbti') h+=`<div style="font-size:.73rem;color:var(--tl);margin-bottom:12px;">${f.hint}</div>`;

  if(f.type==='single-chip'){
    h+=`<div class="chip-grid" id="cg_${f.id}">`;
    f.opts.forEach(o=>{ h+=`<div class="chip" data-id="${f.id}" data-val="${o.v}">${o.l}</div>`; });
    h+=`</div>`;
  }
  else if(f.type==='multi-chip'){
    h+=`<div class="chip-grid" id="cg_${f.id}">`;
    f.opts.forEach(o=>{ h+=`<div class="chip multi" data-id="${f.id}" data-val="${o.v}">${o.l}</div>`; });
    h+=`</div>`;
  }
  else if(f.type==='card-opts'){
    h+=`<div class="card-options" id="co_${f.id}">`;
    f.opts.forEach(o=>{
      h+=`<div class="card-opt" data-id="${f.id}" data-val="${o.v}">
        <span class="co-emoji">${o.e}</span>
        <div class="co-label">${o.l}</div>
        <div class="co-desc">${o.d}</div>
      </div>`;
    });
    h+=`</div>`;
  }
  else if(f.type==='slider'){
    h+=`<div class="range-labels"><span>${f.leftLabel}</span><span>${f.rightLabel}</span></div>
    <div class="range-row">
      <input type="range" id="r_${f.id}" min="${f.min}" max="${f.max}" value="${f.val}"
        style="--pct:50%"
        oninput="onSlider(this,'rv_${f.id}',${JSON.stringify(f.labels).replace(/"/g,"'")})"/>
      <div class="range-val" id="rv_${f.id}">${f.labels[f.val-1]}</div>
    </div>`;
  }
  else if(f.type==='toggles'){
    h+=`<div class="toggle-rows" id="tg_${f.id}">`;
    f.items.forEach(it=>{
      h+=`<div class="toggle-row">
        <span class="toggle-lbl">${it.label}</span>
        <div class="toggle-sw">
          <button class="on" data-tgkey="${it.key}" data-tgv="${it.a}">${it.a}</button>
          <button data-tgkey="${it.key}" data-tgv="${it.b}">${it.b}</button>
        </div>
      </div>`;
    });
    h+=`</div>`;
  }
  else if(f.type==='stars'){
    f.items.forEach(item=>{
      h+=`<div class="star-block">
        <div class="star-block-label">${item.label}</div>
        <div class="star-row" id="sr_${item.id}">
          ${SL.map((l,i)=>`<div class="star-item${i===2?' sel':''}" data-stid="${item.id}" data-sv="${i+1}">
            <div class="s-emoji">${SE[i]}</div>
            <div class="s-label">${l}</div>
          </div>`).join('')}
        </div>
      </div>`;
    });
  }
  else if(f.type==='mbti'){
    h+=`<div id="mb_${f.id}">`;
    f.pairs.forEach(([g,la,lb])=>{
      h+=`<div class="mbti-pair">
        <div class="mbti-btn" data-mbid="${f.id}" data-g="${g}" data-v="${la[0]}">${la}</div>
        <div class="mbti-btn" data-mbid="${f.id}" data-g="${g}" data-v="${lb[0]}">${lb}</div>
      </div>`;
    });
    h+=`</div>
    <div class="mbti-result" id="${f.resultId}">
      <span style="color:var(--tl);font-size:.82rem;font-weight:400;">ì„ íƒí•˜ë©´ ì—¬ê¸°ì— í‘œì‹œë©ë‹ˆë‹¤</span>
    </div>`;
  }
  else if(f.type==='textarea'){
    h+=`<textarea class="free-input" id="ta_${f.id}" rows="4" placeholder="${f.placeholder}"
      oninput="st.freeText=this.value.slice(0,200);document.getElementById('cc_${f.id}').textContent=Math.min(this.value.length,200)"></textarea>
      <div class="char-count"><span id="cc_${f.id}">0</span>/200ì</div>`;
  }

  h+=`</div>`;
  return h;
}

/* â”€â”€ Attach events (after DOM built) â”€â”€ */
function attachEvents(){
  // Single chips
  document.querySelectorAll('.chip:not(.multi)').forEach(c=>{
    c.addEventListener('click',()=>{
      const id=c.dataset.id;
      document.querySelectorAll(`.chip:not(.multi)[data-id="${id}"]`).forEach(x=>x.classList.remove('sel'));
      c.classList.add('sel');
      st[id]=c.dataset.val;
    });
  });
  // Multi chips
  document.querySelectorAll('.chip.multi').forEach(c=>{
    c.addEventListener('click',()=>{
      c.classList.toggle('sel');
      const id=c.dataset.id;
      st[id]=[...document.querySelectorAll(`.chip.multi[data-id="${id}"].sel`)].map(x=>x.dataset.val);
    });
  });
  // Card opts
  document.querySelectorAll('.card-opt').forEach(c=>{
    c.addEventListener('click',()=>{
      const id=c.dataset.id;
      document.querySelectorAll(`.card-opt[data-id="${id}"]`).forEach(x=>x.classList.remove('sel'));
      c.classList.add('sel');
      st[id]=c.dataset.val;
    });
  });
  // Toggles
  document.querySelectorAll('.toggle-sw button').forEach(btn=>{
    btn.addEventListener('click',()=>{
      btn.parentElement.querySelectorAll('button').forEach(b=>b.classList.remove('on'));
      btn.classList.add('on');
      st.habits[btn.dataset.tgkey]=btn.dataset.tgv;
    });
  });
  // Stars
  document.querySelectorAll('.star-item').forEach(item=>{
    item.addEventListener('click',()=>{
      const sid=item.dataset.stid;
      document.querySelectorAll(`.star-item[data-stid="${sid}"]`).forEach(x=>x.classList.remove('sel'));
      item.classList.add('sel');
      st.stars[sid]=parseInt(item.dataset.sv);
    });
  });
  // MBTI
  document.querySelectorAll('.mbti-btn').forEach(btn=>{
    btn.addEventListener('click',()=>{
      const mbid=btn.dataset.mbid, g=btn.dataset.g, v=btn.dataset.v;
      document.querySelectorAll(`.mbti-btn[data-mbid="${mbid}"][data-g="${g}"]`).forEach(x=>x.classList.remove('sel'));
      btn.classList.add('sel');
      const isMyMbti=(mbid==='myMbti');
      const obj=isMyMbti?st.myMbti:st.mateMbti;
      obj[g]=v;
      // update result display
      const step=STEPS.find(s=>s.fields.some(f=>f.id===mbid));
      if(!step)return;
      const fld=step.fields.find(f=>f.id===mbid);
      const vals=fld.pairs.map(([pg])=>obj[pg]);
      const el=document.getElementById(fld.resultId);
      if(vals.every(Boolean)){
        el.innerHTML=`<span style="font-size:1.2rem">ğŸ¯</span><span style="font-size:1.1rem;font-weight:900;color:var(--o)">${vals.join('')}</span>`;
      } else {
        el.innerHTML=`<span style="color:var(--tl);font-size:.82rem;font-weight:400;">${vals.filter(Boolean).length}/4 ì„ íƒë¨</span>`;
      }
    });
  });
}

/* â”€â”€ Slider â”€â”€ */
function onSlider(el,valId,labels){
  const v=parseInt(el.value),pct=((v-el.min)/(el.max-el.min))*100;
  el.style.setProperty('--pct',pct+'%');
  document.getElementById(valId).textContent=labels[v-1];
  st.mealSpeed=v;
}

/* â•â• NAVIGATION â•â• */
let curStep=-1; // -1 = hero

function startSteps(){
  document.getElementById('heroSlide').style.opacity='0';
  document.getElementById('heroSlide').style.transform='translateX(-60px)';
  document.getElementById('heroSlide').style.pointerEvents='none';
  setTimeout(()=>{ document.getElementById('heroSlide').style.display='none'; },400);
  document.getElementById('stepLabel').style.display='flex';
  document.getElementById('bottomNav').style.display='block';
  curStep=0;
  showStep(0,true);
}

function showStep(idx, forward=true){
  const incoming = document.getElementById('slide_'+idx);
  if(!incoming) return;

  // 1) ë“¤ì–´ì˜¬ ìŠ¬ë¼ì´ë“œë¥¼ í™”ë©´ ë°– ëŒ€ê¸° ìœ„ì¹˜ì— ì„¸íŒ… (transition ì—†ì´)
  incoming.style.transition = 'none';
  incoming.style.opacity    = '0';
  incoming.style.transform  = forward ? 'translateX(60px)' : 'translateX(-60px)';
  incoming.style.pointerEvents = 'none';

  // 2) ë¸Œë¼ìš°ì €ê°€ ì´ˆê¸° ìœ„ì¹˜ë¥¼ ì¸ì‹í•˜ë„ë¡ ê°•ì œ reflow
  incoming.getBoundingClientRect();

  // 3) transition ë‹¤ì‹œ ì¼œê³  active ìœ„ì¹˜ë¡œ ì´ë™
  incoming.style.transition = '';
  incoming.style.opacity    = '1';
  incoming.style.transform  = 'translateX(0)';
  incoming.style.pointerEvents = 'all';
  incoming.scrollTop = 0;

  // top bar / step text / back btn / next btn
  document.getElementById('topFill').style.width = ((idx+1)/TOTAL*100)+'%';
  document.getElementById('stepText').textContent = `${idx+1} / ${TOTAL}`;
  const bb = document.getElementById('backBtn');
  idx > 0 ? bb.classList.remove('hidden') : bb.classList.add('hidden');
  const nb = document.getElementById('nextBtn');
  nb.textContent = idx === TOTAL-1 ? 'ğŸ½ï¸ ë¶„ì„ ì‹œì‘í•˜ê¸°' : 'ë‹¤ìŒ â†’';
  nb.disabled = false;

  curStep = idx;
}

function nextStep(){
  if(curStep < TOTAL-1){
    const cur = document.getElementById('slide_'+curStep);
    // í˜„ì¬ ìŠ¬ë¼ì´ë“œ ì™¼ìª½ìœ¼ë¡œ í‡´ì¥
    cur.style.opacity   = '0';
    cur.style.transform = 'translateX(-60px)';
    cur.style.pointerEvents = 'none';
    showStep(curStep+1, true);
  } else {
    submitForm();
  }
}

function prevStep(){
  if(curStep <= 0) return;
  const cur = document.getElementById('slide_'+curStep);
  // í˜„ì¬ ìŠ¬ë¼ì´ë“œ ì˜¤ë¥¸ìª½ìœ¼ë¡œ í‡´ì¥
  cur.style.opacity   = '0';
  cur.style.transform = 'translateX(60px)';
  cur.style.pointerEvents = 'none';
  showStep(curStep-1, false);
}

/* â”€â”€ MBTI string helper â”€â”€ */
function mbtiStr(obj){
  const vals=Object.values(obj);
  return vals.every(Boolean)?vals.join(''):(vals.filter(Boolean).join('')||'ë¯¸ì„ íƒ');
}

/* â•â• SUBMIT â•â• */
async function submitForm(){
  // hide form UI
  document.getElementById('slide_'+(TOTAL-1)).classList.remove('active');
  document.getElementById('bottomNav').style.display='none';
  document.getElementById('stepLabel').style.display='none';
  document.getElementById('topBar').style.display='none';
  document.getElementById('loadSlide').style.display='flex';
  document.getElementById('errBox').style.display='none';

  const SL2=['ê´€ì‹¬ì—†ì–´ìš”','ì¡°ê¸ˆ ì¤‘ìš”','ì¤‘ìš”í•´ìš”','ë§¤ìš° ì¤‘ìš”','ìµœìš°ì„ !'];
  const SITEMS=['speed','food','talk','flex','clean'];
  const SLABELS=['ì‹ì‚¬ ì†ë„ ë¹„ìŠ·','ìŒì‹ ì·¨í–¥ ë§ìŒ','ëŒ€í™” ì˜ í†µí•¨','ë©”ë‰´ ì„ íƒ ìœ ì—°','ê¹”ë”í•˜ê²Œ ë¨¹ìŒ'];
  const starDesc=SITEMS.map((id,i)=>`${SLABELS[i]}: ${SL2[st.stars[id]-1]}`).join(', ');
  const spLab=['ì •ë§ ì²œì²œíˆ','ì—¬ìœ ë¡­ê²Œ','ë³´í†µ','ë¹ ë¥¸ í¸','ì—„ì²­ ë¹ ë¥´ê²Œ'];

  const prompt=`ë‹¹ì‹ ì€ "ë°¥ë©”ì´íŠ¸ ê¶í•© ë¶„ì„ ì „ë¬¸ê°€"ì…ë‹ˆë‹¤. ì•„ë˜ ì •ë³´ë¥¼ ë¶„ì„í•´ ì˜ ì–´ìš¸ë¦¬ëŠ” ë°¥ë©”ì´íŠ¸ ìœ í˜•ì„ ì•Œë ¤ì£¼ì„¸ìš”.

[ì‚¬ìš©ì ì •ë³´]
- ì„±ë³„: ${st.gender||'ë¯¸ì„ íƒ'} / ì—°ë ¹ëŒ€: ${st.age||'ë¯¸ì„ íƒ'}
- ë‚˜ì˜ MBTI: ${mbtiStr(st.myMbti)}
- ì‹ì‚¬ ì†ë„: ${spLab[st.mealSpeed-1]}
- ì„ í˜¸ ìŒì‹: ${st.foodPref.join(', ')||'ë¯¸ì„ íƒ'}
- ëŒ€í™”ëŸ‰: ${st.talkAmt||'ë¯¸ì„ íƒ'}
- ì‹ì‚¬ ì¥ì†Œ: ${st.placeType||'ë¯¸ì„ íƒ'}
- ì‹ì‚¬ ìŠµê´€: ${Object.values(st.habits).join(', ')}
- ë°¥ë©”ì´íŠ¸ì—ê²Œ ì¤‘ìš”í•œ ê²ƒ: ${starDesc}
- ì›í•˜ëŠ” ë°¥ë©”ì´íŠ¸ MBTI: ${mbtiStr(st.mateMbti)}
- ììœ  ì„œìˆ : ${st.freeText||'ì—†ìŒ'}

JSONë§Œ ë°˜í™˜ (ë‹¤ë¥¸ í…ìŠ¤íŠ¸ ì—†ì´):
{"mate_name":"ìœ í˜•ëª…(ì°½ì˜ì )","mate_emoji":"ì´ëª¨ì§€2~3ê°œ","mate_subtitle":"í•œì¤„ ë¶€ì œ","overall_score":85,"analysis":"ì˜ ì–´ìš¸ë¦¬ëŠ” ì´ìœ  3~4ë¬¸ì¥","perfect_scene":"ì™„ë²½í•œ ì‹ì‚¬ ì¥ë©´ 2ë¬¸ì¥","compatibility":[{"label":"ì‹ì‚¬ ì†ë„ ê¶í•©","score":88},{"label":"ìŒì‹ ì·¨í–¥ ì¼€ë¯¸","score":82},{"label":"ëŒ€í™” & ë¶„ìœ„ê¸°","score":90},{"label":"ë©”ë‰´ ê²°ì •ë ¥","score":75}],"recommended_foods":["ìŒì‹1","ìŒì‹2","ìŒì‹3","ìŒì‹4","ìŒì‹5"],"best_restaurants":["ì‹ë‹¹ìœ í˜•1","ì‹ë‹¹ìœ í˜•2","ì‹ë‹¹ìœ í˜•3"],"tip":"ê¿€íŒ í•œ ë¬¸ì¥","warning":"ì£¼ì˜ì‚¬í•­ í•œ ë¬¸ì¥"}`;

  try{
    const res=await fetch(
      `https://generativelanguage.googleapis.com/v1beta/models/gemini-2.5-flash:generateContent?key=${API_KEY}`,
      {method:'POST',headers:{'Content-Type':'application/json'},
       body:JSON.stringify({contents:[{parts:[{text:prompt}]}],generationConfig:{responseMimeType:'application/json'}})}
    );
    if(!res.ok){const e=await res.json();throw new Error(e.error?.message||'API ì˜¤ë¥˜');}
    const data=await res.json();
    let raw=data.candidates[0].content.parts[0].text.replace(/```json|```/g,'').trim();
    showResult(JSON.parse(raw));
  }catch(e){
    document.getElementById('loadSlide').style.display='none';
    document.getElementById('slide_'+(TOTAL-1)).classList.add('active');
    document.getElementById('bottomNav').style.display='block';
    document.getElementById('stepLabel').style.display='flex';
    document.getElementById('topBar').style.display='block';
    document.getElementById('errBox').style.display='block';
    document.getElementById('errMsg').textContent='âŒ '+e.message;
  }
}

/* â•â• RESULT â•â• */
function showResult(r){
  document.getElementById('loadSlide').style.display='none';
  document.getElementById('resultSlide').style.display='block';

  document.getElementById('rTitle').textContent=`ë‹¹ì‹ ì˜ ë°¥ë©”ì´íŠ¸ëŠ” "${r.mate_name}"!`;
  document.getElementById('rSub').textContent=r.mate_subtitle;

  document.getElementById('rC1').innerHTML=`
    <div style="display:flex;flex-direction:column;align-items:center;text-align:center;gap:16px;">
      <span style="font-size:3.6rem;line-height:1;">${r.mate_emoji}</span>
      <div>
        <div style="font-family:'Noto Serif KR',serif;font-size:1.35rem;font-weight:900;color:var(--o);margin-bottom:4px;">${r.mate_name}</div>
        <div style="font-size:13px;color:var(--tl);">${r.mate_subtitle}</div>
      </div>
      <div>
        <div class="score-circle" style="--s:${r.overall_score};"><div class="score-num">${r.overall_score}</div></div>
        <div class="score-lbl" style="margin-top:6px;">ë°¥ë©”ì´íŠ¸ ê¶í•© ì ìˆ˜</div>
      </div>
    </div>`;

  document.getElementById('rC2').innerHTML=`
    <div class="rc-label">ğŸ” ê¶í•© ë¶„ì„</div>
    <p class="ana-p">${r.analysis}</p>
    <div class="divider"></div>
    <div class="rc-label">ğŸ¬ ì™„ë²½í•œ ì‹ì‚¬ ì¥ë©´</div>
    <p class="ana-p">${r.perfect_scene}</p>`;

  document.getElementById('rC3').innerHTML=`
    <div class="rc-label">ğŸ“Š ì„¸ë¶€ ê¶í•© ì ìˆ˜</div>
    ${r.compatibility.map(c=>`<div class="bar-item">
      <div class="bar-head"><span>${c.label}</span><span>${c.score}%</span></div>
      <div class="bar-track"><div class="bar-fill" data-s="${c.score}"></div></div>
    </div>`).join('')}`;

  document.getElementById('rC4').innerHTML=`
    <div class="rc-label">ğŸ½ï¸ í•¨ê»˜í•˜ë©´ ì¢‹ì€ ìŒì‹</div>
    <div class="tag-row">${r.recommended_foods.map(f=>`<span class="tag">ğŸ´ ${f}</span>`).join('')}</div>
    <div class="divider"></div>
    <div class="rc-label">ğŸ—ºï¸ ì–´ìš¸ë¦¬ëŠ” ì‹ë‹¹ ìœ í˜•</div>
    <div class="tag-row">${r.best_restaurants.map(f=>`<span class="tag">ğŸ“ ${f}</span>`).join('')}</div>`;

  document.getElementById('rC5').innerHTML=`
    <div class="rc-label">ğŸ’¡ ê¿€íŒ & ì£¼ì˜ì‚¬í•­</div>
    <div class="tip-box">âœ… <b>ê¿€íŒ:</b> ${r.tip}</div>
    <div class="tip-box" style="background:linear-gradient(135deg,#FFF5F5,#FFF0F0);border-color:rgba(217,64,64,.3);margin-top:9px;">âš ï¸ <b>ì£¼ì˜:</b> ${r.warning}</div>`;

  setTimeout(()=>{
    document.querySelectorAll('.bar-fill').forEach(b=>{ b.style.width=b.dataset.s+'%'; });
  },300);
}

function restart(){ location.reload(); }

/* â•â• INIT â•â• */
buildSlides();
attachEvents();
</script>
</body>
</html>